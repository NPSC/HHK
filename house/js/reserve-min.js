/* 
 * The MIT License
 *
 * Copyright 2017 Eric.
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
function PageManager(e){function t(){function e(e){return!1===t(e)&&(i[e[a]]=e,!0)}function t(e){return void 0!==i[e[a]]}var a,i={},s=this;s.hasItem=t,s.findItem=function(e,t){for(var a in i)if(i[a][e]==t)return i[a];return null},s.addItem=e,s.removeIndex=function(e){delete i[e]},s.list=function(){return i},s.makeList=function(t,s){a=s,i={};for(var r in t)e(t[r])},s._list=i}function a(e){var t=$("#xform");if(t.children("input").remove(),t.prop("action",e.xfer),e.paymentId&&""!=e.paymentId)t.append($('<input type="hidden" name="PaymentID" value="'+e.paymentId+'"/>'));else{if(!e.cardId||""==e.cardId)return void flagAlertMessage("PaymentId and CardId are missing!",!0);t.append($('<input type="hidden" name="CardID" value="'+e.cardId+'"/>'))}t.submit()}function i(e,t,a){"use strict";var i={};t.empty().append($(e.resvChooser)).children().find("input:button").button(),t.children().find(".hhk-checkinNow").click(function(){window.open("CheckIn.php?rid="+$(this).data("rid")+"&gid="+e.id,"_self")}),e.psgChooser&&""!==e.psgChooser&&(i[e.patLabel+" Chooser"]=function(){$(this).dialog("close"),s(e,a)}),e.resvTitle&&(i["New "+e.resvTitle]=function(){e.rid=-1,e.cmd="getResv",$(this).dialog("close"),r(e)}),i.Exit=function(){$(this).dialog("close"),$("div#guestSearch").show(),$("#gstSearch").val("").focus()},t.dialog("option","buttons",i),t.dialog("option","title",e.resvTitle),t.dialog("open")}function s(e,t){"use strict";t.empty().append($(e.psgChooser)).dialog("option","buttons",{Open:function(){$(this).dialog("close"),r({idPsg:t.find("input[name=cbselpsg]:checked").val(),id:e.id,cmd:"getResv"})},Cancel:function(){$(this).dialog("close"),$("div#guestSearch").show(),$("#gstSearch").val("").focus()}}).dialog("option","title",e.patLabel+" Chooser For: "+e.fullName).dialog("open")}function r(e){$.post("ws_resv.php",{id:e.id,rid:e.rid,idPsg:e.idPsg,cmd:e.cmd},function(e){try{e=$.parseJSON(e)}catch(e){return void flagAlertMessage(e.message,!0)}e.gotopage&&window.open(e.gotopage,"_self"),e.error&&(flagAlertMessage(e.error,!0),$("#btnDone").val("Save").show()),n(e)}),$("div#guestSearch").hide()}function n(e){e.xfer&&a(e),e.resvChooser&&""!==e.resvChooser?i(e,$("#resDialog"),$("#psgDialog")):e.psgChooser&&""!==e.psgChooser?s(e,$("#psgDialog")):(e.idPsg&&(o.idPsg=e.idPsg),e.id&&(o.idName=e.id),e.rid&&(o.idResv=e.rid),e.famSection&&(C.makeList(e.famSection.mem,"pref"),y.makeList(e.famSection.addrs,"pref"),b.setUp(e),$("#btnDone").val("Save Family").show()),void 0!==e.hosp&&w.setUp(e.hosp),void 0!==e.expDates&&""!==e.expDates&&x.setUp(e.expDates),void 0!==e.resv&&(k.setUp(e),$("#"+b.divFamDetailId).on("change",".hhk-cbStay",function(){var e=b.findStaysChecked();k.$totalGuests.text(e),e>0?k.$totalGuests.parent().removeClass("ui-state-highlight"):k.$totalGuests.parent().addClass("ui-state-highlight")}),$(".hhk-getVDialog").button(),$("#"+b.divFamDetailId).on("click",".hhk-getVDialog",function(){var e,t=$(this).data("vid"),a=$(this).data("span");e={"Show Statement":function(){window.open("ShowStatement.php?vid="+t,"_blank")},"Show Registration Form":function(){window.open("ShowRegForm.php?vid="+t,"_blank")},Save:function(){saveFees(0,t,a,!1,payFailPage)},Cancel:function(){$(this).dialog("close")}},viewVisit(0,t,e,"Edit Visit #"+t+"-"+a,"",a),$("#submitButtons").hide()}),$("#famSection.hhk-cbStay").change(),$("#btnDone").val("Save "+l).show(),e.rid>0&&($("#btnDelete").val("Delete "+l).show(),$("#btnShowReg").show())),void 0!==e.addPerson&&($("input#txtPersonSearch").val(""),C.addItem(e.addPerson.mem)&&(y.addItem(e.addPerson.addrs),b.newGuestMarkup(e.addPerson,e.addPerson.mem.pref),b.findStaysChecked(),$("#"+e.addPerson.mem.pref+"txtFirstName").focus())))}var o=this,d=e.patLabel,l=e.resvTitle,c=e.patBD,h=e.patAddr,p=e.gstAddr,u=e.patAsGuest,f=e.addrPurpose,v=e.idPsg,g=e.rid,m=e.id,C=new t,y=new t,b=new function(e){function t(){var e=0;return $(".hhk-cbStay").each(function(){var t=$(this).data("prefix");$(this).prop("checked")?(C.list()[t].stay="1",e++):C.list()[t].stay="0"}),e}function a(){var e=$("input[type=radio][name=rbPriGuest]:checked").val();for(var t in C.list())C.list()[t].pri="0";void 0!==e&&(C.list()[e].pri="1")}function i(e){var t=$("#divfamDetail");!0===e?(t.show("blind"),t.prev("div").removeClass("ui-corner-all").addClass("ui-corner-top")):(t.hide("blind"),t.prev("div").addClass("ui-corner-all").removeClass("ui-corner-top"))}function s(e,t){hideAlertMessage(),void 0===e.No_Return||""===e.No_Return?void 0!==e.id&&(e.id>0&&null!==C.findItem("id",e.id)?flagAlertMessage("This person is already listed here. ",!0):r({id:e.id,rid:t.rid,idPsg:t.idPsg,cmd:"addThinGuest"})):flagAlertMessage("This person is set for No Return: "+e.No_Return+".",!0)}function n(e){var t=/^([\(]{1}[0-9]{3}[\)]{1}[\.| |\-]{0,1}|^[0-9]{3}[\.|\-| ]?)?[0-9]{3}(\.|\-| )?[0-9]{4}$/,a=!1;return $("#"+e+"incomplete").length>0&&!1===$("#"+e+"incomplete").prop("checked")&&($("."+e+"hhk-addr-val").each(function(){""!==$(this).val()||$(this).hasClass("bfh-states")?$(this).removeClass("ui-state-error"):($(this).addClass("ui-state-error"),a=!0)}),a)?($("#"+e+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+e+"toggleAddr").click(),"Some or all of the indicated addresses are missing.  "):($('.hhk-phoneInput[id^="'+e+'txtPhone"]').each(function(){""!==$.trim($(this).val())&&!1===t.test($(this).val())?($(this).addClass("ui-state-error"),$("#"+e+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+e+"toggleAddr").click(),$("#"+e+"phEmlTabs").tabs("option","active",1),a=!0):$(this).removeClass("ui-state-error")}),a?"Indicated phone numbers are invalid.  ":"")}function o(e){for(var t in y.list())if(t!==w[e]){if(""!==y.list()[t].Address_1){w[e]=t,$("#"+e+"adraddress1"+f).val(y.list()[t].Address_1),$("#"+e+"adraddress2"+f).val(y.list()[t].Address_2),$("#"+e+"adrcity"+f).val(y.list()[t].City),$("#"+e+"adrcounty"+f).val(y.list()[t].County),$("#"+e+"adrcountry"+f).val(y.list()[t].Country_Code),$("#"+e+"adrcountry"+f).change(),$("#"+e+"adrstate"+f).val(y.list()[t].State_Province),$("#"+e+"adrzip"+f).val(y.list()[t].Postal_Code),""!==$("#"+e+"adraddress1"+f).val()&&""!==$("#"+e+"adrcity"+f).val()&&!0===$("#"+e+"incomplete").prop("checked")&&$("#"+e+"incomplete").prop("checked",!1),g($("#"+e+"liaddrflag"));break}}else w[e]=0}function l(e){$("#"+e+"adraddress1"+f).val(""),$("#"+e+"adraddress2"+f).val(""),$("#"+e+"adrcity"+f).val(""),$("#"+e+"adrcounty"+f).val(""),$("#"+e+"adrstate"+f).val(""),$("#"+e+"adrcountry"+f).val(""),$("#"+e+"adrzip"+f).val(""),g($("#"+e+"liaddrflag"))}function v(e){void 0!==e&&(y.list()[e].Address_1=$("#"+e+"adraddress1"+f).val(),y.list()[e].Address_2=$("#"+e+"adraddress2"+f).val(),y.list()[e].City=$("#"+e+"adrcity"+f).val(),y.list()[e].County=$("#"+e+"adrcounty"+f).val(),y.list()[e].State_Province=$("#"+e+"adrstate"+f).val(),y.list()[e].Country_Code=$("#"+e+"adrcountry"+f).val(),y.list()[e].Postal_Code=$("#"+e+"adrzip"+f).val(),g($("#"+e+"liaddrflag")))}function g(e){var t=e.parents("ul").data("pref");!0===$("#"+t+"incomplete").prop("checked")?(e.show().find("span").removeClass("ui-icon-alert").addClass("ui-icon-check").attr("title","Incomplete Address is checked"),e.removeClass("ui-state-error").addClass("ui-state-highlight")):""===$("#"+t+"adraddress1"+f).val()||""===$("#"+t+"adrcity"+f).val()?(e.show().find("span").removeClass("ui-icon-check").addClass("ui-icon-alert").attr("title","Address is Incomplete"),e.removeClass("ui-state-highlightui-state-error").addClass("ui-state-error")):e.hide()}function m(t){var a,i,s;(a=$("<div/>").addClass("ui-widget-content ui-corner-bottom hhk-tdbox").prop("id",k).css("padding","5px")).append($("<table/>").prop("id",t.famSection.tblId).addClass("hhk-table").append($("<thead/>").append($(t.famSection.tblHead))).append($("<tbody/>"))).append($(t.famSection.adtnl)),s=$("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='f_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),(i=$('<div id="divfamHdr" style="padding:2px; cursor:pointer;"/>').append($(t.famSection.hdr)).append(s).append('<div style="clear:both;"/>')).addClass("ui-widget-header ui-state-default ui-corner-top"),i.click(function(){"none"===a.css("display")?(a.show("blind"),i.removeClass("ui-corner-all").addClass("ui-corner-top")):(a.hide("blind"),i.removeClass("ui-corner-top").addClass("ui-corner-all"))}),e.empty().append(i).append(a).show()}var b=this,k="divfamDetail",w=[];b.findStaysChecked=t,b.findPrimaryGuest=a,b.setupComplete=!1,b.setUp=function(t){var a,i,r;if(void 0!==t.famSection&&void 0!==t.famSection.tblId&&""!=t.famSection.tblId){m(t),r=e.find("#"+t.famSection.tblId);for(var n=0;n<t.famSection.tblBody.length;n++)r.find("tbody:first").append($(t.famSection.tblBody[n]));$("#lnCopy").click(function(){var e=$("input.hhk-lastname").first().val();$("input.hhk-lastname").each(function(){""===$(this).val()&&$(this).val(e)})}),$(".hhk-cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),$(".hhk-lblStay").each(function(){"1"==$(this).data("stay")&&$(this).click()}),$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,maxDate:0,dateFormat:"M d, yy"}),$("#"+k).on("click",".hhk-togAddr, .hhk-AddrFlag",function(){$(this).hasClass("hhk-togAddr")?(a=$(this),i=$(this).siblings()):(i=$(this),a=$(this).siblings()),"none"===$(this).parents("tr").next("tr").css("display")?($(this).parents("tr").next("tr").show(),a.find("span").removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"),a.attr("title","Hide Address Section")):($(this).parents("tr").next("tr").hide(),a.find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),a.attr("title","Show Address Section")),g(i)}),$(".hhk-togAddr").click(),$(".hhk-addrPanel").find("select.bfh-countries").each(function(){var e=$(this);e.bfhcountries(e.data())}),$(".hhk-addrPanel").find("select.bfh-states").each(function(){var e=$(this);e.bfhstates(e.data())}),$(".hhk-addrPanel").on("change","input, select",function(){v($(this).data("pref"))}),$(".hhk-phemtabs").tabs(),$("#"+k).on("click",".hhk-addrCopy",function(){o($(this).attr("name"))}),$("#"+k).on("click",".hhk-addrErase",function(){l($(this).attr("name"))}),$("#"+k).on("click",".hhk-incompleteAddr",function(){g($("#"+$(this).data("prefix")+"liaddrflag"))}),verifyAddrs("#divfamDetail"),$("input.hhk-zipsearch").each(function(){createZipAutoComplete($(this),"ws_admin.php",void 0)}),$(".hhk-removeBtn").button(),$("#"+k).on("click",".hhk-removeBtn",function(){(""===$("#"+$(this).data("prefix")+"txtFirstName").val()&&""===$("#"+$(this).data("prefix")+"txtLastName").val()||!1!==confirm("Remove this person: "+$("#"+$(this).data("prefix")+"txtFirstName").val()+" "+$("#"+$(this).data("prefix")+"txtLastName").val()+"?"))&&($(this).parentsUntil("tbody","tr").next().remove(),$(this).parentsUntil("tbody","tr").remove(),delete C._list[$(this).data("prefix")],delete y._list[$(this).data("prefix")])}),$("#"+k).on("change",".patientRelch",function(){"slf"===$(this).val()?(C.list()[$(this).data("prefix")].role="p",!1===u&&$("#"+$(this).data("prefix")+"lblStay").parent("td").empty()):C.list()[$(this).data("prefix")].role="g"}),createAutoComplete($("#txtPersonSearch"),3,{cmd:"role",gp:"1"},function(e){s(e,t)}),n.setupComplete=!0}},b.newGuestMarkup=function(t,a){var i,s,r,n;void 0!==t.tblId&&""!=t.tblId&&0!==(r=e.find("#"+t.tblId)).length&&(n=r.children("tbody").children("tr").last().hasClass("odd")?"even":"odd",r.find("tbody:first").append($(t.ntr).addClass(n)).append($(t.atr).addClass(n)),$("#"+a+"cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),"1"===$("#"+a+"lblStay").data("stay")&&$("#"+a+"lblStay").click(),$(".hhk-removeBtn").button(),$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,maxDate:0,dateFormat:"M d, yy"}),g($("#"+a+"liaddrflag")),(i=$("#"+a+"adrcountry"+f)).bfhcountries(i.data()),(s=$("#"+a+"adrstate"+f)).bfhstates(s.data()),$("#"+a+"phEmlTabs").tabs(),$("input#"+a+"adrzip1").each(function(){createZipAutoComplete($(this),"ws_admin.php",void 0)}))},b.verify=function(){var s=0,r=0,o=0,l=0,u=!1;$(".patientRelch").removeClass("ui-state-error"),$(".patientRelch").each(function(){if(""===$(this).val())return $(this).addClass("ui-state-error"),flagAlertMessage("Set the highlighted Relationship.",!0),!1}),a(),t();for(var f in C.list())s++,"p"===C.list()[f].role&&r++,"1"===C.list()[f].stay&&o++,"1"===C.list()[f].pri&&l++,$("#"+f+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-n")&&$("#"+f+"toggleAddr").click();if(r<1)return flagAlertMessage("Choose a "+d+".",!0),$(".patientRelch").addClass("ui-state-error"),!1;if(r>1){flagAlertMessage("Only 1 "+d+" is allowed.",!0);for(var f in C.list())"p"===C.list()[f].role&&$("#"+f+"selPatRel").addClass("ui-state-error");return!1}if(o<1)return flagAlertMessage("There is no one actually staying.  Pick someone to stay.",!0),!1;if(0===l&&1===s)for(var f in C.list())C.list()[f].pri="1";else if(0===l)return flagAlertMessage("Set one guest as primary guest.",!0),!1;if(e.find(".hhk-lastname").each(function(){""==$(this).val()?($(this).addClass("ui-state-error"),u=!0):$(this).removeClass("ui-state-error")}),e.find(".hhk-firstname").each(function(){""==$(this).val()?($(this).addClass("ui-state-error"),u=!0):$(this).removeClass("ui-state-error")}),!0===u)return i(!0),flagAlertMessage("Enter a first and last name for the people highlighted.",!0),!1;for(var v in C.list()){if("p"===C.list()[v].role){if(c&""===$("#"+v+"txtBirthDate").val())return $("#"+v+"txtBirthDate").addClass("ui-state-error"),flagAlertMessage(d+" is missing the Birth Date.",!0),i(!0),!1;if($("#"+v+"txtBirthDate").removeClass("ui-state-error"),h&&""!==(g=n(v)))return flagAlertMessage(g,!0),i(!0),$("#"+v+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+v+"toggleAddr").click(),!1}else{if(""===$("#"+v+"selPatRel").val())return $("#"+v+"selPatRel").addClass("ui-state-error"),flagAlertMessage("Person highlighted is missing their "+d+" Relationship.",!0),i(!0),!1;if($("#"+v+"selPatRel").removeClass("ui-state-error"),p){var g=n(v);if(""!==g)return flagAlertMessage(g,!0),i(!0),$("#"+v+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+v+"toggleAddr").click(),!1}}if($("#"+v+"txtBirthDate").length>0&&""!==$("#"+v+"txtBirthDate").val()){if(new Date($("#"+v+"txtBirthDate").val())>new Date)return $("#"+v+"txtBirthDate").addClass("ui-state-error"),flagAlertMessage("This birth date cannot be in the future.",!0),i(!0),!1;$("#"+v+"txtBirthDate").removeClass("ui-state-error")}}return!0},b.divFamDetailId=k}($("#famSection")),k=new function(e){function t(e){var t=1,a=e.find("#cbNoVehicle"),i=e.find("#btnNextVeh"),s=e.find("#tblVehicle");a.change(function(){this.checked?s.hide("scale, horizontal"):s.show("scale, horizontal")}),a.change(),i.button(),i.click(function(){e.find("#trVeh"+t).show("fade"),++t>4&&i.hide("fade")})}function a(t){var a={},i=e.find("#btnFapp");i.length>0&&($("#faDialog").dialog({autoOpen:!1,resizable:!0,width:680,modal:!0,title:"Income Chooser",close:function(){$("div#submitButtons").show()},open:function(){$("div#submitButtons").hide()},buttons:{Save:function(){$.post("ws_ckin.php",$("#formf").serialize()+"&cmd=savefap&rid="+t.rid,function(e){try{e=$.parseJSON(e)}catch(e){return void alert("Bad JSON Encoding")}if(e.gotopage&&window.open(e.gotopage,"_self"),e.rstat&&1==e.rstat){var t=$("#selRateCategory");e.rcat&&""!=e.rcat&&t.length>0&&(t.val(e.rcat),t.change())}}),$(this).dialog("close")},Exit:function(){$(this).dialog("close")}}}),i.button().click(function(){getIncomeDiag(t.rid)})),a.rateList=t.resv.rdiv.ratelist,a.resources=t.resv.rdiv.rooms,a.visitFees=t.resv.rdiv.vfee,setupRates(a),$("#selResource").change(function(){$("#selRateCategory").change(),"Not Suitable"===$("option:selected",this).parent()[0].label?$("#hhkroomMsg").text("Not Suitable").show():$("#hhkroomMsg").hide()})}function i(e){$(".hhk-viewResvActivity").click(function(){$.post("ws_ckin.php",{cmd:"viewActivity",rid:$(this).data("rid")},function(e){if((e=$.parseJSON(e)).error)return e.gotopage&&window.open(e.gotopage,"_self"),void flagAlertMessage(e.error,!0);e.activity&&($("div#submitButtons").hide(),$("#activityDialog").children().remove(),$("#activityDialog").append($(e.activity)),$("#activityDialog").dialog("open"))})}),$("input.hhk-constraintsCB").change(function(){updateRoomChooser(e,"1",$("#gstDate").val(),$("#gstCoDate").val())}),$("#btnShowCnfrm").button().click(function(){var e=$("#spnAmount").text();""===e&&(e=0),$.post("ws_ckin.php",{cmd:"confrv",rid:$(this).data("rid"),amt:e,eml:"0"},function(e){if((e=$.parseJSON(e)).error)return e.gotopage&&window.open(e.gotopage,"_self"),void flagAlertMessage(e.error,!0);e.confrv&&($("div#submitButtons").hide(),$("#frmConfirm").children().remove(),$("#frmConfirm").html(e.confrv).append($('<div style="padding-top:10px;" class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><span>Email Address </span><input type="text" id="confEmail" value="'+e.email+'"/></div>')),$("#confirmDialog").dialog("open"))})})}var s,r,n,o,d=this;d.setupComplete=!1,d.setUp=function(l){(s=$('<div id="divResvDetail" style="padding:2px; float:left;min-width: 810px;" class="ui-widget-content ui-corner-bottom hhk-tdbox"/>')).append($(l.resv.rdiv.rChooser)),void 0!==l.resv.rdiv.rate&&s.append($(l.resv.rdiv.rate)),s.append($(l.resv.rdiv.rstat)).append($(l.resv.rdiv.notes)),void 0!==l.resv.rdiv.vehicle&&(r=$(l.resv.rdiv.vehicle),s.append(r),t(r)),o=$("<ul style='list-style-type:none; float:right; margin-left:5px; padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='r_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),(n=$('<div id="divResvHdr" style="padding:2px; cursor:pointer;"/>').append($(l.resv.hdr)).append(o).append('<div style="clear:both;"/>')).addClass("ui-widget-header ui-state-default ui-corner-top"),n.click(function(){"none"===s.css("display")?(s.show("blind"),n.removeClass("ui-corner-all").addClass("ui-corner-top")):(s.hide("blind"),n.removeClass("ui-corner-top").addClass("ui-corner-all"))}),e.empty().append(n).append(s).show(),d.$totalGuests=$("#spnNumGuests"),i(l.rid),void 0!==l.resv.rdiv.rate&&a(l),d.setupComplete=!0},d.verify=function(){return!0}}($("#resvSection")),w=new function(e){var t=this;t.setupComplete=!1,t.setUp=function(a){var i=$(a.div).addClass("ui-widget-content").prop("id","divhospDetail").hide(),s=$("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='h_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),r=$('<div id="divhospHdr" style="padding:2px; cursor:pointer;"/>').append($(a.hdr)).append(s).append('<div style="clear:both;"/>');r.addClass("ui-widget-header ui-state-default ui-corner-all"),r.click(function(){"none"===i.css("display")?(i.show("blind"),r.removeClass("ui-corner-all").addClass("ui-corner-top")):(i.hide("blind"),r.removeClass("ui-corner-top").addClass("ui-corner-all"))}),e.empty().append(r).append(i),$("#txtEntryDate, #txtExitDate").datepicker({yearRange:"-01:+01",changeMonth:!0,changeYear:!0,autoSize:!0,dateFormat:"M d, yy"}),$("#txtAgentSch").length>0&&(createAutoComplete($("#txtAgentSch"),3,{cmd:"filter",basis:"ra"},getAgent),""===$("#a_txtLastName").val()&&$(".hhk-agentInfo").hide()),$("#txtDocSch").length>0&&(createAutoComplete($("#txtDocSch"),3,{cmd:"filter",basis:"doc"},getDoc),""===$("#d_txtLastName").val()&&$(".hhk-docInfo").hide()),e.on("change","#selHospital, #selAssoc",function(){var e=$("#selAssoc").find("option:selected").text();""!=e&&(e+="/ "),$("span#spnHospName").text(e+$("#selHospital").find("option:selected").text())}),e.show(),""===$("#selHospital").val()&&r.click(),t.setupComplete=!0},t.verify=function(){return e.find(".ui-state-error").each(function(){$(this).removeClass("ui-state-error")}),$("#selHospital").length>0&&!0===t.setupComplete&&""==$("#selHospital").val()?($("#selHospital").addClass("ui-state-error"),flagAlertMessage("Select a hospital.",!0,0),$("#divhospDetail").show("blind"),$("#divhospHdr").removeClass("ui-corner-all").addClass("ui-corner-top"),!1):($("#divhospDetail").hide("blind"),$("#divhospHdr").removeClass("ui-corner-top").addClass("ui-corner-all"),!0)}}($("#hospitalSection")),x=new function(e){var t=this;t.setupComplete=!1,t.ciDate=new Date,t.coDate=new Date,t.setUp=function(t){e.empty(),e.append($(t.mu));var a=$("#gstDate"),i=$("#gstCoDate"),s=parseInt(t.defdays,10);(isNaN(s)||s<1)&&(s=21),$("#spnRangePicker").dateRangePicker({format:"MMM D, YYYY",separator:" to ",minDays:1,autoClose:!0,showShortcuts:!0,shortcuts:{"next-days":[s]},getValue:function(){return a.val()&&i.val()?a.val()+" to "+i.val():""},setValue:function(e,t,s){a.val(t),i.val(s)}}).bind("datepicker-change",function(e,a){var i=Math.ceil((a.date2.getTime()-a.date1.getTime())/864e5);$("#"+t.daysEle).val(i),$("#spnNites").length>0&&$("#spnNites").text(i)}),e.show(),setupComplete=!0},t.verify=function(){var e=$("#gstDate"),a=$("#gstCoDate");return e.removeClass("ui-state-error"),a.removeClass("ui-state-error"),""===e.val()?(e.addClass("ui-state-error"),flagAlertMessage("This "+l+" is missing the check-in date.",!0),!1):(t.ciDate=new Date(e.val()),isNaN(t.ciDate.getTime())?(e.addClass("ui-state-error"),flagAlertMessage("This "+l+" is missing the check-in date.",!0),!1):""===a.val()?(a.addClass("ui-state-error"),flagAlertMessage("This "+l+" is missing the expected departure date.",!0),!1):(t.coDate=new Date(a.val()),isNaN(t.coDate.getTime())?(a.addClass("ui-state-error"),flagAlertMessage("This "+l+" is missing the expected departure date",!0),!1):!(t.ciDate>t.coDate&&(e.addClass("ui-state-error"),flagAlertMessage("This "+l+"'s check-in date is after the expected departure date.",!0),1))))}}($("#datesSection"));o.getReserve=r,o.verifyInput=function(){return!1!==x.verify()&&!1!==b.verify()&&!1!==w.verify()&&(!0!==k.setupComplete||!1!==k.verify())},o.loadResv=n,o.deleteReserve=function(e,t){var a="&cmd=delResv&rid="+e;$.post("ws_ckin.php",a,function(e){var a;try{a=$.parseJSON(e)}catch(e){flagAlertMessage(e.message,!0),$(t).remove()}a.error&&(a.gotopage&&window.open(a.gotopage,"_self"),flagAlertMessage(a.error,!0),$(t).remove()),a.warning&&flagAlertMessage(a.warning,!0),a.result&&($(t).remove(),flagAlertMessage(a.result+' <a href="Reserve.php">Continue</a>',!0))})},o.resvTitle=l,o.people=C,o.addrs=y,o.idPsg=v,o.idResv=g,o.idName=m}
