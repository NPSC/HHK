function isNumber(n){"use strict";return!isNaN(parseFloat(n))&&isFinite(n)}function setRoomTo(b,c){$.post('ws_resv.php',{cmd:'moveResvRoom',rid:b,idResc:c},function(a){try{a=$.parseJSON(a)}catch(err){alert("Parser error - "+err.message);return false}if(a.error){if(a.gotopage){window.location.assign(a.gotopage)}flagAlertMessage(a.error,'error');return false}if(a.warning&&a.warning!==''){flagAlertMessage(a.warning,'alert');return false}if(a.msg&&a.msg!==''){flagAlertMessage(a.msg,'info')}$('#calendar').fullCalendar('refetchEvents');refreshdTables(a)})}var $dailyTbl;function refreshdTables(a){"use strict";if(a.curres&&$('#divcurres').length>0){var b=$('#curres').DataTable();b.ajax.reload()}if(a.reservs&&$('div#vresvs').length>0){var b=$('#reservs').DataTable();b.ajax.reload()}if(a.waitlist&&$('div#vwls').length>0){var b=$('#waitlist').DataTable();b.ajax.reload()}if(a.unreserv&&$('div#vuncon').length>0){var b=$('#unreserv').DataTable();b.ajax.reload()}if($('#daily').length>0&&$dailyTbl){$dailyTbl.ajax.reload()}}function cgResvStatus(b,c){$.post('ws_ckin.php',{cmd:'rvstat',rid:b,stat:c},function(a){if(a){try{a=$.parseJSON(a)}catch(err){alert("Parser error - "+err.message);return}if(a.error){if(a.gotopage){window.location.assign(a.gotopage)}flagAlertMessage(a.error,'error');return}if(a.success){flagAlertMessage(a.success,'info');$('#calendar').fullCalendar('refetchEvents')}refreshdTables(a)}})}function chgRoomCleanStatus(b,c){"use strict";if(confirm('Change the room status?')){$.post('ws_resc.php',{cmd:'saveRmCleanCode',idr:b,stat:c},function(a){if(a){try{a=$.parseJSON(a)}catch(err){alert("Parser error - "+err.message);return}if(a.error){if(a.gotopage){window.location.assign(a.gotopage)}flagAlertMessage("Server error - "+a.error,'error');return}refreshdTables(a);if(a.msg&&a.msg!=''){flagAlertMessage(a.msg,'info')}}})}}function payFee(a,b,c,d){var e={"Show Statement":function(){window.open('ShowStatement.php?vid='+c,'_blank')},"Pay Fees":function(){saveFees(b,c,d,false,'register.php')},"Cancel":function(){$(this).dialog("close")}};viewVisit(b,c,e,'Pay Fees for '+a,'pf',d)}function editPSG(c){var d={"Cancel":function(){$(this).dialog("close")}};$.post('ws_ckin.php',{cmd:'viewPSG',psg:c},function(a){if(a){try{a=$.parseJSON(a)}catch(err){alert("Parser error - "+err.message);return}if(a.error){if(a.gotopage){window.location.assign(a.gotopage)}flagAlertMessage(a.error,'error')}else if(a.markup){var b=$('div#keysfees');b.children().remove();b.append($('<div class="hhk-panel hhk-tdbox hhk-visitdialog" style="font-size:0.8em;"/>').append($(a.markup)));b.dialog('option','buttons',d);b.dialog('option','title','View Patient Support Group');b.dialog('option','width',900);b.dialog('open')}}})}function ckOut(a,b,c,d){var e={"Show Statement":function(){window.open('ShowStatement.php?vid='+c,'_blank')},"Show Registration Form":function(){window.open('ShowRegForm.php?vid='+c+'&span='+d,'_blank')},"Check Out":function(){saveFees(b,c,d,true,'register.php')},"Cancel":function(){$(this).dialog("close")}};viewVisit(b,c,e,'Check Out '+a,'co',d)}function editVisit(a,b,c,d){var e={"Show Statement":function(){window.open('ShowStatement.php?vid='+c,'_blank')},"Show Registration Form":function(){window.open('ShowRegForm.php?vid='+c+'&span='+d,'_blank')},"Save":function(){saveFees(b,c,d,true,'register.php')},"Cancel":function(){$(this).dialog("close")}};viewVisit(b,c,e,'Edit Visit #'+c+'-'+d,'',d)}function getStatusEvent(c,d,e){"use strict";$.post('ws_resc.php',{cmd:'getStatEvent',tp:d,title:e,id:c},function(a){if(a){try{a=$.parseJSON(a)}catch(err){alert("Parser error - "+err.message);return}if(a.error){if(a.gotopage){window.location.assign(a.gotopage)}alert("Server error - "+a.error)}else if(a.tbl){$('#statEvents').children().remove().end().append($(a.tbl));$('.ckdate').datepicker({autoSize:true,dateFormat:'M d, yy'});var b={"Save":function(){saveStatusEvent(c,d)},'Cancel':function(){$(this).dialog('close')}};$('#statEvents').dialog('option','buttons',b);$('#statEvents').dialog('open')}}})}function saveStatusEvent(b,c){"use strict";$.post('ws_resc.php',$('#statForm').serialize()+'&cmd=saveStatEvent'+'&id='+b+'&tp='+c,function(a){if(a){try{a=$.parseJSON(a)}catch(err){alert("Parser error - "+err.message);return}if(a.error){if(a.gotopage){window.location.assign(a.gotopage)}alert("Server error - "+a.error)}if(a.reload&&a.reload==1){$('#calendar').fullCalendar('refetchResources');$('#calendar').fullCalendar('refetchEvents')}if(a.msg&&a.msg!=''){flagAlertMessage(a.msg,'info')}}$('#statEvents').dialog('close')})}function cgRoom(a,b,c,d){var e={"Change Rooms":function(){saveFees(b,c,d,true,'register.php')},"Cancel":function(){$(this).dialog("close")}};viewVisit(b,c,e,'Change Rooms for '+a,'cr',d)}function moveVisit(b,c,d,e,f){$.post('ws_ckin.php',{cmd:b,idVisit:c,span:d,sdelta:e,edelta:f},function(a){if(a){try{a=$.parseJSON(a)}catch(err){alert("Parser error - "+err.message);return}if(a.error){if(a.gotopage){window.location.assign(a.gotopage)}flagAlertMessage(a.error,'error')}else if(a.success){$('#calendar').fullCalendar('refetchEvents');flagAlertMessage(a.success,'success');refreshdTables(a)}}})}function getRoomList(c,d){if(c){$.post('ws_ckin.php',{cmd:'rmlist',rid:c,x:d},function(a){try{a=$.parseJSON(a)}catch(err){alert("Parser error - "+err.message);return}if(a.error){if(a.gotopage){window.location.assign(a.gotopage)}flagAlertMessage(a.error,'error');return}if(a.container){var b=$(a.container);$('body').append(b);b.position({my:'top',at:'bottom',of:"#"+a.eid});$('#selRoom').change(function(){if($('#selRoom').val()==''){b.remove();return}if(confirm('Change room to '+$('#selRoom option:selected').text()+'?')){setRoomTo(a.rid,$('#selRoom').val())}b.remove()})}})}}function refreshPayments(){$('#btnFeesGo').click()}var isGuestAdmin,pmtMkup,rctMkup,defaultTab,resourceGroupBy,resourceColumnWidth,patientLabel,guestLabel,visitorLabel,challVar,defaultView,defaultEventColor,defCalEventTextColor,calDateIncrement,dateFormat,fixedRate,resvPageName,showCreatedDate,expandResources,shoHospitalName,showRateCol,hospTitle,showDiags,showLocs,locationTitle,diagnosisTitle,showWlNotes,showCharges,wlTitle,cgCols,rvCols,wlCols,dailyCols;$(document).ready(function(){"use strict";var i=0;var j=new moment();isGuestAdmin=$('#isGuestAdmin').val();pmtMkup=$('#pmtMkup').val();rctMkup=$('#rctMkup').val();defaultTab=$('#defaultTab').val();resourceGroupBy=$('#resourceGroupBy').val();resourceColumnWidth=$('#resourceColumnWidth').val();patientLabel=$('#patientLabel').val();visitorLabel=$('#visitorLabel').val();guestLabel=$('#guestLabel').val();challVar=$('#challVar').val();defaultView=$('#defaultView').val();defaultEventColor=$('#defaultEventColor').val();defCalEventTextColor=$('#defCalEventTextColor').val();calDateIncrement=$('#calDateIncrement').val();dateFormat=$('#dateFormat').val();fixedRate=$('#fixedRate').val();resvPageName=$('#resvPageName').val();showCreatedDate=$('#showCreatedDate').val();expandResources=$('#expandResources').val();shoHospitalName=$('#shoHospitalName').val();showRateCol=$('#showRateCol').val();hospTitle=$('#hospTitle').val();showDiags=$('#showDiags').val();showLocs=$('#showLocs').val();locationTitle=$('#locationTitle').val();diagnosisTitle=$('#diagnosisTitle').val();showWlNotes=$('#showWlNotes').val();wlTitle=$('#wlTitle').val();showCharges=$('#showCharges').val();cgCols=[{data:'Action',title:'Action',sortable:false,searchable:false},{data:'Guest First',title:guestLabel+' First'},{data:'Guest Last',title:guestLabel+' Last'},{data:'Checked In',title:'Checked In',render:function(a,b){return dateRender(a,b,dateFormat)}},{data:'Nights',title:'Nights',className:'hhk-justify-c'},{data:'Expected Departure',title:'Expected Departure',render:function(a,b){return dateRender(a,b,dateFormat)}},{data:'Room',title:'Room',className:'hhk-justify-c'}];if(showRateCol){cgCols.push({data:'Rate',title:'Rate'})}cgCols.push({data:'Phone',title:'Phone'});if(shoHospitalName){cgCols.push({data:'Hospital',title:hospTitle})}cgCols.push({data:'Patient',title:patientLabel});rvCols=[{data:'Action',title:'Action',sortable:false,searchable:false},{data:'Guest First',title:guestLabel+' First'},{data:'Guest Last',title:guestLabel+' Last'},{data:'Expected Arrival',title:'Expected Arrival',render:function(a,b){return dateRender(a,b,dateFormat)}},{data:'Nights',title:'Nights',className:'hhk-justify-c'},{data:'Expected Departure',title:'Expected Departure',render:function(a,b){return dateRender(a,b,dateFormat)}},{data:'Room',title:'Room',className:'hhk-justify-c'}];if(showRateCol){rvCols.push({data:'Rate',title:'Rate'})}rvCols.push({data:'Occupants',title:'Occupants',className:'hhk-justify-c'});if(shoHospitalName){rvCols.push({data:'Hospital',title:hospTitle})}if(showLocs){rvCols.push({data:'Location',title:locationTitle})}if(showDiags){rvCols.push({data:'Diagnosis',title:diagnosisTitle})}rvCols.push({data:'Patient',title:patientLabel});wlCols=[{data:'Action',title:'Action',sortable:false,searchable:false},{data:'Guest First',title:guestLabel+' First'},{data:'Guest Last',title:guestLabel+' Last'}];if(showCreatedDate){wlCols.push({data:'Timestamp',title:'Created On',render:function(a,b){return dateRender(a,b,"MMM D, YYYY H:mm")}})}wlCols.push({data:'Expected Arrival',title:'Expected Arrival',render:function(a,b){return dateRender(a,b,dateFormat)}});wlCols.push({data:'Nights',title:'Nights',className:'hhk-justify-c'});wlCols.push({data:'Expected Departure',title:'Expected Departure',render:function(a,b){return dateRender(a,b,dateFormat)}});wlCols.push({data:'Occupants',title:'Occupants',className:'hhk-justify-c'});if(shoHospitalName){wlCols.push({data:'Hospital',title:hospTitle})}if(showLocs){wlCols.push({data:'Location',title:locationTitle})}if(showDiags){wlCols.push({data:'Diagnosis',title:diagnosisTitle})}wlCols.push({data:'Patient',title:patientLabel});if(showWlNotes){wlCols.push({data:'WL Notes',title:wlTitle})}dailyCols=[{data:'titleSort','visible':false},{data:'Title',title:'Room','orderData':[0,1],className:'hhk-justify-c'},{data:'Status',title:'Status',searchable:false},{data:'Guests',title:visitorLabel+'s'},{data:'Patient_Name',title:patientLabel}];if(showCharges){dailyCols.push({data:'Unpaid',title:'Unpaid',className:'hhk-justify-r'})}dailyCols.push({data:'Visit_Notes',title:'Last Visit Note',sortable:false});dailyCols.push({data:'Notes',title:'Room Notes',sortable:false});$.widget("ui.autocomplete",$.ui.autocomplete,{_resizeMenu:function(){var a=this.menu.element;a.outerWidth(Math.max(a.width("").outerWidth()+1,this.element.outerWidth())*1.1)}});if(pmtMkup!==''){$('#paymentMessage').html(pmtMkup).show("pulsate",{},400)}$(':input[type="button"], :input[type="submit"]').button();$.datepicker.setDefaults({yearRange:'-10:+02',changeMonth:true,changeYear:true,autoSize:true,numberOfMonths:2,dateFormat:'M d, yy'});$.extend($.fn.dataTable.defaults,{"dom":'<"dtTop"if>rt<"dtBottom"lp><"clear">',"displayLength":50,"lengthMenu":[[25,50,-1],[25,50,"All"]],"order":[[3,'asc']],"processing":true,"deferRender":true});$('#vstays').on('click','.stpayFees',function(a){a.preventDefault();$(".hhk-alert").hide();payFee($(this).data('name'),$(this).data('id'),$(this).data('vid'),$(this).data('spn'))});$('#vstays').on('click','.applyDisc',function(a){a.preventDefault();$(".hhk-alert").hide();getApplyDiscDiag($(this).data('vid'),$('#pmtRcpt'))});$('#vstays').on('click','.stckout',function(a){a.preventDefault();$(".hhk-alert").hide();ckOut($(this).data('name'),$(this).data('id'),$(this).data('vid'),$(this).data('spn'))});$('#vstays').on('click','.stvisit',function(a){a.preventDefault();$(".hhk-alert").hide();editVisit($(this).data('name'),$(this).data('id'),$(this).data('vid'),$(this).data('spn'))});$('#vstays').on('click','.hhk-getPSGDialog',function(a){a.preventDefault();$(".hhk-alert").hide();editPSG($(this).data('psg'))});$('#vstays').on('click','.stchgrooms',function(a){a.preventDefault();$(".hhk-alert").hide();cgRoom($(this).data('name'),$(this).data('id'),$(this).data('vid'),$(this).data('spn'))});$('#vstays').on('click','.stcleaning',function(a){a.preventDefault();$(".hhk-alert").hide();chgRoomCleanStatus($(this).data('idroom'),$(this).data('clean'))});$('#vresvs, #vwls, #vuncon').on('click','.resvStat',function(a){a.preventDefault();$(".hhk-alert").hide();cgResvStatus($(this).data('rid'),$(this).data('stat'))});$('.ckdate').datepicker();$('#regckindate').val(moment().format("MMM DD, YYYY"));$('#statEvents').dialog({autoOpen:false,resizable:true,width:830,modal:true,title:'Manage Status Events'});$('#keysfees').dialog({autoOpen:false,resizable:true,modal:true,close:function(a,b){$('div#submitButtons').show()},open:function(a,b){$('div#submitButtons').hide()}});$(document).mousedown(function(a){var b=$(a.target);if(b[0].id!=='pudiv'&&b.parents("#"+'pudiv').length===0){$('div#pudiv').remove()}});$("#faDialog").dialog({autoOpen:false,resizable:true,width:650,modal:true,title:'Income Chooser'});$("#setBillDate").dialog({autoOpen:false,resizable:true,modal:true,title:'Set Invoice Billing Date'});$('#pmtRcpt').dialog({autoOpen:false,resizable:true,width:530,modal:true,title:'Payment Receipt'});if($('#txtactstart').val()===''){var k=new Date();k.setTime(k.getTime()-(5*86400000));$('#txtactstart').datepicker('setDate',k)}if($('#txtfeestart').val()===''){var k=new Date();k.setTime(k.getTime()-(3*86400000));$('#txtfeestart').datepicker('setDate',k)}$('#txtsearch').keypress(function(a){var b=$(this).val();if(a.keyCode=='13'){if(b===''||!isNumber(parseInt(b,10))){alert("Don't press the return key unless you enter an Id.");a.preventDefault()}else{if(b>0){window.location.assign("GuestEdit.php?id="+b)}a.preventDefault()}}});createAutoComplete($('#txtsearch'),3,{cmd:"role",mode:'mo',gp:'1'},function(a){var b=a.id;if(b>0){window.location.assign("GuestEdit.php?id="+b)}},false);var l=null;if(calDateIncrement>0&&calDateIncrement<5){l={weeks:calDateIncrement}}$('#selRoomGroupScheme').val(resourceGroupBy);var m=window.innerHeight;$('#calendar').fullCalendar({height:m-175,themeSystem:'jquery-ui',allDay:true,firstDay:0,dateIncrement:l,nextDayThreshold:'13:00',schedulerLicenseKey:'CC-Attribution-NonCommercial-NoDerivatives',eventColor:defaultEventColor,eventTextColor:defCalEventTextColor,customButtons:{refresh:{text:'Refresh',click:function(){$('#calendar').fullCalendar('refetchResources');$('#calendar').fullCalendar('refetchEvents')}},prevMonth:{click:function(){$('#calendar').fullCalendar('incrementDate',{months:-1})},themeIcon:'ui-icon-seek-prev'},nextMonth:{click:function(){$('#calendar').fullCalendar('incrementDate',{months:1})},themeIcon:'ui-icon-seek-next'},setup:{click:function(){$('#divRoomGrouping').show('fade')},themeIcon:'ui-icon-gear'}},views:{timeline1weeks:{type:'timeline',slotDuration:{days:1},duration:{weeks:1},buttonText:'1'},timeline2weeks:{type:'timeline',slotDuration:{days:1},duration:{weeks:2},buttonText:'2'},timeline3weeks:{type:'timeline',slotDuration:{days:1},duration:{weeks:3},buttonText:'3'},timeline4weeks:{type:'timeline',slotDuration:{days:7},duration:{weeks:26},buttonText:'26'}},viewRender:function(a,b){defaultView=a.name;j=$('#calendar').fullCalendar('getDate')},header:{left:'setup timeline1weeks,timeline2weeks,timeline3weeks,timeline4weeks title',center:'',right:'refresh,today prevMonth,prev,next,nextMonth'},defaultView:defaultView,editable:true,resourcesInitiallyExpanded:expandResources,resourceLabelText:'Rooms',resourceAreaWidth:resourceColumnWidth,refetchResourcesOnNavigate:false,resourceGroupField:resourceGroupBy,loading:function(a,b){if(a){$('#pCalLoad').show();$('#spnGotoDate').hide()}else{$('#pCalLoad').hide();$('#spnGotoDate').show()}},resources:function(d){$.ajax({url:'ws_calendar.php',dataType:'JSON',data:{cmd:'resclist',start:j.format('YYYY-MM-DD'),view:defaultView,gpby:$('#selRoomGroupScheme').val()},success:function(a){d(a)},error:function(a,b,c){$('#pCalError').text('Error getting resources: '+c).show()}})},resourceGroupText:function(a){return a},resourceRender:function(a,b,c){b.css('background',a.bgColor).css('color',a.textColor);if(a.id>0){var d=a.title+(a.maxOcc==0?'':' ('+a.maxOcc+')');b.prop('title',d);b.click(function(){getStatusEvent(a.id,'resc',a.title)})}},eventOverlap:function(a,b){if(a.kind==='bak'||a.idVisit===b.idVisit){return true}return false},events:{url:'ws_calendar.php?cmd=eventlist',error:function(a,b,c){$('#pCalError').text('Error getting events: '+c).show()}},eventDrop:function(a,b,c){$(".hhk-alert").hide();if(a.idVisit>0&&b.asDays()!==0){if(confirm('Move Visit to a new start date?')){moveVisit('visitMove',a.idVisit,a.Span,b.asDays(),b.asDays())}}if(a.idReservation>0){if(b.asDays()!==0){if(confirm('Move Reservation to a new start date?')){moveVisit('reservMove',a.idReservation,0,b.asDays(),b.asDays());return}}if(a.resourceId!==a.idResc){var d='Move Reservation to a new room?';if(a.resourceId==0){d='Move Reservation to the waitlist?'}if(confirm(d)){if(setRoomTo(a.idReservation,a.resourceId)){return}}}}c()},eventResize:function(a,b,c){$(".hhk-alert").hide();if(b===undefined){c();return}if(a.idVisit>0){if(confirm('Move check out date?')){moveVisit('visitMove',a.idVisit,a.Span,0,b.asDays());return}}if(a.idReservation>0){if(confirm('Move expected end date?')){moveVisit('reservMove',a.idReservation,0,0,b.asDays());return}}c()},eventClick:function(a,b){$(".hhk-alert").hide();if(a.kind&&a.kind==='oos'){getStatusEvent(a.resourceId,'resc',a.title);return}if(a.idReservation&&a.idReservation>0){if(b.target.classList.contains('hhk-schrm')){getRoomList(a.idReservation,b.target.id);return}else{window.location.assign(resvPageName+'?rid='+a.idReservation)}}if(a.idVisit&&a.idVisit>0){var c={"Show Statement":function(){window.open('ShowStatement.php?vid='+a.idVisit,'_blank')},"Show Registration Form":function(){window.open('ShowRegForm.php?vid='+a.idVisit+'&span='+a.Span,'_blank')},"Save":function(){saveFees(0,a.idVisit,a.Span,true,'register.php')},"Cancel":function(){$(this).dialog("close")}};viewVisit(0,a.idVisit,c,'Edit Visit #'+a.idVisit+'-'+a.Span,'',a.Span)}},eventRender:function(a,b){if(i===undefined||i===0||a.idHosp===undefined||a.idAssoc==i||a.idHosp==i){var c=$('#calendar').fullCalendar('getResourceById',a.resourceId);if(a.idReservation!==undefined){b.prop('title',a.fullName+(a.resourceId>0?', Room: '+c.title:'')+', Status: '+a.resvStatus+(shoHospitalName?', '+hospTitle+': '+a.hospName:''));if(a.status==='uc'){b.css('border','2px dashed black').css('padding','1px 0')}else{b.css('border','2px solid black').css('padding','1px 0')}}else if(a.idVisit!==undefined){b.prop('title',a.fullName+', Room: '+c.title+', Status: '+a.visitStatus+', '+a.guests+(a.guests>1?' '+visitorLabel+'s':' '+visitorLabel)+(shoHospitalName?', '+hospTitle+': '+a.hospName:''));if(a.extended!==undefined&&a.extended){b.find('div.fc-content').append($('<span style="float:right;margin-right:5px;" class="hhk-fc-title"/>'))}}else if(a.kind==='oos'){b.prop('title',a.reason)}b.show()}else{b.hide()}}});$(document).mousedown(function(a){var b=$(a.target);if(b[0].id!=='divRoomGrouping'&&b[0].id!=='selRoomGroupScheme'){$('#divRoomGrouping').hide()}});if($('.spnHosp').length>0){$('.spnHosp').click(function(){$(".hhk-alert").hide();$('.spnHosp').css('border','solid 1px black').css('font-size','100%');i=parseInt($(this).data('id'),10);if(isNaN(i))i=0;$('#calendar').fullCalendar('rerenderEvents');$(this).css('border','solid 3px black').css('font-size','120%')})}$('#btnActvtyGo').click(function(){$(".hhk-alert").hide();var d=$('#txtactstart').datepicker("getDate");if(d===null){$('#txtactstart').addClass('ui-state-highlight');flagAlertMessage('Enter start date','alert');return}else{$('#txtactstart').removeClass('ui-state-highlight')}var e=$('#txtactend').datepicker("getDate");if(e===null){e=new Date()}var f={cmd:'actrpt',start:d.toLocaleDateString(),end:e.toLocaleDateString()};if($('#cbVisits').prop('checked')){f.visit='on'}if($('#cbReserv').prop('checked')){f.resv='on'}if($('#cbHospStay').prop('checked')){f.hstay='on'}$.post('ws_resc.php',f,function(c){if(c){try{c=$.parseJSON(c)}catch(err){alert("Parser error - "+err.message);return}if(c.error){if(c.gotopage){window.open(c.gotopage,'_self')}flagAlertMessage(c.error,'error')}else if(c.success){$('#rptdiv').remove();$('#vactivity').append($('<div id="rptdiv"/>').append($(c.success)));$('.hhk-viewvisit').css('cursor','pointer');$('#rptdiv').on('click','.hhk-viewvisit',function(){if($(this).data('visitid')){var a=$(this).data('visitid').split('_');if(a.length!==2)return;var b={"Save":function(){saveFees(0,a[0],a[1])},"Cancel":function(){$(this).dialog("close")}};viewVisit(0,a[0],b,'View Visit','n',a[1])}else if($(this).data('reservid')){window.location.assign('Reserve.php?rid='+$(this).data('reservid'))}})}}})});$('#btnFeesGo').click(function(){$(".hhk-alert").hide();var b=$('#txtfeestart').datepicker("getDate");if(b===null){$('#txtfeestart').addClass('ui-state-highlight');flagAlertMessage('Enter start date','alert');return}else{$('#txtfeestart').removeClass('ui-state-highlight')}var c=$('#txtfeeend').datepicker("getDate");if(c===null){c=new Date()}var d=$('#selPayStatus').val()||[];var e=$('#selPayType').val()||[];var f={cmd:'actrpt',start:b.toDateString(),end:c.toDateString(),st:d,pt:e};if($('#fcbdinv').prop('checked')!==false){f['sdinv']='on'}$('#rptFeeLoading').show();f.fee='on';$.post('ws_resc.php',f,function(a){$('#rptFeeLoading').hide();if(a){try{a=$.parseJSON(a)}catch(err){alert("Parser error - "+err.message);return}if(a.error){if(a.gotopage){window.open(a.gotopage,'_self')}flagAlertMessage(a.error,'error')}else if(a.success){$('#rptfeediv').remove();$('#vfees').append($('<div id="rptfeediv"/>').append($(a.success)));paymentsTable('feesTable','rptfeediv',refreshPayments);$('#btnPayHistRef').hide()}}})});$('#btnInvGo').click(function(){var e=['up'];var f={cmd:'actrpt',st:e,inv:'on'};$.post('ws_resc.php',f,function(d){if(d){try{d=$.parseJSON(d)}catch(err){alert("Parser error - "+err.message);return}if(d.error){if(d.gotopage){window.open(d.gotopage,'_self')}flagAlertMessage(d.error,'error')}else if(d.success){$('#rptInvdiv').remove();$('#vInv').append($('<div id="rptInvdiv" style="min-height:500px;"/>').append($(d.success)));$('#rptInvdiv .gmenu').menu();$('#rptInvdiv').on('click','.invLoadPc',function(a){a.preventDefault();$("#divAlert1, #paymentMessage").hide();invLoadPc($(this).data('name'),$(this).data('id'),$(this).data('iid'))});$('#rptInvdiv').on('click','.invSetBill',function(a){a.preventDefault();$(".hhk-alert").hide();invSetBill($(this).data('inb'),$(this).data('name'),'div#setBillDate','#trBillDate'+$(this).data('inb'),$('#trBillDate'+$(this).data('inb')).text(),$('#divInvNotes'+$(this).data('inb')).text(),'#divInvNotes'+$(this).data('inb'))});$('#rptInvdiv').on('click','.invAction',function(a){a.preventDefault();$(".hhk-alert").hide();if($(this).data('stat')=='del'){if(!confirm('Delete this Invoice?')){return}}if($(this).data('stat')==='vem'){window.open('ShowInvoice.php?invnum='+$(this).data('inb'));return}invoiceAction($(this).data('iid'),$(this).data('stat'),a.target.id);$('#rptInvdiv .gmenu').menu("collapse")});$('#InvTable').dataTable({'columnDefs':[{'targets':[2,4],'type':'date','render':function(a,b,c){return dateRender(a,b)}}],"dom":'<"top"if>rt<"bottom"lp><"clear">',"displayLength":50,"lengthMenu":[[20,50,100,-1],[20,50,100,"All"]],"order":[[1,'asc']]})}}})});$('#btnPrintRegForm').click(function(){window.open($(this).data('page')+'?d='+$('#regckindate').val(),'_blank')});$('#btnPrintWL').click(function(){window.open($(this).data('page')+'?d='+$('#regwldate').val(),'_blank')});$('#btnPrtDaily').button().click(function(){$("#divdaily").printArea()});$('#btnRefreshDaily').button().click(function(){var a=$('#daily').DataTable();a.ajax.reload()});$('#txtGotoDate').change(function(){$(".hhk-alert").hide();j=new moment($(this).datepicker('getDate'));$('#calendar').fullCalendar('refetchResources');$('#calendar').fullCalendar('gotoDate',j)});$('#selRoomGroupScheme').change(function(){$('#divRoomGrouping').hide();$('#calendar').fullCalendar('option','resourceGroupField',$(this).val());$('#calendar').fullCalendar('refetchResources')});if(rctMkup!==''){showReceipt('#pmtRcpt',rctMkup,'Payment Receipt')}$('#mainTabs').tabs({beforeActivate:function(g,h){if(h.newTab.prop('id')==='liInvoice'){$('#btnInvGo').click()}if(h.newTab.prop('id')==='liDaylog'&&!$dailyTbl){$dailyTbl=$('#daily').DataTable({ajax:{url:'ws_resc.php?cmd=getHist&tbl=daily',dataSrc:'daily'},order:[[0,'asc']],columns:dailyCols,infoCallback:function(a,b,c,d,e,f){return"Prepared: "+dateRender(new Date().toISOString(),'display','ddd, MMM D YYYY, h:mm a')}})}},activate:function(a,b){if(b.newTab.prop('id')==='liCal'){$('#calendar').fullCalendar('render');$('#divGoto').position({my:'center top',at:'center top+8',of:'#calendar',within:'#calendar'})}},active:defaultTab});$('#mainTabs').show();$('#divGoto').position({my:'center top',at:'center top+8',of:'#calendar',within:'#calendar'});$('#curres').DataTable({ajax:{url:'ws_resc.php?cmd=getHist&tbl=curres',dataSrc:'curres'},drawCallback:function(a){$('#spnNumCurrent').text(this.api().rows().data().length);$('#curres .gmenu').menu()},columns:cgCols});$('#reservs').DataTable({ajax:{url:'ws_resc.php?cmd=getHist&tbl=reservs',dataSrc:'reservs'},drawCallback:function(a){$('#spnNumConfirmed').text(this.api().rows().data().length);$('#reservs .gmenu').menu()},columns:rvCols});if($('#unreserv').length>0){$('#unreserv').DataTable({ajax:{url:'ws_resc.php?cmd=getHist&tbl=unreserv',dataSrc:'unreserv'},drawCallback:function(a){$('#spnNumUnconfirmed').text(this.api().rows().data().length);$('#unreserv .gmenu').menu()},columns:rvCols})}$('#waitlist').DataTable({ajax:{url:'ws_resc.php?cmd=getHist&tbl=waitlist',dataSrc:'waitlist'},order:[[(showCreatedDate?4:3),'asc']],drawCallback:function(){$('#spnNumWaitlist').text(this.api().rows().data().length);$('#waitlist .gmenu').menu()},columns:wlCols})});
