/**
 * register.js
 *
 * @author    Eric K. Crane <ecrane@nonprofitsoftwarecorp.org>
 * @copyright 2010-2023 <nonprofitsoftwarecorp.org>
 * @license   GPL and MIT
 * @link      https://github.com/NPSC/HHK
 */
function isNumber(e) { "use strict"; return !isNaN(parseFloat(e)) && isFinite(e) } function moveResvRoom(e, t) { $.post("ws_resv.php", { cmd: "moveResvRoom", rid: e, idResc: t }, function (e) { try { e = $.parseJSON(e) } catch (e) { return alert("Parser error - " + e.message), !1 } return e.error ? (e.gotopage && window.location.assign(e.gotopage), flagAlertMessage(e.error, "error"), !1) : e.warning && "" !== e.warning ? (flagAlertMessage(e.warning, "warning"), !1) : (e.msg && "" !== e.msg && flagAlertMessage(e.msg, "info"), e.success && "" !== e.success && flagAlertMessage(e.msg, "success"), calendar.refetchResources(), calendar.refetchEvents(), refreshdTables(e), !0) }) } var $dailyTbl; function refreshdTables(e) { "use strict"; e.curres && 0 < $("#divcurres").length && $("#curres").DataTable().ajax.reload(), e.reservs && 0 < $("div#vresvs").length && $("#reservs").DataTable().ajax.reload(), e.waitlist && 0 < $("div#vwls").length && $("#waitlist").DataTable().ajax.reload(), e.unreserv && 0 < $("div#vuncon").length && $("#unreserv").DataTable().ajax.reload(), 0 < $("#daily").length && $dailyTbl && $dailyTbl.ajax.reload() } function cgResvStatus(e, t) { $.post("ws_ckin.php", { cmd: "rvstat", rid: e, stat: t }, function (e) { if (e) { try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } e.error ? (e.gotopage && window.location.assign(e.gotopage), flagAlertMessage(e.error, "error")) : (e.success && (flagAlertMessage(e.success, "info"), calendar.refetchResources(), calendar.refetchEvents()), refreshdTables(e)) } }) } function chgRoomCleanStatus(e, t) { "use strict"; confirm("Change the room status?") && $.post("ws_resc.php", { cmd: "saveRmCleanCode", idr: e, stat: t }, function (e) { if (e) { try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } e.error ? (e.gotopage && window.location.assign(e.gotopage), flagAlertMessage("Server error - " + e.error, "error")) : (refreshdTables(e), e.msg && "" != e.msg && flagAlertMessage(e.msg, "info")) } }) } function editPSG(e) { var a = { Close: function () { $(this).dialog("close") } }; $.post("ws_ckin.php", { cmd: "viewPSG", psg: e }, function (e) { if (e) { try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } var t; e.error ? (e.gotopage && window.location.assign(e.gotopage), flagAlertMessage(e.error, "error")) : e.markup && ((t = $("div#keysfees")).children().remove(), t.append($('<div class="hhk-panel hhk-tdbox hhk-visitdialog" style="font-size:0.8em;"/>').append($(e.markup))), t.dialog("option", "buttons", a), t.dialog("option", "title", "View Patient Support Group"), t.dialog("option", "width", 900), t.dialog("open")) } }) } function ckOut(e, t, a, s, o) { viewVisit(t, s, { "Show Statement": function () { window.open("ShowStatement.php?vid=" + s, "_blank") }, "Show Registration Form": function () { window.open("ShowRegForm.php?vid=" + s + "&span=" + o, "_blank") }, "Check Out": function () { saveFees(t, s, o, !0, "register.php") }, Cancel: function () { $(this).dialog("close") } }, "Check Out " + e, "co", o) } function editVisit(e, t, a, s, o) { viewVisit(t, s, { "Show Statement": function () { window.open("ShowStatement.php?vid=" + s, "_blank") }, "Show Registration Form": function () { window.open("ShowRegForm.php?vid=" + s + "&span=" + o, "_blank") }, Save: function () { saveFees(t, s, o, !0, "register.php") }, Cancel: function () { $(this).dialog("close") } }, "Edit Visit #" + s + "-" + o, "", o) } function getStatusEvent(t, a, e) { "use strict"; $.post("ws_resc.php", { cmd: "getStatEvent", tp: a, title: e, id: t }, function (e) { if (e) { try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } e.error ? (e.gotopage && window.location.assign(e.gotopage), alert("Server error - " + e.error)) : e.tbl && ($("#statEvents").children().remove().end().append($(e.tbl)), $(".ckdate").datepicker({ autoSize: !0, dateFormat: "M d, yy", beforeShow: function (e, t) { var a = $(this).closest("tr").find('[id^="txtstart"]'), s = $(this).closest("tr").find('[id^="txtend"]'); $(this).attr("id").startsWith("txtstart") && "" != s.val() && $(this).datepicker("option", "maxDate", s.val()), $(this).attr("id").startsWith("txtend") && "" != a.val() && $(this).datepicker("option", "minDate", a.val()) } }), e = { Save: function () { saveStatusEvent(t, a) }, Cancel: function () { $(this).dialog("close") } }, $("#statEvents").dialog("option", "buttons", e), $("#statEvents").dialog("open")) } }) } function saveStatusEvent(e, t) { "use strict"; $.post("ws_resc.php", $("#statForm").serialize() + "&cmd=saveStatEvent&id=" + e + "&tp=" + t, function (e) { if (e) { try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } e.error && (e.gotopage && window.location.assign(e.gotopage), alert("Server error - " + e.error)), e.reload && 1 == e.reload && (calendar.refetchResources(), calendar.refetchEvents()), e.msg && "" != e.msg && flagAlertMessage(e.msg, "info") } $("#statEvents").dialog("close") }) } function showChangeVisitRoom(h, e, v, m) { function f(t, e, a, s, o, i, r) { $.post("ws_ckin.php", { cmd: "doChangeVisitRoom", idVisit: t, span: e, idRoom: a, replaceRoom: s, useDefault: o, changeDate: i, changeEndDate: r }, function (e) { try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } e.error ? (e.gotopage && window.open(e.gotopage), flagAlertMessage(e.error, "error")) : (e.openvisitviewer && editVisit("", 0, 0, t, e.openvisitviewer), e.msg && "" != e.msg && flagAlertMessage(e.msg, "info"), calendar.refetchResources(), calendar.refetchEvents(), refreshdTables(e)) }) } function g(e, t, a, s) { s.prop("disabled", !0), $("#hhk-roomChsrtitle").addClass("hhk-loading"), $("#rmDepMessage").text("").hide(), d = new Date; e = { cmd: "visitRoomList", idVisit: e, span: t, chgDate: a.toDateString(), selRescId: s.val() }; $.post("ws_ckin.php", e, function (e) { var t; s.prop("disabled", !1), $("#hhk-roomChsrtitle").removeClass("hhk-loading"); try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } e.error ? (e.gotopage && window.open(e.gotopage), flagAlertMessage(e.error, "error")) : (e.sel && (t = $(e.sel), s.children().remove(), t.children().appendTo(s), s.val(e.idResc).change()), rooms = e.rooms || {}) }) } this.rooms = {}, $.post("ws_ckin.php", { cmd: "showChangeVisitRoom", idVisit: v, span: m, idGuest: e }, function (r) { "use strict"; if (r) { try { r = $.parseJSON(r) } catch (e) { return void alert("Parser error - " + e.message) } if (r.error) return r.gotopage ? void window.location.assign(r.gotopage) : void flagAlertMessage(r.error, "error"); let e = new Date(r.visitSpan.start); var n = new Date(r.visitSpan.end), d = r.visitSpan.showChangeNow, l = r.visitSpan.reservedIdResource, c = r.visitSpan.reservedTitle; r.visitSpan.hasReservedSpan; const u = new Date; let t = $("#chgRoomDialog"), a = (t.children().remove(), t.append($('<div class="hhk-tdbox hhk-visitdialog" style="font-size:0.8em;"/>').append($(r.success))), t.find("#selResource")), s = t.find("#resvChangeDate"), o = t.find("#resvFutureDate"); var p = t.find("input[name=rbReplaceRoom]"); let i = t.find("#cbUseDefaultRate"); s.datepicker({ yearRange: "-03:+01", changeMonth: !0, changeYear: !0, autoSize: !0, numberOfMonths: 1, maxDate: "+1y", minDate: e, dateFormat: "M d, yy" }), o.datepicker({ yearRange: "-03:+01", changeMonth: !0, changeYear: !0, autoSize: !0, numberOfMonths: 1, maxDate: "+1y", minDate: e, dateFormat: "M d, yy" }), s.datepicker("setDate", u), o.datepicker("setDate", n), r.visitSpan.hasReservedSpan && s.datepicker("setDate", n), p.change(function () { "new" == $(this).val() && "" !== s.val() ? s.change() : "rpl" == $(this).val() && ($("#trFutureDate").hide(), g(v, m, e, a)) }), s.change(function () { $('input[id="rbReplaceRoomnew"]').prop("checked", !0), r.visitSpan.hasReservedSpan = !1 }), rooms = r.rooms || {}, a.change(function () { var e = $(this).val(); rooms[e] && r.curResc.key < rooms[e].key ? t.find("#rmDepMessage").text("Deposit required").show() : t.find("#rmDepMessage").empty().hide(), rooms[e] && "" == r.curResc.defaultRateCat && "" != rooms[e].defaultRateCat || "" != r.curResc.defaultRateCat && "" != rooms[e].defaultRateCat && r.curResc.defaultRateCat != rooms[e].defaultRateCat ? t.find("#trUseDefaultRate").show() : t.find("#trUseDefaultRate").hide() }), d && 0 < l && (a.append($("<option>", { value: l, text: c })), a.val(l).prop("disabled", !0), $('input[id="rbReplaceRoomnew"]').prop("checked", !0), p.prop("disabled", !0), s.datepicker("option", "minDate", n), s.datepicker("option", "maxDate", u)), a.change(); d = { "Change Rooms": function () { 0 < $("#selResource").val() ? (f(v, m, a.val(), $('input[name="rbReplaceRoom"]:checked').val(), i.prop("checked"), s.datepicker("getDate").toUTCString(), o.datepicker("getDate").toUTCString()), $(this).dialog("close")) : $("#rmDepMessage").text("Choose a room").show() }, Cancel: function () { $(this).dialog("close") } }; t.dialog("option", "title", "Change Rooms for " + h), t.dialog("option", "width", "400px"), t.dialog("option", "buttons", d), t.dialog("open") } }) } function moveDates(e, t, a, s, o, i) { $.post("ws_ckin.php", { cmd: e, idVisit: t, span: a, sdelta: s, edelta: o }, function (e) { if (e) { try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } e.error ? (e.gotopage && window.location.assign(e.gotopage), flagAlertMessage(e.error, "error")) : e.success && flagAlertMessage(e.success, "success"), void 0 !== i && !0 !== i || (calendar.refetchResources(), calendar.refetchEvents(), refreshdTables(e)) } }) } function getResvRoomList(e, t, a) { e && $.post("ws_ckin.php", { cmd: "resvRoomlist", rid: e, x: t }, function (t) { try { t = $.parseJSON(t) } catch (e) { return void alert("Parser error - " + e.message) } if (t.error) t.gotopage && window.location.assign(t.gotopage), flagAlertMessage(t.error, "error"); else if (t.container) { let e = $(t.container); $("body").append(e), e.position({ my: "top", at: "bottom", of: a }), $("#selRoom").change(function () { "" == $("#selRoom").val() || confirm("Change room to " + $("#selRoom option:selected").text() + "?") && moveResvRoom(t.rid, $("#selRoom").val()), e.remove() }) } }) } function refreshPayments() { $("#btnFeesGo").click() } function getDtBtns(e, t = !0, a = "") { return [{ extend: "print", className: "ui-corner-all", autoPrint: !0, paperSize: "letter", exportOptions: { stripHtml: t, columns: ":not('.noPrint')" }, title: function () { return e }, messageBottom: function () { return '<div style="padding-top: 10px; position: fixed; bottom: 0; right: 0">Printed on ' + (moment().format("MMM D, YYYY") + " at " + moment().format("h:mm a")) + "</div>" }, customize: function (e) { $(e.document.body).css("font-size", "0.9em"), 0 < a.length && $(e.document.body).addClass(a), $(e.document.body).find("table").css("font-size", "inherit") } }] } function updateFuture() { $.post("ws_resv.php", { cmd: "updtFuture" }, function (e) { if (e) { try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } e.error ? (e.gotopage && window.location.assign(e.gotopage), flagAlertMessage(e.error, "error")) : e.success && flagAlertMessage(e.success, "success"), 0 < e.records && (calendar.refetchResources(), calendar.refetchEvents(), refreshdTables(e)) } }) } var calendar, hindx = 0, pmtMkup = $("#pmtMkup").val(), pmtStatus = $("#pmtStatus").val(), rctMkup = $("#rctMkup").val(), defaultTab = $("#defaultTab").val(), resourceGroupBy = $("#resourceGroupBy").val(), resourceColumnWidth = $("#resourceColumnWidth").val(), patientLabel = $("#patientLabel").val(), visitorLabel = $("#visitorLabel").val(), referralFormTitleLabel = $("#referralFormTitleLabel").val(), reservationLabel = $("#reservationLabel").val(), reservationTabLabel = $("#reservationTabLabel").val(), unconfirmedResvTabLabel = $("#unconfirmedResvTabLabel").val(), defaultView = $("#defaultView").val(), defaultEventColor = $("#defaultEventColor").val(), defCalEventTextColor = $("#defCalEventTextColor").val(), calDateIncrement = $("#calDateIncrement").val(), dateFormat = $("#dateFormat").val(), fixedRate = $("#fixedRate").val(), resvPageName = $("#resvPageName").val(), showCreatedDate = $("#showCreatedDate").val(), expandResources = $("#expandResources").val(), shoHospitalName = $("#shoHospitalName").val(), showRateCol = $("#showRateCol").val(), hospTitle = $("#hospTitle").val(), showDiags = $("#showDiags").val(), showLocs = $("#showLocs").val(), locationTitle = $("#locationTitle").val(), diagnosisTitle = $("#diagnosisTitle").val(), showWlNotes = $("#showWlNotes").val(), wlTitle = $("#wlTitle").val(), showCharges = $("#showCharges").val(), acceptResvPay = $("#acceptResvPay").val(), holidays = $.parseJSON($("#holidays").val()), closedDays = $.parseJSON($("#closedDays").val()), showCurrentGuestPhotos = $("#showCurrentGuestPhotos").val(), useOnlineReferral = $("#useOnlineReferral").val(); $(document).ready(function () { "use strict"; var e = [{ data: "Action", title: "Action", sortable: !1, searchable: !1, className: "noPrint" }, { data: visitorLabel + " First", title: visitorLabel + " First" }, { data: visitorLabel + " Last", title: visitorLabel + " Last" }, { data: "Checked In", title: "Checked In", render: function (e, t) { return dateRender(e, t, dateFormat) } }, { data: "Nights", title: "Nights", className: "hhk-justify-c" }, { data: "Expected Departure", title: "Expected Departure", render: function (e, t) { return dateRender(e, t, dateFormat) } }, { data: "Room", title: "Room", className: "hhk-justify-c" }]; showRateCol && e.push({ data: "Rate", title: "Rate" }), e.push({ data: "Phone", title: "Phone" }), shoHospitalName && e.push({ data: "Hospital", title: hospTitle }), e.push({ data: "Patient", title: patientLabel }), showCurrentGuestPhotos && e.unshift({ data: "photo", title: "Photo", sortable: !1, searchable: !1, className: "noPrint", width: "80px" }), $("#btnTextCurGuests").button().smsDialog({ campaign: "checked_in" }), $("#btnTextConfResvGuests").button().smsDialog({ campaign: "confirmed_reservation" }), $("#btnTextUnConfResvGuests").button().smsDialog({ campaign: "unconfirmed_reservation" }), $("#btnTextWaitlistGuests").button().smsDialog({ campaign: "waitlist" }); let a = $('<div id="registerNotes" class="visitDialog" style="font-size: 0.8em;"><div class="regNotesWrapper hhk-tdbox"></div></div>'); $("document").append(a), a.dialog({ autoOpen: !1, height: "auto", minHeight: 800, width: getDialogWidth(1500), modal: !0, close: function (e, t) { a.find("#note-newNote").trigger("click"), a.find(".regNotesWrapper").empty() }, buttons: { Close: function () { a.dialog("close") } }, position: { my: "center", at: "center" } }), $(".btnRegNotes").button().on("click", function (e) { e.preventDefault(); var e = $(this).data("title"), t = $(this).data("linktype"); a.dialog("open"), a.dialog("option", "title", e), a.find(".regNotesWrapper").notesViewer({ linkId: 0, linkType: t, newNoteLocation: "hidden", defaultLength: 10, alertMessage: function (e, t) { flagAlertMessage(e, t) } }) }); var t = [{ data: "Action", title: "Action", sortable: !1, searchable: !1, className: "noPrint" }, { data: "Guest First", title: visitorLabel + " First" }, { data: "Guest Last", title: visitorLabel + " Last" }, { data: "Expected Arrival", title: "Expected Arrival", render: function (e, t) { return dateRender(e, t, dateFormat) } }, { data: "Nights", title: "Nights", className: "hhk-justify-c" }, { data: "Expected Departure", title: "Expected Departure", render: function (e, t) { return dateRender(e, t, dateFormat) } }, { data: "Room", title: "Room", className: "hhk-justify-c" }], s = (showRateCol && t.push({ data: "Rate", title: "Rate" }), t.push({ data: "Occupants", title: "Occupants", className: "hhk-justify-c" }), acceptResvPay && t.push({ data: "PrePaymt", title: "Pre-Paymt", className: "hhk-justify-c" }), shoHospitalName && t.push({ data: "Hospital", title: hospTitle }), showLocs && t.push({ data: "Location", title: locationTitle }), showDiags && t.push({ data: "Diagnosis", title: diagnosisTitle }), t.push({ data: "Patient", title: patientLabel }), [{ data: "Action", title: "Action", sortable: !1, searchable: !1, className: "noPrint" }, { data: "Guest First", title: visitorLabel + " First" }, { data: "Guest Last", title: visitorLabel + " Last" }]); showCreatedDate && (s.push({ data: "Timestamp", title: "Created On", render: function (e, t) { return dateRender(e, t, "MMM D, YYYY H:mm") } }), s.push({ data: "Updated_By", title: "Updated By" })), s.push({ data: "Expected Arrival", title: "Expected Arrival", render: function (e, t) { return dateRender(e, t, dateFormat) } }), s.push({ data: "Nights", title: "Nights", className: "hhk-justify-c" }), s.push({ data: "Expected Departure", title: "Expected Departure", render: function (e, t) { return dateRender(e, t, dateFormat) } }), s.push({ data: "Occupants", title: "Occupants", className: "hhk-justify-c" }), acceptResvPay && s.push({ data: "PrePaymt", title: "Pre-Paymt", className: "hhk-justify-c" }), shoHospitalName && s.push({ data: "Hospital", title: hospTitle }), showLocs && s.push({ data: "Location", title: locationTitle }), showDiags && s.push({ data: "Diagnosis", title: diagnosisTitle }), s.push({ data: "Patient", title: patientLabel }), showWlNotes && s.push({ data: "WL Notes", title: wlTitle }); let o = [{ data: "titleSort", visible: !1 }, { data: "Title", title: "Room", orderData: [0, 1], className: "hhk-justify-c" }, { data: "Status", title: "Status", searchable: !1 }, { data: "Guests", title: visitorLabel + "s" }, { data: "Patient_Name", title: patientLabel }], i = (showCharges && o.push({ data: "Unpaid", title: "Unpaid", className: "hhk-justify-r" }), o.push({ data: "Visit_Notes", title: "Last Visit Note", sortable: !1 }), o.push({ data: "Notes", title: "Room Notes", sortable: !1 }), "" !== pmtMkup && "" !== pmtStatus && flagAlertMessage(pmtMkup, pmtStatus), $('input[type="button"], input[type="submit"]').button(), $.datepicker.setDefaults({ yearRange: "-10:+02", changeMonth: !0, changeYear: !0, autoSize: !0, numberOfMonths: 2, dateFormat: "M d, yy" }), $.extend($.fn.dataTable.defaults, { dom: '<"dtTop"if>rt<"dtBottom"lp><"clear">', displayLength: 50, lengthMenu: [[25, 50, -1], [25, 50, "All"]], order: [[3, "asc"]], processing: !0, deferRender: !0 }), $("#vstays").on("click", ".applyDisc", function (e) { e.preventDefault(), $(".hhk-alert").hide(), getApplyDiscDiag($(this).data("vid"), $("#pmtRcpt")) }), $("#vstays").on("click", ".stckout", function (e) { e.preventDefault(), $(".hhk-alert").hide(), ckOut($(this).data("name"), $(this).data("id"), $(this).data("rid"), $(this).data("vid"), $(this).data("spn")) }), $("#vstays").on("click", ".stvisit", function (e) { e.preventDefault(), $(".hhk-alert").hide(), editVisit($(this).data("name"), $(this).data("id"), $(this).data("rid"), $(this).data("vid"), $(this).data("spn")) }), $("#vstays").on("click", ".hhk-getPSGDialog", function (e) { e.preventDefault(), $(".hhk-alert").hide(), editPSG($(this).data("psg")) }), $("#vstays").on("click", ".stchgrooms", function (e) { e.preventDefault(), $(".hhk-alert").hide(), showChangeVisitRoom($(this).data("name"), $(this).data("id"), $(this).data("vid"), $(this).data("spn")) }), $("#vstays").on("click", ".stcleaning", function (e) { e.preventDefault(), $(".hhk-alert").hide(), chgRoomCleanStatus($(this).data("idroom"), $(this).data("clean")) }), $("#vresvs, #vwls, #vuncon").on("click", ".resvStat", function (e) { e.preventDefault(), $(".hhk-alert").hide(), cgResvStatus($(this).data("rid"), $(this).data("stat")) }), $(".ckdate").datepicker(), $("#regckindate").val(moment().format("MMM DD, YYYY")), $("#statEvents").dialog({ autoOpen: !1, resizable: !0, width: getDialogWidth(1e3), modal: !0, title: "Manage Status Events" }), $("#statEvents").data("uiDialog")._focusTabbable = function () { }, $("#keysfees").dialog({ autoOpen: !1, resizable: !0, modal: !0, close: function (e, t) { $("div#submitButtons").show() }, open: function (e, t) { $("div#submitButtons").hide() } }), $(document).mousedown(function (e) { var t = $("div#pudiv"); t.is(e.target) || 0 !== t.has(e.target).length || t.remove() }), $("#faDialog").dialog({ autoOpen: !1, resizable: !0, width: getDialogWidth(650), modal: !0, title: "Income Chooser" }), $("#setBillDate").dialog({ autoOpen: !1, resizable: !0, modal: !0, title: "Set Invoice Billing Date" }), $("#chgRoomDialog").dialog({ autoOpen: !1, resizable: !0, modal: !0 }), $("#pmtRcpt").dialog({ autoOpen: !1, resizable: !0, width: getDialogWidth(530), modal: !0, title: "Payment Receipt" }), "" === $("#txtactstart").val() && ((n = new Date).setTime(n.getTime() - 432e6), $("#txtactstart").datepicker("setDate", n)), "" === $("#txtfeestart").val() && ((n = new Date).setTime(n.getTime() - 2592e5), $("#txtfeestart").datepicker("setDate", n)), $("#txtsearch").keypress(function (e) { var t = $(this).val(); "13" == e.keyCode && ("" !== t && isNumber(parseInt(t, 10)) ? 0 < t && window.location.assign("GuestEdit.php?id=" + t) : alert("Don't press the return key unless you enter an Id."), e.preventDefault()) }), createRoleAutoComplete($("#txtsearch"), 3, { cmd: "guest" }, function (e) { 0 < e.id && window.location.assign("GuestEdit.php?id=" + e.id) }, !1), null); 0 < calDateIncrement && calDateIncrement < 5 && (i = { weeks: calDateIncrement }), $("#selRoomGroupScheme").val(resourceGroupBy); var r, n = window.innerHeight, d = (window.innerWidth < 576 ? (defaultView = "timeline4days", i = { days: 4 }) : window.innerWidth <= 768 && (defaultView = "timeline1weeks"), document.getElementById("calendar")); (calendar = new FullCalendar.Calendar(d, { schedulerLicenseKey: "CC-Attribution-NonCommercial-NoDerivatives", height: n - 187, firstDay: 0, dateIncrement: i, nextDayThreshold: "13:00", eventColor: defaultEventColor, eventTextColor: defCalEventTextColor, eventOrder: "start, id, title", eventResizableFromStart: !1, initialView: defaultView, editable: !0, resourcesInitiallyExpanded: expandResources, resourceAreaHeaderContent: "Rooms", nowIndicator: !1, resourceAreaWidth: resourceColumnWidth, refetchResourcesOnNavigate: !0, resourceGroupField: resourceGroupBy, customButtons: { refresh: { text: "Refresh", click: function () { calendar.refetchResources(), calendar.refetchEvents() } }, prevMonth: { click: function () { calendar.incrementDate({ months: -1 }) } }, nextMonth: { click: function () { calendar.incrementDate({ months: 1 }) } } }, buttonIcons: { nextMonth: "chevrons-right", prevMonth: "chevrons-left" }, views: { timeline4days: { type: "resourceTimeline", slotDuration: { days: 1 }, slotLabelFormat: { weekday: "short", day: "numeric" }, duration: { days: 4 }, buttonText: "4 Days" }, timeline1weeks: { type: "resourceTimeline", slotDuration: { days: 1 }, slotLabelFormat: { weekday: "short", day: "numeric" }, duration: { weeks: 1 }, buttonText: "1" }, timeline2weeks: { type: "resourceTimeline", slotLabelFormat: { weekday: "short", day: "numeric" }, slotDuration: { days: 1 }, duration: { weeks: 2 }, buttonText: "2" }, timeline3weeks: { type: "resourceTimeline", slotLabelFormat: { weekday: "short", day: "numeric" }, slotDuration: { days: 1 }, duration: { weeks: 3 }, buttonText: "3" }, timeline4weeks: { type: "resourceTimeline", slotLabelFormat: [{ month: "short", year: "numeric" }, { day: "numeric" }], slotDuration: { days: 7 }, duration: { weeks: 26 }, buttonText: "26" } }, headerToolbar: { left: "title", center: "", right: "timeline1weeks,timeline2weeks,timeline3weeks,timeline4weeks refresh,today prevMonth,prev,next,nextMonth" }, slotLabelClassNames: "hhk-fc-slot-title", slotLaneClassNames: function (e) { var t; return e.isToday ? "hhk-fcslot-today" : (t = e.date.getFullYear() + "-" + (e.date.getMonth() + 1) + "-" + e.date.getDate(), holidays.includes(t) ? "hhk-fcslot-holiday" : closedDays.includes(e.date.getDay()) ? "fc-cell-shaded" : void 0) }, loading: function (e) { e ? ($("#pCalLoad").show(), $("#spnGotoDate").hide()) : ($("#pCalLoad").hide(), $("#spnGotoDate").show()) }, resourceOrder: "Util_Priority,idResc", resources: { url: "ws_calendar.php", extraParams: { cmd: "resclist", gpby: $("#selRoomGroupScheme").val() } }, resourceLabelDidMount: function (e) { e.el.style.background = e.resource.extendedProps.bgColor, e.el.style.color = e.resource.extendedProps.textColor, 0 < e.resource.extendedProps.idResc && (e.resource.extendedProps.hoverText ? e.el.title = e.resource.extendedProps.hoverText : e.el.title = "Maximum Occupants: " + e.resource.extendedProps.maxOcc, e.el.style.cursor = "pointer", e.el.onclick = function () { getStatusEvent(e.resource.extendedProps.idResc, "resc", e.resource.title) }) }, eventOverlap: function (e, t) { return e.idVisit === t.idVisit }, events: { url: "ws_calendar.php?cmd=eventlist", failure: function () { $("#pCalError").text("Error getting events!").show() } }, eventDrop: function (e) { $(".hhk-alert").hide(); var t = e.event; if (0 < t.extendedProps.idVisit && 0 !== e.delta.days && confirm("Move Visit to a new start date?")) moveDates("visitMoveDates", t.extendedProps.idVisit, t.extendedProps.Span, e.delta.days, e.delta.days); else { if (0 < t.extendedProps.idReservation) { var a = t.getResources()[0]; if (0 !== e.delta.days && a.extendedProps.idResc === t.extendedProps.idResc) { if (confirm("Move Reservation to a new start date?")) return void moveDates("reservMoveDates", t.extendedProps.idReservation, 0, e.delta.days, e.delta.days) } else 0 !== e.delta.days && confirm("Move Reservation to a new start date?") && moveDates("reservMoveDates", t.extendedProps.idReservation, 0, e.delta.days, e.delta.days, !1); if (a.extendedProps.idResc !== t.extendedProps.idResc) { let e = "Move Reservation to a new room?"; if (0 == a.extendedProps.idResc && (e = "Move Reservation to the waitlist?"), confirm(e) && moveResvRoom(t.extendedProps.idReservation, a.extendedProps.idResc)) return } } e.revert() } }, eventResize: function (e) { $(".hhk-alert").hide(), void 0 === e.endDelta ? e.revert() : 0 < e.event.extendedProps.idVisit && confirm("Change end date?") ? moveDates("visitMoveDates", e.event.extendedProps.idVisit, e.event.extendedProps.Span, 0, e.endDelta.days) : 0 < e.event.extendedProps.idReservation && confirm("Move expected end date?") ? moveDates("reservMoveDates", e.event.extendedProps.idReservation, 0, 0, e.endDelta.days) : e.revert() }, eventClick: function (e) { if ($(".hhk-alert").hide(), e.event.extendedProps.kind && "oos" === e.event.extendedProps.kind) getStatusEvent(e.event.extendedProps.idResc, "resc", e.event.title); else { if (e.event.extendedProps.idReservation && 0 < e.event.extendedProps.idReservation) { if (e.jsEvent.target.classList.contains("hhk-schrm")) return void getResvRoomList(e.event.extendedProps.idReservation, e.jsEvent.target.id, e.jsEvent.target); window.location.assign(resvPageName + "?rid=" + e.event.extendedProps.idReservation) } e.event.extendedProps.idVisit && 0 < e.event.extendedProps.idVisit && viewVisit(0, e.event.extendedProps.idVisit, { "Show Statement": function () { window.open("ShowStatement.php?vid=" + e.event.extendedProps.idVisit, "_blank") }, "Show Registration Form": function () { window.open("ShowRegForm.php?vid=" + e.event.extendedProps.idVisit + "&span=" + e.event.extendedProps.Span, "_blank") }, Save: function () { saveFees(0, e.event.extendedProps.idVisit, e.event.extendedProps.Span, !0, "register.php") }, Cancel: function () { $(this).dialog("close") } }, "Edit Visit #" + e.event.extendedProps.idVisit + "-" + e.event.extendedProps.Span, "", e.event.extendedProps.Span) } }, eventContent: function (e) { var t, a = document.createElement("span"); return a.appendChild(document.createTextNode(e.event.title)), a.classList.add("ml-1"), void 0 !== e.event.extendedProps.idReservation ? ((t = document.createElement("Span")).classList.add("hhk-schrm", "ui-icon", "ui-icon-arrowthick-2-n-s"), t.style.backgroundColor = "#fff", t.style.border = "0px solid black", t.id = e.event.extendedProps.idResc, { domNodes: [t, a] }) : { domNodes: [a] } }, eventDidMount: function (e) { var t; void 0 === hindx || 0 === hindx || void 0 === e.event.extendedProps.idHosp || e.event.extendedProps.idAssoc == hindx || e.event.extendedProps.idHosp == hindx ? (t = calendar.getResourceById("id-" + e.event.extendedProps.idResc), e.textColor && ("string" != typeof e.textColor || "white" != e.textColor.toLowerCase() && "#ffffff" != e.textColor.toLowerCase()) || e.el.classList.add("hhk-event-light"), void 0 !== e.event.extendedProps.idReservation ? (e.el.title = e.event.extendedProps.fullName + (0 < e.event.extendedProps.idResc ? ", " + t.title : "") + ", " + e.event.extendedProps.resvStatus + (shoHospitalName ? ", " + e.event.extendedProps.hospName : ""), "uc" === e.event.extendedProps.status ? e.el.style.border = "3px dashed black" : e.el.style.border = "3px solid black", e.el.style.padding = "1px 0", "" != e.event.extendedProps.backBorderColor && (e.el.style.cssText += "box-shadow: " + e.event.extendedProps.backBorderColor + " 0px 9px 0 0; margin-bottom:10px;")) : void 0 !== e.event.extendedProps.idVisit ? ("a" == e.event.extendedProps.vStatusCode || "r" == e.event.extendedProps.vStatusCode ? e.el.title = e.event.extendedProps.fullName + ", Room: " + t.title + ", Status: " + e.event.extendedProps.visitStatus + ", " + e.event.extendedProps.guests + (1 < e.event.extendedProps.guests ? " " + visitorLabel + "s" : " " + visitorLabel) + (shoHospitalName ? ", " + hospTitle + ": " + e.event.extendedProps.hospName : "") : e.el.title = e.event.extendedProps.fullName + ", Room: " + t.title + ", Status: " + e.event.extendedProps.visitStatus + (shoHospitalName ? ", " + hospTitle + ": " + e.event.extendedProps.hospName : ""), void 0 !== e.event.extendedProps.extended && e.event.extendedProps.extended && e.el.classList.remove("fc-event-end"), "" != e.event.extendedProps.backBorderColor && (e.el.style.cssText += "box-shadow: " + e.event.extendedProps.backBorderColor + " 0px 9px 0 0; margin-bottom:10px;")) : "oos" === e.event.extendedProps.kind && (e.el.title = e.event.extendedProps.reason), e.event.setProp("display", "auto")) : e.event.setProp("display", "none") } })).render(), window.onresize = function () { clearTimeout(r), r = setTimeout(calendar.setOption("height", window.innerHeight - 187), 100) }, 0 < $(".btnHosp").length && $(".btnHosp").click(function (e) { e.preventDefault(), $(".hhk-alert").hide(), $(".btnHosp").removeClass("hospActive"), $(this).addClass("hospActive"), hindx = parseInt($(this).data("id"), 10), isNaN(hindx) && (hindx = 0), calendar.refetchEvents() }), $("#btnFeesGo").click(function () { $(".hhk-alert").hide(); var t = $("#txtfeestart").datepicker("getDate"); if (null === t) $("#txtfeestart").addClass("ui-state-highlight"), flagAlertMessage("Enter start date", "alert"); else { $("#txtfeestart").removeClass("ui-state-highlight"); let e = $("#txtfeeend").datepicker("getDate"); null === e && (e = new Date); var a = $("#selPayStatus").val() || [], s = $("#selPayType").val() || [], t = { cmd: "actrpt", start: t.toDateString(), end: e.toDateString(), st: a, pt: s }; !1 !== $("#fcbdinv").prop("checked") && (t.sdinv = "on"), $("#rptFeeLoading").show(), t.fee = "on", $.post("ws_resc.php", t, function (e) { if ($("#rptFeeLoading").hide(), e) { try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } e.error ? (e.gotopage && window.open(e.gotopage, "_self"), flagAlertMessage(e.error, "error")) : e.success && ($("#rptfeediv").remove(), $("#vfees").append($('<div id="rptfeediv"/>').append($(e.success))), paymentsTable("feesTable", "rptfeediv", refreshPayments), $("#btnPayHistRef").hide()) } }) } }), $("#btnInvGo").click(function () { $.post("ws_resc.php", { cmd: "actrpt", st: ["up"], inv: "on" }, function (e) { if (e) { try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } e.error ? (e.gotopage && window.open(e.gotopage, "_self"), flagAlertMessage(e.error, "error")) : e.success && ($("#rptInvdiv").remove(), $("#vInv").append($('<div id="rptInvdiv"/>').append($(e.success))), $("#rptInvdiv .gmenu").menu({ focus: function (e, t) { $("#rptInvdiv .gmenu").not(this).menu("collapseAll", null, !0) } }), $("#rptInvdiv").on("click", ".invLoadPc", function (e) { e.preventDefault(), $("#divAlert1, #paymentMessage").hide(), invLoadPc($(this).data("name"), $(this).data("id"), $(this).data("iid")) }), $("#rptInvdiv").on("click", ".invSetBill", function (e) { e.preventDefault(), $(".hhk-alert").hide(), invSetBill($(this).data("inb"), $(this).data("payor"), "div#setBillDate", "#trBillDate" + $(this).data("inb"), $("#trBillDate" + $(this).data("inb")).text(), $("#divInvNotes" + $(this).data("inb")).text(), "#divInvNotes" + $(this).data("inb")) }), $("#rptInvdiv").on("click", ".invAction", function (e) { e.preventDefault(); let t = "#rptInvdiv"; if ($(".hhk-alert").hide(), "del" == $(this).data("stat")) { if (!confirm("Delete Invoice " + $(this).data("inb") + ("" != $(this).data("payor") ? " for " + $(this).data("payor") : "") + "?")) return; t = "" } "vem" === $(this).data("stat") ? window.open("ShowInvoice.php?invnum=" + $(this).data("inb")) : (invoiceAction($(this).data("iid"), $(this).data("stat"), $(this).prop("id"), t, !0), $("#rptInvdiv .gmenu").menu("collapse")) }), $("#InvTable").dataTable({ columnDefs: [{ targets: [2, 4], type: "date", render: function (e, t, a) { return dateRender(e, t) } }], dom: '<"top"if><"hhk-overflow-x hhk-tbl-wrap"rt><"bottom"lp><"clear">', displayLength: 50, lengthMenu: [[20, 50, 100, -1], [20, 50, 100, "All"]], order: [[1, "asc"]] })) } }) }), $("#btnPrintRegForm").click(function () { window.open($(this).data("page") + "?d=" + $("#regckindate").val(), "_blank") }), $("#btnPrintWL").click(function () { window.open($(this).data("page") + "?d=" + $("#regwldate").val(), "_blank") }), $("#btnUpdtFuture").button().click(function (e) { e.preventDefault(), updateFuture() }), $("#btnPrtDaily").button().click(function () { $("#divdaily").printArea() }), $("#btnRefreshDaily").button().click(function () { $("#daily").DataTable().ajax.reload() }), $("#txtGotoDate").change(function () { $(".hhk-alert").hide(), calendar.gotoDate($(this).datepicker("getDate")) }), $("#selRoomGroupScheme").change(function () { $("#divRoomGrouping").hide(), calendar.setOption("resourceGroupField", $(this).val()) }), "" !== rctMkup && showReceipt("#pmtRcpt", rctMkup, "Payment Receipt"), $("#mainTabs").tabs({ beforeActivate: function (e, t) { var a; "liInvoice" === t.newTab.prop("id") && $("#btnInvGo").click(), "liDaylog" === t.newTab.prop("id") && ($dailyTbl = $dailyTbl || $("#daily").DataTable({ ajax: { url: "ws_resc.php?cmd=getHist&tbl=daily", dataSrc: "daily" }, order: [[0, "asc"]], columns: o, infoCallback: function (e, t, a, s, o, i) { return "Prepared: " + dateRender((new Date).toISOString(), "display", "ddd, MMM D YYYY, h:mm a") }, dom: '<"top"if><"hhk-overflow-x hhk-tbl-wrap"rt><"bottom ui-toolbar ui-helper-clearfix"lp>' })), "liStaffNotes" === t.newTab.prop("id") && (a = JSON.parse($("#staffNoteCats").val()), $(".staffNotesDiv").empty().notesViewer({ linkType: "staff", newNoteAttrs: { id: "staffNewNote", name: "staffNewNote" }, newNoteLocation: "top", defaultLength: 25, defaultLengthMenu: [[5, 10, 25, 50], ["5", "10", "25", "50"]], alertMessage: function (e, t) { flagAlertMessage(e, t) }, staffNoteCats: a })), "liCal" === t.newTab.prop("id") && (calendar.refetchResources(), calendar.refetchEvents()) }, active: defaultTab }), $("#calendar .fc-header-toolbar .fc-toolbar-chunk:nth-child(2)").html($("#divGoto").show()), $("#calendar .fc-header-toolbar .fc-toolbar-chunk:nth-child(3) .fc-button-group:nth-child(1)").addClass("hideMobile"), $("#hhk-loading-spinner").hide(), $("#mainTabs").show(), useOnlineReferral && $.ajax({ url: "ws_resc.php", dataType: "JSON", type: "get", data: { cmd: "listforms", totalsonly: "true" }, success: function (e) { e.totals && ($("#vreferrals").referralViewer({ statuses: e.totals, labels: { patient: patientLabel, referralFormTitle: referralFormTitleLabel, reservation: reservationLabel } }), $("#spnNumReferral").text(e.totals.n.count)) } }), $("#curres").DataTable({ ajax: { url: "ws_resc.php?cmd=getHist&tbl=curres", dataSrc: "curres" }, drawCallback: function (e) { var t = this.api().rows().data().length; $("#spnNumCurrent").text(this.api().rows().data().length), $("#spnCurrentS").text("s"), 1 == t && $("#spnCurrentS").text(""), $("#curres .gmenu").menu({ focus: function (e, t) { $("#curres .gmenu").not(this).menu("collapseAll", null, !0) } }), $("#curres .btnShowVisitMsgs").off("click"), $("#curres .btnShowVisitMsgs").each(function () { $(this).smsDialog({ visitId: $(this).data("vid"), spanId: $(this).data("span") }) }) }, columns: e, buttons: getDtBtns("Current " + visitorLabel + "s - " + moment().format("MMM D, YYYY"), !1, "hhk-strip-links"), dom: '<"top"Bif><"hhk-overflow-x"rt><"bottom ui-toolbar ui-helper-clearfix"lp>', autoWidth: !1 }), $("#reservs").DataTable({ ajax: { url: "ws_resc.php?cmd=getHist&tbl=reservs", dataSrc: "reservs" }, drawCallback: function (e) { $("#spnNumConfirmed").text(this.api().rows().data().length), $("#reservs .gmenu").menu({ focus: function (e, t) { $("#reservs .gmenu").not(this).menu("collapseAll", null, !0) } }), $("#reservs .btnShowResvMsgs").off("click"), $("#reservs .btnShowResvMsgs").each(function () { $(this).smsDialog({ resvId: $(this).data("rid") }) }) }, columns: t, buttons: getDtBtns(reservationTabLabel + " - " + moment().format("MMM D, YYYY")), dom: '<"top"Bif><"hhk-overflow-x"rt><"bottom ui-toolbar ui-helper-clearfix"lp>' }), 0 < $("#unreserv").length && $("#unreserv").DataTable({ ajax: { url: "ws_resc.php?cmd=getHist&tbl=unreserv", dataSrc: "unreserv" }, drawCallback: function (e) { $("#spnNumUnconfirmed").text(this.api().rows().data().length), $("#unreserv .gmenu").menu({ focus: function (e, t) { $("#unreserv .gmenu").not(this).menu("collapseAll", null, !0) } }), $("#unreserv .btnShowResvMsgs").off("click"), $("#unreserv .btnShowResvMsgs").each(function () { $(this).smsDialog({ resvId: $(this).data("rid") }) }) }, columns: t, buttons: getDtBtns(unconfirmedResvTabLabel + " - " + moment().format("MMM D, YYYY")), dom: '<"top"Bif><"hhk-overflow-x"rt><"bottom ui-toolbar ui-helper-clearfix"lp>' }), $("#waitlist").DataTable({ ajax: { url: "ws_resc.php?cmd=getHist&tbl=waitlist", dataSrc: "waitlist" }, order: [[showCreatedDate ? 5 : 3, "asc"]], drawCallback: function () { $("#spnNumWaitlist").text(this.api().rows().data().length), $("#waitlist .gmenu").menu({ focus: function (e, t) { $("#waitlist .gmenu").not(this).menu("collapseAll", null, !0) } }), $("#waitlist .btnShowResvMsgs").off("click"), $("#waitlist .btnShowResvMsgs").each(function () { $(this).smsDialog({ resvId: $(this).data("rid") }) }) }, columns: s, buttons: getDtBtns("Waitlist - " + moment().format("MMM D, YYYY")), dom: '<"top"Bif><"hhk-overflow-x"rt><"bottom ui-toolbar ui-helper-clearfix"lp>' }), $("#vstays, #vresvs, #vuncon, #vdaily, #vwls").each(function () { $(this).find("h3 span:first").after($(this).find(".dt-buttons button").css("font-size", "0.9em").addClass("ml-5")) }) });