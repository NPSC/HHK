function removeSlot(a){"use strict";a&&""!==a&&($("."+a+"Slot").remove(),countGuests())}function removePatient(){"use strict";for(var a=chkIn,b=0;b<a.members.length;b++)a.members[b]&&a.members[b].idName===a.patient.idName&&a.members.splice(b,1);a.patient=null,a.havePatient=!1,a.patientStaying=null,$("div#patientSection").children().remove().end().hide("scale, horizontal")}function resvPicker(a,b){"use strict";b.children().remove(),b.append($(a.resCh)),b.children().find("input:button").button(),b.children().find(".hhk-checkinNow").click(function(){window.open("CheckIn.php?rid="+$(this).data("rid"),"_self")}),b.dialog("open")}function injectSlot(a){"use strict";var b="";if(a.idPrefix&&(b=a.idPrefix),a.memMkup&&a.txtHdr){var c=$("<div/>").append($(a.memMkup));c.addClass(b+"Slot "+b+"detail ui-widget-content ui-corner-bottom");var d=$("<ul id='ulIcons' style='float:right;margin-left:5px;padding-top:3px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='"+a.idPrefix+"drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),e=$('<div id="'+b+'memHdr"/>').append($(a.txtHdr)).append($('<span id="'+b+'memMsg" style="float:left;color: red; margin-right:20px;margin-left:20px;"></span>')).append(d).click(function(){"none"===c.css("display")?(c.show("blind"),e.removeClass("ui-corner-all").addClass("ui-corner-top")):(c.hide("blind"),e.removeClass("ui-corner-top").addClass("ui-corner-all"))});if(a.rmvbtn){var f=$('<input type="button" id="'+b+'removeMem" data-slot="'+b+'" value="Remove" style="margin-top:3px;float:right;margin-right:.3em;padding: 0.2em 1em;" />');f.addClass("removeMem"),f.button(),e.append(f)}e.append($('<div style="clear:both;"/>')),e.addClass(b+"Slot ui-widget-header ui-state-default ui-corner-top").css("padding","2px").css("min-width","840px").css("margin-top","5px"),$("."+b+"Slot").remove();var g=$("div#guestAccordion"),h=c.find("select#"+b+"selPatRel");"slf"===h.val()?(g.prepend(c),g.prepend(e),e.removeClass("ui-state-default")):(g.append(e),g.append(c));var i=c.find("input#"+b+"incomplete");i.length>0?(i.change(function(){$(this).prop("checked")?$("#"+b+"naAddrIcon").show():$("#"+b+"naAddrIcon").hide()}),i.change()):$("#"+b+"naAddrIcon").hide(),$("div#guestAccordion .ckdate").datepicker(),c.find("select.bfh-countries").each(function(){var a=$(this);a.bfhcountries(a.data())}),c.find("select.bfh-states").each(function(){var a=$(this);a.bfhstates(a.data())}),$("#"+b+"phEmlTabs").tabs(),a.idName&&0===a.idName&&($("#"+b+"phEmlTabs").tabs("option","active",1),$("#"+b+"phEmlTabs").tabs("option","disabled",0)),h.change();var j;createZipAutoComplete($("input.hhk-zipsearch"),"ws_admin.php",j),$("#gstprompt").text("Add Guest: ")}return b}function ckedIn(a){"use strict";if($("#divAlert1").hide(),a.warning&&flagAlertMessage(a.warning,!0),a.xfer){var b=$("#xform");if(b.children("input").remove(),b.prop("action",a.xfer),a.paymentId&&""!=a.paymentId)b.append($('<input type="hidden" name="PaymentID" value="'+a.paymentId+'"/>'));else{if(!a.cardId||""==a.cardId)return void flagAlertMessage("PaymentId and CardId are missing!",!0);b.append($('<input type="hidden" name="CardID" value="'+a.cardId+'"/>'))}b.submit()}if(a.success){var c=$("#contentDiv");if(c.children().remove(),a.regform&&a.style&&(c.append($('<div id="print_button" style="float:left;">Print</div>')).append($('<div id="btnReg" style="float:left; margin-left:10px;">Check In Followup</div>')).append($('<div id="mesgReg" style="color: darkgreen; clear:left; font-size:1.5em;"></div>')).append($('<div style="clear: left;" class="RegArea"/>').append($(a.style)).append($(a.regform))),$("div#print_button, div#btnReg").button(),$("div#print_button").click(function(){$("div.RegArea").printArea()}),$("div#btnReg").click(function(){getRegistrationDialog(a.reg,c)})),a.ckmeout){var d={"Show Statement":function(){window.open("ShowStatement.php?vid="+a.vid,"_blank")},"Check Out":function(){saveFees(a.gid,a.vid,0,!0,"register.php")},Cancel:function(){$(this).dialog("close")}};viewVisit(a.gid,a.vid,d,"Check Out","co",0,a.ckmeout)}a.regDialog&&showRegDialog(a.regDialog,a.reg,c),a.receipt&&showReceipt("#pmtRcpt",a.receipt)}}function offerShare(a,b){loadReserv(a,b)}function loadReserv(a){"use strict";var b=chkIn;a.rid&&(b.idReserv=parseInt(a.rid,10)),$("div#guestAccordion").hide();var c=processGuests(a);a.warning&&""!=a.warning&&(c=!1,flagAlertMessage(a.warning,!0)),c?(a.vehicle&&($("#vehicle").children().remove().end().append($(a.vehicle)).show(),$("#cbNoVehicle").change(function(){this.checked?$("#tblVehicle").hide("blind"):$("#tblVehicle").show("blind"),$("#vehValidate").text("")}),$("#cbNoVehicle").change(),$("#btnNextVeh").button(),b.nextVeh=1,$("#btnNextVeh").click(function(){$("#trVeh"+b.nextVeh).show("fade"),++b.nextVeh>4&&$("#btnNextVeh").hide("fade")})),a.resc&&($("#rescList").children().remove().end().append($(a.resc)).show(),countGuests()),a.ratelist&&(b.rateList=a.ratelist),a.rate&&($("#rate").children().remove().end().append($(a.rate)).show(),$("#btnFapp").length>0&&($("#btnFapp").button(),$("#btnFapp").click(function(){getIncomeDiag(b.idReserv)})),setupRates(b,$("#selResource").val())),a.pay&&($("#pay").children().remove().end().append($(a.pay)).show(),$("#paymentDate").datepicker({yearRange:"-1:+01",numberOfMonths:1}),setupPayments(b.resources,$("#selResource"),$("#selRateCategory"))),b.hideGuests=!0,$("#btnChkin").show(),$("#btnDone").hide()):($("#btnChkin").hide(),countGuests()>0?$("#btnDone").show():$("#btnDone").hide(),$("#guestSearch").show()),$("div#guestAccordion").show("blind")}function processGuests(a){"use strict";var b=chkIn,c=$("#hospitalSection");if(void 0!==a.hvPat&&(b.havePatient=a.hvPat),b.havePatient?$("#patientSearch").hide("blind"):$("#patientSearch").show("blind"),a.patStay&&(b.patientStaying=a.patStay),a.addRoom&&(b.addRoom=a.addRoom),a.idPsg){if(b.idPsg&&b.idPsg>0&&a.idPsg>0&&b.idPsg!=a.idPsg)return flagAlertMessage("Dazed and confused!  Please try again. ",!0),b.idPsg=0,!1;b.idPsg=parseInt(a.idPsg,10)}if(a.vfee&&(b.visitFees=a.vfee),a.rooms&&(b.resources=a.rooms),a.rcur&&(b.currentGuests=parseInt(a.rcur,10)),a.rmax&&(b.maxRoom=parseInt(a.rmax,10)),a.guests){for(var d=0;d<a.guests.length;d++){for(var e=a.guests[d],f=!1,g=0;g<b.members.length;g++)0===e.idName&&b.members[g].idPrefix==e.idPrefix?f=!0:e.idName>0&&b.members[g].idName===e.idName&&(f=!0);if(!f){var h=injectSlot(e);b.members.push(new Mpanel(h,e.idName,e.role,h)),b.hideGuests&&$("."+h+"detail").hide("scale, horizontal")}}roomFull()}if(a.hosp&&(0===c.children().length||a.patient)){if(a.hosp.div){var i=$(a.hosp.div).addClass("pgdetail ui-widget-content"),j=$("<ul id='ulIcons' style='float:right;margin-left:5px;padding-top:3px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),k=$('<div id="divHdrHosp" style="padding:2px; cursor:pointer;"/>').append($(a.hosp.hdr)).append(j).append($('<div style="clear:both;"/>'));k.addClass("ui-widget-header ui-state-default ui-corner-top"),k.click(function(){"none"===i.css("display")?(i.show("blind"),k.removeClass("ui-corner-all").addClass("ui-corner-top")):(i.hide("blind"),k.removeClass("ui-corner-top").addClass("ui-corner-all"))}),$("#hospitalSection").children().remove().end().append(k).append(i),""!=$("#selHospital").val()&&$("#divHdrHosp").click()}else $("#hospitalSection").children().remove().end().append($(a.hosp)).show("blind");$("#txtEntryDate, #txtExitDate").datepicker(),createAutoComplete($("#txtAgentSch"),3,{cmd:"filter",add:"phone",basis:"ra"},getAgent),""===$("#a_txtLastName").val()&&$(".hhk-agentInfo").hide(),createAutoComplete($("#txtDocSch"),3,{cmd:"filter",basis:"doc"},getDoc),""===$("#d_txtLastName").val()&&$(".hhk-docInfo").hide()}if(a.patient&&""!=a.patient){var l=0;if($(".patientRelch").each(function(a){"slf"===$(this).val()&&l++}),l>0)flagAlertMessage("One of the guests is already set as the "+b.patientLabel+".  ",!0),b.patient=null;else{var o,p,q,m=$("div#patientSection"),n=$(a.patient);if(n.addClass("h_detail"),p=$('<div style="float:left;"/>').append($('<span style="font-size:1.2em;">'+b.patientLabel+": </span>")).append($('<span id="h_hdrFirstName" style="font-size:1.2em;">'+n.find("#h_txtFirstName").val()+"</span>")).append($('<span id="h_hdrLastName" style="font-size:1.2em;">'+n.find("#h_txtLastName").val()+"</span>")),b.patAsGuest&&p.append($('<span style="font-size:1.2em;"> - Not staying tonight</span>')),p.append($('<span id="h_naAddrIcon" class="hhk-icon-redLight" title="Incomplete Address" style="float:right;margin-top:2px;margin-left:5px;"><span>')),o=$('<div class="ui-widget-header ui-corner-top" style="padding:2px;"/>').append(p).append($('<span id="h_memMsg" style="color: red; margin-right:20px;margin-left:20px;"></span>')).append($('<span id="h_drpDown" class="ui-icon ui-icon-circle-triangle-s" style="float:right; cursor:pointer; margin:right:3px;"></span>').click(function(){"none"===n.css("display")?(n.show("blind"),o.removeClass("ui-corner-all").addClass("ui-corner-top")):(n.hide(),o.removeClass("ui-corner-top").addClass("ui-corner-all"))})),void 0!==a.rmvbtnp&&!0===a.rmvbtnp&&$("#h_Search").length>0){var r=$('<input type="button" id="remPatient"  value="Remove" style="float:right;margin-right:.3em;padding: 0.2em 1em;" />');r.click(function(){confirm("Remove "+b.patientLabel+"?")&&(removePatient(),$("#patientSearch").show("blind"),$("#hospitalSection").hide("blind"),$("#h_Search").focus())}),r.button(),o.append(r).append($('<div style="clear:both;"/>'))}m.children().remove().end().removeClass("hhk-panel").removeClass("hhk-visitdialog").addClass("ui-widget hhk-panel hhk-visitdialog").append(o).append(n),m.find("select.bfh-countries").each(function(){var a=$(this);a.bfhcountries(a.data())}),m.find("select.bfh-states").each(function(){var a=$(this);a.bfhstates(a.data())}),q=n.find("input#h_incomplete"),q.length>0?(q.change(function(){$(this).prop("checked")?$("#h_naAddrIcon").show():$("#h_naAddrIcon").hide()}),q.change()):$("#h_naAddrIcon").hide(),m.find("#h_phEmlTabs").tabs(),b.idPsg<1?($("div#patientSection #h_phEmlTabs").tabs("option","active",1),$("div#patientSection #h_phEmlTabs").tabs("option","disabled",[0])):$("#h_drpDown").click();var s;createZipAutoComplete($("div#patientSection .hhk-zipsearch"),"ws_admin.php",s),b.patient=new Mpanel(b.patientPrefix,$("#h_idName").val(),"p",b.patientPrefix),b.members.push(b.patient),$('.patientRelch option[value="slf"]').remove(),$("#hospitalSection").show("blind"),$("#patientSearch").hide("blind"),m.show("blind")}}return a.stays&&$("#stays").children().remove().end().append($(a.stays)).show("blind"),a.adnlrm?($("#addRoom").children().remove().end().append($(a.adnlrm)).show("blind"),$("#cbAddnlRoom").change(function(){!0===$(this).prop("checked")?b.addRoom=!0:b.addRoom=!1})):$("#addRoom").children().remove().end().hide("blind"),$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,dateFormat:"M d, yy"}),!0}function psgChooser(a){"use strict";var b=a.idGuest,c=a.role;$("#psgDialog").children().remove().end().append($(a.choosePsg)).dialog("option","buttons",{Open:function(){var a=!1,d=$("#psgDialog input[name=cbselpsg]:checked").data("pid");$("#psgDialog input[name=cbselpsg]:checked").data("ngid");if(chkIn.idPsg=$("#psgDialog input[name=cbselpsg]:checked").val(),$("#cbpstayy").length>0&&chkIn.idPsg>0){if(!1===$("#cbpstayy").prop("checked")&&!1===$("#cbpstayn").prop("checked"))return $("#spnstaymsg").text("Choose Yes or No"),void $(".pstaytd").addClass("ui-state-highlight");a=$("#cbpstayy").prop("checked"),d===b&&(c="p")}loadGuest(b,chkIn.idPsg,c,a),$("#psgDialog").dialog("close")},Cancel:function(){$("#"+chkIn.guestSearchPrefix+"Search").val(""),$("#psgDialog").dialog("close")}}).dialog("open")}function loadGuest(a,b,c,d){"use strict";var e=chkIn;if($("#divAlert1").hide(),a>0){if(null!==e.patient&&e.patient.idName==a){if(!confirm("The "+e.patientLabel+" is already set as NOT staying at the house tonight.  Is the "+e.patientLabel+" staying here tonight after all?"))return;removePatient(),d=!0}for(var f=0;f<e.members.length;f++)if(e.members[f].idName==a)return void flagAlertMessage("This person is already added.",!0)}c&&""!=c||(c="g"),null!==d&&(e.patientStaying=d);var g={cmd:"getMember",id:a,rid:e.idReserv,idPrefix:e.guestPrefix++,role:c,psg:b,patStay:d,hvPat:e.havePatient,addRoom:e.addRoom};$.post("ws_ckin.php",g).done(function(a){if(!a)return void alert("Bad Reply from Server");try{a=$.parseJSON(a)}catch(a){return void alert("Bad JSON Encoding")}if(a.error)return a.gotopage&&window.open(a.gotopage,"_self"),void flagAlertMessage(a.error,!0);a.warning&&flagAlertMessage(a.warning,!0);var b=chkIn;return void 0!==a.hvPat&&null!==a.hvPat&&(b.havePatient=a.hvPat),void 0!==a.patStay&&null!==a.patStay&&(b.patientStaying=a.patStay),a.choosePsg?void psgChooser(a):a.resCh?(b.idGuest=a.id,b.idPsg=a.idPsg,b.role=a.role,void resvPicker(a,$("#resDialog"))):(void 0!==a.rid&&null!==a.rid&&(b.idReserv=parseInt(a.rid)),a.addr&&(b.addr=a.addr),processGuests(a),a.resc&&($("#rescList").children().remove().end().append($(a.resc)).show(),$("#spnNumGuests").length>0&&$("#spnNumGuests").text(b.members.length-1+b.currentGuests)),$("#"+b.guestSearchPrefix+"Search").val(""),$("#"+b.patientPrefix+"Search").val(""),$(".hhk-info").hide(),$("#divResvList").hide(),$("#guestSearch").show(),void(countGuests()>0?$("#btnDone").show():$("#"+b.guestSearchPrefix+"Search").focus()))})}function countGuests(){"use strict";var a=chkIn,b=a.members.length;return a.patient&&b--,0==a.addRoom&&(b+=a.currentGuests),$("#spnNumGuests").length>0&&$("#spnNumGuests").text(b),b}function roomFull(){"use strict";var a=chkIn,b=countGuests();a.maxRoom>0&&b>a.maxRoom&&flagAlertMessage("The room is full.  ",!0)}function verifyDone(){"use strict";var b,d,e,a=chkIn,c=0,f=0;if(a.fillEmergCont||(f=2),0===a.members.length)return flagAlertMessage("Enter a Guest or "+a.patientLabel+".",!0),$("#"+a.guestSearchPrefix+"Search").addClass("ui-state-highlight"),!1;if($(".patientRelch").each(function(){"slf"===$(this).val()&&c++}),!a.patient&&0===c&&!a.havePatient)return flagAlertMessage("Enter a "+a.patientLabel+".",!0),!1;if($("#hospitalSection").find("input, select").each(function(){$(this).removeClass("ui-state-error")}),""===$("#selHospital").val())return $("#selHospital").addClass("ui-state-error"),flagAlertMessage("Select a hospital.",!0),$(".pgdetail").show("blind"),!1;var g="";if($("#txtEntryDate").length>0&&a.verifyHospDate){if(""===$("#txtEntryDate").val())$("#txtEntryDate").addClass("ui-state-error"),g="The Treatment Start Date is missing.";else try{b=$("#txtEntryDate").datepicker("getDate"),b.setTime(0,0,0)}catch(a){g="Something is wrong with the Treatment Start Date."}if(""!==g)return flagAlertMessage(g,!0),$(".pgdetail").show("blind"),!1}$(".pgdetail").hide("blind"),$("#guestAccordion, #patientSection").find(".ui-state-error").each(function(){$(this).removeClass("ui-state-error")});for(var h=0;h<a.members.length;h++){var j,k,i=a.members[h],l=$("#"+i.idPrefix+"memMsg");l.text("");var m=!1,n=$("span#"+i.idPrefix+"hdrFirstName").text()+" "+$("span#"+i.idPrefix+"hdrLastName").text();if(""===$("#"+i.idPrefix+"txtFirstName").val()&&($("#"+i.idPrefix+"txtFirstName").addClass("ui-state-error"),m=!0),""===$("#"+i.idPrefix+"txtLastName").val()&&($("#"+i.idPrefix+"txtLastName").addClass("ui-state-error"),m=!0),a.forceNamePrefix&&""===$("#"+i.idPrefix+"selPrefix").val()&&($("#"+i.idPrefix+"selPrefix").addClass("ui-state-error"),m=!0),m)return flagAlertMessage("Enter a first and last name for each guest & "+a.patientLabel+".",!0),$("."+i.idSlot+"detail").show("blind"),l.text("Incomplete Name"),!1;if($("#"+i.idPrefix+"selPatRel").length>0&&""===$("#"+i.idPrefix+"selPatRel").val())return $("#"+i.idPrefix+"selPatRel").addClass("ui-state-error"),l.text("Set "+a.patientLabel+" Relationship"),$("."+i.idSlot+"detail").show("blind"),flagAlertMessage(n+" is missing their "+a.patientLabel+" relationship.",!0),!1;if("slf"===$("#"+i.idPrefix+"selPatRel").val()&&a.patientBirthDate&&($("#"+i.idPrefix+"txtBirthDate").removeClass("ui-state-error"),""===$("#"+i.idPrefix+"txtBirthDate").val()))return flagAlertMessage(a.patientLabel+" needs a birth date.",!0),l.text("Birth date"),$("#"+i.idPrefix+"txtBirthDate").addClass("ui-state-error"),!1;if(!1===$("#"+i.idPrefix+"incomplete").prop("checked")&&($("."+i.idPrefix+"hhk-addr-val").each(function(){""===$(this).val()&&($(this).hasClass("bfh-states")||(l.text("Incomplete Address"),$(this).addClass("ui-state-error"),m=!0))}),m))return flagAlertMessage(n+" is missing some or all of their address.",!0),$("."+i.idSlot+"detail").show("blind"),!1;if($("#"+i.idPrefix+"cbEmrgLater").length>0&&!1===$("#"+i.idPrefix+"cbEmrgLater").prop("checked")&&f<1){if(""===$("#"+i.idPrefix+"txtEmrgFirst").val()&&""===$("#"+i.idPrefix+"txtEmrgLast").val()&&($("#"+i.idPrefix+"txtEmrgFirst").addClass("ui-state-error"),$("#"+i.idPrefix+"txtEmrgLast").addClass("ui-state-error"),m=!0),""===$("#"+i.idPrefix+"txtEmrgPhn").val()&&($("#"+i.idPrefix+"txtEmrgPhn").addClass("ui-state-error"),m=!0),""===$("#"+i.idPrefix+"selEmrgRel").val()&&($("#"+i.idPrefix+"selEmrgRel").addClass("ui-state-error"),m=!0),m)return l.text("Enter emergency contact information"),flagAlertMessage("Fill in "+n+"'s emergency contact information",!0),$("."+i.idSlot+"detail").show("blind"),!1;f++}if($("#"+i.idPrefix+"gstDate").length>0){if(""===$("#"+i.idPrefix+"gstDate").val())return $("#"+i.idPrefix+"gstDate").addClass("ui-state-error"),l.text("Enter guest check in date."),flagAlertMessage(n+" is missing their check-in date.",!0),!1;if(null===(j=$("#"+i.idPrefix+"gstDate").datepicker("getDate")))return $("#"+i.idPrefix+"gstDate").addClass("ui-state-error"),l.text("Guest check in date error."),flagAlertMessage(n+" is missing their check-in date.",!0),!1;if(j>new Date)return $("#"+i.idPrefix+"gstDate").addClass("ui-state-error"),l.text("The check-in date cannot be in the future."),flagAlertMessage(n+" cannot check into the future.  This is not the twilight zone.",!0),!1;if(e?j<e&&(e=j):e=j,""!==$("#"+i.idPrefix+"gstCoDate").val()){if(null===(k=$("#"+i.idPrefix+"gstCoDate").datepicker("getDate")))return $("#"+i.idPrefix+"gstCoDate").addClass("ui-state-error"),l.text("The Expected Departure date error."),flagAlertMessage(n+" is missing their Expected Departure date.",!0),!1;if(d?k>d&&(d=k):d=k,j>k)return $("#"+i.idPrefix+"gstDate").addClass("ui-state-error"),l.text("Check in date is after check out date."),flagAlertMessage(n+"  check in date is after their expected departure date.  We cannot reverse time (yet).",!0),!1}}$("div."+i.idPrefix+"detail").hide("blind")}return d?(a.resv.checkOut=d,e?(a.resv.checkIn=e,!0):(flagAlertMessage("Check in date not set",!0),$("input.gstdate").addClass("ui-state-error"),!1)):(flagAlertMessage("Expected departure date not set",!0),$("input.gstchkoutdate").addClass("ui-state-error"),!1)}function getRegistrationDialog(a,b){"use strict";$.post("ws_ckin.php",{cmd:"getReg",reg:a},function(c){if(!c)return void alert("Bad Reply from Server");try{c=$.parseJSON(c)}catch(a){return void alert("Bad JSON Encoding")}if(c.error)return c.gotopage&&window.open(c.gotopage,"_self"),void flagAlertMessage(c.error,!0);c.success&&showRegDialog(c.success,a,b)})}function showRegDialog(a,b,c){"use strict";var d=$('<div id="regDialog" />').append($(a));c.append(d),$("#regDialog").dialog({autoOpen:!0,width:360,resizable:!0,modal:!0,title:"Registration Info",buttons:{Cancel:function(){$(this).dialog("close")},Save:function(){var a={};$(".hhk-regvalue").each(function(){"checkbox"===$(this).attr("type")?!1!==this.checked&&(a[$(this).attr("name")]="on"):a[$(this).attr("name")]=this.value}),$(this).dialog("close"),$.post("ws_ckin.php",{cmd:"saveReg",reg:b,parm:a},function(a){if(!a)return void alert("Bad Reply from Server");try{a=$.parseJSON(a)}catch(a){return void alert("Bad JSON Encoding")}if(a.error)return a.gotopage&&window.open(a.gotopage,"_self"),void alert(a.error);a.success&&$("#mesgReg").text(a.success)})}}})}function Mpanel(a,b,c,d){"use strict";var e=this;e.idPrefix=a,e.idName=b,e.role=c,e.idSlot=d}function CheckIn(){"use strict";var a=this;a.patientPrefix="h_",a.patient=null,a.idPsg=0,a.currentGuests=0,a.guestSearchPrefix="gst",a.guestPrefix,a.adrPurpose="1",a.resv,a.resources,a.maxRoom,a.textInfo,a.rateList,a.ppnl,a.gpnl,a.idReserv,a.members,a.hideGuests=!1,a.idGuest,a.role,a.visitFees,a.patAsGuest,a.patientStaying=null,a.havePatient=!1,a.verifyHospDate,a.addRoom=!1}function gotMember(a){"use strict";var b=chkIn;$("#btnDone").val("Done Adding Guests");try{a=$.parseJSON(a)}catch(a){return void alert("Bad JSON Encoding")}return a.error?(a.gotopage&&window.open(a.gotopage,"_self"),flagAlertMessage(a.error,!0),void $("form#form1").remove()):a.ofrShr?void offerShare(a,b):($("div#guestAccordion").children().remove(),a.ovld?(flagAlertMessage(a.ovld,!0),void $("#btnChkin, #btnDone").hide()):(a.warning&&""!==a.warning&&flagAlertMessage(a.warning,!0),b.hideGuests=!0,void loadReserv(a)))}function reservation(){"use strict";var a=this;a.arrive,a.depart,a.checkIn,a.checkOut,a.adults,a.children,a.resource,a.txtStart,a.txtEnd}function validateCar(a){"use strict";var b="";return""===$("#car"+a+"txtVehLic").val()&&""===$("#car"+a+"txtVehMake").val()?"Enter vehicle info or check the 'No Vehicle' checkbox. ":(""===$("#car"+a+"txtVehLic").val()?(""===$("#car"+a+"txtVehModel").val()&&($("#car"+a+"txtVehModel").addClass("ui-state-highlight"),b="Enter Model"),""===$("#car"+a+"txtVehColor").val()&&($("#car"+a+"txtVehColor").addClass("ui-state-highlight"),b="Enter Color"),""===$("#car"+a+"selVehLicense").val()&&($("#car"+a+"selVehLicense").addClass("ui-state-highlight"),b="Enter state license plate registration")):""===$("#car"+a+"txtVehMake").val()&&""===$("#car"+a+"txtVehLic").val()&&($("#car"+a+"txtVehLic").addClass("ui-state-highlight"),b="Enter a license plate number."),b)}function getECRel(a){"use strict";$("#ecSearch").dialog("close");var b=parseInt(a.id,10);if(!1===isNaN(b)&&b>0){var c=$("#hdnEcSchPrefix").val();if(""==c)return;$("#"+c+"txtEmrgFirst").val(a.first),$("#"+c+"txtEmrgLast").val(a.last),$("#"+c+"txtEmrgPhn").val(a.phone),$("#"+c+"txtEmrgAlt").val(""),$("#"+c+"selEmrgRel").val("")}}function dateRender(a,b){return"display"===b||"filter"===b?null===a||""===a?"":moment(a).format("ddd, MMM Do YYYY"):a}$(document).ready(function(){"use strict";function d(a){if(a.id>0)for(var c=0;c<b.members.length;c++){var d=b.members[c];if(d.idName===a.id)return void flagAlertMessage("This person is already added.  Use the "+b.patientLabel+' Relationship selector to select "'+b.patientLabel+'".',!0)}b.patAsGuest&&null===b.patientStaying?$("#patientPrompt").dialog("option","buttons",{Yes:function(){loadGuest(a.id,b.idPsg,"p",!0),$("#patientPrompt").dialog("close")},No:function(){loadGuest(a.id,b.idPsg,"p",!1),$("#patientPrompt").dialog("close")}}).dialog("open"):loadGuest(a.id,b.idPsg,"p",b.patientStaying)}var a,b=chkIn,c=postBkPg;$(window).bind("beforeunload",function(){var a=!1;if($("#guestAccordion").find("input[type='text']").not(".ignrSave").each(function(){$(this).val()!==$(this).prop("defaultValue")&&(a=!0)}),!0===a)return"You have unsaved changes."}),$(':input[type="button"]').button(),0!==$("#btnDelUnfinished").length&&$("#btnDelUnfinished").click(function(){$.post("ws_ckin.php",{cmd:"dunf"},function(a){$("#divUnfinished").hide()})}),$.extend($.fn.dataTable.defaults,{dom:'<"top"if>rt<"bottom"lp><"clear">',displayLength:25,lengthMenu:[[25,50,-1],[25,50,"All"]],order:[[4,"asc"]]}),$("#atblgetter, #stblgetter, #wtblgetter").DataTable({columnDefs:[{targets:[4,5],type:"date",render:function(a,b,c){return dateRender(a,b)}}]}),$.datepicker.setDefaults({yearRange:"-7:+02",changeMonth:!0,changeYear:!0,autoSize:!0,numberOfMonths:2,dateFormat:"M d, yy"}),$("#psgDialog").dialog({autoOpen:!1,resizable:!0,width:400,modal:!0,title:b.patientLabel+" Selection"}),$("#resDialog").dialog({autoOpen:!1,resizable:!0,width:900,modal:!0,title:"Reservtion Chooser",buttons:{Exit:function(){$("#"+b.patientPrefix+"Search").val(""),$("#"+b.guestSearchPrefix+"Search").val(""),$(this).dialog("close")}}}),$("#ecSearch").dialog({autoOpen:!1,resizable:!1,width:300,title:"Emergency Contact",modal:!0,buttons:{Exit:function(){$(this).dialog("close")}}}),$("#pmtRcpt").dialog({autoOpen:!1,resizable:!0,width:530,modal:!0,title:"Payment Receipt"}),$("#patientPrompt").dialog({autoOpen:!1,resizable:!0,width:470,modal:!0,title:""}),$(".ckdate").datepicker(),$("#faDialog").dialog({autoOpen:!1,resizable:!0,width:650,modal:!0,title:"Income Chooser",close:function(a,b){$("div#submitButtons").show()},open:function(a,b){$("div#submitButtons").hide()},buttons:{Save:function(){$.post("ws_ckin.php",$("#formf").serialize()+"&cmd=savefap&rid="+b.idReserv,function(a){try{a=$.parseJSON(a)}catch(a){return void alert("Bad JSON Encoding")}a.gotopage&&window.open(a.gotopage,"_self"),a.rstat&&1==a.rstat&&a.rcat&&""!=a.rcat&&$("#selRateCategory").length>0&&$("#selRateCategory").val(a.rcat)}),$(this).dialog("close")},Exit:function(){$(this).dialog("close")}}}),$("div#guestAccordion").on("click","input.removeMem",function(){var a=$(this).data("slot");if(a!=b.patientPrefix){for(var c=0;c<b.members.length;c++){var d=b.members[c];d&&d.idPrefix==a&&(b.members.splice(c,1),"slf"==$("#"+d.idPrefix+"selPatRel").val()&&(b.patientStaying=null,b.havePatient=!1))}removeSlot(a),$(".patientRelch").change(),$("#gstspan").show(),b.members.length<2&&($("#gstprompt").text("Add Guest: "),$("#gstpostPrompt").text(""))}}),$("div#guestAccordion, div#patientSection").on("click",".hhk-addrCopy",function(){var a=$(this).attr("name");if(b.addr&&""!=b.addr.adraddress1&&$("#"+a+"adraddress1"+b.adrPurpose).val()!=b.addr.adraddress1)return $("#"+a+"adraddress1"+b.adrPurpose).val(b.addr.adraddress1),$("#"+a+"adraddress2"+b.adrPurpose).val(b.addr.adraddress2),$("#"+a+"adrcity"+b.adrPurpose).val(b.addr.adrcity),$("#"+a+"adrcounty"+b.adrPurpose).val(b.addr.adrcounty),$("#"+a+"adrstate"+b.adrPurpose).val(b.addr.adrstate),$("#"+a+"adrcountry"+b.adrPurpose).val(b.addr.adrcountry),void $("#"+a+"adrzip"+b.adrPurpose).val(b.addr.adrzip);for(var c=0;c<b.members.length;c++)if(b.members[c]&&b.members[c].idPrefix!==a&&""!=$("#"+b.members[c].idPrefix+"adraddress1"+b.adrPurpose).val())return $("#"+a+"adraddress1"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adraddress1"+b.adrPurpose).val()),$("#"+a+"adraddress2"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adraddress2"+b.adrPurpose).val()),$("#"+a+"adrcity"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adrcity"+b.adrPurpose).val()),$("#"+a+"adrcounty"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adrcounty"+b.adrPurpose).val()),$("#"+a+"adrstate"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adrstate"+b.adrPurpose).val()),$("#"+a+"adrcountry"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adrcountry"+b.adrPurpose).val()),void $("#"+a+"adrzip"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adrzip"+b.adrPurpose).val())}),$("div#guestAccordion, div#patientSection").on("click",".hhk-addrErase",function(){var a=$(this).attr("name");$("#"+a+"adraddress1"+b.adrPurpose).val(""),$("#"+a+"adraddress2"+b.adrPurpose).val(""),$("#"+a+"adrcity"+b.adrPurpose).val(""),$("#"+a+"adrcounty"+b.adrPurpose).val(""),$("#"+a+"adrcountry"+b.adrPurpose).val(""),$("#"+a+"adrstate"+b.adrPurpose).val(""),$("#"+a+"adrzip"+b.adrPurpose).val(""),$("#"+a+"adrbad"+b.adrPurpose).prop("checked",!1)}),$("div#guestAccordion").on("click",".hhk-guestSearch",function(){$("#hdnEcSchPrefix").val($(this).attr("name")),$("#ecSearch").dialog("open")}),$("div#guestAccordion").on("change",".patientRelch",function(){var a=0;$("#divAlert1").hide(),b.patientStaying=null,null!==b.patient&&void 0!==b.patient&&(b.patientStaying=!1,b.havePatient=!0,a++),$(".patientRelch").each(function(c){"slf"===$(this).val()?(a++,a>1?($(this).val(""),flagAlertMessage("Only one guest can also be the "+b.patientLabel+".",!0)):($("div#hospitalSection").show("blind"),b.patientStaying=!0,b.havePatient=!0,$("#"+$(this).data("prefix")+"memHdr").removeClass("ui-state-default"),$("div#patientSection").hide("blind"),$("div#patientSearch").hide("blind"),$("span#"+$(this).data("prefix")+"spnHdrLabel").text(b.patientLabel+": "))):($("#"+$(this).data("prefix")+"memHdr").addClass("ui-state-default"),$("span#"+$(this).data("prefix")+"spnHdrLabel").text("Guest: "))}),0===a&&($("div#patientSearch").show("blind"),$("div#hospitalSection").hide("blind"))}),$("div#guestAccordion, div#patientSection").on("change","input.hhk-lastname",function(){$("span#"+$(this).data("prefix")+"hdrLastName").text(" "+$(this).val())}),$("div#guestAccordion, div#patientSection").on("change","input.hhk-firstname",function(){$("span#"+$(this).data("prefix")+"hdrFirstName").text(" "+$(this).val())}),$("div#hospitalSection").on("click",".hhk-agentSearch, .hhk-docSearch",function(){$("#txtAgentSch").val(""),$("#txtDocSch").val("")}),$("div#hospitalSection").on("change","#selHospital, #selAssoc",function(){var a=$("#selAssoc").find("option:selected").text();""!=a&&(a+="/ "),$("span#spnHospName").text(a+$("#selHospital").find("option:selected").text())}),verifyAddrs("div#guestAccordion, div#hospitalSection, div#patientSection"),$("#btnDone").click(function(){if($("#divAlert1").hide(),"Saving >>>>"!==$(this).val()&&!0===verifyDone()){for(var a="",b=chkIn,c=0;c<b.members.length;c++)a+="&mbrs[]="+b.members[c].idPrefix;b.resv.checkOut.setHours(10);var d=new Date;b.resv.checkIn.setHours(d.getHours()),b.resv.checkIn.setMinutes(d.getMinutes()),a+="&ckindt="+b.resv.checkIn.toJSON(),a+="&ckoutdt="+b.resv.checkOut.toJSON(),a+="&rid="+b.idReserv,a+="&psgId="+b.idPsg,a+="&addRoom="+b.addRoom,b.members=[],b.patient=null,$.post("ws_ckin.php",$("#form1").serialize()+a+"&cmd=saveMem",function(a){gotMember(a)}),$(this).val("Saving >>>>"),$("#guestSearch").hide(),$("#rescList").hide()}}),$("#btnChkin").click(function(a){if($("#divAlert1").hide(),"Saving >>>>"!==$(this).val()&&($("#payChooserMsg").text("").hide("fade"),!1!==verifyDone())){if($("#cbNoVehicle").length>0){if(!1===$("#cbNoVehicle").prop("checked")){var d=validateCar(1);if(""!=d){var e=validateCar(2);if(""!=e)return $("#vehValidate").text(e),void flagAlertMessage(d,!0)}}$("#vehValidate").text("")}if($("#selResource").length>0&&(""===$("#selResource").val()||"0"===$("#selResource").val()))return flagAlertMessage("Choose a room.",!0),void $("#selResource").addClass("ui-state-error");if($("#selResource").removeClass("ui-state-error"),"x"==$("#selCategory").val()&&$("#txtFixedRate").length>0&&""==$("#txtFixedRate").val())return flagAlertMessage("Set the Room Rate to an amount, or 0.",!0),void $("#txtRoomRate").addClass("ui-state-error");if($("#txtRoomRate").removeClass("ui-state-error"),$("input#feesPayment").length>0&&""==$("input#feesPayment").val())return $("#payChooserMsg").text("Set the Room Fees to an amount, or 0.").show("fade"),void $("input#feesPayment").addClass("ui-state-error");if($("input#feesPayment").removeClass("ui-state-error"),void 0===verifyAmtTendrd||!1!==verifyAmtTendrd()){b.resv.checkOut.setHours(10);var f=new Date;b.resv.checkIn.setHours(f.getHours()),b.resv.checkIn.setMinutes(f.getMinutes());for(var g="",h=0;h<b.members.length;h++)g+="&mbrs[]="+b.members[h].idPrefix;g+="&ckindt="+b.resv.checkIn.toJSON(),g+="&ckoutdt="+b.resv.checkOut.toJSON(),g+="&rid="+b.idReserv,g+="&hvPat="+b.havePatient,g+="&addRoom="+b.addRoom,$.post("ws_ckin.php",$("#form1").serialize()+g+"&cmd=savePage&pbp="+c,function(a){chkIn;$("#btnChkin").val("Check In");try{a=$.parseJSON(a)}catch(a){alert("Bad JSON Encoding");var c=$("#contentDiv");return c.children().remove(),void null}if(a.error)return a.gotopage&&window.open(a.gotopage,"_self"),void flagAlertMessage(a.error,!0);a.warning&&flagAlertMessage(a.warning,!0),ckedIn(a)}),$(this).val("Saving >>>>")}}}),$("#hhk-confResvHdr").click(function(){$("#hhk-confResv").toggle("blind")}),$("#hhk-chkedInHdr").click(function(){$("#hhk-chkedIn").toggle("blind")}),$("#hhk-wListResvHdr").click(function(){$("#hhk-wListResv").toggle("blind")}),createAutoComplete($("#txtRelSch"),3,{cmd:"filter",add:"phone",basis:"g"},getECRel,a),createAutoComplete($("#"+b.guestSearchPrefix+"Search"),3,{cmd:"role"},function(a){loadGuest(a.id,b.idPsg,"g",b.patientStaying)}),createAutoComplete($("#"+b.guestSearchPrefix+"phSearch"),5,{cmd:"role"},function(a){loadGuest(a.id,b.idPsg,"g",b.patientStaying)}),createAutoComplete($("#"+b.patientPrefix+"Search"),3,{cmd:"role"},d),createAutoComplete($("#"+b.patientPrefix+"phSearch"),5,{cmd:"role"},d),$("#"+b.guestSearchPrefix+"Search").keypress(function(a){$(this).removeClass("ui-state-highlight")}),""!==b.gpnl&&loadGuest(b.gpnl,b.idPsg,"g",b.patientStaying),""!==b.ppnl&&loadGuest(b.ppnl,b.idPsg,"p",b.patientStaying),b.idReserv>0&&loadGuest(b.addGuestId,0,"r",b.patientStaying),$("#guestSearchWrapper").show(),$("#divresvWrapper").show()});
