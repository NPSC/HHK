function removeSlot(e){"use strict";e&&""!==e&&($("."+e+"Slot").remove(),countGuests())}function removePatient(){"use strict";for(var e=chkIn,t=0;t<e.members.length;t++)e.members[t]&&e.members[t].idName===e.patient.idName&&e.members.splice(t,1);e.patient=null,e.havePatient=!1,e.patientStaying=null,$("div#patientSection").children().remove().end().hide("scale, horizontal")}function resvPicker(e,t){"use strict";t.children().remove(),t.append($(e.resCh)),t.children().find("input:button").button(),t.children().find(".hhk-checkinNow").click(function(){window.open("CheckIn.php?rid="+$(this).data("rid"),"_self")}),t.dialog("open")}function injectSlot(e){"use strict";var t="";if(e.idPrefix&&(t=e.idPrefix),e.memMkup&&e.txtHdr){var a=$("<div/>").append($(e.memMkup));a.addClass(t+"Slot "+t+"detail ui-widget-content ui-corner-bottom");var i=$("<ul style='float:right;margin-left:5px;padding-top:3px;' class='ui-widget ui-helper-clearfix hhk-ui-icons'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='"+e.idPrefix+"drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),r=$('<div id="'+t+'memHdr"/>').append($(e.txtHdr)).append($('<span id="'+t+'memMsg" style="float:left;color: red; margin-right:20px;margin-left:20px;"></span>')).append(i).click(function(){"none"===a.css("display")?(a.show("blind"),r.removeClass("ui-corner-all").addClass("ui-corner-top")):(a.hide("blind"),r.removeClass("ui-corner-top").addClass("ui-corner-all"))});if(e.rmvbtn){var s=$('<input type="button" id="'+t+'removeMem" data-slot="'+t+'" value="Remove" style="margin-top:3px;float:right;margin-right:.3em;padding: 0.2em 1em;" />');s.addClass("removeMem"),s.button(),r.append(s)}r.append($('<div style="clear:both;"/>')),r.addClass(t+"Slot ui-widget-header ui-state-default ui-corner-top").css("padding","2px").css("min-width","840px").css("margin-top","5px"),$("."+t+"Slot").remove();var n=$("div#guestAccordion"),d=a.find("select#"+t+"selPatRel");"slf"===d.val()?(n.prepend(a),n.prepend(r),r.removeClass("ui-state-default")):(n.append(r),n.append(a));var o=a.find("input#"+t+"incomplete");0<o.length?(o.change(function(){$(this).prop("checked")?$("#"+t+"naAddrIcon").show():$("#"+t+"naAddrIcon").hide()}),o.change()):$("#"+t+"naAddrIcon").hide(),$("div#guestAccordion .ckdate").datepicker(),$("div#guestAccordion .ckdate").click(function(e){e.stopPropagation()}),a.find("select.bfh-countries").each(function(){var e=$(this);e.bfhcountries(e.data())}),a.find("select.bfh-states").each(function(){var e=$(this);e.bfhstates(e.data())}),$("#"+t+"phEmlTabs").tabs(),e.idName&&0===e.idName&&($("#"+t+"phEmlTabs").tabs("option","active",1),$("#"+t+"phEmlTabs").tabs("option","disabled",0)),d.change(),createZipAutoComplete($("input.hhk-zipsearch"),"ws_admin.php",void 0),$("#gstprompt").text("Add Guest: ")}return t}function ckedIn(e){"use strict";if($("#divAlert1").hide(),e.warning&&flagAlertMessage(e.warning,!0),e.xfer){var t=$("#xform");if(t.children("input").remove(),t.prop("action",e.xfer),e.paymentId&&""!=e.paymentId)t.append($('<input type="hidden" name="PaymentID" value="'+e.paymentId+'"/>'));else{if(!e.cardId||""==e.cardId)return void flagAlertMessage("PaymentId and CardId are missing!",!0);t.append($('<input type="hidden" name="CardID" value="'+e.cardId+'"/>'))}t.submit()}if(e.success){var a=$("#contentDiv"),i={mode:"popup",popClose:!0,popHt:$("div#RegArea").height(),popWd:950,popX:20,popY:20,popTitle:"Guest Registration Form"};if(a.children().remove(),e.regform&&e.style&&(a.append($('<div id="print_button" style="float:left;">Print</div>')).append($('<div id="btnReg" style="float:left; margin-left:10px;">Check In Followup</div>')).append($('<div id="btnStmt" style="float:left; margin-left:10px;">Show Statement</div>')).append($('<div id="mesgReg" style="color: darkgreen; clear:left; font-size:1.5em;"></div>')).append($('<div style="clear: left;" class="RegArea"/>').append($(e.style)).append($(e.regform))),$("div#print_button, div#btnReg, div#btnStmt").button(),$("div#print_button").click(function(){$("div.RegArea").printArea(i)}),$("div#btnReg").click(function(){getRegistrationDialog(e.reg,a)}),$("div#btnStmt").click(function(){window.open("ShowStatement.php?vid="+e.vid,"_blank")})),e.ckmeout){var r={"Show Statement":function(){window.open("ShowStatement.php?vid="+e.vid,"_blank")},"Check Out":function(){saveFees(e.gid,e.vid,0,!0,"register.php")},Cancel:function(){$(this).dialog("close")}};viewVisit(e.gid,e.vid,r,"Check Out","co",0,e.ckmeout)}e.regDialog&&showRegDialog(e.regDialog,e.reg,a),e.receipt&&showReceipt("#pmtRcpt",e.receipt),e.invoiceNumber&&""!==e.invoiceNumber&&window.open("ShowInvoice.php?invnum="+e.invoiceNumber)}}function offerShare(e,t){loadReserv(e,t)}function loadReserv(e){"use strict";var t=chkIn;e.rid&&(t.idReserv=parseInt(e.rid,10)),$("div#guestAccordion").hide();var a=processGuests(e);e.warning&&""!=e.warning&&(a=!1,flagAlertMessage(e.warning,!0)),a?(e.vehicle&&($("#vehicle").children().remove().end().append($(e.vehicle)).show(),$("#cbNoVehicle").change(function(){this.checked?$("#tblVehicle").hide("blind"):$("#tblVehicle").show("blind"),$("#vehValidate").text("")}),$("#cbNoVehicle").change(),$("#btnNextVeh").button(),t.nextVeh=1,$("#btnNextVeh").click(function(){$("#trVeh"+t.nextVeh).show("fade"),t.nextVeh++,4<t.nextVeh&&$("#btnNextVeh").hide("fade")})),e.resc&&($("#rescList").children().remove().end().append($(e.resc)).show(),countGuests()),e.ratelist&&(t.rateList=e.ratelist),e.rate&&($("#rate").children().remove().end().append($(e.rate)).show(),0<$("#btnFapp").length&&($("#btnFapp").button(),$("#btnFapp").click(function(){getIncomeDiag(t.idReserv)})),setupRates(t,$("#selResource").val())),e.pay&&($("#pay").children().remove().end().append($(e.pay)).show(),$("#paymentDate").datepicker({yearRange:"-1:+01",numberOfMonths:1}),setupPayments(t.resources,$("#selResource"),$("#selRateCategory"))),t.hideGuests=!0,$("#btnChkin").show(),$("#btnDone").hide()):($("#btnChkin").hide(),0<countGuests()?$("#btnDone").show():$("#btnDone").hide(),$("#guestSearch").show()),$("div#guestAccordion").show("blind")}function processGuests(e){"use strict";var t=chkIn,a=$("#hospitalSection");if(void 0!==e.hvPat&&(t.havePatient=e.hvPat),t.havePatient?$("#patientSearch").hide("blind"):$("#patientSearch").show("blind"),e.patStay&&(t.patientStaying=e.patStay),e.addRoom&&(t.addRoom=e.addRoom),e.idPsg){if(t.idPsg&&0<t.idPsg&&0<e.idPsg&&t.idPsg!=e.idPsg)return flagAlertMessage("Something is wrong.  Please try again. ",!0),t.idPsg=0,!1;t.idPsg=parseInt(e.idPsg,10)}if(e.vfee&&(t.visitFees=e.vfee),e.rooms&&(t.resources=e.rooms),e.rcur&&(t.currentGuests=parseInt(e.rcur,10)),e.rmax&&(t.maxRoom=parseInt(e.rmax,10)),e.guests){for(var i=0;i<e.guests.length;i++){for(var r=e.guests[i],s=!1,n=0;n<t.members.length;n++)0===r.idName&&t.members[n].idPrefix==r.idPrefix?s=!0:0<r.idName&&t.members[n].idName===r.idName&&(s=!0);if(!s){var d=injectSlot(r);t.members.push(new Mpanel(d,r.idName,r.role,d)),t.hideGuests&&$("."+d+"detail").hide("scale, horizontal")}}roomFull()}if(e.hosp&&(0===a.children().length||e.patient)){if(e.hosp.div){var o=$(e.hosp.div).addClass("pgdetail ui-widget-content"),l=$("<ul id='ulIcons' style='float:right;margin-left:5px;padding-top:3px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),c=$('<div id="divHdrHosp" style="padding:2px; cursor:pointer;"/>').append($(e.hosp.hdr)).append(l).append($('<div style="clear:both;"/>'));c.addClass("ui-widget-header ui-state-default ui-corner-top"),c.click(function(){"none"===o.css("display")?(o.show("blind"),c.removeClass("ui-corner-all").addClass("ui-corner-top")):(o.hide("blind"),c.removeClass("ui-corner-top").addClass("ui-corner-all"))}),$("#hospitalSection").children().remove().end().append(c).append(o),""!=$("#selHospital").val()&&$("#divHdrHosp").click()}else $("#hospitalSection").children().remove().end().append($(e.hosp)).show("blind");$("#txtEntryDate, #txtExitDate").datepicker(),createAutoComplete($("#txtAgentSch"),3,{cmd:"filter",add:"phone",basis:"ra"},getAgent),""===$("#a_txtLastName").val()&&$(".hhk-agentInfo").hide(),createAutoComplete($("#txtDocSch"),3,{cmd:"filter",basis:"doc"},getDoc),""===$("#d_txtLastName").val()&&$(".hhk-docInfo").hide()}if(e.patient&&""!=e.patient){var h=0;if($(".patientRelch").each(function(e){"slf"===$(this).val()&&h++}),0<h)flagAlertMessage("One of the guests is already set as the "+t.patientLabel+".  ",!0),t.patient=null;else{var p,u,g,f=$("div#patientSection"),v=$(e.patient);if(v.addClass("h_detail"),u=$('<div style="float:left;"/>').append($('<span style="font-size:1.2em;">'+t.patientLabel+": </span>")).append($('<span id="h_hdrFirstName" style="font-size:1.2em;">'+v.find("#h_txtFirstName").val()+"</span>")).append($('<span id="h_hdrLastName" style="font-size:1.2em;">'+v.find("#h_txtLastName").val()+"</span>")),t.patAsGuest&&u.append($('<span style="font-size:1.2em;"> - Not staying tonight</span>')),u.append($('<span id="h_naAddrIcon" class="hhk-icon-redLight" title="Incomplete Address" style="float:right;margin-top:2px;margin-left:5px;"><span>')),p=$('<div class="ui-widget-header ui-corner-top" style="padding:2px;"/>').append(u).append($('<span id="h_memMsg" style="color: red; margin-right:20px;margin-left:20px;"></span>')).append($('<span id="h_drpDown" class="ui-icon ui-icon-circle-triangle-s" style="float:right; cursor:pointer; margin:right:3px;"></span>').click(function(){"none"===v.css("display")?(v.show("blind"),p.removeClass("ui-corner-all").addClass("ui-corner-top")):(v.hide(),p.removeClass("ui-corner-top").addClass("ui-corner-all"))})),void 0!==e.rmvbtnp&&!0===e.rmvbtnp&&0<$("#h_Search").length){var m=$('<input type="button" id="remPatient"  value="Remove" style="float:right;margin-right:.3em;padding: 0.2em 1em;" />');m.click(function(){confirm("Remove "+t.patientLabel+"?")&&(removePatient(),$("#patientSearch").show("blind"),$("#hospitalSection").hide("blind"),$("#h_Search").focus())}),m.button(),p.append(m).append($('<div style="clear:both;"/>'))}f.children().remove().end().removeClass("hhk-panel").removeClass("hhk-visitdialog").addClass("ui-widget hhk-panel hhk-visitdialog").append(p).append(v),f.find("select.bfh-countries").each(function(){var e=$(this);e.bfhcountries(e.data())}),f.find("select.bfh-states").each(function(){var e=$(this);e.bfhstates(e.data())}),0<(g=v.find("input#h_incomplete")).length?(g.change(function(){$(this).prop("checked")?$("#h_naAddrIcon").show():$("#h_naAddrIcon").hide()}),g.change()):$("#h_naAddrIcon").hide(),f.find("#h_phEmlTabs").tabs(),t.idPsg<1?($("div#patientSection #h_phEmlTabs").tabs("option","active",1),$("div#patientSection #h_phEmlTabs").tabs("option","disabled",[0])):$("#h_drpDown").click(),createZipAutoComplete($("div#patientSection .hhk-zipsearch"),"ws_admin.php",void 0),t.patient=new Mpanel(t.patientPrefix,$("#h_idName").val(),"p",t.patientPrefix),t.members.push(t.patient),$('.patientRelch option[value="slf"]').remove(),$("#hospitalSection").show("blind"),$("#patientSearch").hide("blind"),f.show("blind")}}return e.stays&&$("#stays").children().remove().end().append($(e.stays)).show("blind"),e.adnlrm?($("#addRoom").children().remove().end().append($(e.adnlrm)).show("blind"),$("#cbAddnlRoom").change(function(){!0===$(this).prop("checked")?t.addRoom=!0:t.addRoom=!1})):$("#addRoom").children().remove().end().hide("blind"),$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,dateFormat:"M d, yy"}),!0}function psgChooser(e){"use strict";var a=e.idGuest,i=e.role;$("#psgDialog").children().remove().end().append($(e.choosePsg)).dialog("option","buttons",{Open:function(){var e=!1,t=$("#psgDialog input[name=cbselpsg]:checked").data("pid");$("#psgDialog input[name=cbselpsg]:checked").data("ngid");if(chkIn.idPsg=$("#psgDialog input[name=cbselpsg]:checked").val(),0<$("#cbpstayy").length&&0<chkIn.idPsg){if(!1===$("#cbpstayy").prop("checked")&&!1===$("#cbpstayn").prop("checked"))return $("#spnstaymsg").text("Choose Yes or No"),void $(".pstaytd").addClass("ui-state-highlight");e=$("#cbpstayy").prop("checked"),t===a&&(i="p")}loadGuest(a,chkIn.idPsg,i,e),$("#psgDialog").dialog("close")},Cancel:function(){$("#"+chkIn.guestSearchPrefix+"Search").val(""),$("#psgDialog").dialog("close")}}).dialog("open")}function loadGuest(e,t,a,i){"use strict";var r=chkIn;if($("#divAlert1").hide(),0<e){if(null!==r.patient&&r.patient.idName==e){if(!confirm("The "+r.patientLabel+" is already set as NOT staying at the house tonight.  Is the "+r.patientLabel+" staying here tonight after all?"))return;removePatient(),i=!0}for(var s=0;s<r.members.length;s++)if(r.members[s].idName==e)return void flagAlertMessage("This person is already added.",!0)}a&&""!=a||(a="g"),null!==i&&(r.patientStaying=i);var n={cmd:"getMember",id:e,rid:r.idReserv,idPrefix:r.guestPrefix++,role:a,psg:t,patStay:i,hvPat:r.havePatient,addRoom:r.addRoom};$.post("ws_ckin.php",n).done(function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Bad JSON Encoding")}if(e.error)return e.gotopage&&window.open(e.gotopage,"_self"),void flagAlertMessage(e.error,!0);e.warning&&flagAlertMessage(e.warning,!0);var t=chkIn;if(void 0!==e.hvPat&&null!==e.hvPat&&(t.havePatient=e.hvPat),void 0!==e.patStay&&null!==e.patStay&&(t.patientStaying=e.patStay),e.choosePsg)psgChooser(e);else{if(e.resCh)return t.idGuest=e.id,t.idPsg=e.idPsg,t.role=e.role,void resvPicker(e,$("#resDialog"));void 0!==e.rid&&null!==e.rid&&(t.idReserv=parseInt(e.rid)),e.addr&&(t.addr=e.addr),processGuests(e),e.resc&&($("#rescList").children().remove().end().append($(e.resc)).show(),0<$("#spnNumGuests").length&&$("#spnNumGuests").text(t.members.length-1+t.currentGuests)),$("#"+t.guestSearchPrefix+"Search").val(""),$("#"+t.patientPrefix+"Search").val(""),$(".hhk-info").hide(),$("#divResvList").hide(),$("#guestSearch").show(),0<countGuests()?$("#btnDone").show():$("#"+t.guestSearchPrefix+"Search").focus()}}else alert("Bad Reply from Server")})}function countGuests(){"use strict";var e=chkIn,t=e.members.length;return e.patient&&t--,0==e.addRoom&&(t+=e.currentGuests),0<$("#spnNumGuests").length&&$("#spnNumGuests").text(t),t}function roomFull(){"use strict";var e=chkIn,t=countGuests();0<e.maxRoom&&t>e.maxRoom&&flagAlertMessage("The room is full.  ",!0)}function verifyDone(){"use strict";var e,t,a=chkIn,i=0,r=0;if(a.fillEmergCont?$(".hhk-EmergCb").each(function(){!0===$(this).prop("checked")&&r++}):r=2,0===a.members.length)return flagAlertMessage("Enter a Guest or "+a.patientLabel+".",!0),$("#"+a.guestSearchPrefix+"Search").addClass("ui-state-highlight"),!1;if($(".patientRelch").each(function(){"slf"===$(this).val()&&i++}),!a.patient&&0===i&&!a.havePatient)return flagAlertMessage("Enter a "+a.patientLabel+".",!0),!1;if($("#hospitalSection").find("input, select").each(function(){$(this).removeClass("ui-state-error")}),""===$("#selHospital").val())return $("#selHospital").addClass("ui-state-error"),flagAlertMessage("Select a hospital.",!0),$(".pgdetail").show("blind"),!1;var s="";if(0<$("#txtEntryDate").length&&a.verifyHospDate){if(""===$("#txtEntryDate").val())$("#txtEntryDate").addClass("ui-state-error"),s="The Treatment Start Date is missing.";else try{$("#txtEntryDate").datepicker("getDate").setTime(0,0,0)}catch(e){s="Something is wrong with the Treatment Start Date."}if(""!==s)return flagAlertMessage(s,!0),$(".pgdetail").show("blind"),!1}$(".pgdetail").hide("blind"),$("#guestAccordion, #patientSection").find(".ui-state-error").each(function(){$(this).removeClass("ui-state-error")});for(var n=0;n<a.members.length;n++){var d,o,l=a.members[n],c=$("#"+l.idPrefix+"memMsg");c.text("");var h=!1,p=$("span#"+l.idPrefix+"hdrFirstName").text()+" "+$("span#"+l.idPrefix+"hdrLastName").text();if(""===$("#"+l.idPrefix+"txtFirstName").val()&&($("#"+l.idPrefix+"txtFirstName").addClass("ui-state-error"),h=!0),""===$("#"+l.idPrefix+"txtLastName").val()&&($("#"+l.idPrefix+"txtLastName").addClass("ui-state-error"),h=!0),a.forceNamePrefix&&""===$("#"+l.idPrefix+"selPrefix").val()&&($("#"+l.idPrefix+"selPrefix").addClass("ui-state-error"),h=!0),h)return flagAlertMessage("Enter a first and last name for each guest & "+a.patientLabel+".",!0),$("."+l.idSlot+"detail").show("blind"),c.text("Incomplete Name"),!1;if(0<$("#"+l.idPrefix+"selPatRel").length&&""===$("#"+l.idPrefix+"selPatRel").val())return $("#"+l.idPrefix+"selPatRel").addClass("ui-state-error"),c.text("Set "+a.patientLabel+" Relationship"),$("."+l.idSlot+"detail").show("blind"),flagAlertMessage(p+" is missing their "+a.patientLabel+" relationship.",!0),!1;if("slf"===$("#"+l.idPrefix+"selPatRel").val()&&a.patientBirthDate&&a.ShowBirthDate&&($("#"+l.idPrefix+"txtBirthDate").removeClass("ui-state-error"),""===$("#"+l.idPrefix+"txtBirthDate").val()))return flagAlertMessage(a.patientLabel+" needs a birth date.",!0),c.text("Birth date"),$("#"+l.idPrefix+"txtBirthDate").addClass("ui-state-error"),!1;if(a.ShowBirthDate){var u=new Date($("#"+l.idPrefix+"txtBirthDate").val()),g=new Date;if($("#"+l.idPrefix+"txtBirthDate").removeClass("ui-state-error"),g<u)return flagAlertMessage("This birth date cannot be in the future.",!0),c.text("Birth date"),$("#"+l.idPrefix+"txtBirthDate").addClass("ui-state-error"),!1}if(!1===$("#"+l.idPrefix+"incomplete").prop("checked")&&($("."+l.idPrefix+"hhk-addr-val").not(".hhk-MissingOk").each(function(){""===$(this).val()&&($(this).hasClass("bfh-states")||(c.text("Incomplete Address"),$(this).addClass("ui-state-error"),h=!0))}),h))return flagAlertMessage(p+" is missing some or all of their address.",!0),$("."+l.idSlot+"detail").show("blind"),!1;if(0<$("#"+l.idPrefix+"cbEmrgLater").length&&!1===$("#"+l.idPrefix+"cbEmrgLater").prop("checked")&&r<1&&(""===$("#"+l.idPrefix+"txtEmrgFirst").val()&&""===$("#"+l.idPrefix+"txtEmrgLast").val()&&($("#"+l.idPrefix+"txtEmrgFirst").addClass("ui-state-error"),$("#"+l.idPrefix+"txtEmrgLast").addClass("ui-state-error"),h=!0),""===$("#"+l.idPrefix+"txtEmrgPhn").val()&&($("#"+l.idPrefix+"txtEmrgPhn").addClass("ui-state-error"),h=!0),""===$("#"+l.idPrefix+"selEmrgRel").val()&&($("#"+l.idPrefix+"selEmrgRel").addClass("ui-state-error"),h=!0),h))return c.text("Enter emergency contact information"),flagAlertMessage("Fill in "+p+"'s emergency contact information",!0),$("."+l.idSlot+"detail").show("blind"),!1;if(0<$("#"+l.idPrefix+"gstDate").length){if(""===$("#"+l.idPrefix+"gstDate").val())return $("#"+l.idPrefix+"gstDate").addClass("ui-state-error"),c.text("Enter guest check in date."),flagAlertMessage(p+" is missing their check-in date.",!0),!1;if(null===(d=$("#"+l.idPrefix+"gstDate").datepicker("getDate")))return $("#"+l.idPrefix+"gstDate").addClass("ui-state-error"),c.text("Guest check in date error."),flagAlertMessage(p+" is missing their check-in date.",!0),!1;if(new Date<d)return $("#"+l.idPrefix+"gstDate").addClass("ui-state-error"),c.text("The check-in date cannot be in the future."),flagAlertMessage(p+" cannot check-in to a future date.",!0),!1;if(t?d<t&&(t=d):t=d,""!==$("#"+l.idPrefix+"gstCoDate").val()){if(null===(o=$("#"+l.idPrefix+"gstCoDate").datepicker("getDate")))return $("#"+l.idPrefix+"gstCoDate").addClass("ui-state-error"),c.text("The Expected Departure date error."),flagAlertMessage(p+" is missing their Expected Departure date.",!0),!1;if(e?e<o&&(e=o):e=o,o<d)return $("#"+l.idPrefix+"gstDate").addClass("ui-state-error"),c.text("Check in date is after check out date."),flagAlertMessage(p+"  check in date is after their expected departure date.",!0),!1}}$("div."+l.idPrefix+"detail").hide("blind")}return e?(a.resv.checkOut=e,t?(a.resv.checkIn=t,!0):(flagAlertMessage("Check in date not set",!0),$("input.gstdate").addClass("ui-state-error"),!1)):(flagAlertMessage("Expected departure date not set",!0),$("input.gstchkoutdate").addClass("ui-state-error"),!1)}function getRegistrationDialog(t,a){"use strict";$.post("ws_ckin.php",{cmd:"getReg",reg:t},function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Bad JSON Encoding")}if(e.error)return e.gotopage&&window.open(e.gotopage,"_self"),void flagAlertMessage(e.error,!0);e.success&&showRegDialog(e.success,t,a)}else alert("Bad Reply from Server")})}function showRegDialog(e,t,a){"use strict";var i=$('<div id="regDialog" />').append($(e));a.append(i),$("#regDialog").dialog({autoOpen:!0,width:360,resizable:!0,modal:!0,title:"Registration Info",buttons:{Cancel:function(){$(this).dialog("close")},Save:function(){var e={};$(".hhk-regvalue").each(function(){"checkbox"===$(this).attr("type")?!1!==this.checked&&(e[$(this).attr("name")]="on"):e[$(this).attr("name")]=this.value}),$(this).dialog("close"),$.post("ws_ckin.php",{cmd:"saveReg",reg:t,parm:e},function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Bad JSON Encoding")}if(e.error)return e.gotopage&&window.open(e.gotopage,"_self"),void alert(e.error);e.success&&$("#mesgReg").text(e.success)}else alert("Bad Reply from Server")})}}})}function Mpanel(e,t,a,i){"use strict";this.idPrefix=e,this.idName=t,this.role=a,this.idSlot=i}function CheckIn(){"use strict";var e=this;e.patientPrefix="h_",e.patient=null,e.idPsg=0,e.currentGuests=0,e.guestSearchPrefix="gst",e.guestPrefix,e.adrPurpose="1",e.resv,e.resources,e.maxRoom,e.textInfo,e.rateList,e.ppnl,e.gpnl,e.idReserv,e.members,e.hideGuests=!1,e.idGuest,e.role,e.visitFees,e.patAsGuest,e.patientStaying=null,e.havePatient=!1,e.verifyHospDate,e.addRoom=!1}function gotMember(e){"use strict";var t=chkIn;$("#btnDone").val("Done Adding Guests");try{e=$.parseJSON(e)}catch(e){return void alert("Bad JSON Encoding")}if(e.error)return e.gotopage&&window.open(e.gotopage,"_self"),flagAlertMessage(e.error,!0),void $("form#form1").remove();if(e.ofrShr)offerShare(e,t);else{if($("div#guestAccordion").children().remove(),e.ovld)return flagAlertMessage(e.ovld,!0),void $("#btnChkin, #btnDone").hide();e.warning&&""!==e.warning&&flagAlertMessage(e.warning,!0),t.hideGuests=!0,loadReserv(e)}}function reservation(){"use strict";var e=this;e.arrive,e.depart,e.checkIn,e.checkOut,e.adults,e.children,e.resource,e.txtStart,e.txtEnd}function validateCar(e){"use strict";var t="";return""===$("#car"+e+"txtVehLic").val()&&""===$("#car"+e+"txtVehMake").val()?"Enter vehicle info or check the 'No Vehicle' checkbox. ":(""===$("#car"+e+"txtVehLic").val()?(""===$("#car"+e+"txtVehModel").val()&&($("#car"+e+"txtVehModel").addClass("ui-state-highlight"),t="Enter Model"),""===$("#car"+e+"txtVehColor").val()&&($("#car"+e+"txtVehColor").addClass("ui-state-highlight"),t="Enter Color"),""===$("#car"+e+"selVehLicense").val()&&($("#car"+e+"selVehLicense").addClass("ui-state-highlight"),t="Enter state license plate registration")):""===$("#car"+e+"txtVehMake").val()&&""===$("#car"+e+"txtVehLic").val()&&($("#car"+e+"txtVehLic").addClass("ui-state-highlight"),t="Enter a license plate number."),t)}function getECRel(e){"use strict";$("#ecSearch").dialog("close");var t=parseInt(e.id,10);if(!1===isNaN(t)&&0<t){var a=$("#hdnEcSchPrefix").val();if(""==a)return;$("#"+a+"txtEmrgFirst").val(e.first),$("#"+a+"txtEmrgLast").val(e.last),$("#"+a+"txtEmrgPhn").val(e.phone),$("#"+a+"txtEmrgAlt").val(""),$("#"+a+"selEmrgRel").val("")}}$(document).ready(function(){"use strict";var n=chkIn,d=postBkPg;function e(e){if(void 0===e.No_Return||""===e.No_Return){if(0<e.id)for(var t=0;t<n.members.length;t++){if(n.members[t].idName===e.id)return void flagAlertMessage("This person is already added.  Use the "+n.patientLabel+' Relationship selector to select "'+n.patientLabel+'".',!0)}n.patAsGuest&&null===n.patientStaying?$("#patientPrompt").dialog("option","buttons",{Yes:function(){loadGuest(e.id,n.idPsg,"p",!0),$("#patientPrompt").dialog("close")},No:function(){loadGuest(e.id,n.idPsg,"p",!1),$("#patientPrompt").dialog("close")}}).dialog("open"):loadGuest(e.id,n.idPsg,"p",n.patientStaying)}else flagAlertMessage("This person is set for No Return: "+e.No_Return+".",!0)}$.widget("ui.autocomplete",$.ui.autocomplete,{_resizeMenu:function(){var e=this.menu.element;e.outerWidth(1.1*Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))}}),$(window).bind("beforeunload",function(){var e=!1;if($("#guestAccordion").find("input[type='text']").not(".ignrSave").each(function(){$(this).val()!==$(this).prop("defaultValue")&&(e=!0)}),!0===e)return"You have unsaved changes."}),$(':input[type="button"]').button(),0!==$("#btnDelUnfinished").length&&$("#btnDelUnfinished").click(function(){$.post("ws_ckin.php",{cmd:"dunf"},function(e){$("#divUnfinished").hide()})}),$.extend($.fn.dataTable.defaults,{dom:'<"top"if>rt<"bottom"lp><"clear">',displayLength:25,lengthMenu:[[25,50,-1],[25,50,"All"]],order:[[4,"asc"]]}),$("#atblgetter, #stblgetter, #wtblgetter, #imtblgetter").DataTable({columnDefs:[{targets:[4,5],type:"date",render:function(e,t){return dateRender(e,t,dateFormat)}}]}),$.datepicker.setDefaults({yearRange:"-7:+02",changeMonth:!0,changeYear:!0,autoSize:!0,numberOfMonths:2,dateFormat:"M d, yy"}),$("#psgDialog").dialog({autoOpen:!1,resizable:!0,width:400,modal:!0,title:n.patientLabel+" Selection"}),$("#resDialog").dialog({autoOpen:!1,resizable:!0,width:900,modal:!0,title:"Reservtion Chooser",buttons:{Exit:function(){$("#"+n.patientPrefix+"Search").val(""),$("#"+n.guestSearchPrefix+"Search").val(""),$(this).dialog("close")}}}),$("#ecSearch").dialog({autoOpen:!1,resizable:!1,width:300,title:"Emergency Contact",modal:!0,buttons:{Exit:function(){$(this).dialog("close")}}}),$("#pmtRcpt").dialog({autoOpen:!1,resizable:!0,width:530,modal:!0,title:"Payment Receipt"}),$("#patientPrompt").dialog({autoOpen:!1,resizable:!0,width:470,modal:!0,title:""}),$(".ckdate").datepicker(),$("#faDialog").dialog({autoOpen:!1,resizable:!0,width:670,modal:!0,title:"Income Chooser",close:function(e,t){$("div#submitButtons").show()},open:function(e,t){$("div#submitButtons").hide()},buttons:{Save:function(){$.post("ws_ckin.php",$("#formf").serialize()+"&cmd=savefap&rid="+n.idReserv,function(e){try{e=$.parseJSON(e)}catch(e){return void alert("Bad JSON Encoding")}e.gotopage&&window.open(e.gotopage,"_self"),e.rstat&&1==e.rstat&&e.rcat&&""!=e.rcat&&0<$("#selRateCategory").length&&$("#selRateCategory").val(e.rcat)}),$(this).dialog("close")},Exit:function(){$(this).dialog("close")}}}),$("div#guestAccordion").on("click","input.removeMem",function(e){var t=$(this).data("slot");if(t!=n.patientPrefix){for(var a=0;a<n.members.length;a++){var i=n.members[a];i&&i.idPrefix==t&&(n.members.splice(a,1),"slf"==$("#"+i.idPrefix+"selPatRel").val()&&(n.patientStaying=null,n.havePatient=!1))}removeSlot(t),$(".patientRelch").change(),$("#gstspan").show(),n.members.length<2&&($("#gstprompt").text("Add Guest: "),$("#gstpostPrompt").text(""))}e.stopPropagation()}),$("div#guestAccordion, div#patientSection").on("click",".hhk-addrCopy",function(){var e=$(this).data("prefix");if(n.addr&&""!=n.addr.adraddress1&&$("#"+e+"adraddress1"+n.adrPurpose).val()!=n.addr.adraddress1)return $("#"+e+"adraddress1"+n.adrPurpose).val(n.addr.adraddress1),$("#"+e+"adraddress2"+n.adrPurpose).val(n.addr.adraddress2),$("#"+e+"adrcity"+n.adrPurpose).val(n.addr.adrcity),$("#"+e+"adrcounty"+n.adrPurpose).val(n.addr.adrcounty),$("#"+e+"adrstate"+n.adrPurpose).val(n.addr.adrstate),$("#"+e+"adrcountry"+n.adrPurpose).val(n.addr.adrcountry),void $("#"+e+"adrzip"+n.adrPurpose).val(n.addr.adrzip);for(var t=0;t<n.members.length;t++)if(n.members[t]&&n.members[t].idPrefix!==e&&""!=$("#"+n.members[t].idPrefix+"adraddress1"+n.adrPurpose).val())return $("#"+e+"adraddress1"+n.adrPurpose).val($("#"+n.members[t].idPrefix+"adraddress1"+n.adrPurpose).val()),$("#"+e+"adraddress2"+n.adrPurpose).val($("#"+n.members[t].idPrefix+"adraddress2"+n.adrPurpose).val()),$("#"+e+"adrcity"+n.adrPurpose).val($("#"+n.members[t].idPrefix+"adrcity"+n.adrPurpose).val()),$("#"+e+"adrcounty"+n.adrPurpose).val($("#"+n.members[t].idPrefix+"adrcounty"+n.adrPurpose).val()),$("#"+e+"adrstate"+n.adrPurpose).val($("#"+n.members[t].idPrefix+"adrstate"+n.adrPurpose).val()),$("#"+e+"adrcountry"+n.adrPurpose).val($("#"+n.members[t].idPrefix+"adrcountry"+n.adrPurpose).val()),void $("#"+e+"adrzip"+n.adrPurpose).val($("#"+n.members[t].idPrefix+"adrzip"+n.adrPurpose).val())}),$("div#guestAccordion, div#patientSection").on("click",".hhk-addrErase",function(){var e=$(this).data("prefix");$("#"+e+"adraddress1"+n.adrPurpose).val(""),$("#"+e+"adraddress2"+n.adrPurpose).val(""),$("#"+e+"adrcity"+n.adrPurpose).val(""),$("#"+e+"adrcounty"+n.adrPurpose).val(""),$("#"+e+"adrcountry"+n.adrPurpose).val(""),$("#"+e+"adrstate"+n.adrPurpose).val(""),$("#"+e+"adrzip"+n.adrPurpose).val(""),$("#"+e+"adrbad"+n.adrPurpose).prop("checked",!1)}),$("div#guestAccordion").on("click",".hhk-guestSearch",function(){$("#hdnEcSchPrefix").val($(this).attr("name")),$("#ecSearch").dialog("open")}),$("div#guestAccordion").on("change",".patientRelch",function(){var t=0;$("#divAlert1").hide(),(n.patientStaying=null)!==n.patient&&void 0!==n.patient&&(n.patientStaying=!1,n.havePatient=!0,t++),$(".patientRelch").each(function(e){"slf"===$(this).val()?1<++t?($(this).val(""),flagAlertMessage("Only one guest can also be the "+n.patientLabel+".",!0)):($("div#hospitalSection").show("blind"),n.patientStaying=!0,n.havePatient=!0,$("#"+$(this).data("prefix")+"memHdr").removeClass("ui-state-default"),$("div#patientSection").hide("blind"),$("div#patientSearch").hide("blind"),$("span#"+$(this).data("prefix")+"spnHdrLabel").text(n.patientLabel+": ")):($("#"+$(this).data("prefix")+"memHdr").addClass("ui-state-default"),$("span#"+$(this).data("prefix")+"spnHdrLabel").text("Guest: "))}),0===t&&($("div#patientSearch").show("blind"),$("div#hospitalSection").hide("blind"))}),$("div#guestAccordion, div#patientSection").on("change","input.hhk-lastname",function(){$("span#"+$(this).data("prefix")+"hdrLastName").text(" "+$(this).val())}),$("div#guestAccordion, div#patientSection").on("change","input.hhk-firstname",function(){$("span#"+$(this).data("prefix")+"hdrFirstName").text(" "+$(this).val())}),$("div#hospitalSection").on("click",".hhk-agentSearch, .hhk-docSearch",function(){$("#txtAgentSch").val(""),$("#txtDocSch").val("")}),$("div#hospitalSection").on("change","#selHospital, #selAssoc",function(){var e=$("#selAssoc").find("option:selected").text();""!=e&&(e+="/ "),$("span#spnHospName").text(e+$("#selHospital").find("option:selected").text())}),verifyAddrs("div#guestAccordion, div#hospitalSection, div#patientSection"),$("#btnDone").click(function(){if($("#divAlert1").hide(),"Saving >>>>"!==$(this).val()&&!0===verifyDone()){for(var e="",t=chkIn,a=0;a<t.members.length;a++)e+="&mbrs[]="+t.members[a].idPrefix;t.resv.checkOut.setHours(10);var i=new Date;t.resv.checkIn.setHours(i.getHours()),t.resv.checkIn.setMinutes(i.getMinutes()),e+="&ckindt="+t.resv.checkIn.toJSON(),e+="&ckoutdt="+t.resv.checkOut.toJSON(),e+="&rid="+t.idReserv,e+="&psgId="+t.idPsg,e+="&addRoom="+t.addRoom,t.members=[],t.patient=null,$.post("ws_ckin.php",$("#form1").serialize()+e+"&cmd=saveMem",function(e){gotMember(e)}),$(this).val("Saving >>>>"),$("#guestSearch").hide(),$("#rescList").hide()}}),$("#btnChkin").click(function(e){if($("#divAlert1").hide(),"Saving >>>>"!==$(this).val()&&($("#payChooserMsg").text("").hide("fade"),!1!==verifyDone())){if(0<$("#cbNoVehicle").length){if(!1===$("#cbNoVehicle").prop("checked")){var t=validateCar(1);if(""!=t){var a=validateCar(2);if(""!=a)return $("#vehValidate").text(a),void flagAlertMessage(t,!0)}}$("#vehValidate").text("")}if(0<$("#selResource").length&&(""===$("#selResource").val()||"0"===$("#selResource").val()))return flagAlertMessage("Choose a room.",!0),void $("#selResource").addClass("ui-state-error");if($("#selResource").removeClass("ui-state-error"),$("#selCategory").val()==fixedRate&&0<$("#txtFixedRate").length&&""==$("#txtFixedRate").val())return flagAlertMessage("Set the Room Rate to an amount, or 0.",!0),void $("#txtRoomRate").addClass("ui-state-error");if($("#txtRoomRate").removeClass("ui-state-error"),0<$("input#feesPayment").length&&""==$("input#feesPayment").val())return $("#payChooserMsg").text("Set the Room Fees to an amount, or 0.").show("fade"),void $("input#feesPayment").addClass("ui-state-error");if($("input#feesPayment").removeClass("ui-state-error"),void 0===verifyAmtTendrd||!1!==verifyAmtTendrd()){n.resv.checkOut.setHours(10);var i=new Date;n.resv.checkIn.setHours(i.getHours()),n.resv.checkIn.setMinutes(i.getMinutes());for(var r="",s=0;s<n.members.length;s++)r+="&mbrs[]="+n.members[s].idPrefix;r+="&ckindt="+n.resv.checkIn.toJSON(),r+="&ckoutdt="+n.resv.checkOut.toJSON(),r+="&rid="+n.idReserv,r+="&hvPat="+n.havePatient,r+="&addRoom="+n.addRoom,$.post("ws_ckin.php",$("#form1").serialize()+r+"&cmd=savePage&pbp="+d,function(e){chkIn;$("#btnChkin").val("Check In");try{e=$.parseJSON(e)}catch(e){return alert("Bad JSON Encoding"),$("#contentDiv").children().remove(),void null}if(e.error)return e.gotopage&&window.open(e.gotopage,"_self"),void flagAlertMessage(e.error,!0);e.warning&&flagAlertMessage(e.warning,!0),ckedIn(e)}),$(this).val("Saving >>>>")}}}),$("#hhk-confResvHdr").click(function(){$("#hhk-confResv").toggle("blind")}),$("#hhk-chkedInHdr").click(function(){$("#hhk-chkedIn").toggle("blind")}),$("#hhk-wListResvHdr").click(function(){$("#hhk-wListResv").toggle("blind")}),createAutoComplete($("#txtRelSch"),3,{cmd:"filter",add:"phone",basis:"g"},getECRel,void 0),createAutoComplete($("#"+n.guestSearchPrefix+"Search"),3,{cmd:"role",gp:"1"},function(e){window.open("Reserve.php?id="+e.id,"_self")}),createAutoComplete($("#"+n.guestSearchPrefix+"phSearch"),5,{cmd:"role",gp:"1"},function(e){window.open("Reserve.php?id="+e.id,"_self")}),createAutoComplete($("#"+n.patientPrefix+"Search"),3,{cmd:"role",gp:"1"},e),createAutoComplete($("#"+n.patientPrefix+"phSearch"),5,{cmd:"role",gp:"1"},e),$("#"+n.guestSearchPrefix+"Search").keypress(function(e){$(this).removeClass("ui-state-highlight")}),""!==n.gpnl&&loadGuest(n.gpnl,n.idPsg,"g",n.patientStaying),""!==n.ppnl&&loadGuest(n.ppnl,n.idPsg,"p",n.patientStaying),0<n.idReserv&&loadGuest(n.addGuestId,0,"r",n.patientStaying),$("#guestSearchWrapper").show(),$("#divresvWrapper").show()});
