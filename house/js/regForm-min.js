function setupRegForm(i,t,e,a,n,s,r,o,g){var d={mode:"popup",popClose:!0,popHt:$("div.PrintArea").height(),popWd:950,popX:20,popY:20,popTitle:"Registration Form",extraHead:$("#regFormStyle").prop("outerHTML")};$("#mainTabs").tabs(),$(".btnPrint").click(function(){d.popHt=$(this).closest(".ui-tabs-panel").find("div.PrintArea").height(),d.popTitle=$(this).data("title"),$(this).closest(".ui-tabs-panel").find("div.PrintArea").printArea(d)}).button(),$(".btnSave").click(function(){var i=$("<div/>").addClass("hhk-loading-btn");if(!($(this).closest(".ui-tabs-panel").find("div.PrintArea .signDate:visible").length>0)){flagAlertMessage("<strong>Error:</strong> At least one signature is required",!0);return}var t=[];$(this).parent(".ui-tabs-panel").find(".regFormInput").each(function(i,e){var a=$(this).val(),n={class:"regFormInput",uniqId:i,val:a};n.type=void 0!=$(this).data("inputtype")?$(this).data("inputtype"):"text",n.height="textarea"==$(this).data("inputtype")?$(this).height():void 0,t.push(n)}),t=t.concat(window.regFormSignatures),$(".btnSave").prop("disabled","disabled").html(i);try{var e=$(this).data("tab");$(this).closest(".ui-tabs-panel").find("div.PrintArea .btnSign, div.PrintArea .btnInitial").remove();var a=new FormData;a.append("cmd","saveRegForm"),a.append("guestId",o),a.append("psgId",g),a.append("idVisit",s),a.append("idResv",r),a.append("docTitle","Registration Form"),a.append("uuid",$(this).data("uuid")),a.append("formCode",e),a.append("docSignatures",JSON.stringify(t)),$.ajax({url:"ws_ckin.php",dataType:"JSON",type:"post",data:a,contentType:!1,processData:!1,success:function(i){i.idDoc>0?(flagAlertMessage("<strong>Success:</strong> Registration form saved successfully",!1),$(".btnSave").hide()):(i.error&&flagAlertMessage("<strong>Error: </strong>"+i.error,!0),$(".btnSave").prop("disabled",!1).text("Save"))},error:function(i,t,e){flagAlertMessage("<strong>Error:</strong> A server error has occurred - "+t,!0),$(".btnSave").prop("disabled",!1).text("Save")}})}catch(n){if(flagAlertMessage("<strong>Error:</strong> "+n.message,!0),$(".btnSave").prop("disabled",!1).text("Save"),"function"==typeof hhkReportError){var d={stackTrace:n.stack,source:"saveRegForm",idResv:"<?php echo $idResv; ?>",idVisit:"<?php echo $idVisit; ?>"};d=btoa(JSON.stringify(d)),hhkReportError(n.message,d)}}}).button(),$("#btnReg").click(function(){getRegistrationDialog(i)}).button(),$("#btnStmt").click(function(){window.open("ShowStatement.php?vid="+s,"_blank")}).button(),$("#pmtRcpt").dialog({autoOpen:!1,resizable:!0,width:getDialogWidth(530),modal:!0,title:"Payment Receipt"}),""!==t&&showReceipt("#pmtRcpt",t,"Payment Receipt",550,receiptPaymentId,receiptBilledToEmail),e&&showRegDialog(e,i),a&&a>0&&reprintReceipt(a,"#pmtRcpt"),n&&""!==n&&window.open("ShowInvoice.php?invnum="+n),$("#regTabDiv .checkboxWrapper").on("click",function(){$(this).hasClass("bi-square")?($(this).find("input").val("true"),$(this).removeClass("bi-square").addClass("bi-check-square-fill")):$(this).hasClass("bi-check-square-fill")&&($(this).find("input").val("false"),$(this).removeClass("bi-check-square-fill").addClass("bi-square"))}),$("#mainTabs").show(),$("#regTabDiv, #signedRegTabDiv").tabs()}function loadSignatures(i){$("#vsignedReg .btnSign, #vsignedReg .btnInitial").hide();try{for(docId in i){var t="vreg"==docId?$("#vreg .regFormInput"):$("#vsignedReg #"+docId+" .regFormInput");t.attr("disabled",!0),i[docId].forEach(i=>{if("signature"==i.type&&void 0!==i.uniqId){var e=$(t[i.uniqId]).parents(".signWrapper");i.val.length>0&&(e.find(".sigLine img").prop("src",i.val).show(),e.find(".signDate").show())}else"regFormInput"==i.class&&void 0!==i.uniqId?($(t[i.uniqId]).val(i.val),"checkbox"==i.type&&"true"==i.val&&$(t[i.uniqId]).parents(".checkboxWrapper").removeClass("bi-square").addClass("bi-check-square-fill"),void 0!==i.height&&$(t[i.uniqId]).height(i.height)):i.idName&&($("#"+docId+" .signWrapper[data-idname="+i.idName+"] .sigLine img").prop("src",i.signature).show(),$("#"+docId+" .signWrapper[data-idname="+i.idName+"] .signDate").show())})}}catch(e){flagAlertMessage("Failed to load registration form fields: "+e.message,!0)}}function setupEsign(){window.regFormSignatures=[],$("#jSignDialog").dialog({autoOpen:!1,width:getDialogWidth(800),modal:!0,buttons:{Clear:function(){var i=$(this).find("input#idName").val(),t=$(this).find("input#formCode").val(),e=$(this).find("input#idBtn").val();$(this).find(".signature").jSignature("clear"),window.regFormSignatures.some((a,n)=>{if(a.formCode==t&&a.idName==i&&a.uniqId==e)return window.regFormSignatures.splice(n,1),!0}),$("#"+t+" .signWrapper[data-uniqid="+e+"] .sigLine img").attr("src","").hide(),$("#"+t+" .signWrapper[data-uniqid="+e+"] .sigLine input.regFormInput").val(""),$("#"+t+" .signWrapper[data-uniqid="+e+"] .signDate").hide()},Sign:function(){var i=$(this).find("input#idName").val(),t=$(this).find("input#formCode").val(),e="data:"+$(this).find(".signature").jSignature("getData","svgbase64").join(","),a=$(this).find("input#idBtn").val();i>0&&window.regFormSignatures.push({formCode:t,idName:i,uniqId:a,signature:e}),$("#"+t+" .signWrapper[data-uniqid="+a+"] .sigLine img").attr("src",e).show(),$("#"+t+" .signWrapper[data-uniqid="+a+"] .sigLine input.regFormInput").val(e),$("#"+t+" .signWrapper[data-uniqid="+a+"] .signDate").show(),$(this).dialog("close")}}}),$("#jSignDialog .signature").jSignature({width:"175px",height:"141px"}),$("#topazDialog").dialog({autoOpen:!1,width:getDialogWidth(550),modal:!0,buttons:{Clear:function(){var i=$(this).find("input#idName").val(),t=$(this).find("input#formCode").val(),e=$(this).find("input#idBtn").val();ClearTablet(),window.regFormSignatures.some((a,n)=>{if(a.formCode==t&&a.idName==i&&a.uniqId==e)return window.regFormSignatures.splice(n,1),!0}),$("#"+t+" .signWrapper[data-uniqid="+e+"] .sigLine img").attr("src","").hide(),$("#"+t+" .signWrapper[data-uniqid="+e+"] .sigLine input.regFormInput").val(""),$("#"+t+" .signWrapper[data-uniqid="+e+"] .signDate").hide()},Sign:function(){var t=$(this).find("input#idName").val(),e=$(this).find("input#formCode").val(),a=$(this).find("input#idBtn").val();if(!1!=(0!=NumberOfTabletPoints()&&(SetTabletState(0,i),!0))){var s=$(this).find("canvas#sigImg")[0].toDataURL("image/png");t>0&&window.regFormSignatures.push({formCode:e,idName:t,uniqId:a,signature:s}),$("#"+e+" .signWrapper[data-uniqid="+a+"] .sigLine img").attr("src",s).show(),$("#"+e+" .signWrapper[data-uniqid="+a+"] .sigLine input.regFormInput").val(s),$("#"+e+" .signWrapper[data-uniqid="+a+"] .signDate").show(),$(this).dialog("close")}else n("Please sign before continuing",!1,!1)}},open:function(){(function s(){if($("#sigWebAlert").hide(),IsSigWebInstalled()){var o,g,d="";try{d=GetSigWebVersion()}catch(p){console.log("Unable to get SigWeb Version: "+p.message)}if(""!==d){try{a=(o=d,!function(i,t){return r(i,t)}("1.7.0.0",o)||(console.log("SigWeb version 1.7.0.0 or higher not installed."),!1))}catch(l){console.log(l.message)}if(a)t=!0,ClearTablet(),function t(){if(IsSigWebInstalled()){$("#sigImg").show();var e=document.getElementById("sigImg").getContext("2d");SetDisplayXSize($("#sigImg")[0].width),SetDisplayYSize($("#sigImg")[0].height),SetTabletState(0,i),SetJustifyMode(5),ClearTablet(),null===i||(SetTabletState(0,i),i=null),i=SetTabletState(1,e,50),0==GetTabletState()&&n("Unable to connect to Signature Pad, please check that it is connected to this computer",!1,!0)}else n("Unable to communicate with SigWeb, please make sure it is installed and running ",!0)}();else{try{e=(g=d,!function(i,t){return r(i,t)}("1.6.4.0",g)||(console.log("SigWeb version 1.6.4.0 or higher not installed."),!1))}catch(u){console.log(u.message)}e?(t=!0,n("SigWeb 1.6.4 is installed. Please install the latest version: ",!0)):n("A newer version of SigWeb is available. Please install the latest version: ",!0)}}else n("A newer version of SigWeb is available. Please install the latest version: ",!0)}else n("Unable to communicate with SigWeb, please make sure it is installed and running ",!0)})()},close:function(){o(),clearInterval(i)}}),$(".btnSign, .btnInitial").uniqueId().on("click",function(){let i=$(this).data("esign"),t=$(this).closest(".row").find(".printName").text(),e=$(this).attr("id");$(this).parents(".signWrapper").attr("data-uniqid",e),"jSign"===i?($("#jSignDialog input#idName").val($(this).closest(".signWrapper").data("idname")),$("#jSignDialog input#formCode").val($(this).closest(".ui-tabs-panel").attr("id")),$("#jSignDialog input#idBtn").val(e),$("#jSignDialog").find(".signature").jSignature("clear"),$(this).hasClass("btnInitial")?($("#jSignDialog .signature").empty().jSignature({width:"175px",height:"141px"}),$("#jSignDialog").dialog("option","title","Initial").dialog("option","width",getDialogWidth(240)).dialog("open")):($("#jSignDialog .signature").empty().jSignature({width:"750px",height:"141px"}),$("#jSignDialog").dialog("option","title","Signature: "+t).dialog("option","width",getDialogWidth(800)).dialog("open"))):"topaz"===i&&($("#topazDialog input#idName").val($(this).closest(".signWrapper").data("idname")),$("#topazDialog input#formCode").val($(this).closest(".ui-tabs-panel").attr("id")),$("#topazDialog input#idBtn").val(e),$(this).hasClass("btnInitial")?($("#topazDialog #sigImg").attr("width","150"),$("#topazDialog").dialog("option","title","Initial").dialog("option","width",getDialogWidth(225)).dialog("open")):($("#topazDialog #sigImg").attr("width","500"),$("#topazDialog").dialog("option","title","Signature: "+t).dialog("option","width",getDialogWidth(550)).dialog("open")))}),$(document).on("input","textarea.regFormInput",function(){this.style.height="auto",this.style.height=this.scrollHeight+3+"px"});var i,t=!1,e=!1,a=!1;function n(i,t=!1,e=!0){let a=$("#sigWebAlert"),n=a.find("#alertMessage"),s=$("<a></a>").prop("href","https://www.topazsystems.com/software/sigweb.exe").text("Install SigWeb").button();i&&n.html("<p>"+i+"</p>"),t&&n.append(s),e&&$("#sigImg").hide(),a.show()}function s(i,t){return r(i,t)}function r(i,t){let e=i.split("."),a=t.split(".");for(var n=0;n<a.length;n++){let s=parseInt(a[n])||0,r=parseInt(e[n])||0;if(s<r)return!0;if(s>r)break}return!1}function o(){t?Reset():"undefined"!=typeof clearTablet&&(ClearTablet(),SetTabletState(0,i))}document.addEventListener("beforeunload",function(t){try{o(),clearInterval(i)}catch(e){}},!1)}