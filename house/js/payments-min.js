var gblAdjustData=[];function getApplyDiscDiag(e,t){"use strict";e&&""!=e&&0!=e?$.post("ws_ckin.php",{cmd:"getHPay",ord:e,arrDate:$("#spanvArrDate").text()},function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}if(e.error)e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,"error");else if(e.markup){t.children().remove();var a={Save:function(){var e=parseFloat($("#housePayment").val().replace("$","").replace(",","")),t=parseFloat($("#houseTax").val()),a=$("#housePayment").data("vid"),r=$.datepicker.formatDate("yy-mm-dd",$("#housePaymentDate").datepicker("getDate")),i=$("#housePaymentNote").val();isNaN(e)&&(e=0),isNaN(t)&&(t=0),saveDiscountPayment(a,$("#cbAdjustPmt1").prop("checked")?$("#cbAdjustPmt1").data("item"):$("#cbAdjustPmt2").data("item"),e,$("#selHouseDisc").val(),$("#selAddnlChg").val(),r,i),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}};t.append($('<div class="hhk-panel hhk-tdbox hhk-visitdialog" style="font-size:0.8em;"/>').append($(e.markup))),$("#cbAdjustType").buttonset(),$("#cbAdjustPmt1, #cbAdjustPmt2").change(function(){var e=$(this).data("hid"),t=$(this).data("sho");$("."+e).val(""),$("."+t).val(""),$("#housePayment").val(""),$("#housePayment").change(),$("."+t).show(),$("."+e).hide()}),gblAdjustData.disc=e.disc,gblAdjustData.addnl=e.addnl,$("#selAddnlChg, #selHouseDisc").change(function(){var e=parseFloat(gblAdjustData[$(this).data("amts")][$(this).val()]);$("#housePayment").val(e.toFixed(2)),$("#housePayment").change()}),$("#housePayment").change(function(){if($("#cbAdjustPmt2").prop("checked")&&$("#houseTax").length>0){var e=parseFloat($("#houseTax").data("tax")),t=parseFloat($("#housePayment").val().replace("$","").replace(",","")),a=0,r=0;isNaN(e)&&(e=0),isNaN(t)&&(t=0),r=t+(a=e*t),$("#houseTax").val(a>0?a.toFixed(2):""),$("#totalHousePayment").val(r>0?r.toFixed(2):"")}}),$("#cbAdjustPmt1").length>0?($("#cbAdjustPmt1").prop("checked",!0),$("#cbAdjustPmt1").change()):($("#cbAdjustPmt2").prop("checked",!0),$("#cbAdjustPmt2").change()),t.dialog("option","buttons",a),t.dialog("option","title","Adjust Fees"),t.dialog("option","width",430),t.dialog("open")}}}):flagAlertMessage("Order Number is missing","error")}function saveDiscountPayment(e,t,a,r,i,s,n){"use strict";$.post("ws_ckin.php",{cmd:"saveHPay",ord:e,item:t,amt:a,dsc:r,chg:i,adjDate:s,notes:n},function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}e.error&&(e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,"error")),e.reply&&""!=e.reply&&(flagAlertMessage(e.reply,"success"),$("#keysfees").dialog("close")),e.receipt&&""!==e.receipt&&($("#keysfees").length>0&&$("#keysfees").dialog("close"),showReceipt("#pmtRcpt",e.receipt,"Payment Receipt"))}})}function getInvoicee(e,t){"use strict";var a=parseInt(e.id,10);!1===isNaN(a)&&a>0?($("#txtInvName").val(e.value),$("#txtInvId").val(a)):($("#txtInvName").val(""),$("#txtInvId").val("")),$("#txtOrderNum").val(t),$("#txtInvSearch").val("")}function invoiceAction(e,t,a,r,i){"use strict";$.post("ws_resc.php",{cmd:"invAct",iid:e,x:a,action:t,sbt:i},function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}if(e.error)return e.gotopage&&window.location.assign(e.gotopage),void flagAlertMessage(e.error,"error");if(e.delete&&("0"==e.eid?(flagAlertMessage(e.delete,"success"),$("#btnInvGo").click()):$("#"+e.eid).parents("tr").first().hide("fade")),e.markup){var t=$(e.markup);null!=r&&""!=r?$(r).append(t):$("body").append(t),t.position({my:"left top",at:"left bottom",of:"#"+e.eid})}}})}function sendVoidReturn(e,t,a,r){var i={pid:a,bid:e};t&&"v"===t?i.cmd="void":t&&"rv"===t?i.cmd="revpmt":t&&"r"===t?(i.cmd="rtn",i.amt=r):t&&"ur"===t?(i.cmd="undoRtn",i.amt=r):t&&"vr"===t?i.cmd="voidret":t&&"d"===t&&(i.cmd="delWaive",i.iid=r),$.post("ws_ckin.php",i,function(e){var t="";if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}if(e.bid&&$("#"+e.bid).remove(),e.error)return e.gotopage&&window.location.assign(e.gotopage),void flagAlertMessage(e.error,"error");if(e.reversal&&""!==e.reversal&&(t=e.reversal),e.warning)return void flagAlertMessage(t+e.warning,"warning");e.success&&flagAlertMessage(t+e.success,"success"),e.receipt&&showReceipt("#pmtRcpt",e.receipt,"Receipt")}})}var payCtrls=function(){var e=this;e.keyDepAmt=$("#keyDepAmt"),e.keyDepCb=$("#keyDepRx"),e.depRefundCb=$("#cbDepRefundApply"),e.depRefundAmt=$("#DepRefundAmount"),e.visitFeeAmt=$("#visitFeeAmt"),e.visitFeeCb=$("#visitFeeCb"),e.feePayAmt=$("input#feesPayment"),e.feesCharges=$("#feesCharges"),e.totalPayment=$("#totalPayment"),e.totalCharges=$("#totalCharges"),e.cashTendered=$("#txtCashTendered"),e.invoiceCb=$(".hhk-payInvCb"),e.adjustBtn=$("#paymentAdjust"),e.msg=$("#payChooserMsg"),e.heldAmtTb=$("#heldAmount"),e.heldCb=$("#cbHeld"),e.reimburseVatCb=$("#cbReimburseVAT"),e.reimburseVatAmt=$("#reimburseVat"),e.hsDiscAmt=$("#HsDiscAmount"),e.finalPaymentCb=$("input#cbFinalPayment"),e.overPay=$("#txtOverPayAmt"),e.guestCredit=$("#guestCredit"),e.selBalTo=$("#selexcpay")};function roundTo(e,t){void 0===t&&(t=0);var a=Math.pow(10,t);return e=parseFloat((e*a).toFixed(11)),Math.round(e)/a}function amtPaid(){"use strict";var e=new payCtrls,t=0,a=0,r=0,i=0,s="",n=0,o=0,d=0,h=0,l=0,c=0,p=0,u=0,m=0,g=0,v=0,f=0,y=0,b=0,C=0,k=0,A=isCheckedOut,P=parseFloat(e.feePayAmt.data("tax")),N=parseFloat($("#spnCfBalDue").data("rmbal")),x=parseFloat($("#spnCfBalDue").data("totbal"));if(P=isNaN(P)||P<0?0:roundTo(P,3),isNaN(N)?N=0:b=roundTo(N*P,2),e.msg.text("").hide(),e.visitFeeCb.length>0&&(a=parseFloat($("#spnvfeeAmt").data("amt")),isNaN(a)||a<0||!1===e.visitFeeCb.prop("checked")?(a=0,e.visitFeeAmt.val("")):e.visitFeeAmt.val(a.toFixed(2).toString())),!A&&e.keyDepCb.length>0&&(t=parseFloat($("#hdnKeyDepAmt").val()),isNaN(t)||t<0||!1===e.keyDepCb.prop("checked")?(t=0,e.keyDepAmt.val("")):e.keyDepAmt.val(t.toFixed(2).toString())),e.invoiceCb.length>0&&e.invoiceCb.each(function(){var e,t=parseInt($(this).data("invnum")),a=$("#"+t+"invPayAmt"),r=parseFloat($(this).data("invamt"));!0===$(this).prop("checked")?(a.prop("disabled",!1),""===a.val()&&a.val(r.toFixed(2).toString()),e=parseFloat(a.val().replace("$","").replace(",","")),isNaN(e)||0==e?(e=0,a.val("")):Math.abs(e)>Math.abs(r)?(e=r,a.val(e.toFixed(2).toString())):a.val(e.toFixed(2).toString()),n+=e):""!==a.val()&&(a.val(""),a.prop("disabled",!0))}),e.depRefundAmt.length>0&&(v=parseFloat(e.depRefundAmt.data("amt")),isNaN(v)||v<0||!1===e.depRefundCb.prop("checked")?(v=0,e.depRefundAmt.val("")):((y=roundTo(v-v/(1+P),2))>b&&(y=b),f=v-y,e.depRefundAmt.val((0-v).toFixed(2).toString()))),e.heldCb.length>0&&(o=parseFloat(e.heldCb.data("amt")),isNaN(o)||o<0||!1===e.heldCb.prop("checked")?o=0:((d=roundTo(o-o/(1+P),2))>b-y&&(d=b-y),h=o-d)),e.reimburseVatCb.length>0&&(l=parseFloat(e.reimburseVatCb.data("amt")),isNaN(l)||l<0||!1===e.reimburseVatCb.prop("checked")?l=0:((p=roundTo(l-l/(1+P),2))>b-y-d&&(p=b-y-d),c=l-p)),e.feePayAmt.length>0&&(s=e.feePayAmt.val().replace("$","").replace(",",""),i=parseFloat(s),"0"!==s&&(s=""),isNaN(i)||i<=0?i=0:P>0&&((C=roundTo(i*P,2))>b-y-d-p&&A?C=b-y-d-p:C-=d-p),C<0&&(C=0),r=roundTo(i+C,2)),A){$(".hhk-minPayment").show("fade"),k=0,e.hsDiscAmt.val("");var w=N+b;if(N>=0?(e.feesCharges.val(w.toFixed(2).toString()),$(".hhk-GuestCredit").hide(),$(".hhk-RoomCharge").show()):(e.guestCredit.val(w.toFixed(2).toString()),$(".hhk-RoomCharge").hide(),$(".hhk-GuestCredit").show()),(u=roundTo(a+n+x-o-v-l,2))-(g=roundTo(a+n+r,2))>=0){var F=roundTo(a+n+N-f-h-c-i,2);if(F>0){if(e.finalPaymentCb.prop("checked")){var T=roundTo(b-(C+d+y+p),2);e.hsDiscAmt.val(F.toFixed(2).toString()),e.feesCharges.val((w-T).toFixed(2).toString()),u-=T,g=r}else e.hsDiscAmt.val("");$(".hhk-Overpayment").hide(),$(".hhk-HouseDiscount").show("fade")}else e.finalPaymentCb.prop("checked",!1),e.hsDiscAmt.val(""),$(".hhk-HouseDiscount").hide(),$(".hhk-Overpayment").hide()}else e.finalPaymentCb.prop("checked",!1),e.hsDiscAmt.val(""),k=g-u,"r"===e.selBalTo.val()?(u>=0?(i>k&&alert("Pay Room Fees amount is reduced to: $"+(i-k).toFixed(2).toString()),r=(i-=k)+C,k=0,e.selBalTo.val(""),$("#txtRtnAmount").val(""),$("#divReturnPay").hide()):(r>0&&alert("Pay Room Fees amount is reduced to: $0.00"),k-=r,i=0,C=0,r=0,$("#divReturnPay").show("fade"),$("#txtRtnAmount").val(k.toFixed(2).toString())),g=a+n+r):($("#txtRtnAmount").val(""),$("#divReturnPay").hide()),k.toFixed(2)>0?($(".hhk-Overpayment").show("fade"),$(".hhk-HouseDiscount").hide()):($(".hhk-Overpayment").hide(),$(".hhk-HouseDiscount").hide())}else(u=a+t+n+r)>0&&o>0?o>u?(o=u,u=0):u-=o:u<0&&o>0?u-=o:e.heldCb.length>0&&e.heldAmtTb.val(""),u>0&&l>0?l>u?(l=u,u=0):u-=l:u<0&&l>0?u-=l:e.reimburseVatCb.length>0&&e.reimburseVatCb.val(""),$(".hhk-Overpayment").hide(),$(".hhk-HouseDiscount").hide(),e.hsDiscAmt.val(""),k=0,g=u,m=a+t+n+r;g>0||g<0&&!A?($(".paySelectTbl").show("fade"),$(".hhk-minPayment").show("fade"),$("#cbNewCard").length>0&&$("#cbNewCard").prop("checked",!1).change().prop("disabled",!0),g<0&&!A&&$("#txtRtnAmount").val((0-g).toFixed(2).toString())):(g=0,$(".paySelectTbl").hide(),$("#cbNewCard").length>0&&$("#cbNewCard").prop("disabled",!1),!1===A&&0===m?($(".hhk-minPayment").hide(),o=0):$(".hhk-minPayment").show("fade")),0===r?(e.feePayAmt.val(s),$("#feesTax").val("")):(e.feePayAmt.val(i.toFixed(2).toString()),$("#feesTax").val(C.toFixed(2).toString())),0===k?e.overPay.val(""):e.overPay.val(k.toFixed(2).toString()),o>0?e.heldAmtTb.val((0-o).toFixed(2).toString()):e.heldAmtTb.val(""),l>0?e.reimburseVatAmt.val((0-l).toFixed(2).toString()):e.reimburseVatAmt.val(""),e.totalCharges.val(u.toFixed(2).toString()),e.totalPayment.val(g.toFixed(2).toString()),$("#spnPayAmount").text("$"+g.toFixed(2).toString()),e.cashTendered.change()}function setupPayments(e,t,a,r){"use strict";var i=$("#PayTypeSel"),s=$(".tblCredit"),n=new payCtrls;0===s.length&&(s=$(".hhk-mcred")),i.length>0&&(i.change(function(){$(".hhk-cashTndrd").hide(),$(".hhk-cknum").hide(),$("#tblInvoice").hide(),$(".hhk-transfer").hide(),$(".hhk-tfnum").hide(),s.hide(),$(".hhkvrKeyNumber").hide(),$("#tdCashMsg").hide(),$(".paySelectNotes").show(),"cc"===$(this).val()?(s.show("fade"),0==$("input[name=rbUseCard]:checked").val()&&$(".hhkvrKeyNumber").show()):"ck"===$(this).val()?$(".hhk-cknum").show("fade"):"in"===$(this).val()?($("#tblInvoice").show("fade"),$(".paySelectNotes").hide()):"tf"===$(this).val()?$(".hhk-transfer").show("fade"):$(".hhk-cashTndrd").show("fade")}),i.change()),$("#trvdCHName").length>0&&($("input[name=rbUseCard]").on("change",function(){0==$(this).val()?$(".hhkvrKeyNumber").show():($(".hhkvrKeyNumber").hide(),$("#btnvrKeyNumber").prop("checked",!1).change())}),$("input[name=rbUseCard]:checked").val()>0&&$(".hhkvrKeyNumber").hide(),$("#btnvrKeyNumber").change(function(){this.checked&&0==$("input[name=rbUseCard]:checked").val()?$("#trvdCHName").show():$("#trvdCHName").hide()}),$("#btnvrKeyNumber").change());var o=$("#rtnTypeSel"),d=$(".tblCreditr");0===d.length&&(d=$(".hhk-mcredr")),o.length>0&&(o.change(function(){d.hide(),$(".hhk-transferr").hide(),$(".payReturnNotes").show(),$(".hhk-cknum").hide(),"cc"===$(this).val()?d.show("fade"):"ck"===$(this).val()?$(".hhk-cknum").show("fade"):"tf"===$(this).val()?$(".hhk-transferr").show("fade"):"in"===$(this).val()&&$(".payReturnNotes").hide()}),o.change()),n.selBalTo.length>0&&n.selBalTo.change(function(){amtPaid()}),n.finalPaymentCb.length>0&&n.finalPaymentCb.change(function(){amtPaid()}),n.keyDepCb.length>0&&n.keyDepCb.change(function(){amtPaid()}),n.depRefundCb.length>0&&n.depRefundCb.change(function(){amtPaid()}),n.heldCb.length>0&&n.heldCb.change(function(){amtPaid()}),n.reimburseVatCb.length>0&&n.reimburseVatCb.change(function(){amtPaid()}),n.invoiceCb.length>0&&(n.invoiceCb.change(function(){amtPaid()}),$(".hhk-payInvAmt").change(function(){amtPaid()})),n.visitFeeCb.length>0&&n.visitFeeCb.change(function(){amtPaid()}),n.feePayAmt.length>0&&n.feePayAmt.change(function(){$(this).removeClass("ui-state-error"),amtPaid()}),n.cashTendered.length>0&&n.cashTendered.change(function(){n.cashTendered.removeClass("ui-state-highlight"),$("#tdCashMsg").hide();var e=parseFloat(n.totalPayment.val().replace(",",""));(isNaN(e)||e<0)&&(e=0);var t=parseFloat(n.cashTendered.val().replace("$","").replace(",",""));(isNaN(t)||t<0)&&(t=0,n.cashTendered.val(""));var a=t-e;a<0&&(a=0,n.cashTendered.addClass("ui-state-highlight")),$("#txtCashChange").text("$"+a.toFixed(2).toString())}),n.adjustBtn.length>0&&(n.adjustBtn.button(),n.adjustBtn.click(function(){getApplyDiscDiag(t,r)})),$("#divPmtMkup").on("click",".invAction",function(e){e.preventDefault(),("del"!=$(this).data("stat")||confirm("Delete this Invoice?"))&&invoiceAction($(this).data("iid"),$(this).data("stat"),e.target.id,"#keysfees",!0)}),$("#txtInvSearch").length>0&&($("#txtInvSearch").keypress(function(e){var a=$(this).val();"13"==e.keyCode&&(""!=a&&isNumber(parseInt(a,10))?$.getJSON("../house/roleSearch.php",{cmd:"filter",basis:"ba",letters:a},function(e){try{e=e[0]}catch(e){return void alert("Parser error - "+e.message)}e&&e.error&&(e.gotopage&&(response(),window.open(e.gotopage)),e.value=e.error),getInvoicee(e,t)}):(alert("Don't press the return key unless you enter an Id."),e.preventDefault()))}),createAutoComplete($("#txtInvSearch"),3,{cmd:"filter",basis:"ba"},function(e){getInvoicee(e,t)},!1)),$("#daystoPay").change(function(){var t=parseInt($(this).val()),a=parseInt($(this).data("vid")),r=parseFloat($("#txtFixedRate").val()),i=parseInt($("#spnNumGuests").text()),s=n.feePayAmt,o=parseFloat($("#spnRcTax").data("tax")),d=parseFloat($("#txtadjAmount").val());$(this).val(""),isNaN(i)&&(i=1),isNaN(r)&&(r=0),isNaN(o)&&(o=0),isNaN(d)&&(d=0),isNaN(t)||t>0&&daysCalculator(t,e.val(),a,r,d,i,0,function(e){s.val(e.toFixed(2).toString()),s.change()})}),amtPaid()}function daysCalculator(e,t,a,r,i,s,n,o){if(e>0){var d={cmd:"rtcalc",vid:a,rid:n,nites:e,rcat:t,fxd:r,adj:i,gsts:s};$.post("ws_ckin.php",d,function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}if(e.error)return e.gotopage&&window.open(e.gotopage),void flagAlertMessage(e.error,"error");if(e.amt){var t=parseFloat(e.amt);(isNaN(t)||t<0)&&(t=0),o(t)}}else alert("Bad Reply from Server")})}}function verifyBalDisp(){return""==$("#selexcpay").val()&&""!=$("#txtOverPayAmt").val()?($("#payChooserMsg").text('Set "Apply To" to the desired overpayment disposition. ').show(),$("#selexcpay").addClass("ui-state-highlight"),$("#pWarnings").text('Set "Apply To" to the desired overpayment disposition.').show(),!1):($("#payChooserMsg").text("").hide(),$("#selexcpay").removeClass("ui-state-highlight"),!0)}function verifyAmtTendrd(){"use strict";if(0===$("#PayTypeSel").length)return!0;var e=parseFloat($("#totalPayment").val().replace("$","").replace(",",""));if($("#tdCashMsg").hide("fade"),$("#tdInvceeMsg").text("").hide(),"ca"===$("#PayTypeSel").val()){var t=parseFloat($("#txtCashTendered").val().replace("$","").replace(",","")),a=$("#remtotalPayment");if(a.length>0&&(e=parseFloat(a.val().replace("$","").replace(",",""))),(isNaN(e)||e<0)&&(e=0),(isNaN(t)||t<0)&&(t=0),e>0&&t<=0)return $("#tdCashMsg").text('Enter the amount paid into "Amount Tendered" ').show(),$("#pWarnings").text('Enter the amount paid into "Amount Tendered"').show(),!1;if(e>0&&t<e)return $("#tdCashMsg").text("Amount tendered is not enough ").show("fade"),$("#pWarnings").text("Amount tendered is not enough").show(),!1}else if("in"===$("#PayTypeSel").val()){var r=parseInt($("#txtInvId").val(),10);if((isNaN(r)||r<1)&&0!=e)return $("#tdInvceeMsg").text("The Invoicee is missing. ").show("fade"),!1}return!0}function showReceipt(e,t,a,r){var i=$(e),s=$("<div id='print_button' style='margin-left:1em;'>Print</div>"),n={mode:"popup",popClose:!1,popHt:500,popWd:400,popX:200,popY:200,popTitle:a};void 0!==r&&r||(r=550),i.children().remove(),i.append($(t).addClass("ReceiptArea").css("max-width",r+"px")),s.button(),s.click(function(){$(".ReceiptArea").printArea(n),i.dialog("close")}),i.prepend(s),i.dialog("option","title",a),i.dialog("option","buttons",{}),i.dialog("option","width",r),i.dialog("open"),n.popHt=$("#pmtRcpt").height(),n.popWd=$("#pmtRcpt").width()}function reprintReceipt(e,t){$.post("ws_ckin.php",{cmd:"getPrx",pid:e},function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}e.error&&(e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,"error")),showReceipt(t,e.receipt,"Receipt Copy")}})}function paymentRedirect(e,t){"use strict";if(e)if(e.hostedError)flagAlertMessage(e.hostedError,"error");else if(e.cvtx)window.location.assign(e.cvtx);else if(e.xfer&&t.length>0){if(t.children("input").remove(),t.prop("action",e.xfer),e.paymentId&&""!=e.paymentId)t.append($('<input type="hidden" name="PaymentID" value="'+e.paymentId+'"/>'));else{if(!e.cardId||""==e.cardId)return void flagAlertMessage("PaymentId and CardId are missing!","error");t.append($('<input type="hidden" name="CardID" value="'+e.cardId+'"/>'))}t.submit()}else e.inctx&&($("#contentDiv").empty().append($("<p>Processing Credit Payment...</p>")),InstaMed.launch(e.inctx),$("#instamed").css("visibility","visible").css("margin-top","50px;"))}function setupCOF(){$("#trCHName").length>0&&($("#cbNewCard").change(function(){this.checked?$(".hhkKeyNumber").show():($(".hhkKeyNumber").hide(),$("#cbKeyNumber").prop("checked",!1).change())}),$("#cbNewCard").change(),$("#cbKeyNumber").change(function(){this.checked&&!0===$("#cbNewCard").prop("checked")?$("#trCHName").show():$("#trCHName").hide()}),$("#cbKeyNumber").change())}function cardOnFile(e,t,a){var r={cmd:"cof",idGuest:e,idGrp:t,pbp:a};$("#tblupCredit").find("input").each(function(){if("checkbox"===$(this).attr("type"))!1!==this.checked&&(r[$(this).attr("id")]="on");else if($(this).hasClass("ckdate")){var e=$(this).datepicker("getDate");r[$(this).attr("id")]=e?e.toJSON():""}else"radio"===$(this).attr("type")?!1!==this.checked&&(r[$(this).attr("id")]=this.value):r[$(this).attr("id")]=this.value}),$.post("ws_ckin.php",r,function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}if(e.error)return e.gotopage&&window.location.assign(e.gotopage),void flagAlertMessage(e.error,"error");e.hostedError&&flagAlertMessage(e.hostedError,"error"),paymentRedirect(e,$("#xform")),e.success&&""!=e.success&&flagAlertMessage(e.success,"success"),e.COFmkup&&""!==e.COFmkup&&($("#tblupCredit").remove(),$("#upCreditfs").append($(e.COFmkup)),setupCOF())}})}function updateCredit(e,t,a,r,i){var s="";a&&""!=a&&(s=" - "+a),$.post("ws_ckin.php",{cmd:"viewCredit",idGuest:e,reg:t,pbp:i},function(a){if(a){try{a=$.parseJSON(a)}catch(e){return void alert("Parser error - "+e.message)}a.error&&(a.gotopage&&window.location.assign(a.gotopage),flagAlertMessage(a.error,"error"));var i={Continue:function(){cardOnFile(e,t,a.pbp),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}};if(a.success){var n=$("#"+r);n.children().remove(),n.append($('<div class="hhk-panel hhk-tdbox hhk-visitdialog"/>').append($(a.success))),n.dialog("option","buttons",i),n.dialog("option","width",400),n.dialog("option","title","Card On File"+s),setupCOF(),n.dialog("open")}}})}
