var gblAdjustData=[];function getApplyDiscDiag(e,a){"use strict";e&&""!=e&&0!=e?$.post("ws_ckin.php",{cmd:"getHPay",ord:e,arrDate:$("#spanvArrDate").text()},function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}var t;e.error?(e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,"error")):e.markup&&(a.children().remove(),t={Save:function(){var e=parseFloat($("#housePayment").val().replace("$","").replace(",","")),t=parseFloat($("#houseTax").val()),a=$("#housePayment").data("vid"),i=$.datepicker.formatDate("yy-mm-dd",$("#housePaymentDate").datepicker("getDate")),r=$("#housePaymentNote").val();isNaN(e)&&(e=0),isNaN(t)&&(t=0),saveDiscountPayment(a,$("#cbAdjustPmt1").prop("checked")?$("#cbAdjustPmt1").data("item"):$("#cbAdjustPmt2").data("item"),e,$("#selHouseDisc").val(),$("#selAddnlChg").val(),i,r),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},a.append($('<div class="hhk-panel hhk-tdbox hhk-visitdialog" style="font-size:0.8em;"/>').append($(e.markup))),$("#cbAdjustType").buttonset(),$("#cbAdjustPmt1, #cbAdjustPmt2").change(function(){var e=$(this).data("hid"),t=$(this).data("sho");$("."+e).val(""),$("."+t).val(""),$("#housePayment").val(""),$("#housePayment").change(),$("."+t).show(),$("."+e).hide()}),gblAdjustData.disc=e.disc,gblAdjustData.addnl=e.addnl,$("#selAddnlChg, #selHouseDisc").change(function(){var e=parseFloat(gblAdjustData[$(this).data("amts")][$(this).val()]);$("#housePayment").val(e.toFixed(2)),$("#housePayment").change()}),$("#housePayment").change(function(){var e,t,a,i;$("#cbAdjustPmt2").prop("checked")&&0<$("#houseTax").length&&(e=parseFloat($("#houseTax").data("tax")),t=parseFloat($("#housePayment").val().replace("$","").replace(",","")),i=a=0,isNaN(e)&&(e=0),isNaN(t)&&(t=0),i=t+(a=e*t),$("#houseTax").val(0<a?a.toFixed(2):""),$("#totalHousePayment").val(0<i?i.toFixed(2):""))}),0<$("#cbAdjustPmt1").length?($("#cbAdjustPmt1").prop("checked",!0),$("#cbAdjustPmt1").change()):($("#cbAdjustPmt2").prop("checked",!0),$("#cbAdjustPmt2").change()),a.dialog("option","buttons",t),a.dialog("option","title","Adjust Fees"),a.dialog("option","width",430),a.dialog("open"))}}):flagAlertMessage("Order Number is missing","error")}function saveDiscountPayment(e,t,a,i,r,n,s){"use strict";$.post("ws_ckin.php",{cmd:"saveHPay",ord:e,item:t,amt:a,dsc:i,chg:r,adjDate:n,notes:s},function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}e.error&&(e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,"error")),e.reply&&""!=e.reply&&(flagAlertMessage(e.reply,"success"),$("#keysfees").dialog("close")),e.receipt&&""!==e.receipt&&(0<$("#keysfees").length&&$("#keysfees").dialog("close"),showReceipt("#pmtRcpt",e.receipt,"Payment Receipt"))}})}function getInvoicee(e,t,a){"use strict";var i=parseInt(e.id,10);!1===isNaN(i)&&0<i?($("#txtInvName"+a).val(e.value),$("#txtInvId"+a).val(i)):($("#txtInvName"+a).val(""),$("#txtInvId"+a).val("")),$("#txtOrderNum").val(t),$("#txtInvSearch"+a).val("")}function sendVoidReturn(e,t,a,i,r){var n={pid:a,bid:e};t&&"v"===t?n.cmd="void":t&&"rv"===t?n.cmd="revpmt":t&&"r"===t?(n.cmd="rtn",n.amt=i):t&&"ur"===t?(n.cmd="undoRtn",n.amt=i):t&&"vr"===t?n.cmd="voidret":t&&"d"===t&&(n.cmd="delWaive",n.iid=i),$.post("ws_ckin.php",n,function(e){var t="";if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}if(e.error)return e.gotopage&&window.location.assign(e.gotopage),void flagAlertMessage(e.error,"error");if(e.reversal&&""!==e.reversal&&(t=e.reversal),e.warning)return void flagAlertMessage(t+e.warning,"warning");e.success&&(flagAlertMessage(t+e.success,"success"),r()),e.receipt&&showReceipt("#pmtRcpt",e.receipt,"Receipt")}})}var payCtrls=function(){var e=this;e.keyDepAmt=$("#keyDepAmt"),e.keyDepCb=$("#keyDepRx"),e.depRefundCb=$("#cbDepRefundApply"),e.depRefundAmt=$("#DepRefundAmount"),e.visitFeeAmt=$("#visitFeeAmt"),e.visitFeeCb=$("#visitFeeCb"),e.feePayAmt=$("input#feesPayment"),e.feesCharges=$("#feesCharges"),e.totalPayment=$("#totalPayment"),e.totalCharges=$("#totalCharges"),e.cashTendered=$("#txtCashTendered"),e.invoiceCb=$(".hhk-payInvCb"),e.adjustBtn=$("#paymentAdjust"),e.msg=$("#payChooserMsg"),e.heldAmtTb=$("#heldAmount"),e.heldCb=$("#cbHeld"),e.reimburseVatCb=$("#cbReimburseVAT"),e.reimburseVatAmt=$("#reimburseVat"),e.hsDiscAmt=$("#HsDiscAmount"),e.finalPaymentCb=$("input#cbFinalPayment"),e.overPay=$("#txtOverPayAmt"),e.guestCredit=$("#guestCredit"),e.selBalTo=$("#selexcpay")};function roundTo(e,t){void 0===t&&(t=0);var a=Math.pow(10,t);return e=parseFloat((e*a).toFixed(11)),Math.round(e)/a}function amtPaid(){"use strict";var t,e,a,i,r,n=new payCtrls,s=0,o=0,d=0,l=0,h="",c=0,p=0,u=0,v=0,g=0,m=0,f=0,y=0,b=0,C=0,k=0,x=isCheckedOut,A=parseFloat($("#spnCfBalDue").data("rmbal")),P=$(".hhk-TaxingItem");isNaN(A)?A=0:P.each(function(){var e=parseFloat($(this).data("taxrate"));y+=roundTo(A*e,2)}),n.msg.text("").hide(),0<n.visitFeeCb.length&&(o=parseFloat($("#spnvfeeAmt").data("amt")),isNaN(o)||o<0||!1===n.visitFeeCb.prop("checked")?(o=0,n.visitFeeAmt.val("")):n.visitFeeAmt.val(o.toFixed(2).toString())),!x&&0<n.keyDepCb.length&&(s=parseFloat($("#hdnKeyDepAmt").val()),isNaN(s)||s<0||!1===n.keyDepCb.prop("checked")?(s=0,n.keyDepAmt.val("")):(n.keyDepAmt.val(s.toFixed(2).toString()),$(".hhk-kdrow").show())),0<n.invoiceCb.length&&n.invoiceCb.each(function(){var e,t=parseInt($(this).data("invnum")),a=$("#"+t+"invPayAmt"),i=parseFloat($(this).data("invamt"));!0===$(this).prop("checked")?(a.prop("disabled",!1),""===a.val()&&a.val(i.toFixed(2).toString()),e=parseFloat(a.val().replace("$","").replace(",","")),isNaN(e)||0==e?(e=0,a.val("")):(Math.abs(e)>Math.abs(i)&&(e=i),a.val(e.toFixed(2).toString())),c+=e):""!==a.val()&&(a.val(""),a.prop("disabled",!0))}),0<n.depRefundAmt.length&&x&&(f=parseFloat(n.depRefundAmt.data("amt")),isNaN(f)||f<0||!1===n.depRefundCb.prop("checked")?(f=0,n.depRefundAmt.val("")):n.depRefundAmt.val((0-f).toFixed(2).toString())),0<n.heldCb.length&&(p=parseFloat(n.heldCb.data("amt")),(isNaN(p)||p<0||!1===n.heldCb.prop("checked"))&&(p=0)),0<n.reimburseVatCb.length&&(u=parseFloat(n.reimburseVatCb.data("amt")),(isNaN(u)||u<0||!1===n.reimburseVatCb.prop("checked"))&&(u=0)),t=p+f+u,P.each(function(){var e=parseFloat($(this).data("taxrate"));k+=roundTo(t/(1+e),2)}),y<k&&(k=y),e=t-k,0<n.feePayAmt.length&&(h=n.feePayAmt.val().replace("$","").replace(",",""),l=roundTo(parseFloat(h),2),"0.00"===h&&(h="0"),"0"!==h&&(h=""),(isNaN(l)||l<=0)&&(l=0),0<P.length&&(P.each(function(){var e=parseFloat($(this).data("taxrate")),t=roundTo(l*e,2);$(this).val(t.toFixed(2).toString()),b+=t}),y-k<b&&x&&(b=y-k),b<=0&&(b=0)),d=l+b),x?($(".hhk-minPayment").show("fade"),C=0,n.hsDiscAmt.val(""),a=roundTo(A+y,2),0<=A?(n.feesCharges.val(a.toFixed(2).toString()),$(".hhk-GuestCredit").hide(),$(".hhk-RoomCharge").show()):(n.guestCredit.val(a.toFixed(2).toString()),$(".hhk-RoomCharge").hide(),$(".hhk-GuestCredit").show(),0<c&&(a+c<=0?(a+=c,c=0):(c=a+c,a=0)),0<o&&(a+o<=0?(a+=o,o=0):(o=a+o,a=0))),(m=o+c+d)<=(v=o+c+a-t)&&0<v?(0<(i=roundTo(o+c+A-e-l,2))?(n.finalPaymentCb.prop("checked")?(r=roundTo(y-(b+k),2),n.hsDiscAmt.val(i.toFixed(2).toString()),n.feesCharges.val((a-r).toFixed(2).toString()),v-=r,m=d):n.hsDiscAmt.val(""),$(".hhk-Overpayment").hide(),$(".hhk-HouseDiscount").show("fade")):(n.finalPaymentCb.prop("checked",!1),n.hsDiscAmt.val(""),$(".hhk-HouseDiscount").hide(),$(".hhk-Overpayment").hide()),n.selBalTo.val(""),$("#txtRtnAmount").val(""),$("#divReturnPay").hide()):(n.finalPaymentCb.prop("checked",!1),n.hsDiscAmt.val(""),C=0<=v?m-v:o+d-v,"r"===n.selBalTo.val()?(0<=v?(C<l&&alert("Pay Room Fees amount is reduced to: $"+(l-C).toFixed(2).toString()),d=(l-=C)+b,C=0,n.selBalTo.val(""),$("#txtRtnAmount").val(""),$("#divReturnPay").hide()):(0<d&&alert("Pay Room Fees amount is reduced to: $0.00"),C-=d,b=l=0,P.each(function(){$(this).val("")}),d=0,$("#divReturnPay").show("fade"),$("#txtRtnAmount").val(C.toFixed(2).toString())),m=o+c+d):($("#txtRtnAmount").val(""),$("#divReturnPay").hide()),0<C.toFixed(2)?$(".hhk-Overpayment").show("fade"):$(".hhk-Overpayment").hide(),$(".hhk-HouseDiscount").hide())):(0<(v=o+s+c+d)&&0<p?v<p?(p=v,v=0):v-=p:v<0&&0<p?v-=p:0<n.heldCb.length&&n.heldAmtTb.val(""),0<v&&0<u?v<u?u=0:v-=u:v<0&&0<u?v-=u:0<n.reimburseVatCb.length&&(u=0),$(".hhk-Overpayment").hide(),$(".hhk-HouseDiscount").hide(),n.hsDiscAmt.val(""),C=0,m=v,g=o+s+c+d),0<m||m<0&&!x?($(".paySelectTbl").show("fade"),$(".hhk-minPayment").show("fade"),m<0&&!x&&$("#txtRtnAmount").val((0-m).toFixed(2).toString())):(m=0,$(".paySelectTbl").hide(),$("#divReturnPay").hide(),!1===x&&0===g?($(".hhk-minPayment").hide(),u=p=0):$(".hhk-minPayment").show("fade")),0===d?n.feePayAmt.val(h):n.feePayAmt.val(l.toFixed(2).toString()),0==C.toFixed(2)?n.overPay.val(""):n.overPay.val(C.toFixed(2).toString()),0<p.toFixed(2)?n.heldAmtTb.val((0-p).toFixed(2).toString()):n.heldAmtTb.val(""),0<u?n.reimburseVatAmt.val((0-u).toFixed(2).toString()):n.reimburseVatAmt.val(""),n.totalCharges.val(v.toFixed(2).toString()),n.totalPayment.val(m.toFixed(2).toString()),$("#spnPayAmount").text("$"+m.toFixed(2).toString()),n.cashTendered.change()}function setupPayments(o,e,t,a){"use strict";var i=$("#PayTypeSel"),r=$(".tblCredit"),n=$("#trvdCHName"),d=new payCtrls;0===r.length&&(r=$(".hhk-mcred")),0<i.length&&(i.change(function(){$(".hhk-cashTndrd").hide(),$(".hhk-cknum").hide(),$("#tblInvoice").hide(),$(".hhk-transfer").hide(),$(".hhk-tfnum").hide(),r.hide(),n.hide(),$("#tdCashMsg").hide(),$(".paySelectNotes").show(),"cc"===$(this).val()?(r.show("fade"),0==$("input[name=rbUseCard]:checked").val()&&n.show()):"ck"===$(this).val()?$(".hhk-cknum").show("fade"):"in"===$(this).val()?($("#tblInvoice").show("fade"),$(".paySelectNotes").hide()):"tf"===$(this).val()?$(".hhk-transfer").show("fade"):$(".hhk-cashTndrd").show("fade")}),i.change()),setupCOF(n);var s=$("#rtnTypeSel"),l=$(".tblCreditr");0===l.length&&(l=$(".hhk-mcredr")),0<s.length&&(s.change(function(){l.hide(),$(".hhk-transferr").hide(),$(".payReturnNotes").show(),$(".hhk-cknumr").hide(),"cc"===$(this).val()?l.show("fade"):"ck"===$(this).val()?$(".hhk-cknumr").show("fade"):"tf"===$(this).val()&&$(".hhk-transferr").show("fade")}),s.change()),0<d.selBalTo.length&&d.selBalTo.change(function(){amtPaid()}),0<d.finalPaymentCb.length&&d.finalPaymentCb.change(function(){amtPaid()}),0<d.keyDepCb.length&&d.keyDepCb.change(function(){amtPaid()}),0<d.depRefundCb.length&&d.depRefundCb.change(function(){amtPaid()}),0<d.heldCb.length&&d.heldCb.change(function(){amtPaid()}),0<d.reimburseVatCb.length&&d.reimburseVatCb.change(function(){amtPaid()}),0<d.invoiceCb.length&&(d.invoiceCb.change(function(){amtPaid()}),$(".hhk-payInvAmt").change(function(){amtPaid()})),0<d.visitFeeCb.length&&d.visitFeeCb.change(function(){amtPaid()}),0<d.feePayAmt.length&&d.feePayAmt.change(function(){$(this).removeClass("ui-state-error"),amtPaid()}),0<d.cashTendered.length&&d.cashTendered.change(function(){d.cashTendered.removeClass("ui-state-highlight"),$("#tdCashMsg").hide();var e=parseFloat(d.totalPayment.val().replace(",",""));(isNaN(e)||e<0)&&(e=0);var t=parseFloat(d.cashTendered.val().replace("$","").replace(",",""));(isNaN(t)||t<0)&&(t=0,d.cashTendered.val(""));var a=t-e;a<0&&(a=0,d.cashTendered.addClass("ui-state-highlight")),$("#txtCashChange").text("$"+a.toFixed(2).toString())}),0<d.adjustBtn.length&&(d.adjustBtn.button(),d.adjustBtn.click(function(){getApplyDiscDiag(e,a)})),$("#divPmtMkup").on("click",".invAction",function(e){e.preventDefault(),"del"==$(this).data("stat")&&!confirm("Delete this Invoice?")||invoiceAction($(this).data("iid"),$(this).data("stat"),e.target.id,"#keysfees",!0)}),createInvChooser(e,""),$("#daystoPay").change(function(){var e=parseInt($(this).val()),t=parseInt($(this).data("vid")),a=parseFloat($("#txtFixedRate").val()),i=parseInt($("#spnNumGuests").text()),r=d.feePayAmt,n=parseFloat($("#spnRcTax").data("tax")),s=parseFloat($("#txtadjAmount").val());$(this).val(""),isNaN(i)&&(i=1),isNaN(a)&&(a=0),isNaN(n)&&(n=0),isNaN(s)&&(s=0),isNaN(e)||0<e&&daysCalculator(e,o.val(),t,a,s,i,0,function(e){r.val(e.toFixed(2).toString()),r.change()})}),amtPaid()}function createInvChooser(a,i){0<$("#txtInvSearch"+i).length&&($("#txtInvSearch"+i).keypress(function(e){var t=$(this).val();"13"==e.keyCode&&(""!=t&&isNumber(parseInt(t,10))?$.getJSON("../house/roleSearch.php",{cmd:"filter",basis:"ba",letters:t},function(e){try{e=e[0]}catch(e){return void alert("Parser error - "+e.message)}e&&e.error&&(e.gotopage&&(response(),window.open(e.gotopage)),e.value=e.error),getInvoicee(e,a,i)}):(alert("Don't press the return key unless you enter an Id."),e.preventDefault()))}),createAutoComplete($("#txtInvSearch"+i),3,{cmd:"filter",basis:"ba"},function(e){getInvoicee(e,a,i)},!1))}function daysCalculator(e,t,a,i,r,n,s,o){var d;0<e&&(d={cmd:"rtcalc",vid:a,rid:s,nites:e,rcat:t,fxd:i,adj:r,gsts:n},$.post("ws_ckin.php",d,function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}if(e.error)return e.gotopage&&window.open(e.gotopage),void flagAlertMessage(e.error,"error");var t;e.amt&&(t=parseFloat(e.amt),(isNaN(t)||t<0)&&(t=0),o(t))}else alert("Bad Reply from Server")}))}function verifyBalDisp(){return""==$("#selexcpay").val()&&""!=$("#txtOverPayAmt").val()?($("#payChooserMsg").text('Set "Apply To" to the desired overpayment disposition. ').show(),$("#selexcpay").addClass("ui-state-highlight"),$("#pWarnings").text('Set "Apply To" to the desired overpayment disposition.').show(),!1):($("#payChooserMsg").text("").hide(),$("#selexcpay").removeClass("ui-state-highlight"),!0)}function verifyAmtTendrd(){"use strict";if(0===$("#PayTypeSel").length)return!0;var e=parseFloat($("#totalPayment").val().replace("$","").replace(",",""));if($("#tdCashMsg").hide("fade"),$("#tdInvceeMsg").text("").hide(),$("#tdChargeMsg").text("").hide(),"ca"===$("#PayTypeSel").val()){var t=parseFloat($("#txtCashTendered").val().replace("$","").replace(",","")),a=$("#remtotalPayment");if(0<a.length&&(e=parseFloat(a.val().replace("$","").replace(",",""))),(isNaN(e)||e<0)&&(e=0),(isNaN(t)||t<0)&&(t=0),0<e&&t<=0)return $("#tdCashMsg").text('Enter the amount paid into "Amount Tendered" ').show(),$("#pWarnings").text('Enter the amount paid into "Amount Tendered"').show(),!1;if(0<e&&t<e)return $("#tdCashMsg").text("Amount tendered is not enough ").show("fade"),$("#pWarnings").text("Amount tendered is not enough").show(),!1}else if("in"===$("#PayTypeSel").val()){var i=parseInt($("#txtInvId").val(),10);if((isNaN(i)||i<1)&&0!=e)return $("#tdInvceeMsg").text("The Invoicee is missing. ").show("fade"),!1}else if("cc"===$("#PayTypeSel").val()&&0<$("#selccgw").length&&""===$("#selccgw").val())return $("#tdChargeMsg").text("Select a location.").show("fade"),!1;return!0}function showReceipt(e,t,a,i){var r=$(e),n=$("<div id='print_button' style='margin-left:1em;'>Print</div>"),s={mode:"popup",popClose:!1,popHt:500,popWd:400,popX:200,popY:200,popTitle:a};void 0!==i&&i||(i=550),r.children().remove(),r.append($(t).addClass("ReceiptArea").css("max-width",i+"px")),n.button(),n.click(function(){$(".ReceiptArea").printArea(s),r.dialog("close")}),r.prepend(n),r.dialog("option","title",a),r.dialog("option","buttons",{}),r.dialog("option","width",i),r.dialog("open"),s.popHt=$("#pmtRcpt").height(),s.popWd=$("#pmtRcpt").width()}function reprintReceipt(e,t){$.post("ws_ckin.php",{cmd:"getPrx",pid:e},function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}e.error&&(e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,"error")),showReceipt(t,e.receipt,"Receipt Copy")}})}function paymentRedirect(e,t){"use strict";if(e)if(e.hostedError)flagAlertMessage(e.hostedError,"error");else if(e.cvtx)window.location.assign(e.cvtx);else if(e.xfer&&0<t.length){if(t.children("input").remove(),t.prop("action",e.xfer),e.paymentId&&""!=e.paymentId)t.append($('<input type="hidden" name="PaymentID" value="'+e.paymentId+'"/>'));else{if(!e.cardId||""==e.cardId)return void flagAlertMessage("PaymentId and CardId are missing!","error");t.append($('<input type="hidden" name="CardID" value="'+e.cardId+'"/>'))}t.submit()}else e.inctx&&($("#contentDiv").empty().append($("<p>Processing Credit Payment...</p>")),InstaMed.launch(e.inctx),$("#instamed").css("visibility","visible").css("margin-top","50px;"))}function setupCOF(e,t){null==t&&(t=""),0<e.length&&($("input[name=rbUseCard"+t+"]").on("change",function(){0==$(this).val()||!0===$(this).prop("checked")&&"checkbox"===$(this).prop("type")?e.show():(e.hide(),$("#btnvrKeyNumber"+t).prop("checked",!1).change(),$("#txtvdNewCardName"+t).val("")),$("#tdChargeMsg"+t).text("").hide(),$("#selccgw"+t).removeClass("ui-state-highlight")}),(0<$("input[name=rbUseCard"+t+"]:checked").val()||!1===$("input[name=rbUseCard"+t+"]").prop("checked")&&"checkbox"===$("input[name=rbUseCard"+t+"]").prop("type"))&&e.hide(),0<$("#btnvrKeyNumber"+t).length&&($("#btnvrKeyNumber"+t).change(function(){this.checked&&0==$("input[name=rbUseCard"+t+"]:checked").val()?$("#txtvdNewCardName"+t).show():($("#txtvdNewCardName"+t).hide(),$("#txtvdNewCardName"+t).val(""))}),$("#btnvrKeyNumber"+t).change()))}function cardOnFile(e,t,a,i){if($("#tdChargeMsg"+i).text("").hide(),0<$("#selccgw"+i).length&&(0==$("input[name=rbUseCard"+i+"]:checked").val()||!0===$("input[name=rbUseCard"+i+"]").prop("checked"))&&($("#selccgw"+i).removeClass("ui-state-highlight"),0===$("#selccgw"+i+" option:selected").length))return $("#tdChargeMsg"+i).text("Select a location.").show("fade"),$("#selccgw"+i).addClass("ui-state-highlight"),!1;var r={cmd:"cof",idGuest:e,idGrp:t,pbp:a,index:i};$("#tblupCredit"+i).find("input").each(function(){"checkbox"===$(this).attr("type")?!1!==this.checked&&(r[$(this).attr("id")]="on"):"radio"===$(this).attr("type")&&!1===this.checked||(r[$(this).attr("id")]=this.value)}),0<$("#selccgw"+i).length&&(r["selccgw"+i]=$("#selccgw"+i).val()),0<$("#selChargeType"+i).length&&(r["selChargeType"+i]=$("#selChargeType"+i).val()),$.post("ws_ckin.php",r,function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}if(e.error)return e.gotopage&&window.location.assign(e.gotopage),void flagAlertMessage(e.error,"error");e.hostedError&&flagAlertMessage(e.hostedError,"error"),paymentRedirect(e,$("#xform")),(e.success&&""!=e.success||e.COFmsg&&""!=e.COFmsg)&&flagAlertMessage((void 0===e.success?"":e.success)+(void 0===e.COFmsg?"":e.COFmsg),"success"),e.COFmkup&&""!==e.COFmkup&&($("#tblupCredit"+i).remove(),$("#upCreditfs").prepend($(e.COFmkup)),setupCOF($("#trvdCHName"+i),i))}})}function paymentsTable(e,t,a){$("#"+e).dataTable({columnDefs:[{targets:8,type:"date",render:function(e,t,a){return dateRender(e,t)}}],dom:'<"top"if>rt<"bottom"lp><"clear">',displayLength:50,order:[[8,"asc"]],lengthMenu:[[25,50,-1],[25,50,"All"]]}),$("#btnPayHistRef").button().click(function(){a()}),$("#"+t).on("click",".invAction",function(e){invoiceAction($(this).data("iid"),"view",e.target.id)}),$("#"+t).on("click",".hhk-voidPmt",function(){var e=$(this),t=parseFloat(e.data("amt"));"Saving..."!==e.val()&&confirm("Void/Reverse this payment for $"+t.toFixed(2).toString()+"?")&&(e.val("Saving..."),sendVoidReturn(e.attr("id"),"rv",e.data("pid"),null,a))}),$("#"+t).on("click",".hhk-voidRefundPmt",function(){var e=$(this);"Saving..."!==e.val()&&confirm("Void this Return?")&&(e.val("Saving..."),sendVoidReturn(e.attr("id"),"vr",e.data("pid"),null,a))}),$("#"+t).on("click",".hhk-returnPmt",function(){var e=$(this),t=parseFloat(e.data("amt"));"Saving..."!==e.val()&&confirm("Return this payment for $"+t.toFixed(2).toString()+"?")&&(e.val("Saving..."),sendVoidReturn(e.attr("id"),"r",e.data("pid"),t,a))}),$("#"+t).on("click",".hhk-undoReturnPmt",function(){var e=$(this),t=parseFloat(e.data("amt"));"Saving..."!==e.val()&&confirm("Undo this Return/Refund for $"+t.toFixed(2).toString()+"?")&&(e.val("Saving..."),sendVoidReturn(e.attr("id"),"ur",e.data("pid"),null,a))}),$("#"+t).on("click",".hhk-deleteWaive",function(){var e=$(this);"Deleting..."!==e.val()&&confirm("Delete this House payment?")&&(e.val("Deleting..."),sendVoidReturn(e.attr("id"),"d",e.data("ilid"),e.data("iid"),null,a))}),$("#"+t).on("click",".pmtRecpt",function(){reprintReceipt($(this).data("pid"),"#pmtRcpt")}),$("#"+t).mousedown(function(e){var t=$(e.target);"pudiv"!==t[0].id&&0===t.parents("#pudiv").length&&$("div#pudiv").remove()})}
