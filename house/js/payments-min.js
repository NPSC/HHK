function getApplyDiscDiag(e,t){"use strict";return e&&""!=e?void $.post("ws_ckin.php",{cmd:"getHPay",ord:e},function(e){if(e){try{e=$.parseJSON(e)}catch(a){return void alert("Parser error - "+a.message)}if(e.error)e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,!0);else if(e.markup){t.children().remove();var i={Save:function(){var e=parseFloat($("#housePayment").val().replace("$","").replace(",","")),t=$("#housePayment").data("vid"),a="";isNaN(e)&&(e=0),a=$("#cbAdjustPmt1").prop("checked")?$("#cbAdjustPmt1").data("item"):$("#cbAdjustPmt2").data("item"),saveDiscountPayment(t,a,e,$("#selHouseDisc").val(),$("#selAddnlChg").val()),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}};t.append($('<div class="hhk-panel hhk-tdbox hhk-visitdialog" style="font-size:0.8em;"/>').append($(e.markup))),$("#cbAdjustType").buttonset(),$("#cbAdjustPmt1, #cbAdjustPmt2").change(function(){var e=$(this).data("hid"),t=$(this).data("sho");$("#"+e).val(""),$("#"+t).val(""),$("#housePayment").val(""),$(this).prop("checked")?($("#"+t).show(),$("#"+e).hide()):($("#"+e).hide(),$("#"+t).show())}),gblAdjustData.disc=e.disc,gblAdjustData.addnl=e.addnl,$("#selAddnlChg, #selHouseDisc").change(function(){var e=gblAdjustData[$(this).data("amts")];$("#housePayment").val(e[$(this).val()])}),$("#cbAdjustPmt1").length>0?($("#cbAdjustPmt1").prop("checked",!0),$("#cbAdjustPmt1").change()):($("#cbAdjustPmt2").prop("checked",!0),$("#cbAdjustPmt2").change()),t.dialog("option","buttons",i),t.dialog("option","title","Adjust Fees"),t.dialog("option","width",400),t.dialog("open")}}}):void flagAlertMessage("Order Number is missing",!0)}function saveDiscountPayment(e,t,a,i,s){"use strict";$.post("ws_ckin.php",{cmd:"saveHPay",ord:e,item:t,amt:a,dsc:i,chg:s},function(e){if(e){try{e=$.parseJSON(e)}catch(t){return void alert("Parser error - "+t.message)}if(e.error&&(e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,!0)),e.msg&&""!=e.msg&&updateVisitMessage("Adjust Payment",e.msg),void 0!==e.CurrFees&&""!=e.CurrFees&&$("#divCurrFees").children().remove().end().append(e.CurrFees),e.pay&&""!=e.pay){$("#payTodayTbl").prepend($(e.pay));var a=e.invNum;$("#"+a+"unpaidCb").length>0&&$("#"+a+"unpaidCb").change(function(){amtPaid()}),$("#"+a+"invPayAmt").length>0&&$("#"+a+"invPayAmt").change(function(){amtPaid()})}}})}function invoiceAction(e,t,a,i,s){"use strict";$.post("ws_resc.php",{cmd:"invAct",iid:e,x:a,action:t,sbt:s},function(e){if(e){try{e=$.parseJSON(e)}catch(t){return void alert("Parser error - "+t.message)}if(e.error)return e.gotopage&&window.location.assign(e.gotopage),void flagAlertMessage(e.error,!0);if(e["delete"]&&("0"==e.eid?(flagAlertMessage(e["delete"],!1),$("#btnInvGo").click()):$("#"+e.eid).parents("tr").first().hide("fade")),e.markup){var a=$(e.markup);void 0!=i&&""!=i?$(i).append(a):$("body").append(a),a.position({my:"left top",at:"left bottom",of:"#"+e.eid})}}})}function amtPaid(){"use strict";var e=new payCtrls,t=0,a=0,i=0,s=0,n=0,o=0,r=0,d=0,l=0,h=0,p=0,c=0,g=isCheckedOut;if(e.msg.text("").hide(),e.visitFeeCb.length>0&&(a=parseFloat($("#spnvfeeAmt").data("amt")),isNaN(a)||0>a||e.visitFeeCb.prop("checked")===!1?(a=0,e.visitFeeAmt.val("")):e.visitFeeAmt.val(a.toFixed(2).toString())),!g&&e.keyDepCb.length>0&&(t=parseFloat($("#spnDepAmt").data("amt")),isNaN(t)||0>t||e.keyDepCb.prop("checked")===!1?(t=0,e.keyDepAmt.val("")):e.keyDepAmt.val(t.toFixed(2).toString())),e.invoiceCb.length>0&&e.invoiceCb.each(function(){var e=parseInt($(this).data("invnum")),t=$("#"+e+"invPayAmt");if($(this).prop("checked")===!0){var a=parseFloat($(this).data("invamt"));t.prop("disabled",!1),""===t.val()&&t.val(a.toFixed(2).toString());var i=parseFloat(t.val().replace("$","").replace(",",""));isNaN(i)||0==i?(i=0,t.val("")):Math.abs(i)>Math.abs(a)&&(i=a,t.val(i.toFixed(2).toString())),n+=i}else""!==t.val()&&(t.val(""),t.prop("disabled",!0))}),e.feePayAmt.length>0){var i=parseFloat(e.feePayAmt.val().replace("$","").replace(",",""));(isNaN(i)||0>i)&&(e.feePayAmt.val(""),i=0)}if(e.feesCharges.length>0&&(s=parseFloat(e.feesCharges.val()),isNaN(s)&&(s=0)),e.guestCredit.length>0&&(h=parseFloat(e.guestCredit.val()),isNaN(h)&&(h=0)),e.depRefundAmt.length>0&&(l=parseFloat(e.depRefundAmt.val()),isNaN(l)&&(l=0)),e.heldCb.length>0&&(o=parseFloat(e.heldCb.data("amt")),(isNaN(o)||0>=o||e.heldCb.prop("checked")===!1)&&(o=0)),r=a+t+s+h+n+l,d=i+a+t+n,g){$(".hhk-minPayment").show("fade"),c=r-d,c>0&&o>=c?(o=c,e.heldAmtTb.val((0-o).toFixed(2).toString())):o>0?e.heldAmtTb.val((0-o).toFixed(2).toString()):e.heldAmtTb.val(""),r-=o;var m=s-i-o+l;m>0?($(".hhk-HouseDiscount").show("fade"),e.finalPaymentCb.prop("checked")?e.hsDiscAmt.val((0-m).toFixed(2).toString()):e.hsDiscAmt.val("")):($(".hhk-HouseDiscount").hide("fade"),e.hsDiscAmt.val("")),p=d-r,p>0?(d>=p&&"r"==e.selBalTo.val()?(i-=p,e.feePayAmt.val(i.toFixed(2).toString()),p=0,e.selBalTo.val(""),$(".hhk-Overpayment").hide()):"r"==e.selBalTo.val()?(p-=i,e.feePayAmt.val(""),i=0,$(".hhk-Overpayment").show("fade")):$(".hhk-Overpayment").show("fade"),d=i+a+t+n):($(".hhk-Overpayment").hide(),p=0)}else $(".hhk-Overpayment").hide(),p=0,$(".hhk-HouseDiscount").hide(),e.hsDiscAmt.val(0),d>0&&o>0&&e.heldCb.prop("checked")===!0?(o>=d?(o=d,d=0):d-=o,e.heldAmtTb.val((0-o).toFixed(2).toString())):e.heldAmtTb.val("");d>0?($(".paySelectTbl").show("fade"),$(".hhk-minPayment").show("fade")):($(".paySelectTbl").hide("fade"),g===!1&&$(".hhk-minPayment").hide("fade")),0===p?e.overPay.val(""):e.overPay.val(p.toFixed(2).toString()),e.totalCharges.val(r.toFixed(2).toString()),e.totalPayment.val(d.toFixed(2).toString()),e.cashTendered.change()}function setupPayments(e,t,a,i,s){"use strict";var n=$("#PayTypeSel"),o=$(".tblCredit");0===o.length&&(o=$(".hhk-mcred")),n.length>0&&(n.change(function(){$(".hhk-cashTndrd").hide(),$(".hhk-cknum").hide(),$("#tblInvoice").hide(),$(".hhk-transfer").hide(),$(".hhk-tfnum").hide(),o.hide(),$("#tdCashMsg").hide(),"cc"===$(this).val()?o.show("fade"):"ck"===$(this).val()?$(".hhk-cknum").show("fade"):"in"===$(this).val()?$("#tblInvoice").show("fade"):"tf"===$(this).val()?$(".hhk-transfer").show("fade"):$(".hhk-cashTndrd").show("fade")}),n.change());var r=new payCtrls;r.selBalTo.length>0&&r.selBalTo.change(function(){amtPaid()}),r.finalPaymentCb.length>0&&(r.finalPaymentCb.change(function(){amtPaid()}),r.finalPaymentCb.change()),r.keyDepCb.length>0&&r.keyDepCb.change(function(){amtPaid()}),r.heldCb.length>0&&r.heldCb.change(function(){amtPaid()}),r.invoiceCb.length>0&&(r.invoiceCb.change(function(){amtPaid()}),$(".hhk-payInvAmt").change(function(){amtPaid()})),r.visitFeeCb.length>0&&r.visitFeeCb.change(function(){amtPaid()}),r.feePayAmt.length>0&&r.feePayAmt.change(function(){$(this).removeClass("ui-state-error"),amtPaid()}),r.cashTendered.length>0&&r.cashTendered.change(function(){r.cashTendered.removeClass("ui-state-highlight"),$("#tdCashMsg").hide();var e=parseFloat(r.totalPayment.val().replace(",",""));(isNaN(e)||0>e)&&(e=0);var t=parseFloat(r.cashTendered.val().replace("$","").replace(",",""));(isNaN(t)||0>t)&&(t=0,r.cashTendered.val(""));var a=t-e;0>a&&(a=0,r.cashTendered.addClass("ui-state-highlight")),$("#txtCashChange").text("$"+a.toFixed(2).toString())}),t&&t.length>0&&(t.change(function(){$(this).removeClass("ui-state-error");var t=$(this).val();if(""==t&&(t=0),r.keyDepAmt.length>0&&e[t]&&(0===e[t].key?($("#spnDepAmt").data("amt",""),$("#spnDepAmt").text(""),r.keyDepAmt.val(""),r.keyDepCb.prop("checked",!1),$(".hhk-kdrow").hide("fade")):($("#spnDepAmt").data("amt",e[t].key),$("#spnDepAmt").text("($"+e[t].key+")"),r.keyDepAmt.val(e[t].key),$(".hhk-kdrow").show("fade")),amtPaid()),t>0&&e[t]&&$("#myRescId").length>0){$("#rmChgMsg").text("").hide("fade"),$("#rmDepMessage").text("").hide("fade");var i=$("#myRescId").data("idresc"),s=$("#myRescId").data("pmdl");if(e[i].rate!==e[t].rate&&"b"===s&&$("#rmChgMsg").text("The room rate is different.").show("fade"),e[i].key!==e[t].key){var n="";$("#spnDepMsg").hide("fade"),$("#selDepDisposition").show("fade"),0==e[t].key?"0"!=$("#kdPaid").data("amt")&&(n="There is no deposit for this room.  Set the Deposit Status (above) accordingly."):n="The deposit for this room is $"+e[t].key.toFixed(2).toString(),$("#rmDepMessage").text(n).show("fade")}else $("#selDepDisposition").hide("fade"),$("#spnDepMsg").show("fade")}a.change()}),t.change(),$("#resvChangeDate").change(function(){$("#rbReplaceRoomnew").prop("checked",!0)})),r.adjustBtn.length>0&&(r.adjustBtn.button(),r.adjustBtn.click(function(){getApplyDiscDiag(i,s)})),$("#divPmtMkup").on("click",".invAction",function(e){e.preventDefault(),("del"!=$(this).data("stat")||confirm("Delete this Invoice?"))&&invoiceAction($(this).data("iid"),$(this).data("stat"),e.target.id,"#keysfees",!0)}),$("#calcpment").click(function(){var e=parseInt($("#daystoPay").val()),t=parseInt($(this).data("vid")),i=parseFloat($("#txtFixedRate").val());isNaN(i)&&(i=0);var s=parseFloat($("#txtadjAmount").val());if(isNaN(s)&&(s=0),isNaN(e))return void $("#daystoPay").val("");if(("x"!==a.val()||0!==i)&&e>0){var n={cmd:"rtcalc",vid:t,nites:e,rcat:a.val(),fxd:i,adj:s};$.post("ws_ckin.php",n,function(e){if(!e)return void alert("Bad Reply from Server");try{e=$.parseJSON(e)}catch(t){return void alert("Parser error - "+t.message)}return e.error?(e.gotopage&&window.open(e.gotopage),void flagAlertMessage(e.error,!0)):void(e.amt&&(r.feePayAmt.val(e.amt),r.feePayAmt.change(),$("#daystoPay").val("")))})}}),amtPaid()}function verifyBalDisp(){return""==$("#selexcpay").val()&&""!=$("#txtOverPayAmt").val()?($("#payChooserMsg").text('Set "Apply To" to the desired overpayment disposition. ').show("fade"),$("#selexcpay").addClass("ui-state-highlight"),!1):($("#payChooserMsg").text("").hide(),$("#selexcpay").removeClass("ui-state-highlight"),!0)}function verifyAmtTendrd(){"use strict";if($("#tdCashMsg").hide("fade"),"ca"==$("#PayTypeSel").val()){var e=parseFloat($("#totalPayment").val().replace("$","").replace(",","")),t=parseFloat($("#txtCashTendered").val().replace("$","").replace(",","")),a=$("#remtotalPayment");if(a.length>0&&(e=parseFloat(a.val().replace("$","").replace(",",""))),(isNaN(e)||0>e)&&(e=0),(isNaN(t)||0>t)&&(t=0),e>0&&0>=t)return $("#tdCashMsg").text('Enter the amount paid into "Amount Tendered" ').show("fade"),!1;if(e>0&&e>t)return $("#tdCashMsg").text("Amount tendered is not enough ").show("fade"),!1}return!0}function showReceipt(e,t,a,i){var s=$(e),n=$("<div id='print_button' style='margin-left:1em;'>Print</div>"),o={mode:"popup",popClose:!1,popHt:500,popWd:400,popX:200,popY:200,popTitle:a};void 0!==i&&i||(i=550),s.children().remove(),s.append($(t).addClass("PrintArea").css("max-width",i+"px")),n.button(),n.click(function(){$(".PrintArea").printArea(o),s.dialog("close")}),s.prepend(n),s.dialog("option","title",a),s.dialog("option","buttons",{}),s.dialog("option","width",i),s.dialog("open"),o.popHt=$("#pmtRcpt").height(),o.popWd=$("#pmtRcpt").width()}function reprintReceipt(e,t){$.post("ws_ckin.php",{cmd:"getPrx",pid:e},function(e){if(e){try{e=$.parseJSON(e)}catch(a){return void alert("Parser error - "+a.message)}e.error&&(e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,!0)),showReceipt(t,e.receipt,"Receipt Copy")}})}function cardOnFile(e,t){var a={cmd:"cof",idGuest:e,idGrp:t,pbp:"register.php"};$("#tblupCredit").find("input").each(function(){this.checked&&(a[$(this).attr("id")]=$(this).val())}),$.post("ws_ckin.php",a,function(e){if(e){try{e=$.parseJSON(e)}catch(t){return void alert("Parser error - "+t.message)}if(e.error)return e.gotopage&&window.location.assign(e.gotopage),void flagAlertMessage(e.error,!0);if(e.hostedError&&flagAlertMessage(e.hostedError,!0),e.xfer){var a=$("#xform");if(a.children("input").remove(),a.prop("action",e.xfer),e.paymentId&&""!=e.paymentId)a.append($('<input type="hidden" name="PaymentID" value="'+e.paymentId+'"/>'));else{if(!e.cardId||""==e.cardId)return void flagAlertMessage("PaymentId and CardId are missing!",!0);a.append($('<input type="hidden" name="CardID" value="'+e.cardId+'"/>'))}a.submit()}e.success&&""!=e.success&&flagAlertMessage(e.success,!1)}})}function updateCredit(e,t,a,i){var s={Continue:function(){cardOnFile(e,t),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}},n="";a&&""!=a&&(n=" - "+a),$.post("ws_ckin.php",{cmd:"viewCredit",idGuest:e,reg:t},function(e){if(e){try{e=$.parseJSON(e)}catch(t){return void alert("Parser error - "+t.message)}if(e.error)e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,!0);else if(e.success){var a=$("#"+i);a.children().remove(),a.append($('<div class="hhk-panel hhk-tdbox hhk-visitdialog"/>').append($(e.success))),a.dialog("option","buttons",s),a.dialog("option","width",400),a.dialog("option","title","Card On File"+n),a.dialog("open")}}})}var gblAdjustData=[],payCtrls=function(){var e=this;e.keyDepAmt=$("#keyDepAmt"),e.keyDepCb=$("#keyDepRx"),e.visitFeeAmt=$("#visitFeeAmt"),e.visitFeeCb=$("#visitFeeCb"),e.feePayAmt=$("input#feesPayment"),e.feesCharges=$("#feesCharges"),e.totalPayment=$("#totalPayment"),e.totalCharges=$("#totalCharges"),e.cashTendered=$("#txtCashTendered"),e.invoiceCb=$(".hhk-payInvCb"),e.adjustBtn=$("#paymentAdjust"),e.msg=$("#payChooserMsg"),e.heldAmtTb=$("#heldAmount"),e.heldCb=$("#cbHeld"),e.hsDiscAmt=$("#HsDiscAmount"),e.depRefundAmt=$("#DepRefundAmount"),e.finalPaymentCb=$("input#cbFinalPayment"),e.overPay=$("#txtOverPayAmt"),e.guestCredit=$("#guestCredit"),e.selBalTo=$("#selexcpay")};
