function isNumber(e){"use strict";return!isNaN(parseFloat(e))&&isFinite(e)}function relationReturn(e){if((e=$.parseJSON(e)).error)e.gotopage&&window.open(e.gotopage,"_self"),flagAlertMessage(e.error,!0);else if(e.success){if(e.rc&&e.markup){var t=$("#acm"+e.rc);t.children().remove();var i=$(e.markup);t.append(i.children())}flagAlertMessage(e.success,!1)}}function manageRelation(e,t,i,a){$.post("ws_admin.php",{id:e,rId:t,rc:i,cmd:a},relationReturn)}var dtCols=[{targets:[0],title:"Date",data:"Date",render:function(e,t){return dateRender(e,t,dateFormat)}},{targets:[1],title:"Type",searchable:!1,sortable:!1,data:"Type"},{targets:[2],title:"Sub-Type",searchable:!1,sortable:!1,data:"Sub-Type"},{targets:[3],title:"User",searchable:!1,sortable:!0,data:"User"},{targets:[4],visible:!1,data:"Id"},{targets:[5],title:"Log Text",sortable:!1,data:"Log Text"}];$(document).ready(function(){"use strict";var e,t=memberData,i=!1,a=1,n="../admin/ws_gen.php?cmd=chglog&uid="+t.id;if($.widget("ui.autocomplete",$.ui.autocomplete,{_resizeMenu:function(){var e=this.menu.element;e.outerWidth(1.1*Math.max(e.width("").outerWidth()+1,this.element.outerWidth()))}}),$(window).bind("beforeunload",function(){if(!0!==i){var e=!1;if($("#form1").find("input[type='text'],textarea").not(".ignrSave").each(function(){if(this.value!=this.defaultValue&&0===$(this).parents("div.ignrSave").length){this.value;return e=!0,!1}}),$("#form1").find("input[type='radio'],input[type='checkbox']").not(".ignrSave").each(function(){if($(this).prop("checked")!==$(this).prop("defaultChecked")&&0===$(this).parents("div.ignrSave").length){$(this).prop("checked");return e=!0,!1}}),$("#form1").find("select").not(".ignrSave").each(function(){if(0===$(this).parents("div.ignrSave").length)if($(this).data("bfhstates")){if($(this).data("state")!==$(this).val())return e=!0,!1}else if($(this).data("bfhcountries")){if($(this).data("country")!==$(this).val())return e=!0,!1}else $(this).children("option").each(function(){if(void 0!==this.defaultSelected&&void 0!==this.selected&&this.defaultSelected!==this.selected){this.selected;e=!0}})}),!0===e)return!1}}),$("#divFuncTabs").tabs({collapsible:!0}),$("#submit").dialog({autoOpen:!1,resizable:!1,width:300,modal:!0,buttons:{Exit:function(){$(this).dialog("close")}}}),$("#keysfees").dialog({autoOpen:!1,resizable:!0,modal:!0,close:function(e,t){$("div#submitButtons").show()},open:function(e,t){$("div#submitButtons").hide()}}),$("#pmtRcpt").dialog({autoOpen:!1,resizable:!0,modal:!0,title:"Payment Receipt"}),$("#faDialog").dialog({autoOpen:!1,resizable:!0,width:650,modal:!0,title:"Income Chooser"}),""!==rctMkup&&showReceipt("#pmtRcpt",rctMkup),$(".hhk-view-visit").click(function(){var e=$(this).data("vid"),i=$(this).data("gid"),a=$(this).data("span"),n={"Show Statement":function(){window.open("ShowStatement.php?vid="+e,"_blank")},"Show Registration Form":function(){window.open("ShowRegForm.php?vid="+e,"_blank")},Save:function(){saveFees(i,e,a,!1,"GuestEdit.php?id="+i+"&psg="+t.idPsg)},Cancel:function(){$(this).dialog("close")}};viewVisit(i,e,n,"Edit Visit #"+e+"-"+a,"",a),$("#divAlert1").hide()}),$("#resvAccordion").accordion({heightStyle:"content",collapsible:!0,active:!1,icons:!1}),$("div.hhk-relations").each(function(){var e=$(this).attr("name");$(this).on("click","td.hhk-deletelink",function(){t.id>0&&confirm($(this).attr("title")+"?")&&manageRelation(t.id,$(this).attr("name"),e,"delRel")}),$(this).on("click","td.hhk-newlink",function(){if(t.id>0){var i=$(this).attr("title");$("#hdnRelCode").val(e),$("#submit").dialog("option","title",i),$("#submit").dialog("open")}})}),$("#cbNoVehicle").change(function(){this.checked?$("#tblVehicle").hide():$("#tblVehicle").show()}),$("#cbNoVehicle").change(),$("#btnNextVeh, #exAll, #exNone").button(),$("#btnNextVeh").click(function(){$("#trVeh"+a).show("fade"),++a>4&&$("#btnNextVeh").hide("fade")}),$("#divNametabs").tabs({beforeActivate:function(e,i){var a=$("#vvisitLog").find("table");"visitLog"===i.newTab.prop("id")&&0===a.length&&$.post("ws_ckin.php",{cmd:"gtvlog",idReg:t.idReg},function(e){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}e.error?(e.gotopage&&window.open(e.gotopage,"_self"),flagAlertMessage(e.error,!0)):e.vlog&&$("#vvisitLog").append($(e.vlog))}})},collapsible:!0}),$("#btnSubmit, #btnReset, #btnCred").button(),$("#btnCred").click(function(){cardOnFile($(this).data("id"),$(this).data("idreg"),"GuestEdit.php?id="+id+"&psg="+t.idPsg)}),$("#phEmlTabs").tabs(),$("#emergTabs").tabs(),$("#addrsTabs").tabs(),$("#psgList").tabs({collapsible:!0,beforeActivate:function(i,a){a.newPanel.length>0&&("fin"===a.newTab.prop("id")&&(getIncomeDiag(0,t.idReg),i.preventDefault()),"chglog"!==a.newTab.prop("id")||e||(e=$("#dataTbl").dataTable({columnDefs:dtCols,serverSide:!0,processing:!0,deferRender:!0,language:{search:"Search Log Text:"},sorting:[[0,"desc"]],displayLength:25,lengthMenu:[[25,50,100,-1],[25,50,100,"All"]],Dom:'<"top"ilf>rt<"bottom"ip>',ajax:{url:n}})))}}),t.psgOnly&&$("#psgList").tabs("disable"),$("#psgList").tabs("enable",psgTabIndex),$("#psgList").tabs("option","active",psgTabIndex),$("#cbnoReturn").change(function(){this.checked?$("#selnoReturn").show():$("#selnoReturn").hide()}),$("#cbnoReturn").change(),0===t.id)$("#divFuncTabs").tabs("option","disabled",[2,3,4]),$("#phEmlTabs").tabs("option","active",1),$("#phEmlTabs").tabs("option","disabled",[0]);else{var o=parseInt($("#addrsTabs").children("ul").data("actidx"),10);isNaN(o)&&(o=0),$("#addrsTabs").tabs("option","active",o)}$.datepicker.setDefaults({yearRange:"-0:+02",changeMonth:!0,changeYear:!0,autoSize:!0,numberOfMonths:1,dateFormat:"M d, yy"}),$(".ckdate").datepicker({yearRange:"-02:+03"}),$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,maxDate:0,dateFormat:"M d, yy"}),$("#cbLastConfirmed").change(function(){$(this).prop("checked")?$("#txtLastConfirmed").datepicker("setDate","+0"):$("#txtLastConfirmed").val($("#txtLastConfirmed").prop("defaultValue"))}),$("#txtLastConfirmed").change(function(){$("#txtLastConfirmed").val()==$("#txtLastConfirmed").prop("defaultValue")?$("#cbLastConfirmed").prop("checked",!1):$("#cbLastConfirmed").prop("checked",!0)}),verifyAddrs("div#nameTab, div#hospitalSection"),addrPrefs(t);createZipAutoComplete($("input.hhk-zipsearch"),"ws_admin.php",void 0),$("#btnSubmit").click(function(){if("Saving>>>>"===$(this).val())return!1;i=!0,$(this).val("Saving>>>>")}),$("#txtsearch").keypress(function(e){var t=$(this).val();"13"==e.keyCode&&(""!=t&&isNumber(parseInt(t,10))?(t>0&&window.location.assign("GuestEdit.php?id="+t),e.preventDefault()):(alert("Don't press the return key unless you enter an Id."),e.preventDefault()))}),$("#cbdeceased").change(function(){$(this).prop("checked")?$("#disp_deceased").show():$("#disp_deceased").hide()}),$("select.hhk-multisel").each(function(){$(this).multiselect({selectedList:3})}),createAutoComplete($("#txtAgentSch"),3,{cmd:"filter",add:"phone",basis:"ra"},getAgent),""===$("#a_txtLastName").val()&&$(".hhk-agentInfo").hide(),createAutoComplete($("#txtDocSch"),3,{cmd:"filter",basis:"doc"},getDoc),""===$("#d_txtLastName").val()&&$(".hhk-docInfo").hide(),createAutoComplete($("#txtsearch"),3,{cmd:"role",mode:"mo",gp:"1"},function(e){e.id>0&&window.location.assign("GuestEdit.php?id="+e.id)}),createAutoComplete($("#txtPhsearch"),5,{cmd:"role",mode:"mo",gp:"1"},function(e){e.id>0&&window.location.assign("GuestEdit.php?id="+e.id)}),createAutoComplete($("#txtRelSch"),3,{cmd:"srrel",basis:$("#hdnRelCode").val(),id:t.id},function(e){$.post("ws_admin.php",{rId:e.id,id:t.id,rc:$("#hdnRelCode").val(),cmd:"newRel"},relationReturn)}),$("input.hhk-check-button").click(function(){"exAll"===$(this).prop("id")?$("input.hhk-ex").prop("checked",!0):$("input.hhk-ex").prop("checked",!1)}),$(".hhk-hideStatus, .hhk-hideBasis").hide(),$("#divFuncTabs").show(),$(".hhk-showonload").show(),$("#txtsearch").focus()});
