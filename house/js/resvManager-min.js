/**
 * resvManager.js
 *
 * @author    Eric K. Crane <ecrane@nonprofitsoftwarecorp.org>
 * @copyright 2010-2023 <nonprofitsoftwarecorp.org>
 * @license   GPL and MIT
 * @link      https://github.com/NPSC/HHK
 */
function resvManager(e, t) { var a = this, i = e.patLabel, r = e.visitorLabel, s = (e.guestLabel, e.primaryGuestLabel), n = e.resvTitle, o = e.saveButtonLabel, l = e.patBD, d = e.gstBD, c = e.patAddr, h = e.gstAddr, p = e.patAsGuest, u = void 0 !== e.emergencyContact && e.emergencyContact, v = void 0 !== e.isCheckin && e.isCheckin, f = e.addrPurpose, g = e.idPsg, m = e.rid, k = e.id, C = e.vid, y = e.span, b = e.arrival, x = e.insistPayFilledIn, w = e.prePaymt, S = e.datePickerButtons, D = t.closedDays, A = !1, M = e.insistCkinEmail, P = e.insistCkinPhone, R = e.insistCkinAddress, _ = [], I = new q, N = new q, E = new q, T = new function (e) { var a, n = this, o = "divfamDetail", m = !1; n.findStaysChecked = C, n.findStays = function (e) { var t = 0; for (var a in I.list()) I.list()[a].stay === e && t++; return t }, n.findPrimaryGuest = y, n.setUp = function (i) { var r; if (void 0 === i.famSection || void 0 === i.famSection.tblId || "" === i.famSection.tblId) return; !1 === m && (function (t) { var i, r, s; i = $("<div/>").addClass("ui-widget-content ui-corner-bottom hhk-tdbox hhk-overflow-x").prop("id", o).css("padding", "5px"), a = $("<table/>").prop("id", t.famSection.tblId).addClass("hhk-table").append($("<thead/>").append($(t.famSection.tblHead))).append($("<tbody/>")), i.append(a).append($(t.famSection.adtnl)), s = $("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='f_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))), r = $('<div id="divfamHdr" style="padding:2px; cursor:pointer;"/>').append($(t.famSection.hdr)).append(s).append('<div style="clear:both;"/>'), r.addClass("ui-widget-header ui-state-default ui-corner-top"), r.click((function () { "none" === i.css("display") ? (i.show("blind"), r.removeClass("ui-corner-all").addClass("ui-corner-top")) : (i.hide("blind"), r.removeClass("ui-corner-top").addClass("ui-corner-all")) })), e.empty().append(r).append(i).show() }(i), t.UseIncidentReports && function () { if (g) { var t, a, i; t = $('<div style="font-size: 0.9em; max-width: 100%; margin-bottom: 0.5em; margin-top: 0.5em; display: none;"/>').addClass("ui-widget hhk-visitdialog hhk-row").prop("id", "incidentsSection"), a = $('<div style="padding:2px; cursor:pointer;"/>').addClass("ui-widget-header ui-state-default ui-corner-all hhk-incidentHdr"), i = $('<div style="padding: 5px;"/>').addClass("ui-corner-bottom hhk-tdbox ui-widget-content").prop("id", "incidentContent").hide(), a.append('<div class="hhk-checkinHdr" style="display: inline-block">Incidents<span id="incidentCounts"/></div>').append('<ul style="list-style-type:none; float:right;margin-left:5px;padding-top:2px;" class="ui-widget"><li class="ui-widget-header ui-corner-all" title="Open - Close"><span id="f_drpDown" class="ui-icon ui-icon-circle-triangle-n"></span></li></ul>'), i.incidentViewer({ psgId: g, guestLabel: $("#guestLabel").val(), visitorLabel: $("#visitorLabel").val() }), a.click((function () { "none" === i.css("display") ? (i.show("blind"), a.removeClass("ui-corner-all").addClass("ui-corner-top")) : (i.hide("blind"), a.removeClass("ui-corner-top").addClass("ui-corner-all")) })), t.append(a).append(i).show(), e.find("#divfamDetail").append(t) } }()); for (var s in i.famSection.mem) { let e = I.findItem("pref", i.famSection.mem[s].pref); e && (a.find("tr#" + e.id + "n").remove(), a.find("tr#" + e.id + "a").remove(), a.find("input#" + e.pref + "idName").parents("tr").next("tr").remove(), a.find("input#" + e.pref + "idName").parents("tr").remove(), I.removeIndex(e.pref), N.removeIndex(e.pref)) } I.makeList(i.famSection.mem, "pref"), N.makeList(i.famSection.addrs, "pref"), E.makeList(i.famSection.emergContacts, "pref"), void 0 !== i.famSection.tblBody[1] && a.find("tbody:first").prepend($(i.famSection.tblBody[1])); void 0 !== i.famSection.tblBody[0] && a.find("tbody:first").prepend($(i.famSection.tblBody[0])); for (var n in i.famSection.tblBody) if ("0" !== n && "1" !== n) { let e = $(i.famSection.tblBody[n]); if (2 == n) { let t = e.find("input.hhk-lastname"); "" === t.val() && t.val(U("last")).focus(), t = e.find("input.hhk-firstname"), "" === t.val() && t.val(U("first")).focus() } a.find("tbody:first").append(e) } if ($(".hhk-cbStay").checkboxradio({ classes: { "ui-checkboxradio-label": "hhk-unselected-text" } }), $(".hhk-lblStay").each((function () { "1" == $(this).data("stay") && $(this).click() })), $(".ckbdate").datepicker(k), $(".hhk-addrPanel").find("select.bfh-countries").each((function () { var e = $(this); e.bfhcountries(e.data()), $(this).data("dirrty-initial-value", $(this).data("country")) })), $(".hhk-addrPanel").find("select.bfh-states").each((function () { var e = $(this); e.bfhstates(e.data()), $(this).data("dirrty-initial-value", $(this).data("state")) })), $(".hhk-phemtabs").tabs(), $("#InsTabs").tabs(), verifyAddrs("#divfamDetail"), $("input.hhk-zipsearch").each((function () { var e; createZipAutoComplete($(this), "ws_admin.php", e, T) })), !1 === m) { $("#lnCopy").click((function () { var e = $("input.hhk-lastname").first().val(); $("input.hhk-lastname").each((function () { "" === $(this).val() && $(this).val(e) })) })), $("#adrCopy").click((function () { !function (e) { for (var t in N.list()) e != t && ("" !== $("#" + t + "adraddress1" + f).val() && "" !== $("#" + t + "adrzip" + f).val() || ($("#" + t + "adraddress1" + f).val(N.list()[e].Address_1), $("#" + t + "adraddress2" + f).val(N.list()[e].Address_2), $("#" + t + "adrcity" + f).val(N.list()[e].City), $("#" + t + "adrcounty" + f).val(N.list()[e].County), $("#" + t + "adrzip" + f).val(N.list()[e].Postal_Code), $("#" + t + "adrcountry" + f).val() != N.list()[e].Country_Code && $("#" + t + "adrcountry" + f).val(N.list()[e].Country_Code).change(), $("#" + t + "adrstate" + f).val(N.list()[e].State_Province), !0 === $("#" + e + "incomplete").prop("checked") ? $("#" + t + "incomplete").prop("checked", !0) : _(t) && !0 === $("#" + t + "incomplete").prop("checked") && $("#" + t + "incomplete").prop("checked", !1), F($("#" + t + "liaddrflag")))) }($("li.hhk-AddrFlag").first().data("pref")) })), $("#" + o).on("click", ".hhk-togAddr", (function () { r = $(this), $(this).siblings(), "none" === $(this).parents("tr").next("tr").css("display") ? ($(this).parents("tr").next("tr").show(), r.find("span").removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"), r.attr("title", "Hide Address Section")) : ($(this).parents("tr").next("tr").hide(), r.find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"), r.attr("title", "Show Address Section"), isIE() && $("#divSelAddr").remove()) })), $("#" + o).on("click", ".hhk-AddrFlag", (function () { $("#" + $(this).data("pref") + "incomplete").click() })), $("#" + o).on("change", ".hhk-copy-target", (function () { T($(this).data("pref")), function (e) { if (void 0 === e) return; E.list()[e].First = $("#" + e + "txtEmrgFirst").val(), E.list()[e].Last = $("#" + e + "txtEmrgLast").val(), E.list()[e].phone = $("#" + e + "txtEmrgPhn").val(), E.list()[e].altPhone = $("#" + e + "txtEmrgAlt").val(), E.list()[e].relation = $("#" + e + "selEmrgRel").val() }($(this).data("pref")) })), $("#" + o).on("click", ".hhk-addrCopy", (function () { !function (e, t) { $(".hhk-addrPicker").remove(); var a = $('<select id="selAddrch" multiple="multiple" />'), i = 0, r = []; for (var s in N.list()) if ("" != N.list()[s].Address_1 || "" != N.list()[s].Postal_Code) { for (var n = !0, o = N.list()[s].Address_1 + ", " + ("" == N.list()[s].Address_2 ? "" : N.list()[s].Address_2 + ", ") + N.list()[s].City + ", " + N.list()[s].State_Province + "  " + N.list()[s].Postal_Code, l = 0; l <= r.length; l++)r[l] != o || (n = !1); n && (r[i] = o, i++, $('<option class="hhk-addrPickerPanel" value="' + s + '">' + o + "</option>").appendTo(a)) } if (i > 0) { a.prop("size", i + 1).prepend($('<option value="0" >(Cancel)</option>')), a.change((function () { !function (e, t) { if (0 == t) return void $("#divSelAddr").remove(); $("#" + e + "adraddress1" + f).val(N.list()[t].Address_1), $("#" + e + "adraddress2" + f).val(N.list()[t].Address_2), $("#" + e + "adrcity" + f).val(N.list()[t].City), $("#" + e + "adrcounty" + f).val(N.list()[t].County), $("#" + e + "adrzip" + f).val(N.list()[t].Postal_Code), $("#" + e + "adrcountry" + f).val() != N.list()[t].Country_Code && $("#" + e + "adrcountry" + f).val(N.list()[t].Country_Code).change(); $("#" + e + "adrstate" + f).val(N.list()[t].State_Province), _(e) && !0 === $("#" + e + "incomplete").prop("checked") && $("#" + e + "incomplete").prop("checked", !1); F($("#" + e + "liaddrflag")), $("#divSelAddr").remove() }(t, $(this).val()) })), $('<div id="divSelAddr" style="position:absolute; vertical-align:top;" class="hhk-addrPicker hhk-addrPickerPanel"/>').append($('<p class="hhk-addrPickerPanel">Choose an Address: </p>')).append(a).appendTo($("body")).position({ my: "left top", at: "right center", of: e }) } }($(this), $(this).data("prefix")) })), $("#" + o).on("click", ".hhk-emergCopy", (function () { !function (e, t) { $(".hhk-addrPicker").remove(); var a = $('<select id="selAddrch" multiple="multiple" />'), i = 0, r = []; for (var s in E.list()) if ("" != E.list()[s].First || "" != E.list()[s].Last) { for (var n = !0, o = E.list()[s].First + " " + E.list()[s].Last + " " + E.list()[s].phone, l = 0; l <= r.length; l++)r[l] != o || (n = !1); n && (r[i] = o, i++, $('<option class="hhk-addrPickerPanel" value="' + s + '">' + o + "</option>").appendTo(a)) } if (i > 0) { a.prop("size", i + 1).prepend($('<option value="0" >(Cancel)</option>')), a.change((function () { !function (e, t) { if (0 == t) return void $("#divSelAddr").remove(); $("#" + e + "txtEmrgFirst").val(E.list()[t].First), $("#" + e + "txtEmrgLast").val(E.list()[t].Last), $("#" + e + "txtEmrgPhn").val(E.list()[t].phone), $("#" + e + "txtEmrgAlt").val(E.list()[t].altPhone), $("#" + e + "selEmrgRel").val(E.list()[t].relation).change(), $("#divSelAddr").remove() }(t, $(this).val()) })), $('<div id="divSelAddr" style="position:absolute; vertical-align:top;" class="hhk-addrPicker hhk-addrPickerPanel"/>').append($('<p class="hhk-addrPickerPanel">Choose an Emergency Contact: </p>')).append(a).appendTo($("body")).position({ my: "left top", at: "right center", of: e }) } }($(this), $(this).data("prefix")) })), $("#" + o).on("click", ".hhk-addrErase", (function () { var e; e = $(this).data("prefix"), $("#" + e + "adraddress1" + f).val(""), $("#" + e + "adraddress2" + f).val(""), $("#" + e + "adrcity" + f).val(""), $("#" + e + "adrcounty" + f).val(""), $("#" + e + "adrstate" + f).val(""), $("#" + e + "adrcountry" + f).val(""), $("#" + e + "adrzip" + f).val(""), F($("#" + e + "liaddrflag")) })), $("#" + o).on("click", ".hhk-incompleteAddr", (function () { F($("#" + $(this).data("prefix") + "liaddrflag")) })), $("#" + o).on("click", ".hhk-removeBtn", (function () { ("" === $("#" + $(this).data("prefix") + "txtFirstName").val() && "" === $("#" + $(this).data("prefix") + "txtLastName").val() || !1 !== confirm("Remove this person: " + $("#" + $(this).data("prefix") + "txtFirstName").val() + " " + $("#" + $(this).data("prefix") + "txtLastName").val() + "?")) && (I.removeIndex($(this).data("prefix")), N.removeIndex($(this).data("prefix")), $(this).parentsUntil("tbody", "tr").next().remove(), $(this).parentsUntil("tbody", "tr").remove()) })), $(".hhk-getVDialog").button(), $("#" + o).on("change", ".patientRelch", (function () { "slf" === $(this).val() ? I.list()[$(this).data("prefix")].role = "p" : I.list()[$(this).data("prefix")].role = "g" })), createRoleAutoComplete($("#txtPersonSearch"), 3, { cmd: "guest" }, (function (e) { !function (e, t, a) { if (void 0 !== e.No_Return && "" !== e.No_Return) return void flagAlertMessage("This person is set for No Return: " + e.No_Return + ".", "alert"); if (void 0 === e.id) return; if (e.id > 0 && null !== I.findItem("id", e.id)) return void flagAlertMessage("This person is already listed here. ", "alert"); G = a; var i = { id: e.id, rid: t.rid, idPsg: t.idPsg, isCheckin: v, gstDate: $("#gstDate").val(), gstCoDate: $("#gstCoDate").val(), cmd: "addResvGuest" }; Z(i) }(e, i, $("#txtPersonSearch").val()) })), $("#" + o).on("click", ".hhk-emSearch", (function () { $("#hdnEcSchPrefix").val($(this).data("prefix")), $("#ecSearch").dialog("open") })), createAutoComplete($("#txtemSch"), 3, { cmd: "filter", add: "phone", basis: "psg", psg: i.idPsg }, x); let e = function (e) { "n" !== e.id && ($("#selDiagnosis").val(e.id), $("#selectedDiag").text(e.label).closest("tr").removeClass("d-none")) }; createAutoComplete($("#diagSearch"), 3, { cmd: "diagnosis" }, e, !1), $(document).on("click", "#delDiagnosis", (function (e) { e.preventDefault(), $("#selDiagnosis").val(""), $("#diagSearch").val(""), $(this).closest("tr").addClass("d-none") })), $("ul.hhk-ui-icons li").hover((function () { $(this).addClass("ui-state-hover") }), (function () { $(this).removeClass("ui-state-hover") })) } for (var l in I.list()) F($("#" + l + "liaddrflag")); $(".hhk-togAddr").each((function () { $(this).parents("tr").next("tr").hide(), $(this).find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"), $(this).attr("title", "Show Address Section") })), m = !0 }, n.newGuestMarkup = function (e, t) { var i, r, s, n, o; if (void 0 === e.tblId || "" == e.tblId) return; if (0 === a.length) return; s = a.children("tbody").children("tr").last().hasClass("odd") ? "even" : "odd"; a.find("tbody:first").append($(e.ntr).addClass(s)).append($(e.atr).addClass(s)), $("#" + t + "cbStay").checkboxradio({ classes: { "ui-checkboxradio-label": "hhk-unselected-text" } }), "1" == $("#" + t + "lblStay").data("stay") && $("#" + t + "lblStay").click(); $(".ckbdate").datepicker(k), n = $("#" + t + "liaddrflag"), o = n.siblings(), F(n), o.parents("tr").next("tr").hide(), o.find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"), o.attr("title", "Show Address Section"), (i = $("#" + t + "adrcountry" + f)).bfhcountries(i.data()), $(this).data("dirrty-initial-value", $(this).data("country")), (r = $("#" + t + "adrstate" + f)).bfhstates(r.data()), $(this).data("dirrty-initial-value", $(this).data("state")), $("#" + t + "phEmlTabs").tabs(), $("input#" + t + "adrzip1").each((function () { var e; createZipAutoComplete($(this), "ws_admin.php", e, T) })) }, n.verify = function () { var t = 0, a = 0, n = 0, o = 0, v = !1, f = 0, g = !1; if ($(".patientRelch").removeClass("ui-state-error"), $(".patientRelch").each((function () { "" === $(this).val() ? ($(this).addClass("ui-state-error"), g = !0) : $(this).removeClass("ui-state-error") })), g) return flagAlertMessage("Set the highlighted Relationship(s).", "alert", O), !1; for (var k in y(), C(), I.list()) t++, "p" === I.list()[k].role && a++, "1" === I.list()[k].stay && n++, "1" === I.list()[k].pri && o++, $("#" + k + "toggleAddr").find("span").hasClass("ui-icon-circle-triangle-n") && $("#" + k + "toggleAddr").click(); if (a < 1) return flagAlertMessage("Choose a " + i + ".", "alert", O), $(".patientRelch").addClass("ui-state-error"), !1; if (a > 1) { for (var k in flagAlertMessage("Only 1 " + i + " is allowed.", "alert", O), I.list()) "p" === I.list()[k].role && $("#" + k + "selPatRel").addClass("ui-state-error"); return !1 } if (n < 1) return flagAlertMessage("There is no one actually staying.  Pick someone to stay.", "alert", O), !1; if ($("input.hhk-rbPri").parent().removeClass("ui-state-error"), 0 === o && 1 === t) for (var k in I.list()) I.list()[k].pri = "1"; else if (0 === o) return O.text("Set one " + r + " as " + s + ".").show(), flagAlertMessage("Set one " + r + " as " + s + ".", "alert", O), $("input.hhk-rbPri").parent().addClass("ui-state-error"), !1; if (e.find(".hhk-lastname").each((function () { "" == $(this).val() ? ($(this).addClass("ui-state-error"), v = !0) : $(this).removeClass("ui-state-error") })), e.find(".hhk-firstname").each((function () { "" == $(this).val() ? ($(this).addClass("ui-state-error"), v = !0) : $(this).removeClass("ui-state-error") })), !0 === v) return b(!0), flagAlertMessage("Enter a first and last name for the people highlighted.", "alert", O), !1; u && e.find(".hhk-EmergCb").each((function () { var e = A($(this).data("prefix")); !0 !== $(this).prop("checked") && "" !== e || f++ })); for (var x in I.list()) { if ("p" === I.list()[x].role) { if (l & "" === $("#" + x + "txtBirthDate").val()) return $("#" + x + "txtBirthDate").addClass("ui-state-error"), flagAlertMessage(i + " is missing the Birth Date.", "alert", O), b(!0), !1; if ($("#" + x + "txtBirthDate").removeClass("ui-state-error"), c || p) if ("" !== (S = w(x))) return flagAlertMessage(S, "alert", O), b(!0), $("#" + x + "toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s") && $("#" + x + "toggleAddr").click(), !1 } else { if (d & "" === $("#" + x + "txtBirthDate").val()) return $("#" + x + "txtBirthDate").addClass("ui-state-error"), flagAlertMessage(r + " is missing the Birth Date.", "alert", O), b(!0), !1; if ($("#" + x + "txtBirthDate").removeClass("ui-state-error"), h) if ("" !== (S = w(x))) return flagAlertMessage(S, "alert", O), b(!0), $("#" + x + "toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s") && $("#" + x + "toggleAddr").click(), !1 } if ($("#" + x + "txtBirthDate").length > 0 && "" !== $("#" + x + "txtBirthDate").val()) { if (new Date($("#" + x + "txtBirthDate").val()) > new Date) return $("#" + x + "txtBirthDate").addClass("ui-state-error"), flagAlertMessage("This birth date cannot be in the future.", "alert", O), b(!0), !1; $("#" + x + "txtBirthDate").removeClass("ui-state-error") } var S; if (u && f < 1) if ("" !== (S = A(x))) return flagAlertMessage(S, "alert", O), b(!0), $("#" + x + "toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s") && $("#" + x + "toggleAddr").click(), !1; if (z()) if ("" !== (S = D(x))) return flagAlertMessage(S, "alert", O), b(!0), $("#" + x + "toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s") && $("#" + x + "toggleAddr").click(), !1 } return m = !1, !0 }, n.divFamDetailId = o, n.$famTbl = a; const k = { yearRange: "-99:+00", changeMonth: !0, changeYear: !0, autoSize: !0, maxDate: 0, dateFormat: "M d, yy", showButtonPanel: S, beforeShow: function (e) { setTimeout((function () { var t = $(e).datepicker("widget").find(".ui-datepicker-buttonpane"); t.empty(), $("<button>", { text: "Minor", click: function () { var t = $(e), a = $.datepicker._getInst(t[0]); a.input.val("Minor"); var i = $.datepicker._get(a, "onSelect"); i ? i.apply(a.input ? a.input[0] : null, ["Minor", a]) : a.input && a.input.trigger("change"), a.inline ? $.datepicker._updateDatepicker(a) : ($.datepicker._hideDatepicker(), $.datepicker._lastInput = a.input[0], "object" != typeof a.input[0] && a.input.trigger("focus"), $.datepicker._lastInput = null) } }).appendTo(t).addClass("ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all") }), 1) }, onChangeMonthYear: function (e, t, a) { setTimeout((function () { var e = $(a).datepicker("widget").find(".ui-datepicker-buttonpane"); e.empty(), $("<button>", { text: "Minor", click: function () { var e = $(a.input), t = $.datepicker._getInst(e[0]); t.input.val("Minor"); var i = $.datepicker._get(t, "onSelect"); i ? i.apply(t.input ? t.input[0] : null, ["Minor", t]) : t.input && t.input.trigger("change"), t.inline ? $.datepicker._updateDatepicker(t) : ($.datepicker._hideDatepicker(), $.datepicker._lastInput = t.input[0], "object" != typeof t.input[0] && t.input.trigger("focus"), $.datepicker._lastInput = null) } }).appendTo(e).addClass("ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all") }), 1) } }; function C() { var e = 0; return $(".hhk-cbStay").each((function () { var t = $(this).data("prefix"); $(this).prop("checked") ? (I.list()[t].stay = "1", e++) : 1 === $(".hhk-cbStay").length ? I.list()[t].stay = "1" : I.list()[t].stay = "0" })), e } function y() { var e = $("input[type=radio][name=rbPriGuest]:checked").val(); for (var t in I.list()) I.list()[t].pri = "0"; void 0 !== e && (I.list()[e].pri = "1") } function b(e) { var t = $("#divfamDetail"); !0 === e ? (t.show("blind"), t.prev("div").removeClass("ui-corner-all").addClass("ui-corner-top")) : (t.hide("blind"), t.prev("div").addClass("ui-corner-all").removeClass("ui-corner-top")) } function x(e) { "use strict"; $("#ecSearch").dialog("close"); var t = parseInt(e.id, 10); if (!1 === isNaN(t) && t > 0) { var a = $("#hdnEcSchPrefix").val(); if ("" == a) return; $("#" + a + "txtEmrgFirst").val(e.first), $("#" + a + "txtEmrgLast").val(e.last), $("#" + a + "txtEmrgPhn").val(e.phone), $("#" + a + "txtEmrgAlt").val(""), $("#" + a + "selEmrgRel").val("") } } function w(e) { var t = /^([\(]{1}[0-9]{3}[\)]{1}[\.| |\-]{0,1}|^[0-9]{3}[\.|\-| ]?)?[0-9]{3}(\.|\-| )?[0-9]{4}$/, a = !1; if ($("#" + e + "incomplete").length > 0 && (!1 === $("#" + e + "incomplete").prop("checked") || 1 == v && 1 == R && !0 === $("#" + e + "cbStay").prop("checked")) && ($("." + e + "hhk-addr-val").not(".hhk-MissingOk").each((function () { "" !== $(this).val() || $(this).hasClass("bfh-states") ? $(this).removeClass("ui-state-error") : ($(this).addClass("ui-state-error"), a = !0) })), a)) return $("#" + e + "toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s") && $("#" + e + "toggleAddr").click(), "Some or all of the indicated addresses are missing.  "; var i = !1; $('.hhk-phoneInput[id^="' + e + 'txtPhone"]').each((function () { "" !== $.trim($(this).val()) && !1 === t.test($(this).val()) ? ($(this).addClass("ui-state-error"), $("#" + e + "toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s") && $("#" + e + "toggleAddr").click(), $("#" + e + "phEmlTabs").tabs("option", "active", 1), a = !0) : $(this).removeClass("ui-state-error"), "" === $.trim($(this).val()) || $(this).hasClass("ui-state-error") || 0 != i || (i = !0) })); var r = 0 !== $('.prefPhone[id^="' + e + 'phno"]:checked').length; if (1 == v && 1 == P && 0 == i && 0 == r && !0 === $("#" + e + "cbStay").prop("checked")) return "At least one phone number or 'No Phone' is required for check in."; var s = !1, n = 0 !== $('.prefEmail[id^="' + e + 'emno"]:checked').length; return $('.hhk-emailInput[id^="' + e + 'txtEmail"]').each((function () { "" === $.trim($(this).val()) || $(this).hasClass("ui-state-error") || 0 != s || (s = !0) })), 1 == v && 1 == M && 0 == s && 0 == n && !0 === $("#" + e + "cbStay").prop("checked") ? "At least one email address or 'No Email' is required for check in." : "" } function D(e) { var t = !1; return $("." + e + "hhk-demog-input").each((function () { "" === $(this).val() && !0 === $("#" + e + "cbStay").prop("checked") ? ($(this).addClass("ui-state-error"), t = !0) : $(this).removeClass("ui-state-error") })), t ? "Some or all Demographics are not set" : "" } function A(e) { var t = !1, a = $("#" + e + "txtEmrgFirst"), i = $("#" + e + "txtEmrgLast"), r = $("#" + e + "txtEmrgPhn"), s = $("#" + e + "selEmrgRel"); return a.removeClass("ui-state-error"), i.removeClass("ui-state-error"), r.removeClass("ui-state-error"), s.removeClass("ui-state-error"), $("#" + e + "cbEmrgLater").length > 0 && !1 === $("#" + e + "cbEmrgLater").prop("checked") && ("" === a.val() && "" === i.val() && (a.addClass("ui-state-error"), i.addClass("ui-state-error"), t = !0), "" === r.val() && (r.addClass("ui-state-error"), t = !0), "" === s.val() && (s.addClass("ui-state-error"), t = !0), t) ? "Some or all of the indicated Emergency Contact Information is missing.  " : "" } function _(e) { return !(void 0 === e || !e || "" == e) && ("" !== $("#" + e + "adraddress1" + f).val() && "" !== $("#" + e + "adrzip" + f).val() && "" !== $("#" + e + "adrstate" + f).val() && "" !== $("#" + e + "adrcity" + f).val()) } function T(e) { void 0 !== e && (N.list()[e].Address_1 = $("#" + e + "adraddress1" + f).val(), N.list()[e].Address_2 = $("#" + e + "adraddress2" + f).val(), N.list()[e].City = $("#" + e + "adrcity" + f).val(), N.list()[e].County = $("#" + e + "adrcounty" + f).val(), N.list()[e].State_Province = $("#" + e + "adrstate" + f).val(), N.list()[e].Country_Code = $("#" + e + "adrcountry" + f).val(), N.list()[e].Postal_Code = $("#" + e + "adrzip" + f).val(), F($("#" + e + "liaddrflag"))) } function F(e) { var t = e.data("pref"); !0 === $("#" + t + "incomplete").prop("checked") ? (e.show().find("span").removeClass("ui-icon-alert").addClass("ui-icon-check").attr("title", "Incomplete Address is checked"), e.removeClass("ui-state-error").addClass("ui-state-highlight")) : _(t) ? e.hide() : (e.show().find("span").removeClass("ui-icon-check").addClass("ui-icon-mail-closed").attr("title", "Address is Incomplete"), e.removeClass("ui-state-highlight").addClass("ui-state-error")) } }($("#famSection")), F = new function (e) { var t, a, i, s = this; let n = "Determine how to handle the pre-payment."; function o(e) { var t = _[$("#selResource").val()], a = !0; $("#selccgw" + e + " option").each((function () { this.value === t.merchant && (a = !1) })), a && $("#selccgw" + e).append('<option value="' + t.merchant + '">' + t.merchant + "</option>"), $("#selccgw" + e).val(t.merchant) } function l(e) { "use strict"; var t = ""; return "" === $("#car" + e + "txtVehLic").val() && "" === $("#car" + e + "txtVehMake").val() ? "Enter vehicle info or check the 'No Vehicle' checkbox. " : ("" === $("#car" + e + "txtVehLic").val() ? ("" === $("#car" + e + "txtVehModel").val() && ($("#car" + e + "txtVehModel").addClass("ui-state-highlight"), t = "Enter Model"), "" === $("#car" + e + "txtVehColor").val() && ($("#car" + e + "txtVehColor").addClass("ui-state-highlight"), t = "Enter Color"), "" === $("#car" + e + "selVehLicense").val() && ($("#car" + e + "selVehLicense").addClass("ui-state-highlight"), t = "Enter state license plate registration")) : "" === $("#car" + e + "txtVehMake").val() && "" === $("#car" + e + "txtVehLic").val() && ($("#car" + e + "txtVehLic").addClass("ui-state-highlight"), t = "Enter a license plate number."), t) } s.setupComplete = !1, s.checkPayments = !0, s.setUp = function (l) { var d, c, h, p, u, v, f, g; if (t = $("<div/>").addClass(" hhk-tdbox ui-corner-bottom hhk-tdbox ui-widget-content hhk-flex hhk-flex-wrap hhk-overflow-x").prop("id", "divResvDetail").css({ padding: "5px" }), void 0 !== l.resv.rdiv.rChooser && t.append($(l.resv.rdiv.rChooser)), void 0 !== l.resv.rdiv.rate && t.append($(l.resv.rdiv.rate)), void 0 !== l.resv.rdiv.cof && t.append(l.resv.rdiv.cof), void 0 !== l.resv.rdiv.pay && t.append($(l.resv.rdiv.pay)), void 0 !== l.resv.rdiv.rstat && (t.append($(l.resv.rdiv.rstat)), t.on("change", ".hhk-checkboxlist", (function () { $(this).prop("checked") ? ($("#date" + $(this).data("code")).datepicker("setDate", "+0"), $("#disp" + $(this).data("code")).show()) : ($("#date" + $(this).data("code")).val($("#date" + $(this).data("code")).prop("defaultValue")), $("#disp" + $(this).data("code")).hide()) })), t.find(".ckdate").datepicker({ yearRange: "-02:+03", changeMonth: !0, changeYear: !0, autoSize: !0, numberOfMonths: 1, dateFormat: "M d, yy" })), void 0 !== l.resv.rdiv.multiResv && t.append($(l.resv.rdiv.multiResv)), void 0 !== l.resv.rdiv.vehicle && t.append($(l.resv.rdiv.vehicle)), void 0 !== l.resv.rdiv.notes && t.append(function (e, t, a = null) { return e > 0 ? t.notesViewer({ linkId: e, linkType: "reservation", newNoteAttrs: { id: "taNewNote", name: "taNewNote" }, alertMessage: function (e, t) { flagAlertMessage(e, t) } }) : a > 0 && t.notesViewer({ linkId: a, linkType: "psg", newNoteAttrs: { id: "taNewNote", name: "taNewNote" }, alertMessage: function (e, t) { flagAlertMessage(e, t) } }), t }(l.rid, $(l.resv.rdiv.notes), l.idPsg)), void 0 !== l.resv.rdiv.docViewer && t.append((d = l.idPsg, (c = $(l.resv.rdiv.docViewer)).docUploader({ visitorLabel: r, psgId: d, alertMessage: function (e, t) { flagAlertMessage(e, t) } }), c)), void 0 !== l.resv.rdiv.wlnotes && t.append($(l.resv.rdiv.wlnotes)), i = $("<ul style='list-style-type:none; float:right; margin-left:5px; padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='r_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))), (a = $('<div id="divResvHdr" style="padding:2px; cursor:pointer;"/>').append($(l.resv.hdr)).append(i).append('<div style="clear:both;"/>')).addClass("ui-widget-header ui-state-default ui-corner-top"), a.click((function (e) { var i = $(e.target); "divResvHdr" !== i[0].id && "r_drpDown" !== i[0].id || ("none" === t.css("display") ? (t.show("blind"), a.removeClass("ui-corner-all").addClass("ui-corner-top")) : (t.hide("blind"), a.removeClass("ui-corner-top").addClass("ui-corner-all"))) })), e.empty().append(a).append(t).show(), s.$totalGuests = $("#spnNumGuests"), s.origRoomId = $("#selResource").val(), s.checkPayments = !0, $(".hhk-viewResvActivity").length > 0 && $(".hhk-viewResvActivity").click((function () { $.post("ws_ckin.php", { cmd: "viewActivity", rid: $(this).data("rid") }, (function (e) { if ((e = $.parseJSON(e)).error) return e.gotopage && window.open(e.gotopage, "_self"), void flagAlertMessage(e.error, "error"); e.activity && ($("div#submitButtons").hide(), $("#activityDialog").children().remove(), $("#activityDialog").append($(e.activity)), $("#activityDialog").dialog("open")) })) })), $("#btnShowCnfrm").button().click((function () { var e = $("#spnAmount").text(); "" === e && (e = 0), $.post("ws_ckin.php", { cmd: "confrv", rid: $(this).data("rid"), amt: e, eml: "0" }, (function (e) { if ((l = $.parseJSON(e)).error) return l.gotopage && window.open(l.gotopage, "_self"), void flagAlertMessage(l.error, "error"); if (l.confrv) { $("div#submitButtons").hide(), $("#frmConfirm").children().remove(), $("#frmConfirm").html(l.confrv); var t = '<div class="col-md-6 my-2 hhk-flex"><label for="confEmail" class="pr-2" style="min-width:fit-content;">To Address</label><input type="text" style="width:100%" id="confEmail" value="' + l.email + '"></div>'; t += '<div class="col-md-6 my-2 hhk-flex"><label for="ccConfEmail" class="pr-2" style="min-width:fit-content;">CC Address</label><input type="text" style="width:100%" id="ccConfEmail" value="' + l.ccemail + '"></div>', $("#frmConfirm").append($('<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix hhk-flex hhk-flex-wrap">' + t + "</div>")), $("#frmConfirm").find("#confirmTabDiv").tabs(), $("#confirmDialog").dialog("open") } })) })), $("#btnShowResvMsgs").button().smsDialog({ resvId: l.rid }), $(".btnTextGuest").each((function () { var e = $(this).data("idname"); $(this).smsDialog({ guestId: e }) })), h = l.rid, V.idReservation = h, $("input.hhk-constraintsCB").change((function () { V.go($("#gstDate").val(), $("#gstCoDate").val()) })), void 0 !== l.resv.rdiv.rate && function (t) { var a = {}, i = e.find("#btnFapp"); i.length > 0 && ($("#faDialog").dialog({ autoOpen: !1, resizable: !0, width: getDialogWidth(680), modal: !0, title: "Income Chooser", close: function () { $("div#submitButtons").show() }, open: function () { $("div#submitButtons").hide() }, buttons: { Save: function () { $.post("ws_ckin.php", $("#formf").serialize() + "&cmd=savefap&rid=" + t.rid, (function (e) { try { e = $.parseJSON(e) } catch (e) { return void alert("Bad JSON Encoding") } if (e.gotopage && window.open(e.gotopage, "_self"), e.rstat && 1 == e.rstat) { var t = $("#selRateCategory"); e.rcat && "" != e.rcat && t.length > 0 && (t.val(e.rcat), t.change()) } })), $(this).dialog("close") }, Exit: function () { $(this).dialog("close") } } }), i.button().click((function () { getIncomeDiag(t.rid) }))), t.resv.rdiv.ratelist && (a.rateList = t.resv.rdiv.ratelist, a.resources = t.resv.rdiv.rooms, a.visitFees = t.resv.rdiv.vfee, a.idResv = m, setupRates(a)), $("#selResource").length > 0 && $("#selResource").change((function () { var e = _[$("#selResource").val()]; e.defaultRateCat && "" != e.defaultRateCat && "a" == Y && $("#selRateCategory").val(e.defaultRateCat), $("#selRateCategory").change(); var t = $("option:selected", this).parent()[0].label; null == t ? $("#hhkroomMsg").hide() : $("#hhkroomMsg").text(t).show(), $("#selccgw").length > 0 ? o("") : $("#selccgwg").length > 0 && o("g") })) }(l), void 0 !== l.resv.rdiv.pay && $("#selResource").length > 0 && $("#selRateCategory").length > 0 && (setupPayments($("#selRateCategory").val()), $("#paymentDate").datepicker({ yearRange: "-1:+00", numberOfMonths: 1, autoSize: !0, dateFormat: "M d, yy" }), $(document).on("change", "#selResvStatus", (function () { O.text() == n && O.hide(), w > 0 && "a" != $(this).val() && "uc" != $(this).val() && "w" != $(this).val() ? (isCheckedOut = !0, $("#cbHeld").prop("checked", !0).trigger("change")) : (isCheckedOut = !1, $("#heldAmount").val(""), $("#txtOverPayAmt").val(""), $("#cbHeld").prop("checked", !1).trigger("change")) })), $("#selResvStatus").change()), void 0 !== l.resv.rdiv.rstat && function () { let e = { yearRange: "00:+2", changeMonth: !0, changeYear: !0, autoSize: !0, minDate: 0, dateFormat: "M d, yy" }, t = moment().add("1", "days").format("MMM D, YYYY"); $(document).on("change", "#selResvStatus", (function () { $("#selexcpay option[value='m']").hide(), "a" != $(this).val() && "uc" != $(this).val() && "w" != $(this).val() ? ($("#newGstDate").datepicker(e), $("#rebookRow").show("fade")) : ($("#newGstDate").val(""), $("#cbRebook").prop("checked", !1), $("#rebookRow").hide()) })), $(document).on("change", "#newGstDate", (function () { "" != $(this).val() ? ($("#cbRebook").prop("checked", !0), $("#selexcpay option[value='m']").show()) : ($("#cbRebook").removeAttr("checked"), $("#selexcpay option[value='m']").hide()) })), $(document).on("click", "#cbRebook", (function () { $(this).prop("checked") ? ($("#newGstDate").val(t), $("#selexcpay option[value='m']").show()) : ($("#newGstDate").val(""), $("#selexcpay option[value='m']").hide()) })), $("#selResvStatus").change() }(), void 0 !== l.resv.rdiv.vehicle && (u = 2, v = (p = t).find("#cbNoVehicle"), f = p.find("#btnNextVeh"), g = p.find("#tblVehicle"), v.change((function () { this.checked ? g.hide("scale, horizontal") : g.show("scale, horizontal") })), v.change(), f.button(), f.click((function () { p.find("#trVeh" + u).show("fade"), ++u > 4 && f.hide("fade") }))), void 0 !== l.resv.rdiv.cof) { var k = _[$("#selResource").val()]; $("#btnUpdtCred").button().click((function () { cardOnFile($(this).data("id"), $(this).data("idreg"), "Reserve.php?rid=" + m, $(this).data("indx")) })), setupCOF($(".tblCreditExpandg"), $("#btnUpdtCred").data("indx")), "" !== k.merchant && $("#selccgwg").val(k.merchant) } $("#addGuestHeader").length > 0 && (B.openControl = !0, B.setUp(l.resv.rdiv, J, $("#addGuestHeader"))), s.setupComplete = !0 }, s.verify = function () { if (O.hide(), $("#cbNoVehicle").length > 0) { if (!1 === $("#cbNoVehicle").prop("checked")) { var e = l(1); if ("" != e) { var t = l(2); if ("" != t) return $("#vehValidate").text(t), flagAlertMessage(e, "alert", O), !1 } } $("#vehValidate").text("") } if (v) { if (!0 === s.checkPayments) { if ($("#selCategory").val() == fixedRate && $("#txtFixedRate").length > 0 && "" == $("#txtFixedRate").val()) return flagAlertMessage("Set the Room Rate to an amount, or to 0.", "alert", O), $("#txtFixedRate").addClass("ui-state-error"), !1; if ($("#txtFixedRate").removeClass("ui-state-error"), $("input#feesPayment").length > 0 && "" == $("input#feesPayment").val() && x) return flagAlertMessage("Set the Room Fees to an amount, or 0.", "alert", O), $("#payChooserMsg").text("Set the Room Fees to an amount, or 0.").show(), $("input#feesPayment").addClass("ui-state-error"), !1; if ($("input#feesPayment").removeClass("ui-state-error"), $("#payChooserMsg").text(""), void 0 !== verifyAmtTendrd && !1 === verifyAmtTendrd()) return !1 } } else { if (w > 0 && isCheckedOut && "" == $("#selexcpay").val()) return $("#selexcpay").addClass("ui-state-error"), flagAlertMessage(n, "alert", O), $("#payChooserMsg").text(n).show(), !1; if ($("#selexcpay").removeClass("ui-state-error"), $("#payChooserMsg").text(""), $("#selccgw").length > 0 && "" === $("#spnPayAmount").html() && (0 == $("input[name=rbUseCard]:checked").val() || !0 === $("input[name=rbUseCard]").prop("checked"))) { if ($("#selccgw").removeClass("ui-state-highlight"), 0 === $("#selccgw option:selected").length) return $("#tdChargeMsg").text("Select a location.").show("fade"), $("#selccgw").addClass("ui-state-highlight"), !1 } else $("#selccgw").removeClass("ui-state-highlight"), $("#tdChargeMsg").text("").hide("fade") } return !0 } }($("#resvSection")), L = new function (e) { var t = this; t.setupComplete = !1, t.setUp = function (a) { var i = $(a.div).addClass("ui-widget-content").prop("id", "divhospDetail").hide(), r = $("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='h_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))), s = $('<div id="divhospHdr" style="padding:2px; cursor:pointer;"/>').append($(a.hdr)).append(r).append('<div style="clear:both;"/>'); s.addClass("ui-widget-header ui-state-default ui-corner-all"), s.click((function () { "none" === i.css("display") ? (i.show("blind"), s.removeClass("ui-corner-all").addClass("ui-corner-top")) : (i.hide("blind"), s.removeClass("ui-corner-top").addClass("ui-corner-all")) })), e.empty().append(s).append(i), $("#txtEntryDate, #txtExitDate").datepicker({ yearRange: "-01:+01", changeMonth: !0, changeYear: !0, autoSize: !0, numberOfMonths: 1, dateFormat: "M d, yy", showButtonPanel: !0, beforeShow: function (e) { setTimeout((function () { var t = $(e).datepicker("widget").find(".ui-datepicker-buttonpane"); t.empty(), $("<button>", { text: "Clear", click: function () { $.datepicker._clearDate(e) } }).appendTo(t).addClass("ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all") }), 1) }, onChangeMonthYear: function (e, t, a) { setTimeout((function () { var e = $(a).datepicker("widget").find(".ui-datepicker-buttonpane"); e.empty(), $("<button>", { text: "Clear", click: function () { $.datepicker._clearDate(a.input) } }).appendTo(e).addClass("ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all") }), 1) } }), $("#txtAgentSch").length > 0 && (createAutoComplete($("#txtAgentSch"), 3, { cmd: "filter", basis: "ra" }, getAgent), "" === $("#a_txtLastName").val() && $(".hhk-agentInfo").hide(), $(document).on("click", "#a_delete", (function () { $("#a_idName").val(""), $("input.hhk-agentInfo").val(""), $(".hhk-agentInfo").hide() })), "" !== $("#a_idName").val() ? $("input.hhk-agentInfo.name").attr("readonly", "readonly") : $("input.hhk-agentInfo.name").removeAttr("readonly")), $("#txtDocSch").length > 0 && (createAutoComplete($("#txtDocSch"), 3, { cmd: "filter", basis: "doc" }, getDoc), "" === $("#d_txtLastName").val() && $(".hhk-docInfo").hide(), "" !== $("#d_idName").val() ? $("input.hhk-docInfo.name").attr("readonly", "readonly") : $("input.hhk-docInfo.name").removeAttr("readonly"), $(document).on("click", "#d_delete", (function () { $("#d_idName").val(""), $("input.hhk-docInfo").val(""), $(".hhk-docInfo").hide() }))), verifyAddrs("#divhospDetail"), e.on("change", "#selHospital, #selAssoc", (function () { var e = $("#selAssoc").find("option:selected").text(); "" != e && (e += "/ "), $("span#spnHospName").text(e + $("#selHospital").find("option:selected").text()) })), e.show(), "" === $("#selHospital").val() && s.click(), t.setupComplete = !0 }, t.verify = function () { return e.find(".ui-state-error").each((function () { $(this).removeClass("ui-state-error") })), $("#selHospital").length > 0 && !0 === t.setupComplete && "" == $("#selHospital").val() ? ($("#selHospital").addClass("ui-state-error"), flagAlertMessage("Select a hospital.", "alert", O), $("#divhospDetail").show("blind"), $("#divhospHdr").removeClass("ui-corner-all").addClass("ui-corner-top"), !1) : ($("#divhospDetail").hide("blind"), $("#divhospHdr").removeClass("ui-corner-top").addClass("ui-corner-all"), !0) } }($("#hospitalSection")), B = new function () { var e = this; e.setupComplete = !1, e.ciDate = new Date, e.coDate = new Date, e.openControl = !1, e.setUp = function (e, t, a) { if (a.empty(), e.mu && "" !== e.mu) { a.append($(e.mu)); var i, r = $("#gstDate"), s = $("#gstCoDate"), n = parseInt(e.defdays, 10), o = !1, l = !1; "" === r.val() && b && r.val(b), e.startDate && (o = e.startDate), e.endDate && (l = e.endDate), $("#spnRangePicker").length > 0 && (i = $("#spnRangePicker").dateRangePicker({ format: "MMM D, YYYY", separator: " to ", minDays: 1, autoClose: !0, showShortcuts: !0, shortcuts: { "next-days": [n] }, getValue: function () { return r.val() && s.val() ? r.val() + " to " + s.val() : "" }, setValue: function (e, t, a) { r.val(t), s.val(a) }, startDate: o, endDate: l, beforeShowDay: function (e) { return [!0, D.includes(e.getDay()) ? "hhk-datepicker-closed" : ""] } }), e.updateOnChange && i.bind("datepicker-change", (function (a, i) { var r = Math.ceil((i.date2.getTime() - i.date1.getTime()) / 864e5); $("#" + e.daysEle).val(r), e.mindays > 0 && r < e.mindays ? $("#" + e.daysErrEle).text("Stay length is less than " + e.mindays + " days").show() : $("#" + e.daysErrEle).empty().hide(), $("#spnNites").length > 0 && $("#spnNites").text(r), $("#gstDate").removeClass("ui-state-error"), $("#gstCoDate").removeClass("ui-state-error"), $.isFunction(t) && t(i) }))), a.show() } setupComplete = !0 }, e.verify = function () { var t = $("#gstDate"), a = $("#gstCoDate"); return t.removeClass("ui-state-error"), a.removeClass("ui-state-error"), "" === t.val() ? (t.addClass("ui-state-error"), flagAlertMessage("This " + n + " is missing the check-in date.", "alert", O), !1) : (e.ciDate = new Date(t.val()), isNaN(e.ciDate.getTime()) ? (t.addClass("ui-state-error"), flagAlertMessage("This " + n + " is missing the check-in date.", "alert", O), !1) : void 0 !== v && !0 === v && moment($("#gstDate").val(), "MMM D, YYYY") > moment().endOf("date") ? (t.addClass("ui-state-error"), flagAlertMessage("Set the Check in date to today or earlier.", "alert", O), !1) : "" === a.val() ? (a.addClass("ui-state-error"), flagAlertMessage("This " + n + " is missing the expected departure date.", "alert", O), !1) : (e.coDate = new Date(a.val()), isNaN(e.coDate.getTime()) ? (a.addClass("ui-state-error"), flagAlertMessage("This " + n + " is missing the expected departure date", "alert", O), !1) : !(e.ciDate > e.coDate) || (t.addClass("ui-state-error"), flagAlertMessage("This " + n + "'s check-in date is after the expected departure date.", "alert", O), !1))) } }, V = new V, O = $("#pWarnings"), Y = (t = t, ""), G = ""; function H(e) { _ = e } function z() { return A } function U(e) { if ("" != G) { const t = G.split(","); if ("last" == e.toLowerCase() && t.length > 0) return t[0].trim(); if ("first" == e.toLowerCase() && t.length > 1) return t[1].trim() } return "" } function J(e) { O.text("").hide(); var t = !1; for (var a in I.list()) if (I.list()[a].id > 0) { t = !0; break } if (t) { $(".hhk-stayIndicate").hide().parent("td").addClass("hhk-loading"); var i = { cmd: "updateAgenda", idPsg: g, idResv: m, idVisit: C, span: y, dt1: e.date1.getFullYear() + "-" + (e.date1.getMonth() + 1) + "-" + e.date1.getDate(), dt2: e.date2.getFullYear() + "-" + (e.date2.getMonth() + 1) + "-" + e.date2.getDate(), mems: I.list() }; $.post("ws_resv.php", i, (function (e) { $(".hhk-stayIndicate").show().parent("td").removeClass("hhk-loading"); try { e = $.parseJSON(e) } catch (e) { return void flagAlertMessage(e.message, "error") } if (e.gotopage && window.open(e.gotopage, "_self"), e.error && flagAlertMessage(e.error, "error"), e.stayCtrl) { for (var t in e.stayCtrl) { var a; $("#sb" + t).empty().html(e.stayCtrl[t].ctrl), $("#" + t + "cbStay").checkboxradio({ classes: { "ui-checkboxradio-label": "hhk-unselected-text" } }), I.list()[t].stay = "0", (a = $("#" + t + "lblStay")).length > 0 && "1" == a.data("stay") && a.click() } $(".hhk-getVDialog").button(), "" != $("#gstDate").val() && "" != $("#gstCoDate").val() && V.go($("#gstDate").val(), $("#gstCoDate").val()), $(".hhk-cbStay").change() } })) } j(e.date1.t, m) } function j(e, t, a) { var i = moment(e, "MMM D, YYYY"), r = moment().endOf("date"); t > 0 && i <= r && !a ? $("#btnCheckinNow").show() : $("#btnCheckinNow").hide() } function V() { var e = this, t = {}; e.omitSelf = !0, e.numberGuests = 0, e.idReservation = 0, e.go = function (a, i) { var r, s = $("#selResource"); if (0 === s.length) return; r = s.find("option:selected").val(), s.prop("disabled", !0), $("#hhk-roomChsrtitle").addClass("hhk-loading"), $("#hhkroomMsg").text("").hide(), t = {}, $("input.hhk-constraintsCB:checked").each((function () { t[$(this).data("cnid")] = "ON" })), $.post("ws_ckin.php", { cmd: "newConstraint", rid: e.idReservation, numguests: e.numberGuests, expArr: a, expDep: i, idr: r, cbRS: t, omsf: e.omitSelf }, (function (e) { var t; s.prop("disabled", !1), $("#hhk-roomChsrtitle").removeClass("hhk-loading"); try { e = $.parseJSON(e) } catch (e) { return void alert("Parser error - " + e.message) } if (e.error) return e.gotopage && window.location.assign(e.gotopage), void flagAlertMessage(e.error, "error"); e.rooms && H(e.rooms), e.selectr && (t = $(e.selectr), s.children().remove(), t.children().appendTo(s), s.val(e.idResource).change(), e.msg && "" !== e.msg && $("#hhkroomMsg").text(e.msg).show()) })) } } function q() { var e, t = {}, a = this; function i(a) { return !1 === r(a) && (t[a[e]] = a, !0) } function r(a) { return void 0 !== t[a[e]] } a.hasItem = r, a.findItem = function (e, a) { for (var i in t) if (t[i][e] == a) return t[i]; return null }, a.addItem = i, a.removeIndex = function (e) { delete t[e] }, a.list = function () { return t }, a.makeList = function (t, a) { for (var r in e = a, t) i(t[r]) }, a._list = t } function W(e, t) { "use strict"; $("input#txtPersonSearch").val(""), t.empty().append($(e.psgChooser)).dialog("option", "buttons", { Open: function () { $(this).dialog("close"), Z({ idPsg: t.find("input[name=cbselpsg]:checked").val(), id: e.id, cmd: "getResv" }) }, Cancel: function () { $(this).dialog("close"), $("input#gstSearch").val("").focus() } }).dialog("option", "title", e.patLabel + " Chooser" + (void 0 === e.fullName ? "" : " For: " + e.fullName)).dialog("open") } function Z(e) { e.guestSearchTerm && "" != e.guestSearchTerm && (G = e.guestSearchTerm); const t = { id: e.id, rid: e.rid, idPsg: e.idPsg, vid: e.vid, span: e.span, isCheckin: v, gstDate: e.gstDate, gstCoDate: e.gstCoDate, cmd: e.cmd }; $.post("ws_resv.php", t, (function (e) { try { e = $.parseJSON(e) } catch (e) { return void flagAlertMessage(e.message, "error") } e.gotopage && window.open(e.gotopage, "_self"), e.error && (flagAlertMessage(e.error, "error", O), $("#btnDone").val("Save " + n).show()), K(e) })) } function K(e) { if ((e.xfer || e.inctx || e.deluxehpf) && function (e, t) { paymentRedirect(e, $("#xform"), { resvId: t }) }(e, e.rid), e.deleted) return $("#guestSearch").hide(), $("#contentDiv").append("<p>" + e.deleted + "</p>"), e.childDeleted && e.childDeleted > 0 && $("#contentDiv").append("<p>Also deleted " + e.childDeleted + " child reservations.</p>"), void $("#spnStatus").text("Deleted"); e.resvChooser && "" !== e.resvChooser ? function (e, t, a) { "use strict"; var i = {}; $("input#txtPersonSearch").val(""), t.empty().append($(e.resvChooser)).children().find("input:button").button(), t.children().find(".hhk-checkinNow").click((function () { window.open("CheckingIn.php?rid=" + $(this).data("rid") + "&gid=" + e.id, "_self") })), e.psgChooser && "" !== e.psgChooser && (i[e.patLabel + " Chooser"] = function () { $(this).dialog("close"), W(e, a) }), e.resvTitle && (i["New " + e.resvTitle] = function () { e.rid = -1, e.cmd = "getResv", $(this).dialog("close"), Z(e) }), i.Exit = function () { $(this).dialog("close"), $("input#gstSearch").val("").focus() }, t.dialog("option", "width", "95%"), t.dialog("option", "buttons", i), t.dialog("option", "title", e.resvTitle + " Chooser"), t.dialog("open"); var r = t.find("table").width(); t.dialog("option", "width", r + 80) }(e, $("#resDialog"), $("#psgDialog")) : e.psgChooser && "" !== e.psgChooser ? W(e, $("#psgDialog")) : (e.idPsg && (g = e.idPsg), e.id && (k = e.id), e.rid && (m = e.rid), e.vid && (C = e.vid), e.span && (y = e.span), e.resvStatusCode, e.resvStatusType && (Y = e.resvStatusType), e.prePayment && (w = e.prePayment), void 0 !== e.hosp && L.setUp(e.hosp), e.famSection && (T.setUp(e), $("div#guestSearch").hide(), $("#btnDone").val("Save Family").show(), $("select.hhk-multisel").each((function () { $(this).multiselect({ selectedList: 3 }) }))), void 0 !== e.expDates && "" !== e.expDates && (B.openControl = !1, B.setUp(e.expDates, J, $("#datesSection"))), void 0 !== e.warning && "" !== e.warning && flagAlertMessage(e.warning, "warning", O), void 0 !== e.resv && (e.resv.rdiv.rooms && (_ = e.resv.rdiv.rooms), F.setUp(e), $("#" + T.divFamDetailId).on("change", ".hhk-cbStay", (function () { let e = T.findStaysChecked(); if (F.$totalGuests.text(e), e += T.findStays("r"), $("#selRateCategory").trigger("change"), $("#selResource").length > 0 && "0" !== $("#selResource").val()) { let t = "Room may be too small"; e > _[$("#selResource").val()].maxOcc ? $("#hhkroomMsg").text(t).show() : $("#hhkroomMsg").text() == t && $("#hhkroomMsg").text("").hide() } e > 0 ? F.$totalGuests.parent().removeClass("ui-state-highlight") : F.$totalGuests.parent().addClass("ui-state-highlight") })), $("#" + T.divFamDetailId).on("click", ".hhk-getVDialog", (function () { var e = $(this).data("vid"), t = $(this).data("span"); viewVisit(0, e, { "Show Statement": function () { window.open("ShowStatement.php?vid=" + e, "_blank") }, "Show Registration Form": function () { window.open("ShowRegForm.php?vid=" + e + "&span=" + t, "_blank") }, Save: function () { saveFees(0, e, t, !1, payFailPage) }, Cancel: function () { $(this).dialog("close") } }, "Edit Visit #" + e + "-" + t, "hf", t), $("#submitButtons").hide() })), $(".hhk-cbStay").change(), $("#btnDone").val(o).show(), e.rid > 0 && ($("#btnDelete").val("Delete " + n).show(), $("#btnShowReg").show(), $("#spnStatus").text("" === e.resv.rdiv.rStatTitle ? "" : " - " + e.resv.rdiv.rStatTitle)), j($("#gstDate").val(), e.rid, e.resv.rdiv.hideCiNowBtn), A = e.insistCkinDemog), void 0 !== e.addPerson && I.addItem(e.addPerson.mem) && (N.addItem(e.addPerson.addrs), T.newGuestMarkup(e.addPerson, e.addPerson.mem.pref), T.findStaysChecked(), $(".hhk-cbStay").change(), $("#txtPersonSearch").val(""), "" === $("#" + e.addPerson.mem.pref + "txtLastName").val() && $("#" + e.addPerson.mem.pref + "txtLastName").val(U("last")).focus(), "" === $("#" + e.addPerson.mem.pref + "txtFirstName").val() && $("#" + e.addPerson.mem.pref + "txtFirstName").val(U("first")).focus()), $("#submitButtons").show()) } a.getReserve = Z, a.verifyInput = function () { if (O.text("").hide(), !1 === B.verify()) return !1; if (!1 === T.verify()) return !1; if (!1 === L.verify()) return !1; if (!0 === F.setupComplete && !1 === F.verify()) return !1; return !0 }, a.loadResv = K, a.deleteReserve = function () { if (w > 0 && "" == $("#selexcpay").val()) return isCheckedOut ? ($("#selexcpay").addClass("ui-state-error"), flagAlertMessage("Determine how to handle the pre-payment.", "alert", O), $("#payChooserMsg").text("Determine how to handle the pre-payment.").show(), !1) : ($("#selexcpay").removeClass("ui-state-error"), isCheckedOut = !0, $("#cbHeld").prop("checked", !0), amtPaid(), !1); return !0 }, a.resvTitle = n, a.people = I, a.addrs = N, a.getIdPsg = function () { return g }, a.getIdResv = function () { return m }, a.getIdName = function () { return k }, a.getIdVisit = function () { return C }, a.getPrePaymtAmt = function () { return w }, a.getSpan = function () { return y }, a.setRooms = H, a.options = t }