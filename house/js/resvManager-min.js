function resvManager(e){var t=this,S=e.patLabel,i=e.resvTitle,a=e.saveButtonLabel,A=e.patBD,D=e.patAddr,R=e.gstAddr,M=e.patAsGuest,P=void 0!==e.emergencyContact&&e.emergencyContact,_=void 0!==e.isCheckin&&e.isCheckin,N=e.addrPurpose,r=e.idPsg,g=e.rid,s=e.id,n=e.vid,o=e.span,I=new p,E=new p,m=new function(h){var c,e=this,p="divfamDetail",u=!1;function v(){var t=0;return $(".hhk-cbStay").each(function(){var e=$(this).data("prefix");$(this).prop("checked")?(I.list()[e].stay="1",t++):I.list()[e].stay="0"}),t}function f(){var e=$("input[type=radio][name=rbPriGuest]:checked").val();for(var t in I.list())I.list()[t].pri="0";void 0!==e&&(I.list()[e].pri="1")}function g(e){var t=$("#divfamDetail");!0===e?(t.show("blind"),t.prev("div").removeClass("ui-corner-all").addClass("ui-corner-top")):(t.hide("blind"),t.prev("div").addClass("ui-corner-all").removeClass("ui-corner-top"))}function m(e){"use strict";$("#ecSearch").dialog("close");var t=parseInt(e.id,10);if(!1===isNaN(t)&&0<t){var a=$("#hdnEcSchPrefix").val();if(""==a)return;$("#"+a+"txtEmrgFirst").val(e.first),$("#"+a+"txtEmrgLast").val(e.last),$("#"+a+"txtEmrgPhn").val(e.phone),$("#"+a+"txtEmrgAlt").val(""),$("#"+a+"selEmrgRel").val("")}}function C(e){var t=/^([\(]{1}[0-9]{3}[\)]{1}[\.| |\-]{0,1}|^[0-9]{3}[\.|\-| ]?)?[0-9]{3}(\.|\-| )?[0-9]{4}$/,a=!1;return 0<$("#"+e+"incomplete").length&&!1===$("#"+e+"incomplete").prop("checked")&&($("."+e+"hhk-addr-val").not(".hhk-MissingOk").each(function(){""!==$(this).val()||$(this).hasClass("bfh-states")?$(this).removeClass("ui-state-error"):($(this).addClass("ui-state-error"),a=!0)}),a)?($("#"+e+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+e+"toggleAddr").click(),"Some or all of the indicated addresses are missing.  "):($('.hhk-phoneInput[id^="'+e+'txtPhone"]').each(function(){""!==$.trim($(this).val())&&!1===t.test($(this).val())?($(this).addClass("ui-state-error"),$("#"+e+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+e+"toggleAddr").click(),$("#"+e+"phEmlTabs").tabs("option","active",1),a=!0):$(this).removeClass("ui-state-error")}),"")}function y(e){var t=!1,a=$("#"+e+"txtEmrgFirst"),i=$("#"+e+"txtEmrgLast"),r=$("#"+e+"txtEmrgPhn"),s=$("#"+e+"selEmrgRel");return a.removeClass("ui-state-error"),i.removeClass("ui-state-error"),r.removeClass("ui-state-error"),s.removeClass("ui-state-error"),0<$("#"+e+"cbEmrgLater").length&&!1===$("#"+e+"cbEmrgLater").prop("checked")&&(""===a.val()&&""===i.val()&&(a.addClass("ui-state-error"),i.addClass("ui-state-error"),t=!0),""===r.val()&&(r.addClass("ui-state-error"),t=!0),""===s.val()&&(s.addClass("ui-state-error"),t=!0),t)?"Some or all of the indicated Emergency Contact Information is missing.  ":""}function k(e){return!(void 0===e||!e||""==e)&&(""!==$("#"+e+"adraddress1"+N).val()&&""!==$("#"+e+"adrzip"+N).val()&&""!==$("#"+e+"adrstate"+N).val()&&""!==$("#"+e+"adrcity"+N).val())}function b(e,t){var a=$('<select id="selAddrch" multiple="multiple"/>'),i=0,r=[];for(var s in E.list())if(""!=E.list()[s].Address_1||""!=E.list()[s].Postal_Code){for(var n=!0,o=E.list()[s].Address_1+", "+(""==E.list()[s].Address_2?"":E.list()[s].Address_2+", ")+E.list()[s].City+", "+E.list()[s].State_Province+"  "+E.list()[s].Postal_Code,d=0;d<=r.length;d++)r[d]!=o||(n=!1);n&&(r[i]=o,i++,$('<option value="'+s+'">'+o+"</option>").appendTo(a))}if(0<i){a.prop("size",i+1).prepend($('<option value="0" >(Cancel)</option>')),a.change(function(){!function(e,t){if(0==t)return $("#divSelAddr").remove();$("#"+e+"adraddress1"+N).val(E.list()[t].Address_1),$("#"+e+"adraddress2"+N).val(E.list()[t].Address_2),$("#"+e+"adrcity"+N).val(E.list()[t].City),$("#"+e+"adrcounty"+N).val(E.list()[t].County),$("#"+e+"adrzip"+N).val(E.list()[t].Postal_Code),$("#"+e+"adrcountry"+N).val()!=E.list()[t].Country_Code&&$("#"+e+"adrcountry"+N).val(E.list()[t].Country_Code).change();$("#"+e+"adrstate"+N).val(E.list()[t].State_Province),k(e)&&!0===$("#"+e+"incomplete").prop("checked")&&$("#"+e+"incomplete").prop("checked",!1);w($("#"+e+"liaddrflag")),$("#divSelAddr").remove()}(t,$(this).val())});var l=$('<div id="divSelAddr" style="position:absolute; vertical-align:top;" class="hhk-addrPicker"/>').append($("<p>Choose an Address: </p>")).append(a).appendTo($("body"));l.position({my:"left top",at:"right center",of:e})}}function x(e){void 0!==e&&(E.list()[e].Address_1=$("#"+e+"adraddress1"+N).val(),E.list()[e].Address_2=$("#"+e+"adraddress2"+N).val(),E.list()[e].City=$("#"+e+"adrcity"+N).val(),E.list()[e].County=$("#"+e+"adrcounty"+N).val(),E.list()[e].State_Province=$("#"+e+"adrstate"+N).val(),E.list()[e].Country_Code=$("#"+e+"adrcountry"+N).val(),E.list()[e].Postal_Code=$("#"+e+"adrzip"+N).val(),w($("#"+e+"liaddrflag")))}function w(e){var t=e.data("pref");!0===$("#"+t+"incomplete").prop("checked")?(e.show().find("span").removeClass("ui-icon-alert").addClass("ui-icon-check").attr("title","Incomplete Address is checked"),e.removeClass("ui-state-error").addClass("ui-state-highlight")):k(t)?e.hide():(e.show().find("span").removeClass("ui-icon-check").addClass("ui-icon-alert").attr("title","Address is Incomplete"),e.removeClass("ui-state-highlight").addClass("ui-state-error"))}e.findStaysChecked=v,e.findPrimaryGuest=f,e.setUp=function(t){var e;if(void 0===t.famSection||void 0===t.famSection.tblId||""===t.famSection.tblId)return;!1===u&&(a=t,i=$("<div/>").addClass("ui-widget-content ui-corner-bottom hhk-tdbox").prop("id",p).css("padding","5px"),c=$("<table/>").prop("id",a.famSection.tblId).addClass("hhk-table").append($("<thead/>").append($(a.famSection.tblHead))).append($("<tbody/>")),i.append(c).append($(a.famSection.adtnl)),s=$("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='f_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),(r=$('<div id="divfamHdr" style="padding:2px; cursor:pointer;"/>').append($(a.famSection.hdr)).append(s).append('<div style="clear:both;"/>')).addClass("ui-widget-header ui-state-default ui-corner-top"),r.click(function(){"none"===i.css("display")?(i.show("blind"),r.removeClass("ui-corner-all").addClass("ui-corner-top")):(i.hide("blind"),r.removeClass("ui-corner-top").addClass("ui-corner-all"))}),h.empty().append(r).append(i).show());var a,i,r,s;for(var n in t.famSection.mem){var o=I.findItem("pref",t.famSection.mem[n].pref);o&&(c.find("tr#"+o.id+"n").remove(),c.find("tr#"+o.id+"a").remove(),c.find("input#"+o.pref+"idName").parents("tr").next("tr").remove(),c.find("input#"+o.pref+"idName").parents("tr").remove(),I.removeIndex(o.pref),E.removeIndex(o.pref))}I.makeList(t.famSection.mem,"pref"),E.makeList(t.famSection.addrs,"pref"),void 0!==t.famSection.tblBody[1]&&c.find("tbody:first").prepend($(t.famSection.tblBody[1]));void 0!==t.famSection.tblBody[0]&&c.find("tbody:first").prepend($(t.famSection.tblBody[0]));for(var d in t.famSection.tblBody)"0"!==d&&"1"!==d&&c.find("tbody:first").append($(t.famSection.tblBody[d]));$(".hhk-cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),$(".hhk-lblStay").each(function(){"1"==$(this).data("stay")&&$(this).click()}),$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,maxDate:0,dateFormat:"M d, yy"}),$(".hhk-addrPanel").find("select.bfh-countries").each(function(){var e=$(this);e.bfhcountries(e.data()),$(this).data("dirrty-initial-value",$(this).data("country"))}),$(".hhk-addrPanel").find("select.bfh-states").each(function(){var e=$(this);e.bfhstates(e.data()),$(this).data("dirrty-initial-value",$(this).data("state"))}),$(".hhk-phemtabs").tabs(),verifyAddrs("#divfamDetail"),$("input.hhk-zipsearch").each(function(){createZipAutoComplete($(this),"ws_admin.php",void 0,x)}),!1===u&&($("#lnCopy").click(function(){var e=$("input.hhk-lastname").first().val();$("input.hhk-lastname").each(function(){""===$(this).val()&&$(this).val(e)})}),$("#adrCopy").click(function(){var e=$("li.hhk-AddrFlag").first().data("pref");!function(e){for(var t in E.list())e!=t&&(""!==$("#"+t+"adraddress1"+N).val()&&""!==$("#"+t+"adrzip"+N).val()||($("#"+t+"adraddress1"+N).val(E.list()[e].Address_1),$("#"+t+"adraddress2"+N).val(E.list()[e].Address_2),$("#"+t+"adrcity"+N).val(E.list()[e].City),$("#"+t+"adrcounty"+N).val(E.list()[e].County),$("#"+t+"adrzip"+N).val(E.list()[e].Postal_Code),$("#"+t+"adrcountry"+N).val()!=E.list()[e].Country_Code&&$("#"+t+"adrcountry"+N).val(E.list()[e].Country_Code).change(),$("#"+t+"adrstate"+N).val(E.list()[e].State_Province),!0===$("#"+e+"incomplete").prop("checked")?$("#"+t+"incomplete").prop("checked",!0):k(t)&&!0===$("#"+t+"incomplete").prop("checked")&&$("#"+t+"incomplete").prop("checked",!1),w($("#"+t+"liaddrflag"))))}(e)}),$("#"+p).on("click",".hhk-togAddr",function(){e=$(this),$(this).siblings(),"none"===$(this).parents("tr").next("tr").css("display")?($(this).parents("tr").next("tr").show(),e.find("span").removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"),e.attr("title","Hide Address Section")):($(this).parents("tr").next("tr").hide(),e.find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),e.attr("title","Show Address Section"))}),$("#"+p).on("click",".hhk-AddrFlag",function(){$("#"+$(this).data("pref")+"incomplete").click()}),$("#"+p).on("change",".hhk-copy-target",function(){x($(this).data("pref"))}),$("#"+p).on("click",".hhk-addrCopy",function(){b($(this),$(this).data("prefix"))}),$("#"+p).on("click",".hhk-addrErase",function(){var e;e=$(this).data("prefix"),$("#"+e+"adraddress1"+N).val(""),$("#"+e+"adraddress2"+N).val(""),$("#"+e+"adrcity"+N).val(""),$("#"+e+"adrcounty"+N).val(""),$("#"+e+"adrstate"+N).val(""),$("#"+e+"adrcountry"+N).val(""),$("#"+e+"adrzip"+N).val(""),w($("#"+e+"liaddrflag"))}),$("#"+p).on("click",".hhk-incompleteAddr",function(){w($("#"+$(this).data("prefix")+"liaddrflag"))}),$("#"+p).on("click",".hhk-removeBtn",function(){(""===$("#"+$(this).data("prefix")+"txtFirstName").val()&&""===$("#"+$(this).data("prefix")+"txtLastName").val()||!1!==confirm("Remove this person: "+$("#"+$(this).data("prefix")+"txtFirstName").val()+" "+$("#"+$(this).data("prefix")+"txtLastName").val()+"?"))&&(I.removeIndex($(this).data("prefix")),E.removeIndex($(this).data("prefix")),$(this).parentsUntil("tbody","tr").next().remove(),$(this).parentsUntil("tbody","tr").remove())}),$("#"+p).on("change",".patientRelch",function(){"slf"===$(this).val()?I.list()[$(this).data("prefix")].role="p":I.list()[$(this).data("prefix")].role="g"}),createAutoComplete($("#txtPersonSearch"),3,{cmd:"role",gp:"1"},function(e){!function(e,t){if(void 0!==e.No_Return&&""!==e.No_Return)return flagAlertMessage("This person is set for No Return: "+e.No_Return+".","alert");if(void 0===e.id)return;if(0<e.id&&null!==I.findItem("id",e.id))return flagAlertMessage("This person is already listed here. ","alert");V({id:e.id,rid:t.rid,idPsg:t.idPsg,isCheckin:_,cmd:"addResvGuest"})}(e,t)}),$("#"+p).on("click",".hhk-emSearch",function(){$("#hdnEcSchPrefix").val($(this).data("prefix")),$("#ecSearch").dialog("open")}),createAutoComplete($("#txtemSch"),3,{cmd:"filter",add:"phone",basis:"g"},m),$("ul.hhk-ui-icons li").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}));for(var l in I.list())w($("#"+l+"liaddrflag"));$(".hhk-togAddr").each(function(){$(this).parents("tr").next("tr").hide(),$(this).find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),$(this).attr("title","Show Address Section")}),u=!0},e.newGuestMarkup=function(e,t){var a,i,r,s,n;if(void 0===e.tblId||""==e.tblId)return;if(0===c.length)return;r=c.children("tbody").children("tr").last().hasClass("odd")?"even":"odd";c.find("tbody:first").append($(e.ntr).addClass(r)).append($(e.atr).addClass(r)),$("#"+t+"cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),"1"==$("#"+t+"lblStay").data("stay")&&$("#"+t+"lblStay").click();$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,maxDate:0,dateFormat:"M d, yy"}),s=$("#"+t+"liaddrflag"),n=s.siblings(),w(s),n.parents("tr").next("tr").hide(),n.find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),n.attr("title","Show Address Section"),(a=$("#"+t+"adrcountry"+N)).bfhcountries(a.data()),$(this).data("dirrty-initial-value",$(this).data("country")),(i=$("#"+t+"adrstate"+N)).bfhstates(i.data()),$(this).data("dirrty-initial-value",$(this).data("state")),$("#"+t+"phEmlTabs").tabs(),$("input#"+t+"adrzip1").each(function(){createZipAutoComplete($(this),"ws_admin.php",void 0,x)})},e.verify=function(){var e=0,t=0,a=0,i=0,r=!1,s=0;for(var n in $(".patientRelch").removeClass("ui-state-error"),$(".patientRelch").each(function(){if(""===$(this).val())return $(this).addClass("ui-state-error"),flagAlertMessage("Set the highlighted Relationship.","alert"),!1}),f(),v(),I.list())e++,"p"===I.list()[n].role&&t++,"1"===I.list()[n].stay&&a++,"1"===I.list()[n].pri&&i++,$("#"+n+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-n")&&$("#"+n+"toggleAddr").click();{if(t<1)return flagAlertMessage("Choose a "+S+".","alert"),$(".patientRelch").addClass("ui-state-error"),!1;if(1<t){for(var n in flagAlertMessage("Only 1 "+S+" is allowed.","alert"),I.list())"p"===I.list()[n].role&&$("#"+n+"selPatRel").addClass("ui-state-error");return!1}}if(a<1)return flagAlertMessage("There is no one actually staying.  Pick someone to stay.","alert"),!1;if(0===i&&1===e)for(var n in I.list())I.list()[n].pri="1";else if(0===i)return flagAlertMessage("Set one guest as primary guest.","alert"),!1;if(h.find(".hhk-lastname").each(function(){""==$(this).val()?($(this).addClass("ui-state-error"),r=!0):$(this).removeClass("ui-state-error")}),h.find(".hhk-firstname").each(function(){""==$(this).val()?($(this).addClass("ui-state-error"),r=!0):$(this).removeClass("ui-state-error")}),!0===r)return g(!0),flagAlertMessage("Enter a first and last name for the people highlighted.","alert"),!1;P&&h.find(".hhk-EmergCb").each(function(){var e=y($(this).data("prefix"));!0!==$(this).prop("checked")&&""!==e||s++});for(var o in I.list()){if("p"===I.list()[o].role){if(A&""===$("#"+o+"txtBirthDate").val())return $("#"+o+"txtBirthDate").addClass("ui-state-error"),flagAlertMessage(S+" is missing the Birth Date.","alert"),g(!0),!1;if($("#"+o+"txtBirthDate").removeClass("ui-state-error"),D||M){var d=C(o);if(""!==d)return flagAlertMessage(d,"alert"),g(!0),$("#"+o+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+o+"toggleAddr").click(),!1}}else{if(""===$("#"+o+"selPatRel").val())return $("#"+o+"selPatRel").addClass("ui-state-error"),flagAlertMessage("Person highlighted is missing their "+S+" Relationship.","alert"),g(!0),!1;if($("#"+o+"selPatRel").removeClass("ui-state-error"),R){var d=C(o);if(""!==d)return flagAlertMessage(d,"alert"),g(!0),$("#"+o+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+o+"toggleAddr").click(),!1}}if(0<$("#"+o+"txtBirthDate").length&&""!==$("#"+o+"txtBirthDate").val()){var l=new Date($("#"+o+"txtBirthDate").val()),c=new Date;if(c<l)return $("#"+o+"txtBirthDate").addClass("ui-state-error"),flagAlertMessage("This birth date cannot be in the future.","alert"),g(!0),!1;$("#"+o+"txtBirthDate").removeClass("ui-state-error")}if(P&&s<1){var d=y(o);if(""!==d)return flagAlertMessage(d,"alert"),g(!0),$("#"+o+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+o+"toggleAddr").click(),!1}}return!(u=!1)},e.divFamDetailId=p,e.$famTbl=c}($("#famSection")),d=new function(c){var h,p,u,v,f=this;function a(e){"use strict";var t="";return""===$("#car"+e+"txtVehLic").val()&&""===$("#car"+e+"txtVehMake").val()?"Enter vehicle info or check the 'No Vehicle' checkbox. ":(""===$("#car"+e+"txtVehLic").val()?(""===$("#car"+e+"txtVehModel").val()&&($("#car"+e+"txtVehModel").addClass("ui-state-highlight"),t="Enter Model"),""===$("#car"+e+"txtVehColor").val()&&($("#car"+e+"txtVehColor").addClass("ui-state-highlight"),t="Enter Color"),""===$("#car"+e+"selVehLicense").val()&&($("#car"+e+"selVehLicense").addClass("ui-state-highlight"),t="Enter state license plate registration")):""===$("#car"+e+"txtVehMake").val()&&""===$("#car"+e+"txtVehLic").val()&&($("#car"+e+"txtVehLic").addClass("ui-state-highlight"),t="Enter a license plate number."),t)}f.setupComplete=!1,f.checkPayments=!0,f.setUp=function(t){(h=$('<div id="divResvDetail" style="padding:2px; float:left; width: 100%;" class="ui-widget-content ui-corner-bottom hhk-tdbox"/>')).append($(t.resv.rdiv.rChooser)),void 0!==t.resv.rdiv.rate&&h.append($(t.resv.rdiv.rate));void 0!==t.resv.rdiv.rstat&&h.append($(t.resv.rdiv.rstat));void 0!==t.resv.rdiv.vehicle&&(p=$(t.resv.rdiv.vehicle),h.append(p),a=1,i=(e=p).find("#cbNoVehicle"),r=e.find("#btnNextVeh"),s=e.find("#tblVehicle"),i.change(function(){this.checked?s.hide("scale, horizontal"):s.show("scale, horizontal")}),i.change(),r.button(),r.click(function(){e.find("#trVeh"+a).show("fade"),4<++a&&r.hide("fade")}));var e,a,i,r,s;void 0!==t.resv.rdiv.pay&&h.append($(t.resv.rdiv.pay));void 0!==t.resv.rdiv.notes&&h.append((n=t.rid,(o=$(t.resv.rdiv.notes)).notesViewer({linkId:n,linkType:"reservation",newNoteAttrs:{id:"taNewNote",name:"taNewNote"},alertMessage:function(e,t){flagAlertMessage(e,t)}}),o));var n,o;void 0!==t.resv.rdiv.wlnotes&&h.append($(t.resv.rdiv.wlnotes));v=$("<ul style='list-style-type:none; float:right; margin-left:5px; padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='r_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),(u=$('<div id="divResvHdr" style="padding:2px; cursor:pointer;"/>').append($(t.resv.hdr)).append(v).append('<div style="clear:both;"/>')).addClass("ui-widget-header ui-state-default ui-corner-top"),u.click(function(e){var t=$(e.target);"divResvHdr"!==t[0].id&&"r_drpDown"!==t[0].id||("none"===h.css("display")?(h.show("blind"),u.removeClass("ui-corner-all").addClass("ui-corner-top")):(h.hide("blind"),u.removeClass("ui-corner-top").addClass("ui-corner-all")))}),c.empty().append(u).append(h).show(),f.$totalGuests=$("#spnNumGuests"),f.origRoomId=$("#selResource").val(),f.checkPayments=!0,0<$(".hhk-viewResvActivity").length&&$(".hhk-viewResvActivity").click(function(){$.post("ws_ckin.php",{cmd:"viewActivity",rid:$(this).data("rid")},function(e){if((e=$.parseJSON(e)).error)return e.gotopage&&window.open(e.gotopage,"_self"),void flagAlertMessage(e.error,"error");e.activity&&($("div#submitButtons").hide(),$("#activityDialog").children().remove(),$("#activityDialog").append($(e.activity)),$("#activityDialog").dialog("open"))})});$("#btnShowCnfrm").button().click(function(){var e=$("#spnAmount").text();""===e&&(e=0),$.post("ws_ckin.php",{cmd:"confrv",rid:$(this).data("rid"),amt:e,eml:"0"},function(e){if((t=$.parseJSON(e)).error)return t.gotopage&&window.open(t.gotopage,"_self"),void flagAlertMessage(t.error,"error");t.confrv&&($("div#submitButtons").hide(),$("#frmConfirm").children().remove(),$("#frmConfirm").html(t.confrv).append($('<div style="padding-top:10px;" class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><span>Email Address </span><input type="text" id="confEmail" value="'+t.email+'"/></div>')),$("#confirmDialog").dialog("open"))})}),d=t.rid,y.idReservation=d,$("input.hhk-constraintsCB").change(function(){y.go($("#gstDate").val(),$("#gstCoDate").val())}),void 0!==t.resv.rdiv.rate&&function(e){var t={},a=c.find("#btnFapp");0<a.length&&($("#faDialog").dialog({autoOpen:!1,resizable:!0,width:680,modal:!0,title:"Income Chooser",close:function(){$("div#submitButtons").show()},open:function(){$("div#submitButtons").hide()},buttons:{Save:function(){$.post("ws_ckin.php",$("#formf").serialize()+"&cmd=savefap&rid="+e.rid,function(e){try{e=$.parseJSON(e)}catch(e){return void alert("Bad JSON Encoding")}if(e.gotopage&&window.open(e.gotopage,"_self"),e.rstat&&1==e.rstat){var t=$("#selRateCategory");e.rcat&&""!=e.rcat&&0<t.length&&(t.val(e.rcat),t.change())}}),$(this).dialog("close")},Exit:function(){$(this).dialog("close")}}}),a.button().click(function(){getIncomeDiag(e.rid)}));t.rateList=e.resv.rdiv.ratelist,t.resources=e.resv.rdiv.rooms,t.visitFees=e.resv.rdiv.vfee,t.idResv=g,setupRates(t),$("#selResource").change(function(){$("#selRateCategory").change();var e=$("option:selected",this),t=e.parent()[0].label;null==t?$("#hhkroomMsg").hide():$("#hhkroomMsg").text(t).show()})}(t);var d;void 0!==t.resv.rdiv.pay&&(l=t,$("#paymentDate").datepicker({yearRange:"-1:+00",numberOfMonths:1}),setupPayments(l.resv.rdiv.rooms,$("#selResource"),$("#selRateCategory")));var l;0<$("#addGuestHeader").length&&((C=new k($("#addGuestHeader"))).openControl=!0,C.setUp(t.resv.rdiv,b),y.omitSelf=!1,y.idReservation=0,f.checkPayments=!1,$("#selResource").change(function(){""!==$("#gstDate").val()&&""!==$("#gstCoDate").val()&&($(this).val()!==f.origRoomId?($("#divRateChooser").show(),$("#divPayChooser").show(),f.checkPayments=!0):($("#divRateChooser").hide(),$("#divPayChooser").hide(),f.checkPayments=!1))}),$("#"+m.divFamDetailId).on("change",".hhk-cbStay",function(){y.numberGuests=m.findStaysChecked()}));f.setupComplete=!0},f.verify=function(){if(0<$("#cbNoVehicle").length){if(!1===$("#cbNoVehicle").prop("checked")){var e=a(1);if(""!=e){var t=a(2);if(""!=t)return $("#vehValidate").text(t),flagAlertMessage(e,"alert"),!1}}$("#vehValidate").text("")}if(_&&!0===f.checkPayments){if($("#selCategory").val()==fixedRate&&0<$("#txtFixedRate").length&&""==$("#txtFixedRate").val())return flagAlertMessage("Set the Room Rate to an amount, or to 0.","alert"),$("#txtFixedRate").addClass("ui-state-error"),!1;if($("#txtFixedRate").removeClass("ui-state-error"),0<$("input#feesPayment").length&&""==$("input#feesPayment").val())return $("#payChooserMsg").text("Set the Room Fees to an amount, or 0.").show("fade"),$("input#feesPayment").addClass("ui-state-error"),!1;if($("input#feesPayment").removeClass("ui-state-error"),void 0!==verifyAmtTendrd&&!1===verifyAmtTendrd())return!1}return!0}}($("#resvSection")),l=new function(r){var s=this;s.setupComplete=!1,s.setUp=function(e){var t=$(e.div).addClass("ui-widget-content").prop("id","divhospDetail").hide(),a=$("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='h_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),i=$('<div id="divhospHdr" style="padding:2px; cursor:pointer;"/>').append($(e.hdr)).append(a).append('<div style="clear:both;"/>');i.addClass("ui-widget-header ui-state-default ui-corner-all"),i.click(function(){"none"===t.css("display")?(t.show("blind"),i.removeClass("ui-corner-all").addClass("ui-corner-top")):(t.hide("blind"),i.removeClass("ui-corner-top").addClass("ui-corner-all"))}),r.empty().append(i).append(t),$("#txtEntryDate, #txtExitDate").datepicker({yearRange:"-01:+01",changeMonth:!0,changeYear:!0,autoSize:!0,dateFormat:"M d, yy"}),0<$("#txtAgentSch").length&&(createAutoComplete($("#txtAgentSch"),3,{cmd:"filter",basis:"ra"},getAgent),""===$("#a_txtLastName").val()&&$(".hhk-agentInfo").hide()),0<$("#txtDocSch").length&&(createAutoComplete($("#txtDocSch"),3,{cmd:"filter",basis:"doc"},getDoc),""===$("#d_txtLastName").val()&&$(".hhk-docInfo").hide()),verifyAddrs("#divhospDetail"),r.on("change","#selHospital, #selAssoc",function(){var e=$("#selAssoc").find("option:selected").text();""!=e&&(e+="/ "),$("span#spnHospName").text(e+$("#selHospital").find("option:selected").text())}),r.show(),""===$("#selHospital").val()&&i.click(),s.setupComplete=!0},s.verify=function(){return r.find(".ui-state-error").each(function(){$(this).removeClass("ui-state-error")}),0<$("#selHospital").length&&!0===s.setupComplete&&""==$("#selHospital").val()?($("#selHospital").addClass("ui-state-error"),flagAlertMessage("Select a hospital.","alert"),$("#divhospDetail").show("blind"),$("#divhospHdr").removeClass("ui-corner-all").addClass("ui-corner-top"),!1):($("#divhospDetail").hide("blind"),$("#divhospHdr").removeClass("ui-corner-top").addClass("ui-corner-all"),!0)}}($("#hospitalSection")),C=new k($("#datesSection")),y=new y;function c(e){e}function k(t){var o=this;o.setupComplete=!1,o.ciDate=new Date,o.coDate=new Date,o.openControl=!1,o.setUp=function(i,r){if(t.empty(),i.mu&&""!==i.mu){t.append($(i.mu));var s=$("#gstDate"),n=$("#gstCoDate"),e=parseInt(i.defdays,10);(isNaN(e)||e<1)&&(e=21),$("#spnRangePicker").dateRangePicker({format:"MMM D, YYYY",separator:" to ",minDays:1,autoClose:!0,showShortcuts:!0,shortcuts:{"next-days":[e]},getValue:function(){return s.val()&&n.val()?s.val()+" to "+n.val():""},setValue:function(e,t,a){s.val(t),n.val(a)}}).bind("datepicker-change",function(e,t){var a=Math.ceil((t.date2.getTime()-t.date1.getTime())/864e5);$("#"+i.daysEle).val(a),0<$("#spnNites").length&&$("#spnNites").text(a),$.isFunction(r)&&r(t)}),t.show(),o.openControl&&$("#spnRangePicker").data("dateRangePicker").open()}setupComplete=!0},o.verify=function(){var e=$("#gstDate"),t=$("#gstCoDate");if(e.removeClass("ui-state-error"),t.removeClass("ui-state-error"),""===e.val())return e.addClass("ui-state-error"),flagAlertMessage("This "+i+" is missing the check-in date.","alert"),!1;if(o.ciDate=new Date(e.val()),isNaN(o.ciDate.getTime()))return e.addClass("ui-state-error"),flagAlertMessage("This "+i+" is missing the check-in date.","alert"),!1;if(void 0!==_&&!0===_){var a=moment($("#gstDate").val(),"MMM D, YYYY");if(moment().endOf("date")<a)return e.addClass("ui-state-error"),flagAlertMessage("Set the Check in date to today or earlier.","alert"),!1}return""===t.val()?(t.addClass("ui-state-error"),flagAlertMessage("This "+i+" is missing the expected departure date.","alert"),!1):(o.coDate=new Date(t.val()),isNaN(o.coDate.getTime())?(t.addClass("ui-state-error"),flagAlertMessage("This "+i+" is missing the expected departure date","alert"),!1):!(o.ciDate>o.coDate)||(e.addClass("ui-state-error"),flagAlertMessage("This "+i+"'s check-in date is after the expected departure date.","alert"),!1))}}function b(e){var t=!1;for(var a in I.list())0<I.list()[a].id&&(t=!0);if(t){$(".hhk-stayIndicate").hide().parent("td").addClass("hhk-loading");var i={cmd:"updateAgenda",idPsg:r,idResv:g,idVisit:n,dt1:e.date1.toUTCString(),dt2:e.date2.toUTCString(),mems:I.list()};$.post("ws_resv.php",i,function(e){$(".hhk-stayIndicate").show().parent("td").removeClass("hhk-loading");try{e=$.parseJSON(e)}catch(e){return void flagAlertMessage(e.message,"error")}if(e.gotopage&&window.open(e.gotopage,"_self"),e.error&&flagAlertMessage(e.error,"error"),e.stayCtrl){for(var t in e.stayCtrl){var a;$("#sb"+t).empty().html(e.stayCtrl[t].ctrl),$("#"+t+"cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),I.list()[t].stay="0",0<(a=$("#"+t+"lblStay")).length&&"1"==a.data("stay")&&a.click()}$(".hhk-getVDialog").button(),""!=$("#gstDate").val()&&""!=$("#gstCoDate").val()&&y.go($("#gstDate").val(),$("#gstCoDate").val())}})}h(e.date1.t,g)}function h(e,t){var a=moment(e,"MMM D, YYYY"),i=moment().endOf("date");0<t&&a<=i?$("#btnCheckinNow").show():$("#btnCheckinNow").hide()}function y(){var r=this,s={};r.omitSelf=!0,r.numberGuests=0,r.idReservation=0,r.go=function(e,t){var a,i=$("#selResource");if(0===i.length)return;a=i.find("option:selected").val(),i.prop("disabled",!0),$("#hhk-roomChsrtitle").addClass("hhk-loading"),$("#hhkroomMsg").text("").hide(),s={},$("input.hhk-constraintsCB:checked").each(function(){s[$(this).data("cnid")]="ON"}),$.post("ws_ckin.php",{cmd:"newConstraint",rid:r.idReservation,numguests:r.numberGuests,expArr:e,expDep:t,idr:a,cbRS:s,omsf:r.omitSelf},function(e){var t;i.prop("disabled",!1),$("#hhk-roomChsrtitle").removeClass("hhk-loading");try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}if(e.error)return e.gotopage&&window.location.assign(e.gotopage),void flagAlertMessage(e.error,"error");e.selectr&&(t=$(e.selectr),i.children().remove(),t.children().appendTo(i),i.val(e.idResource).change(),e.msg&&""!==e.msg&&$("#hhkroomMsg").text(e.msg).show()),e.rooms&&c(e.rooms)})}}function p(){var i,r={},e=this;function s(e){return!1===t(e)&&(r[e[i]]=e,!0)}function t(e){return void 0!==r[e[i]]}e.hasItem=t,e.findItem=function(e,t){for(var a in r)if(r[a][e]==t)return r[a];return null},e.addItem=s,e.removeIndex=function(e){delete r[e]},e.list=function(){return r},e.makeList=function(e,t){for(var a in i=t,e)s(e[a])},e._list=r}function u(e,t){"use strict";$("input#txtPersonSearch").val(""),t.empty().append($(e.psgChooser)).dialog("option","buttons",{Open:function(){$(this).dialog("close"),V({idPsg:t.find("input[name=cbselpsg]:checked").val(),id:e.id,cmd:"getResv"})},Cancel:function(){$(this).dialog("close"),$("input#gstSearch").val("").focus()}}).dialog("option","title",e.patLabel+" Chooser"+(void 0===e.fullName?"":" For: "+e.fullName)).dialog("open")}function V(e){var t={id:e.id,rid:e.rid,idPsg:e.idPsg,vid:e.vid,span:e.span,isCheckin:_,cmd:e.cmd};$.post("ws_resv.php",t,function(e){try{e=$.parseJSON(e)}catch(e){return void flagAlertMessage(e.message,"error")}e.gotopage&&window.open(e.gotopage,"_self"),e.error&&(flagAlertMessage(e.error,"error"),$("#btnDone").val("Save "+i).show()),v(e)})}function v(e){e.xfer&&paymentRedirect(e,$("#xform")),e.resvChooser&&""!==e.resvChooser?function(e,t,a){"use strict";var i={};$("input#txtPersonSearch").val(""),t.empty().append($(e.resvChooser)).children().find("input:button").button(),t.children().find(".hhk-checkinNow").click(function(){window.open("CheckingIn.php?rid="+$(this).data("rid")+"&gid="+e.id,"_self")}),e.psgChooser&&""!==e.psgChooser&&(i[e.patLabel+" Chooser"]=function(){$(this).dialog("close"),u(e,a)}),e.resvTitle&&(i["New "+e.resvTitle]=function(){e.rid=-1,e.cmd="getResv",$(this).dialog("close"),V(e)}),i.Exit=function(){$(this).dialog("close"),$("input#gstSearch").val("").focus()},t.dialog("option","width","95%"),t.dialog("option","buttons",i),t.dialog("option","title",e.resvTitle+" Chooser"),t.dialog("open");var r=t.find("table").width();t.dialog("option","width",r+80)}(e,$("#resDialog"),$("#psgDialog")):e.psgChooser&&""!==e.psgChooser?u(e,$("#psgDialog")):(e.idPsg&&(r=e.idPsg),e.id&&(s=e.id),e.rid&&(g=e.rid),e.vid&&(n=e.vid),e.span&&(o=e.span),void 0!==e.hosp&&l.setUp(e.hosp),e.famSection&&(m.setUp(e),$("div#guestSearch").hide(),$("#btnDone").val("Save Family").show()),void 0!==e.expDates&&""!==e.expDates&&C.setUp(e.expDates,b),void 0!==e.warning&&""!==e.warning&&flagAlertMessage(e.warning,"warning"),void 0!==e.resv&&(e.resv.rdiv.rooms&&e.resv.rdiv.rooms,d.setUp(e),$("#"+m.divFamDetailId).on("change",".hhk-cbStay",function(){var e=m.findStaysChecked();d.$totalGuests.text(e),0<e?d.$totalGuests.parent().removeClass("ui-state-highlight"):d.$totalGuests.parent().addClass("ui-state-highlight")}),0<$(".hhk-getVDialog").length&&($(".hhk-getVDialog").button(),$("#"+m.divFamDetailId).on("click",".hhk-getVDialog",function(){var e=$(this).data("vid"),t=$(this).data("span");viewVisit(0,e,{"Show Statement":function(){window.open("ShowStatement.php?vid="+e,"_blank")},"Show Registration Form":function(){window.open("ShowRegForm.php?vid="+e,"_blank")},Save:function(){saveFees(0,e,t,!1,payFailPage)},Cancel:function(){$(this).dialog("close")}},"Edit Visit #"+e+"-"+t,"",t),$("#submitButtons").hide()})),$(".hhk-cbStay").change(),void 0!==e.resv.rdiv.hideCkinBtn&&e.resv.rdiv.hideCkinBtn?$("#btnDone").hide():$("#btnDone").val(a).show(),0<e.rid&&($("#btnDelete").val("Delete "+i).show(),$("#btnShowReg").show(),$("#spnStatus").text(""===e.resv.rdiv.rStatTitle?"":" - "+e.resv.rdiv.rStatTitle)),h($("#gstDate").val(),e.rid)),void 0!==e.addPerson&&($("input#txtPersonSearch").val(""),I.addItem(e.addPerson.mem)&&(E.addItem(e.addPerson.addrs),m.newGuestMarkup(e.addPerson,e.addPerson.mem.pref),m.findStaysChecked(),$(".hhk-cbStay").change(),$("#"+e.addPerson.mem.pref+"txtFirstName").focus())))}t.getReserve=V,t.verifyInput=function(){if(!1===C.verify())return!1;if(!1===m.verify())return!1;if(!1===l.verify())return!1;if(!0===d.setupComplete&&!1===d.verify())return!1;return!0},t.loadResv=v,t.deleteReserve=function(e,a,i){var t="&cmd=delResv&rid="+e;$.post("ws_ckin.php",t,function(e){var t;try{t=$.parseJSON(e)}catch(e){flagAlertMessage(e.message,"error"),$(a).remove()}t.error&&(t.gotopage&&window.open(t.gotopage,"_self"),flagAlertMessage(t.error,"error"),$(a).remove()),t.warning&&(flagAlertMessage(t.warning,"warning"),i.hide()),t.result&&($(a).remove(),flagAlertMessage(t.result+' <a href="Reserve.php">Continue</a>',"success"))})},t.resvTitle=i,t.people=I,t.addrs=E,t.getIdPsg=function(){return r},t.getIdResv=function(){return g},t.getIdName=function(){return s},t.getIdVisit=function(){return n},t.getSpan=function(){return o},t.setRooms=c}
