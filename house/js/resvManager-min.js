function resvManager(e,t){var a=this,i=e.patLabel,r=e.visitorLabel,s=(e.guestLabel,e.primaryGuestLabel),n=e.resvTitle,o=e.saveButtonLabel,d=e.patBD,l=e.gstBD,c=e.patAddr,h=e.gstAddr,p=e.patAsGuest,u=void 0!==e.emergencyContact&&e.emergencyContact,v=void 0!==e.isCheckin&&e.isCheckin,g=e.addrPurpose,f=e.idPsg,m=e.rid,C=e.id,y=e.vid,k=e.span,b=e.arrival,x=e.insistPayFilledIn,w=!1,S=[],D=new B,A=new B,R=new function(e){var a,n=this,o="divfamDetail",m=!1;function C(){var e=0;return $(".hhk-cbStay").each(function(){var t=$(this).data("prefix");$(this).prop("checked")?(D.list()[t].stay="1",e++):1===$(".hhk-cbStay").length?D.list()[t].stay="1":D.list()[t].stay="0"}),e}function y(){var e=$("input[type=radio][name=rbPriGuest]:checked").val();for(var t in D.list())D.list()[t].pri="0";void 0!==e&&(D.list()[e].pri="1")}function k(e){var t=$("#divfamDetail");!0===e?(t.show("blind"),t.prev("div").removeClass("ui-corner-all").addClass("ui-corner-top")):(t.hide("blind"),t.prev("div").addClass("ui-corner-all").removeClass("ui-corner-top"))}function b(e){"use strict";$("#ecSearch").dialog("close");var t=parseInt(e.id,10);if(!1===isNaN(t)&&t>0){var a=$("#hdnEcSchPrefix").val();if(""==a)return;$("#"+a+"txtEmrgFirst").val(e.first),$("#"+a+"txtEmrgLast").val(e.last),$("#"+a+"txtEmrgPhn").val(e.phone),$("#"+a+"txtEmrgAlt").val(""),$("#"+a+"selEmrgRel").val("")}}function x(e){var t=/^([\(]{1}[0-9]{3}[\)]{1}[\.| |\-]{0,1}|^[0-9]{3}[\.|\-| ]?)?[0-9]{3}(\.|\-| )?[0-9]{4}$/,a=!1;return $("#"+e+"incomplete").length>0&&!1===$("#"+e+"incomplete").prop("checked")&&($("."+e+"hhk-addr-val").not(".hhk-MissingOk").each(function(){""!==$(this).val()||$(this).hasClass("bfh-states")?$(this).removeClass("ui-state-error"):($(this).addClass("ui-state-error"),a=!0)}),a)?($("#"+e+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+e+"toggleAddr").click(),"Some or all of the indicated addresses are missing.  "):($('.hhk-phoneInput[id^="'+e+'txtPhone"]').each(function(){""!==$.trim($(this).val())&&!1===t.test($(this).val())?($(this).addClass("ui-state-error"),$("#"+e+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+e+"toggleAddr").click(),$("#"+e+"phEmlTabs").tabs("option","active",1),a=!0):$(this).removeClass("ui-state-error")}),"")}function S(e){var t=!1;return $("."+e+"hhk-demog-input").each(function(){""===$(this).val()?($(this).addClass("ui-state-error"),t=!0):$(this).removeClass("ui-state-error")}),t?"Some or all Demographics are not set":""}function R(e){var t=!1,a=$("#"+e+"txtEmrgFirst"),i=$("#"+e+"txtEmrgLast"),r=$("#"+e+"txtEmrgPhn"),s=$("#"+e+"selEmrgRel");return a.removeClass("ui-state-error"),i.removeClass("ui-state-error"),r.removeClass("ui-state-error"),s.removeClass("ui-state-error"),$("#"+e+"cbEmrgLater").length>0&&!1===$("#"+e+"cbEmrgLater").prop("checked")&&(""===a.val()&&""===i.val()&&(a.addClass("ui-state-error"),i.addClass("ui-state-error"),t=!0),""===r.val()&&(r.addClass("ui-state-error"),t=!0),""===s.val()&&(s.addClass("ui-state-error"),t=!0),t)?"Some or all of the indicated Emergency Contact Information is missing.  ":""}function M(e){return!(void 0===e||!e||""==e)&&(""!==$("#"+e+"adraddress1"+g).val()&&""!==$("#"+e+"adrzip"+g).val()&&""!==$("#"+e+"adrstate"+g).val()&&""!==$("#"+e+"adrcity"+g).val())}function P(e,t){$(".hhk-addrPicker").remove();var a=$('<select id="selAddrch" multiple="multiple" />'),i=0,r=[];for(var s in A.list())if(""!=A.list()[s].Address_1||""!=A.list()[s].Postal_Code){for(var n=!0,o=A.list()[s].Address_1+", "+(""==A.list()[s].Address_2?"":A.list()[s].Address_2+", ")+A.list()[s].City+", "+A.list()[s].State_Province+"  "+A.list()[s].Postal_Code,d=0;d<=r.length;d++)r[d]!=o||(n=!1);n&&(r[i]=o,i++,$('<option class="hhk-addrPickerPanel" value="'+s+'">'+o+"</option>").appendTo(a))}if(i>0){a.prop("size",i+1).prepend($('<option value="0" >(Cancel)</option>')),a.change(function(){!function(e,t){if(0==t)return void $("#divSelAddr").remove();$("#"+e+"adraddress1"+g).val(A.list()[t].Address_1),$("#"+e+"adraddress2"+g).val(A.list()[t].Address_2),$("#"+e+"adrcity"+g).val(A.list()[t].City),$("#"+e+"adrcounty"+g).val(A.list()[t].County),$("#"+e+"adrzip"+g).val(A.list()[t].Postal_Code),$("#"+e+"adrcountry"+g).val()!=A.list()[t].Country_Code&&$("#"+e+"adrcountry"+g).val(A.list()[t].Country_Code).change();$("#"+e+"adrstate"+g).val(A.list()[t].State_Province),M(e)&&!0===$("#"+e+"incomplete").prop("checked")&&$("#"+e+"incomplete").prop("checked",!1);N($("#"+e+"liaddrflag")),$("#divSelAddr").remove()}(t,$(this).val())});var l=$('<div id="divSelAddr" style="position:absolute; vertical-align:top;" class="hhk-addrPicker hhk-addrPickerPanel"/>').append($('<p class="hhk-addrPickerPanel">Choose an Address: </p>')).append(a).appendTo($("body"));l.position({my:"left top",at:"right center",of:e})}}function _(e){void 0!==e&&(A.list()[e].Address_1=$("#"+e+"adraddress1"+g).val(),A.list()[e].Address_2=$("#"+e+"adraddress2"+g).val(),A.list()[e].City=$("#"+e+"adrcity"+g).val(),A.list()[e].County=$("#"+e+"adrcounty"+g).val(),A.list()[e].State_Province=$("#"+e+"adrstate"+g).val(),A.list()[e].Country_Code=$("#"+e+"adrcountry"+g).val(),A.list()[e].Postal_Code=$("#"+e+"adrzip"+g).val(),N($("#"+e+"liaddrflag")))}function N(e){var t=e.data("pref");!0===$("#"+t+"incomplete").prop("checked")?(e.show().find("span").removeClass("ui-icon-alert").addClass("ui-icon-check").attr("title","Incomplete Address is checked"),e.removeClass("ui-state-error").addClass("ui-state-highlight")):M(t)?e.hide():(e.show().find("span").removeClass("ui-icon-check").addClass("ui-icon-alert").attr("title","Address is Incomplete"),e.removeClass("ui-state-highlight").addClass("ui-state-error"))}n.findStaysChecked=C,n.findStays=function(e){var t=0;for(var a in D.list())D.list()[a].stay===e&&t++;return t},n.findPrimaryGuest=y,n.setUp=function(i){var r;if(void 0===i.famSection||void 0===i.famSection.tblId||""===i.famSection.tblId)return;!1===m&&(function(t){var i,r,s;i=$("<div/>").addClass("ui-widget-content ui-corner-bottom hhk-tdbox").prop("id",o).css("padding","5px"),a=$("<table/>").prop("id",t.famSection.tblId).addClass("hhk-table").append($("<thead/>").append($(t.famSection.tblHead))).append($("<tbody/>")),i.append(a).append($(t.famSection.adtnl)),s=$("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='f_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),(r=$('<div id="divfamHdr" style="padding:2px; cursor:pointer;"/>').append($(t.famSection.hdr)).append(s).append('<div style="clear:both;"/>')).addClass("ui-widget-header ui-state-default ui-corner-top"),r.click(function(){"none"===i.css("display")?(i.show("blind"),r.removeClass("ui-corner-all").addClass("ui-corner-top")):(i.hide("blind"),r.removeClass("ui-corner-top").addClass("ui-corner-all"))}),e.empty().append(r).append(i).show()}(i),t.UseIncidentReports&&function(){if(f){var t,a,i;t=$('<div style="font-size: 0.9em; min-width: 810px; margin-bottom: 0.5em; margin-top: 0.5em; display: none;"/>').addClass("ui-widget hhk-visitdialog hhk-row").prop("id","incidentsSection"),a=$('<div style="padding:2px; cursor:pointer;"/>').addClass("ui-widget-header ui-state-default ui-corner-all hhk-incidentHdr"),i=$('<div style="padding: 5px;"/>').addClass("ui-corner-bottom hhk-tdbox ui-widget-content").prop("id","incidentContent").hide(),a.append('<div class="hhk-checkinHdr" style="display: inline-block">Incidents<span id="incidentCounts"/></div>').append('<ul style="list-style-type:none; float:right;margin-left:5px;padding-top:2px;" class="ui-widget"><li class="ui-widget-header ui-corner-all" title="Open - Close"><span id="f_drpDown" class="ui-icon ui-icon-circle-triangle-n"></span></li></ul>'),i.incidentViewer({psgId:f,guestLabel:$("#guestLabel").val(),visitorLabel:$("#visitorLabel").val()}),a.click(function(){"none"===i.css("display")?(i.show("blind"),a.removeClass("ui-corner-all").addClass("ui-corner-top")):(i.hide("blind"),a.removeClass("ui-corner-top").addClass("ui-corner-all"))}),t.append(a).append(i).show(),e.find("#divfamDetail").append(t)}}());for(var s in i.famSection.mem){var n=D.findItem("pref",i.famSection.mem[s].pref);n&&(a.find("tr#"+n.id+"n").remove(),a.find("tr#"+n.id+"a").remove(),a.find("input#"+n.pref+"idName").parents("tr").next("tr").remove(),a.find("input#"+n.pref+"idName").parents("tr").remove(),D.removeIndex(n.pref),A.removeIndex(n.pref))}D.makeList(i.famSection.mem,"pref"),A.makeList(i.famSection.addrs,"pref"),void 0!==i.famSection.tblBody[1]&&a.find("tbody:first").prepend($(i.famSection.tblBody[1]));void 0!==i.famSection.tblBody[0]&&a.find("tbody:first").prepend($(i.famSection.tblBody[0]));for(var d in i.famSection.tblBody)"0"!==d&&"1"!==d&&a.find("tbody:first").append($(i.famSection.tblBody[d]));$(".hhk-cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),$(".hhk-lblStay").each(function(){"1"==$(this).data("stay")&&$(this).click()}),$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,maxDate:0,dateFormat:"M d, yy"}),$(".hhk-addrPanel").find("select.bfh-countries").each(function(){var e=$(this);e.bfhcountries(e.data()),$(this).data("dirrty-initial-value",$(this).data("country"))}),$(".hhk-addrPanel").find("select.bfh-states").each(function(){var e=$(this);e.bfhstates(e.data()),$(this).data("dirrty-initial-value",$(this).data("state"))}),$(".hhk-phemtabs").tabs(),$("#InsTabs").tabs(),verifyAddrs("#divfamDetail"),$("input.hhk-zipsearch").each(function(){createZipAutoComplete($(this),"ws_admin.php",void 0,_)}),!1===m&&($("#lnCopy").click(function(){var e=$("input.hhk-lastname").first().val();$("input.hhk-lastname").each(function(){""===$(this).val()&&$(this).val(e)})}),$("#adrCopy").click(function(){var e=$("li.hhk-AddrFlag").first().data("pref");!function(e){for(var t in A.list())e!=t&&(""!==$("#"+t+"adraddress1"+g).val()&&""!==$("#"+t+"adrzip"+g).val()||($("#"+t+"adraddress1"+g).val(A.list()[e].Address_1),$("#"+t+"adraddress2"+g).val(A.list()[e].Address_2),$("#"+t+"adrcity"+g).val(A.list()[e].City),$("#"+t+"adrcounty"+g).val(A.list()[e].County),$("#"+t+"adrzip"+g).val(A.list()[e].Postal_Code),$("#"+t+"adrcountry"+g).val()!=A.list()[e].Country_Code&&$("#"+t+"adrcountry"+g).val(A.list()[e].Country_Code).change(),$("#"+t+"adrstate"+g).val(A.list()[e].State_Province),!0===$("#"+e+"incomplete").prop("checked")?$("#"+t+"incomplete").prop("checked",!0):M(t)&&!0===$("#"+t+"incomplete").prop("checked")&&$("#"+t+"incomplete").prop("checked",!1),N($("#"+t+"liaddrflag"))))}(e)}),$("#"+o).on("click",".hhk-togAddr",function(){r=$(this),$(this).siblings(),"none"===$(this).parents("tr").next("tr").css("display")?($(this).parents("tr").next("tr").show(),r.find("span").removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"),r.attr("title","Hide Address Section")):($(this).parents("tr").next("tr").hide(),r.find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),r.attr("title","Show Address Section"),isIE()&&$("#divSelAddr").remove())}),$("#"+o).on("click",".hhk-AddrFlag",function(){$("#"+$(this).data("pref")+"incomplete").click()}),$("#"+o).on("change",".hhk-copy-target",function(){_($(this).data("pref"))}),$("#"+o).on("click",".hhk-addrCopy",function(){P($(this),$(this).data("prefix"))}),$("#"+o).on("click",".hhk-addrErase",function(){var e;e=$(this).data("prefix"),$("#"+e+"adraddress1"+g).val(""),$("#"+e+"adraddress2"+g).val(""),$("#"+e+"adrcity"+g).val(""),$("#"+e+"adrcounty"+g).val(""),$("#"+e+"adrstate"+g).val(""),$("#"+e+"adrcountry"+g).val(""),$("#"+e+"adrzip"+g).val(""),N($("#"+e+"liaddrflag"))}),$("#"+o).on("click",".hhk-incompleteAddr",function(){N($("#"+$(this).data("prefix")+"liaddrflag"))}),$("#"+o).on("click",".hhk-removeBtn",function(){(""===$("#"+$(this).data("prefix")+"txtFirstName").val()&&""===$("#"+$(this).data("prefix")+"txtLastName").val()||!1!==confirm("Remove this person: "+$("#"+$(this).data("prefix")+"txtFirstName").val()+" "+$("#"+$(this).data("prefix")+"txtLastName").val()+"?"))&&(D.removeIndex($(this).data("prefix")),A.removeIndex($(this).data("prefix")),$(this).parentsUntil("tbody","tr").next().remove(),$(this).parentsUntil("tbody","tr").remove())}),$("#"+o).on("change",".patientRelch",function(){"slf"===$(this).val()?D.list()[$(this).data("prefix")].role="p":D.list()[$(this).data("prefix")].role="g"}),createAutoComplete($("#txtPersonSearch"),3,{cmd:"role",gp:"1"},function(e){!function(e,t,a){if(void 0!==e.No_Return&&""!==e.No_Return)return void flagAlertMessage("This person is set for No Return: "+e.No_Return+".","alert");if(void 0===e.id)return;if(e.id>0&&null!==D.findItem("id",e.id))return void flagAlertMessage("This person is already listed here. ","alert");L({id:e.id,rid:t.rid,idPsg:t.idPsg,isCheckin:v,gstDate:$("#gstDate").val(),gstCoDate:$("#gstCoDate").val(),cmd:"addResvGuest",schTerm:a})}(e,i,$("#txtPersonSearch").val())}),$("#"+o).on("click",".hhk-emSearch",function(){$("#hdnEcSchPrefix").val($(this).data("prefix")),$("#ecSearch").dialog("open")}),createAutoComplete($("#txtemSch"),3,{cmd:"filter",add:"phone",basis:"g"},b),$("ul.hhk-ui-icons li").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")}));for(var l in D.list())N($("#"+l+"liaddrflag"));$(".hhk-togAddr").each(function(){$(this).parents("tr").next("tr").hide(),$(this).find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),$(this).attr("title","Show Address Section")}),m=!0},n.newGuestMarkup=function(e,t){var i,r,s,n,o;if(void 0===e.tblId||""==e.tblId)return;if(0===a.length)return;s=a.children("tbody").children("tr").last().hasClass("odd")?"even":"odd";a.find("tbody:first").append($(e.ntr).addClass(s)).append($(e.atr).addClass(s)),$("#"+t+"cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),"1"==$("#"+t+"lblStay").data("stay")&&$("#"+t+"lblStay").click();$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,maxDate:0,dateFormat:"M d, yy"}),n=$("#"+t+"liaddrflag"),o=n.siblings(),N(n),o.parents("tr").next("tr").hide(),o.find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),o.attr("title","Show Address Section"),(i=$("#"+t+"adrcountry"+g)).bfhcountries(i.data()),$(this).data("dirrty-initial-value",$(this).data("country")),(r=$("#"+t+"adrstate"+g)).bfhstates(r.data()),$(this).data("dirrty-initial-value",$(this).data("state")),$("#"+t+"phEmlTabs").tabs(),$("input#"+t+"adrzip1").each(function(){createZipAutoComplete($(this),"ws_admin.php",void 0,_)})},n.verify=function(){var t=0,a=0,n=0,o=0,v=!1,g=0,f=!1;if($(".patientRelch").removeClass("ui-state-error"),$(".patientRelch").each(function(){""===$(this).val()?($(this).addClass("ui-state-error"),f=!0):$(this).removeClass("ui-state-error")}),f)return flagAlertMessage("Set the highlighted Relationship(s).","alert",I),!1;for(var b in y(),C(),D.list())t++,"p"===D.list()[b].role&&a++,"1"===D.list()[b].stay&&n++,"1"===D.list()[b].pri&&o++,$("#"+b+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-n")&&$("#"+b+"toggleAddr").click();if(a<1)return flagAlertMessage("Choose a "+i+".","alert",I),$(".patientRelch").addClass("ui-state-error"),!1;if(a>1){for(var b in flagAlertMessage("Only 1 "+i+" is allowed.","alert",I),D.list())"p"===D.list()[b].role&&$("#"+b+"selPatRel").addClass("ui-state-error");return!1}if(n<1)return flagAlertMessage("There is no one actually staying.  Pick someone to stay.","alert",I),!1;if($("input.hhk-rbPri").parent().removeClass("ui-state-error"),0===o&&1===t)for(var b in D.list())D.list()[b].pri="1";else if(0===o)return I.text("Set one "+r+" as "+s+".").show(),flagAlertMessage("Set one "+r+" as "+s+".","alert",I),$("input.hhk-rbPri").parent().addClass("ui-state-error"),!1;if(e.find(".hhk-lastname").each(function(){""==$(this).val()?($(this).addClass("ui-state-error"),v=!0):$(this).removeClass("ui-state-error")}),e.find(".hhk-firstname").each(function(){""==$(this).val()?($(this).addClass("ui-state-error"),v=!0):$(this).removeClass("ui-state-error")}),!0===v)return k(!0),flagAlertMessage("Enter a first and last name for the people highlighted.","alert",I),!1;u&&e.find(".hhk-EmergCb").each(function(){var e=R($(this).data("prefix"));!0!==$(this).prop("checked")&&""!==e||g++});for(var A in D.list()){if("p"===D.list()[A].role){if(d&""===$("#"+A+"txtBirthDate").val())return $("#"+A+"txtBirthDate").addClass("ui-state-error"),flagAlertMessage(i+" is missing the Birth Date.","alert",I),k(!0),!1;if($("#"+A+"txtBirthDate").removeClass("ui-state-error"),c||p){var M=x(A);if(""!==M)return flagAlertMessage(M,"alert",I),k(!0),$("#"+A+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+A+"toggleAddr").click(),!1}}else{if(l&""===$("#"+A+"txtBirthDate").val())return $("#"+A+"txtBirthDate").addClass("ui-state-error"),flagAlertMessage(r+" is missing the Birth Date.","alert",I),k(!0),!1;if($("#"+A+"txtBirthDate").removeClass("ui-state-error"),h){var M=x(A);if(""!==M)return flagAlertMessage(M,"alert",I),k(!0),$("#"+A+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+A+"toggleAddr").click(),!1}}if($("#"+A+"txtBirthDate").length>0&&""!==$("#"+A+"txtBirthDate").val()){var P=new Date($("#"+A+"txtBirthDate").val()),_=new Date;if(P>_)return $("#"+A+"txtBirthDate").addClass("ui-state-error"),flagAlertMessage("This birth date cannot be in the future.","alert",I),k(!0),!1;$("#"+A+"txtBirthDate").removeClass("ui-state-error")}if(u&&g<1){var M=R(A);if(""!==M)return flagAlertMessage(M,"alert",I),k(!0),$("#"+A+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+A+"toggleAddr").click(),!1}if(w){var M=S(A);if(""!==M)return flagAlertMessage(M,"alert",I),k(!0),$("#"+A+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+A+"toggleAddr").click(),!1}}return m=!1,!0},n.divFamDetailId=o,n.$famTbl=a}($("#famSection")),M=new function(e){var t,a,i,r,s=this;function n(e){var t=S[$("#selResource").val()],a=!0;$("#selccgw"+e+" option").each(function(){this.value===t.merchant&&(a=!1)}),a&&$("#selccgw"+e).append('<option value="'+t.merchant+'">'+t.merchant+"</option>"),$("#selccgw"+e).val(t.merchant)}function o(e){"use strict";var t="";return""===$("#car"+e+"txtVehLic").val()&&""===$("#car"+e+"txtVehMake").val()?"Enter vehicle info or check the 'No Vehicle' checkbox. ":(""===$("#car"+e+"txtVehLic").val()?(""===$("#car"+e+"txtVehModel").val()&&($("#car"+e+"txtVehModel").addClass("ui-state-highlight"),t="Enter Model"),""===$("#car"+e+"txtVehColor").val()&&($("#car"+e+"txtVehColor").addClass("ui-state-highlight"),t="Enter Color"),""===$("#car"+e+"selVehLicense").val()&&($("#car"+e+"selVehLicense").addClass("ui-state-highlight"),t="Enter state license plate registration")):""===$("#car"+e+"txtVehMake").val()&&""===$("#car"+e+"txtVehLic").val()&&($("#car"+e+"txtVehLic").addClass("ui-state-highlight"),t="Enter a license plate number."),t)}s.setupComplete=!1,s.checkPayments=!0,s.setUp=function(o){t=$("<div/>").addClass(" hhk-tdbox ui-corner-bottom hhk-tdbox ui-widget-content").prop("id","divResvDetail").css({padding:"5px",display:"flex","flex-wrap":"wrap"}),void 0!==o.resv.rdiv.rChooser&&t.append($(o.resv.rdiv.rChooser));void 0!==o.resv.rdiv.rate&&t.append($(o.resv.rdiv.rate));void 0!==o.resv.rdiv.cof&&t.append(o.resv.rdiv.cof);void 0!==o.resv.rdiv.rstat&&t.append($(o.resv.rdiv.rstat));void 0!==o.resv.rdiv.vehicle&&(a=$(o.resv.rdiv.vehicle),t.append(a),l=2,c=(d=a).find("#cbNoVehicle"),h=d.find("#btnNextVeh"),p=d.find("#tblVehicle"),c.change(function(){this.checked?p.hide("scale, horizontal"):p.show("scale, horizontal")}),c.change(),h.button(),h.click(function(){d.find("#trVeh"+l).show("fade"),++l>4&&h.hide("fade")}));var d,l,c,h,p;void 0!==o.resv.rdiv.pay&&t.append($(o.resv.rdiv.pay));void 0!==o.resv.rdiv.notes&&t.append((u=o.rid,(v=$(o.resv.rdiv.notes)).notesViewer({linkId:u,linkType:"reservation",newNoteAttrs:{id:"taNewNote",name:"taNewNote"},alertMessage:function(e,t){flagAlertMessage(e,t)}}),v));var u,v;void 0!==o.resv.rdiv.wlnotes&&t.append($(o.resv.rdiv.wlnotes));r=$("<ul style='list-style-type:none; float:right; margin-left:5px; padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='r_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),(i=$('<div id="divResvHdr" style="padding:2px; cursor:pointer;"/>').append($(o.resv.hdr)).append(r).append('<div style="clear:both;"/>')).addClass("ui-widget-header ui-state-default ui-corner-top"),i.click(function(e){var a=$(e.target);"divResvHdr"!==a[0].id&&"r_drpDown"!==a[0].id||("none"===t.css("display")?(t.show("blind"),i.removeClass("ui-corner-all").addClass("ui-corner-top")):(t.hide("blind"),i.removeClass("ui-corner-top").addClass("ui-corner-all")))}),e.empty().append(i).append(t).show(),s.$totalGuests=$("#spnNumGuests"),s.origRoomId=$("#selResource").val(),s.checkPayments=!0,$(".hhk-viewResvActivity").length>0&&$(".hhk-viewResvActivity").click(function(){$.post("ws_ckin.php",{cmd:"viewActivity",rid:$(this).data("rid")},function(e){if((e=$.parseJSON(e)).error)return e.gotopage&&window.open(e.gotopage,"_self"),void flagAlertMessage(e.error,"error");e.activity&&($("div#submitButtons").hide(),$("#activityDialog").children().remove(),$("#activityDialog").append($(e.activity)),$("#activityDialog").dialog("open"))})});$("#btnShowCnfrm").button().click(function(){var e=$("#spnAmount").text();""===e&&(e=0),$.post("ws_ckin.php",{cmd:"confrv",rid:$(this).data("rid"),amt:e,eml:"0"},function(e){if((o=$.parseJSON(e)).error)return o.gotopage&&window.open(o.gotopage,"_self"),void flagAlertMessage(o.error,"error");if(o.confrv){$("div#submitButtons").hide(),$("#frmConfirm").children().remove(),$("#frmConfirm").html(o.confrv);var t='<div style="width: 100%"><label for="confEmail" style="padding-right: 0.5em;">To Address</label><input type="text" style="width:70%" id="confEmail" value="'+o.email+'"></div>';t+='<div style="width: 100%"><label for="ccConfEmail" style="padding-right: 0.5em;">CC Address</label><input type="text" style="width:70%" id="ccConfEmail" value="'+o.ccemail+'"></div>',$("#frmConfirm").append($('<div style="padding-top:10px; display: flex;" class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"">'+t+"</div>")),$("#frmConfirm").find("#confirmTabDiv").tabs(),$("#confirmDialog").dialog("open")}})}),function(e){N.idReservation=e,$("input.hhk-constraintsCB").change(function(){N.go($("#gstDate").val(),$("#gstCoDate").val())})}(o.rid),void 0!==o.resv.rdiv.rate&&function(t){var a={},i=e.find("#btnFapp");i.length>0&&($("#faDialog").dialog({autoOpen:!1,resizable:!0,width:680,modal:!0,title:"Income Chooser",close:function(){$("div#submitButtons").show()},open:function(){$("div#submitButtons").hide()},buttons:{Save:function(){$.post("ws_ckin.php",$("#formf").serialize()+"&cmd=savefap&rid="+t.rid,function(e){try{e=$.parseJSON(e)}catch(e){return void alert("Bad JSON Encoding")}if(e.gotopage&&window.open(e.gotopage,"_self"),e.rstat&&1==e.rstat){var t=$("#selRateCategory");e.rcat&&""!=e.rcat&&t.length>0&&(t.val(e.rcat),t.change())}}),$(this).dialog("close")},Exit:function(){$(this).dialog("close")}}}),i.button().click(function(){getIncomeDiag(t.rid)}));t.resv.rdiv.ratelist&&(a.rateList=t.resv.rdiv.ratelist,a.resources=t.resv.rdiv.rooms,a.visitFees=t.resv.rdiv.vfee,a.idResv=m,setupRates(a));$("#selResource").length>0&&$("#selResource").change(function(){var e=S[$("#selResource").val()];!e.defaultRateCat||""==e.defaultRateCat||"w"!==$("#selResvStatus").val()&&"uc"!==$("#selResvStatus").val()&&"a"!==$("#selResvStatus").val()||$("#selRateCategory").val(e.defaultRateCat),$("#selRateCategory").change();var t=$("option:selected",this),a=t.parent()[0].label;null==a?$("#hhkroomMsg").hide():$("#hhkroomMsg").text(a).show(),$("#selccgw").length>0?n(""):$("#selccgwg").length>0&&n("g")})}(o);void 0!==o.resv.rdiv.pay&&$("#selResource").length>0&&$("#selRateCategory").length>0&&(setupPayments($("#selRateCategory")),$("#paymentDate").datepicker({yearRange:"-1:+00",numberOfMonths:1,autoSize:!0,dateFormat:"M d, yy"}));if(void 0!==o.resv.rdiv.cof){var g=S[$("#selResource").val()];$("#btnUpdtCred").button().click(function(){cardOnFile($(this).data("id"),$(this).data("idreg"),"Reserve.php?rid="+m,$(this).data("indx"))}),setupCOF($("#trvdCHNameg"),$("#btnUpdtCred").data("indx")),$("#selccgwg").val(g.merchant)}$("#addGuestHeader").length>0&&(_.openControl=!0,_.setUp(o.resv.rdiv,F,$("#addGuestHeader")));s.setupComplete=!0},s.verify=function(){if($("#cbNoVehicle").length>0){if(!1===$("#cbNoVehicle").prop("checked")){var e=o(1);if(""!=e){var t=o(2);if(""!=t)return $("#vehValidate").text(t),flagAlertMessage(e,"alert",I),!1}}$("#vehValidate").text("")}if(v&&!0===s.checkPayments){if($("#selCategory").val()==fixedRate&&$("#txtFixedRate").length>0&&""==$("#txtFixedRate").val())return flagAlertMessage("Set the Room Rate to an amount, or to 0.","alert",I),$("#txtFixedRate").addClass("ui-state-error"),!1;if($("#txtFixedRate").removeClass("ui-state-error"),$("input#feesPayment").length>0&&""==$("input#feesPayment").val()&&x)return flagAlertMessage("Set the Room Fees to an amount, or 0.","alert",I),$("#payChooserMsg").text("Set the Room Fees to an amount, or 0.").show(),$("input#feesPayment").addClass("ui-state-error"),!1;if($("input#feesPayment").removeClass("ui-state-error"),void 0!==verifyAmtTendrd&&!1===verifyAmtTendrd())return!1}return!0}}($("#resvSection")),P=new function(e){var t=this;t.setupComplete=!1,t.setUp=function(a){var i=$(a.div).addClass("ui-widget-content").prop("id","divhospDetail").hide(),r=$("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='h_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),s=$('<div id="divhospHdr" style="padding:2px; cursor:pointer;"/>').append($(a.hdr)).append(r).append('<div style="clear:both;"/>');s.addClass("ui-widget-header ui-state-default ui-corner-all"),s.click(function(){"none"===i.css("display")?(i.show("blind"),s.removeClass("ui-corner-all").addClass("ui-corner-top")):(i.hide("blind"),s.removeClass("ui-corner-top").addClass("ui-corner-all"))}),e.empty().append(s).append(i),$("#txtEntryDate, #txtExitDate").datepicker({yearRange:"-01:+01",changeMonth:!0,changeYear:!0,autoSize:!0,dateFormat:"M d, yy"}),$("#txtAgentSch").length>0&&(createAutoComplete($("#txtAgentSch"),3,{cmd:"filter",basis:"ra"},getAgent),""===$("#a_txtLastName").val()&&$(".hhk-agentInfo").hide(),$(document).on("click","#a_delete",function(){$("#a_idName").val(""),$("input.hhk-agentInfo").val(""),$(".hhk-agentInfo").hide()}),""!==$("#a_idName").val()?$("input.hhk-agentInfo.name").attr("readonly","readonly"):$("input.hhk-agentInfo.name").removeAttr("readonly")),$("#txtDocSch").length>0&&(createAutoComplete($("#txtDocSch"),3,{cmd:"filter",basis:"doc"},getDoc),""===$("#d_txtLastName").val()&&$(".hhk-docInfo").hide(),""!==$("#d_idName").val()?$("input.hhk-docInfo.name").attr("readonly","readonly"):$("input.hhk-docInfo.name").removeAttr("readonly"),$(document).on("click","#d_delete",function(){$("#d_idName").val(""),$("input.hhk-docInfo").val(""),$(".hhk-docInfo").hide()})),verifyAddrs("#divhospDetail"),e.on("change","#selHospital, #selAssoc",function(){var e=$("#selAssoc").find("option:selected").text();""!=e&&(e+="/ "),$("span#spnHospName").text(e+$("#selHospital").find("option:selected").text())}),e.show(),""===$("#selHospital").val()&&s.click(),t.setupComplete=!0},t.verify=function(){return e.find(".ui-state-error").each(function(){$(this).removeClass("ui-state-error")}),$("#selHospital").length>0&&!0===t.setupComplete&&""==$("#selHospital").val()?($("#selHospital").addClass("ui-state-error"),flagAlertMessage("Select a hospital.","alert",I),$("#divhospDetail").show("blind"),$("#divhospHdr").removeClass("ui-corner-all").addClass("ui-corner-top"),!1):($("#divhospDetail").hide("blind"),$("#divhospHdr").removeClass("ui-corner-top").addClass("ui-corner-all"),!0)}}($("#hospitalSection")),_=new function(){var e=this;e.setupComplete=!1,e.ciDate=new Date,e.coDate=new Date,e.openControl=!1,e.setUp=function(t,a,i){if(i.empty(),t.mu&&""!==t.mu){i.append($(t.mu));var r,s=$("#gstDate"),n=$("#gstCoDate"),o=parseInt(t.defdays,10),d=!1,l=!1;""===s.val()&&b&&s.val(b),t.startDate&&(d=t.startDate),t.endDate&&(l=t.endDate),r=$("#spnRangePicker").dateRangePicker({format:"MMM D, YYYY",separator:" to ",minDays:1,autoClose:!0,showShortcuts:!0,shortcuts:{"next-days":[o]},getValue:function(){return s.val()&&n.val()?s.val()+" to "+n.val():""},setValue:function(e,t,a){s.val(t),n.val(a)},startDate:d,endDate:l}),t.updateOnChange&&r.bind("datepicker-change",function(e,i){var r=Math.ceil((i.date2.getTime()-i.date1.getTime())/864e5);$("#"+t.daysEle).val(r),$("#spnNites").length>0&&$("#spnNites").text(r),$("#gstDate").removeClass("ui-state-error"),$("#gstCoDate").removeClass("ui-state-error"),$.isFunction(a)&&a(i)}),i.show(),e.openControl&&$("#spnRangePicker").data("dateRangePicker").open()}setupComplete=!0},e.verify=function(){var t=$("#gstDate"),a=$("#gstCoDate");if(t.removeClass("ui-state-error"),a.removeClass("ui-state-error"),""===t.val())return t.addClass("ui-state-error"),flagAlertMessage("This "+n+" is missing the check-in date.","alert",I),!1;if(e.ciDate=new Date(t.val()),isNaN(e.ciDate.getTime()))return t.addClass("ui-state-error"),flagAlertMessage("This "+n+" is missing the check-in date.","alert",I),!1;if(void 0!==v&&!0===v){var i=moment($("#gstDate").val(),"MMM D, YYYY"),r=moment().endOf("date");if(i>r)return t.addClass("ui-state-error"),flagAlertMessage("Set the Check in date to today or earlier.","alert",I),!1}return""===a.val()?(a.addClass("ui-state-error"),flagAlertMessage("This "+n+" is missing the expected departure date.","alert",I),!1):(e.coDate=new Date(a.val()),isNaN(e.coDate.getTime())?(a.addClass("ui-state-error"),flagAlertMessage("This "+n+" is missing the expected departure date","alert",I),!1):!(e.ciDate>e.coDate)||(t.addClass("ui-state-error"),flagAlertMessage("This "+n+"'s check-in date is after the expected departure date.","alert",I),!1))}},N=new N,I=$("#pWarnings");t=t;function E(e){S=e}function F(e){I.text("").hide();var t=!1;for(var a in D.list())if(D.list()[a].id>0){t=!0;break}if(t){$(".hhk-stayIndicate").hide().parent("td").addClass("hhk-loading");var i={cmd:"updateAgenda",idPsg:f,idResv:m,idVisit:y,span:k,dt1:e.date1.getFullYear()+"-"+(e.date1.getMonth()+1)+"-"+e.date1.getDate(),dt2:e.date2.getFullYear()+"-"+(e.date2.getMonth()+1)+"-"+e.date2.getDate(),mems:D.list()};$.post("ws_resv.php",i,function(e){$(".hhk-stayIndicate").show().parent("td").removeClass("hhk-loading");try{e=$.parseJSON(e)}catch(e){return void flagAlertMessage(e.message,"error")}if(e.gotopage&&window.open(e.gotopage,"_self"),e.error&&flagAlertMessage(e.error,"error"),e.stayCtrl){for(var t in e.stayCtrl){var a;$("#sb"+t).empty().html(e.stayCtrl[t].ctrl),$("#"+t+"cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),D.list()[t].stay="0",(a=$("#"+t+"lblStay")).length>0&&"1"==a.data("stay")&&a.click()}$(".hhk-getVDialog").button(),""!=$("#gstDate").val()&&""!=$("#gstCoDate").val()&&N.go($("#gstDate").val(),$("#gstCoDate").val()),$(".hhk-cbStay").change()}})}T(e.date1.t,m)}function T(e,t,a){var i=moment(e,"MMM D, YYYY"),r=moment().endOf("date");t>0&&i<=r&&!a?$("#btnCheckinNow").show():$("#btnCheckinNow").hide()}function N(){var e=this,t={};e.omitSelf=!0,e.numberGuests=0,e.idReservation=0,e.go=function(a,i){var r,s=$("#selResource");if(0===s.length)return;r=s.find("option:selected").val(),s.prop("disabled",!0),$("#hhk-roomChsrtitle").addClass("hhk-loading"),$("#hhkroomMsg").text("").hide(),t={},$("input.hhk-constraintsCB:checked").each(function(){t[$(this).data("cnid")]="ON"}),$.post("ws_ckin.php",{cmd:"newConstraint",rid:e.idReservation,numguests:e.numberGuests,expArr:a,expDep:i,idr:r,cbRS:t,omsf:e.omitSelf},function(e){var t;s.prop("disabled",!1),$("#hhk-roomChsrtitle").removeClass("hhk-loading");try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}if(e.error)return e.gotopage&&window.location.assign(e.gotopage),void flagAlertMessage(e.error,"error");e.rooms&&E(e.rooms),e.selectr&&(t=$(e.selectr),s.children().remove(),t.children().appendTo(s),s.val(e.idResource).change(),e.msg&&""!==e.msg&&$("#hhkroomMsg").text(e.msg).show())})}}function B(){var e,t={},a=this;function i(a){return!1===r(a)&&(t[a[e]]=a,!0)}function r(a){return void 0!==t[a[e]]}a.hasItem=r,a.findItem=function(e,a){for(var i in t)if(t[i][e]==a)return t[i];return null},a.addItem=i,a.removeIndex=function(e){delete t[e]},a.list=function(){return t},a.makeList=function(t,a){for(var r in e=a,t)i(t[r])},a._list=t}function V(e,t){"use strict";$("input#txtPersonSearch").val(""),t.empty().append($(e.psgChooser)).dialog("option","buttons",{Open:function(){$(this).dialog("close"),L({idPsg:t.find("input[name=cbselpsg]:checked").val(),id:e.id,cmd:"getResv"})},Cancel:function(){$(this).dialog("close"),$("input#gstSearch").val("").focus()}}).dialog("option","title",e.patLabel+" Chooser"+(void 0===e.fullName?"":" For: "+e.fullName)).dialog("open")}function L(e){var t={id:e.id,rid:e.rid,idPsg:e.idPsg,vid:e.vid,span:e.span,isCheckin:v,gstDate:e.gstDate,gstCoDate:e.gstCoDate,cmd:e.cmd};$.post("ws_resv.php",t,function(e){try{e=$.parseJSON(e)}catch(e){return void flagAlertMessage(e.message,"error")}e.gotopage&&window.open(e.gotopage,"_self"),e.error&&(flagAlertMessage(e.error,"error",I),$("#btnDone").val("Save "+n).show()),O(e)})}function O(e){e.xfer||e.inctx?function(e){paymentRedirect(e,$("#xform"))}(e):e.resvChooser&&""!==e.resvChooser?function(e,t,a){"use strict";var i={};$("input#txtPersonSearch").val(""),t.empty().append($(e.resvChooser)).children().find("input:button").button(),t.children().find(".hhk-checkinNow").click(function(){window.open("CheckingIn.php?rid="+$(this).data("rid")+"&gid="+e.id,"_self")}),e.psgChooser&&""!==e.psgChooser&&(i[e.patLabel+" Chooser"]=function(){$(this).dialog("close"),V(e,a)}),e.resvTitle&&(i["New "+e.resvTitle]=function(){e.rid=-1,e.cmd="getResv",$(this).dialog("close"),L(e)}),i.Exit=function(){$(this).dialog("close"),$("input#gstSearch").val("").focus()},t.dialog("option","width","95%"),t.dialog("option","buttons",i),t.dialog("option","title",e.resvTitle+" Chooser"),t.dialog("open");var r=t.find("table").width();t.dialog("option","width",r+80)}(e,$("#resDialog"),$("#psgDialog")):e.psgChooser&&""!==e.psgChooser?V(e,$("#psgDialog")):(e.idPsg&&(f=e.idPsg),e.id&&(C=e.id),e.rid&&(m=e.rid),e.vid&&(y=e.vid),e.span&&(k=e.span),void 0!==e.hosp&&P.setUp(e.hosp),e.famSection&&(R.setUp(e),$("div#guestSearch").hide(),$("#btnDone").val("Save Family").show(),$("select.hhk-multisel").each(function(){$(this).multiselect({selectedList:3})})),void 0!==e.expDates&&""!==e.expDates&&(_.openControl=!1,_.setUp(e.expDates,F,$("#datesSection"))),void 0!==e.warning&&""!==e.warning&&flagAlertMessage(e.warning,"warning",I),void 0!==e.resv&&(e.resv.rdiv.rooms&&(S=e.resv.rdiv.rooms),M.setUp(e),$("#"+R.divFamDetailId).on("change",".hhk-cbStay",function(){var e=R.findStaysChecked()+R.findStays("r");if(M.$totalGuests.text(e),$("#selRateCategory").trigger("change"),$("#selResource").length>0&&"0"!==$("#selResource").val()){var t="Room may be too small";e>S[$("#selResource").val()].maxOcc?$("#hhkroomMsg").text(t).show():$("#hhkroomMsg").text()==t&&$("#hhkroomMsg").text("").hide()}e>0?M.$totalGuests.parent().removeClass("ui-state-highlight"):M.$totalGuests.parent().addClass("ui-state-highlight")}),$("#"+R.divFamDetailId).on("click",".hhk-getVDialog",function(){var e=$(this).data("vid"),t=$(this).data("span");viewVisit(0,e,{"Show Statement":function(){window.open("ShowStatement.php?vid="+e,"_blank")},"Show Registration Form":function(){window.open("ShowRegForm.php?vid="+e+"&span="+t,"_blank")},Save:function(){saveFees(0,e,t,!1,payFailPage)},Cancel:function(){$(this).dialog("close")}},"Edit Visit #"+e+"-"+t,"hf",t),$("#submitButtons").hide()}),$(".hhk-cbStay").change(),$("#btnDone").val(o).show(),e.rid>0&&($("#btnDelete").val("Delete "+n).show(),$("#btnShowReg").show(),$("#spnStatus").text(""===e.resv.rdiv.rStatTitle?"":" - "+e.resv.rdiv.rStatTitle)),T($("#gstDate").val(),e.rid,e.resv.rdiv.hideCiNowBtn),w=e.insistCkinDemog),void 0!==e.addPerson&&($("input#txtPersonSearch").val(""),D.addItem(e.addPerson.mem)&&(A.addItem(e.addPerson.addrs),R.newGuestMarkup(e.addPerson,e.addPerson.mem.pref),R.findStaysChecked(),$(".hhk-cbStay").change(),$("#"+e.addPerson.mem.pref+"txtFirstName").focus())))}a.getReserve=L,a.verifyInput=function(){if(I.text("").hide(),!1===_.verify())return!1;if(!1===R.verify())return!1;if(!1===P.verify())return!1;if(!0===M.setupComplete&&!1===M.verify())return!1;return!0},a.loadResv=O,a.deleteReserve=function(e,t,a){var i="&cmd=delResv&rid="+e;$.post("ws_ckin.php",i,function(e){var i;try{i=$.parseJSON(e)}catch(e){flagAlertMessage(e.message,"error"),$(t).remove()}i.error&&(i.gotopage&&window.open(i.gotopage,"_self"),flagAlertMessage(i.error,"error"),$(t).remove()),i.warning&&(flagAlertMessage(i.warning,"warning"),a.hide()),i.result&&($(t).remove(),flagAlertMessage(i.result+' <a href="Reserve.php">Continue</a>',"success"))})},a.resvTitle=n,a.people=D,a.addrs=A,a.getIdPsg=function(){return f},a.getIdResv=function(){return m},a.getIdName=function(){return C},a.getIdVisit=function(){return y},a.getSpan=function(){return k},a.setRooms=E,a.options=t}