/** 
 * resvManager.js
 *
 * @author    Eric K. Crane <ecrane@nonprofitsoftwarecorp.org>
 * @copyright 2010-2023 <nonprofitsoftwarecorp.org>
 * @license   GPL and MIT
 * @link      https://github.com/NPSC/HHK
 */ function resvManager(e,t){var a=this,i=e.patLabel,r=e.visitorLabel;e.guestLabel;var s=e.primaryGuestLabel,n=e.resvTitle,o=e.saveButtonLabel,d=e.patBD,l=e.gstBD,c=e.patAddr,h=e.gstAddr,p=e.patAsGuest,u=void 0!==e.emergencyContact&&e.emergencyContact,v=void 0!==e.isCheckin&&e.isCheckin,f=e.addrPurpose,g=e.idPsg,m=e.rid,k=e.id,C=e.vid,y=e.span,b=e.arrival,x=e.insistPayFilledIn,w=e.prePaymt,_=e.datePickerButtons,S=t.closedDays,D=!1,P=e.insistCkinEmail,R=e.insistCkinPhone,A=e.insistCkinAddress,I=[],M=new ee,E=new ee,N=new ee,L=new function e(a){var n,o=this,m="divfamDetail",k=!1;o.findStaysChecked=y,o.findStays=function e(t){var a=0;for(var i in M.list())M.list()[i].stay===t&&a++;return a},o.findPrimaryGuest=b,o.setUp=function e(i){var r,s,o,d,l,c;if(void 0!==i.famSection&&void 0!==i.famSection.tblId&&""!==i.famSection.tblId){for(var h in!1===k&&(o=i,d=$("<div/>").addClass("ui-widget-content ui-corner-bottom hhk-tdbox hhk-overflow-x").prop("id",m).css("padding","5px"),n=$("<table/>").prop("id",o.famSection.tblId).addClass("hhk-table").append($("<thead/>").append($(o.famSection.tblHead))).append($("<tbody/>")),d.append(n).append($(o.famSection.adtnl)),c=$("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='f_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),(l=$('<div id="divfamHdr" style="padding:2px; cursor:pointer;"/>').append($(o.famSection.hdr)).append(c).append('<div style="clear:both;"/>')).addClass("ui-widget-header ui-state-default ui-corner-top"),l.click(function(){"none"===d.css("display")?(d.show("blind"),l.removeClass("ui-corner-all").addClass("ui-corner-top")):(d.hide("blind"),l.removeClass("ui-corner-top").addClass("ui-corner-all"))}),a.empty().append(l).append(d).show(),t.UseIncidentReports&&function e(){if(g){var t,i,r;t=$('<div style="font-size: 0.9em; max-width: 100%; margin-bottom: 0.5em; margin-top: 0.5em; display: none;"/>').addClass("ui-widget hhk-visitdialog hhk-row").prop("id","incidentsSection"),i=$('<div style="padding:2px; cursor:pointer;"/>').addClass("ui-widget-header ui-state-default ui-corner-all hhk-incidentHdr"),r=$('<div style="padding: 5px;"/>').addClass("ui-corner-bottom hhk-tdbox ui-widget-content").prop("id","incidentContent").hide(),i.append('<div class="hhk-checkinHdr" style="display: inline-block">Incidents<span id="incidentCounts"/></div>').append('<ul style="list-style-type:none; float:right;margin-left:5px;padding-top:2px;" class="ui-widget"><li class="ui-widget-header ui-corner-all" title="Open - Close"><span id="f_drpDown" class="ui-icon ui-icon-circle-triangle-n"></span></li></ul>'),r.incidentViewer({psgId:g,guestLabel:$("#guestLabel").val(),visitorLabel:$("#visitorLabel").val()}),i.click(function(){"none"===r.css("display")?(r.show("blind"),i.removeClass("ui-corner-all").addClass("ui-corner-top")):(r.hide("blind"),i.removeClass("ui-corner-top").addClass("ui-corner-all"))}),t.append(i).append(r).show(),a.find("#divfamDetail").append(t)}}()),i.famSection.mem){let p=M.findItem("pref",i.famSection.mem[h].pref);p&&(n.find("tr#"+p.id+"n").remove(),n.find("tr#"+p.id+"a").remove(),n.find("input#"+p.pref+"idName").parents("tr").next("tr").remove(),n.find("input#"+p.pref+"idName").parents("tr").remove(),M.removeIndex(p.pref),E.removeIndex(p.pref))}for(var u in M.makeList(i.famSection.mem,"pref"),E.makeList(i.famSection.addrs,"pref"),N.makeList(i.famSection.emergContacts,"pref"),void 0!==i.famSection.tblBody["1"]&&n.find("tbody:first").prepend($(i.famSection.tblBody["1"])),void 0!==i.famSection.tblBody["0"]&&n.find("tbody:first").prepend($(i.famSection.tblBody["0"])),i.famSection.tblBody)if("0"!==u&&"1"!==u){let y=$(i.famSection.tblBody[u]);if(2==u){let b=y.find("input.hhk-lastname");""===b.val()&&b.val(Q("last")).focus(),""===(b=y.find("input.hhk-firstname")).val()&&b.val(Q("first")).focus()}n.find("tbody:first").append(y)}if($(".hhk-cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),$(".hhk-lblStay").each(function(){"1"==$(this).data("stay")&&$(this).click()}),$(".ckbdate").datepicker(C),$(".hhk-addrPanel").find("select.bfh-countries").each(function(){var e=$(this);e.bfhcountries(e.data()),$(this).data("dirrty-initial-value",$(this).data("country"))}),$(".hhk-addrPanel").find("select.bfh-states").each(function(){var e=$(this);e.bfhstates(e.data()),$(this).data("dirrty-initial-value",$(this).data("state"))}),$(".hhk-phemtabs").tabs(),$("#InsTabs").tabs(),verifyAddrs("#divfamDetail"),$("input.hhk-zipsearch").each(function(){var e;createZipAutoComplete($(this),"ws_admin.php",e,F)}),!1===k){$("#lnCopy").click(function(){var e=$("input.hhk-lastname").first().val();$("input.hhk-lastname").each(function(){""===$(this).val()&&$(this).val(e)})}),$("#adrCopy").click(function(){!function e(t){for(var a in E.list())t!=a&&(""===$("#"+a+"adraddress1"+f).val()||""===$("#"+a+"adrzip"+f).val())&&($("#"+a+"adraddress1"+f).val(E.list()[t].Address_1),$("#"+a+"adraddress2"+f).val(E.list()[t].Address_2),$("#"+a+"adrcity"+f).val(E.list()[t].City),$("#"+a+"adrcounty"+f).val(E.list()[t].County),$("#"+a+"adrzip"+f).val(E.list()[t].Postal_Code),$("#"+a+"adrcountry"+f).val()!=E.list()[t].Country_Code&&$("#"+a+"adrcountry"+f).val(E.list()[t].Country_Code).change(),$("#"+a+"adrstate"+f).val(E.list()[t].State_Province),!0===$("#"+t+"incomplete").prop("checked")?$("#"+a+"incomplete").prop("checked",!0):T(a)&&!0===$("#"+a+"incomplete").prop("checked")&&$("#"+a+"incomplete").prop("checked",!1),B($("#"+a+"liaddrflag")))}($("li.hhk-AddrFlag").first().data("pref"))}),$("#"+m).on("click",".hhk-togAddr",function(){r=$(this),s=$(this).siblings(),"none"===$(this).parents("tr").next("tr").css("display")?($(this).parents("tr").next("tr").show(),r.find("span").removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"),r.attr("title","Hide Address Section")):($(this).parents("tr").next("tr").hide(),r.find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),r.attr("title","Show Address Section"),isIE()&&$("#divSelAddr").remove())}),$("#"+m).on("click",".hhk-AddrFlag",function(){$("#"+$(this).data("pref")+"incomplete").click()}),$("#"+m).on("change",".hhk-copy-target",function(){var e;F($(this).data("pref")),e=$(this).data("pref"),void 0!==e&&(N.list()[e].First=$("#"+e+"txtEmrgFirst").val(),N.list()[e].Last=$("#"+e+"txtEmrgLast").val(),N.list()[e].phone=$("#"+e+"txtEmrgPhn").val(),N.list()[e].altPhone=$("#"+e+"txtEmrgAlt").val(),N.list()[e].relation=$("#"+e+"selEmrgRel").val())}),$("#"+m).on("click",".hhk-addrCopy",function(){!function e(t,a){$(".hhk-addrPicker").remove();var i=$('<select id="selAddrch" multiple="multiple" />'),r=0,s=[];for(var n in E.list())if(""!=E.list()[n].Address_1||""!=E.list()[n].Postal_Code){for(var o=!0,d=E.list()[n].Address_1+", "+(""==E.list()[n].Address_2?"":E.list()[n].Address_2+", ")+E.list()[n].City+", "+E.list()[n].State_Province+"  "+E.list()[n].Postal_Code,l=0;l<=s.length;l++)if(s[l]==d){o=!1;continue}o&&(s[r]=d,r++,$('<option class="hhk-addrPickerPanel" value="'+n+'">'+d+"</option>").appendTo(i))}r>0&&(i.prop("size",r+1).prepend($('<option value="0" >(Cancel)</option>')),i.change(function(){(function e(t,a){if(0==a){$("#divSelAddr").remove();return}$("#"+t+"adraddress1"+f).val(E.list()[a].Address_1),$("#"+t+"adraddress2"+f).val(E.list()[a].Address_2),$("#"+t+"adrcity"+f).val(E.list()[a].City),$("#"+t+"adrcounty"+f).val(E.list()[a].County),$("#"+t+"adrzip"+f).val(E.list()[a].Postal_Code),$("#"+t+"adrcountry"+f).val()!=E.list()[a].Country_Code&&$("#"+t+"adrcountry"+f).val(E.list()[a].Country_Code).change(),$("#"+t+"adrstate"+f).val(E.list()[a].State_Province),T(t)&&!0===$("#"+t+"incomplete").prop("checked")&&$("#"+t+"incomplete").prop("checked",!1),B($("#"+t+"liaddrflag")),$("#divSelAddr").remove()})(a,$(this).val())}),$('<div id="divSelAddr" style="position:absolute; vertical-align:top;" class="hhk-addrPicker hhk-addrPickerPanel"/>').append($('<p class="hhk-addrPickerPanel">Choose an Address: </p>')).append(i).appendTo($("body")).position({my:"left top",at:"right center",of:t}))}($(this),$(this).data("prefix"))}),$("#"+m).on("click",".hhk-emergCopy",function(){!function e(t,a){$(".hhk-addrPicker").remove();var i=$('<select id="selAddrch" multiple="multiple" />'),r=0,s=[];for(var n in N.list())if(""!=N.list()[n].First||""!=N.list()[n].Last){for(var o=!0,d=N.list()[n].First+" "+N.list()[n].Last+" "+N.list()[n].phone,l=0;l<=s.length;l++)if(s[l]==d){o=!1;continue}o&&(s[r]=d,r++,$('<option class="hhk-addrPickerPanel" value="'+n+'">'+d+"</option>").appendTo(i))}r>0&&(i.prop("size",r+1).prepend($('<option value="0" >(Cancel)</option>')),i.change(function(){(function e(t,a){if(0==a){$("#divSelAddr").remove();return}$("#"+t+"txtEmrgFirst").val(N.list()[a].First),$("#"+t+"txtEmrgLast").val(N.list()[a].Last),$("#"+t+"txtEmrgPhn").val(N.list()[a].phone),$("#"+t+"txtEmrgAlt").val(N.list()[a].altPhone),$("#"+t+"selEmrgRel").val(N.list()[a].relation).change(),$("#divSelAddr").remove()})(a,$(this).val())}),$('<div id="divSelAddr" style="position:absolute; vertical-align:top;" class="hhk-addrPicker hhk-addrPickerPanel"/>').append($('<p class="hhk-addrPickerPanel">Choose an Emergency Contact: </p>')).append(i).appendTo($("body")).position({my:"left top",at:"right center",of:t}))}($(this),$(this).data("prefix"))}),$("#"+m).on("click",".hhk-addrErase",function(){var e;e=$(this).data("prefix"),$("#"+e+"adraddress1"+f).val(""),$("#"+e+"adraddress2"+f).val(""),$("#"+e+"adrcity"+f).val(""),$("#"+e+"adrcounty"+f).val(""),$("#"+e+"adrstate"+f).val(""),$("#"+e+"adrcountry"+f).val(""),$("#"+e+"adrzip"+f).val(""),B($("#"+e+"liaddrflag"))}),$("#"+m).on("click",".hhk-incompleteAddr",function(){B($("#"+$(this).data("prefix")+"liaddrflag"))}),$("#"+m).on("click",".hhk-removeBtn",function(){(""===$("#"+$(this).data("prefix")+"txtFirstName").val()&&""===$("#"+$(this).data("prefix")+"txtLastName").val()||!1!==confirm("Remove this person: "+$("#"+$(this).data("prefix")+"txtFirstName").val()+" "+$("#"+$(this).data("prefix")+"txtLastName").val()+"?"))&&(M.removeIndex($(this).data("prefix")),E.removeIndex($(this).data("prefix")),$(this).parentsUntil("tbody","tr").next().remove(),$(this).parentsUntil("tbody","tr").remove())}),$(".hhk-getVDialog").button(),$("#"+m).on("change",".patientRelch",function(){"slf"===$(this).val()?M.list()[$(this).data("prefix")].role="p":M.list()[$(this).data("prefix")].role="g"}),createRoleAutoComplete($("#txtPersonSearch"),3,{cmd:"guest"},function(e){!function e(t,a,i){if(void 0!==t.No_Return&&""!==t.No_Return){flagAlertMessage("This person is set for No Return: "+t.No_Return+".","alert");return}if(void 0!==t.id){if(t.id>0&&null!==M.findItem("id",t.id)){flagAlertMessage("This person is already listed here. ","alert");return}G=i;var r={id:t.id,rid:a.rid,idPsg:a.idPsg,isCheckin:v,gstDate:$("#gstDate").val(),gstCoDate:$("#gstCoDate").val(),cmd:"addResvGuest"};ea(r)}}(e,i,$("#txtPersonSearch").val())}),$("#"+m).on("click",".hhk-emSearch",function(){$("#hdnEcSchPrefix").val($(this).data("prefix")),$("#ecSearch").dialog("open")}),createAutoComplete($("#txtemSch"),3,{cmd:"filter",add:"phone",basis:"psg",psg:i.idPsg},w);let x=function(e){"n"!==e.id&&($("#selDiagnosis").val(e.id),$("#selectedDiag").text(e.label).closest("tr").removeClass("d-none"))};createAutoComplete($("#diagSearch"),3,{cmd:"diagnosis"},x,!1),$(document).on("click","#delDiagnosis",function(e){e.preventDefault(),$("#selDiagnosis").val(""),$("#diagSearch").val(""),$(this).closest("tr").addClass("d-none")}),$("ul.hhk-ui-icons li").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})}for(var _ in M.list())B($("#"+_+"liaddrflag"));$(".hhk-togAddr").each(function(){$(this).parents("tr").next("tr").hide(),$(this).find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),$(this).attr("title","Show Address Section")}),k=!0}},o.newGuestMarkup=function e(t,a){var i,r,s,o,d;void 0!==t.tblId&&""!=t.tblId&&0!==n.length&&(s=n.children("tbody").children("tr").last().hasClass("odd")?"even":"odd",n.find("tbody:first").append($(t.ntr).addClass(s)).append($(t.atr).addClass(s)),$("#"+a+"cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),"1"==$("#"+a+"lblStay").data("stay")&&$("#"+a+"lblStay").click(),$(".ckbdate").datepicker(C),d=(o=$("#"+a+"liaddrflag")).siblings(),B(o),d.parents("tr").next("tr").hide(),d.find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),d.attr("title","Show Address Section"),(i=$("#"+a+"adrcountry"+f)).bfhcountries(i.data()),$(this).data("dirrty-initial-value",$(this).data("country")),(r=$("#"+a+"adrstate"+f)).bfhstates(r.data()),$(this).data("dirrty-initial-value",$(this).data("state")),$("#"+a+"phEmlTabs").tabs(),$("input#"+a+"adrzip1").each(function(){var e;createZipAutoComplete($(this),"ws_admin.php",e,F)}))},o.verify=function e(){let t=0,n=0,o=0,v=0,f=!1,g=0,m=!1,C=!0;for(var w in msgs=[],$(".patientRelch").removeClass("ui-state-error"),$(".patientRelch").each(function(){""===$(this).val()?($(this).addClass("ui-state-error"),m=!0):$(this).removeClass("ui-state-error")}),m&&(msgs.push("Set the highlighted Relationship(s)."),C=!1),b(),y(),M.list())t++,"p"===M.list()[w].role&&n++,"1"===M.list()[w].stay&&o++,"1"===M.list()[w].pri&&v++,$("#"+w+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-n")&&$("#"+w+"toggleAddr").click();if(n<1)msgs.push("Choose a "+i+"."),$(".patientRelch").addClass("ui-state-error"),C=!1;else if(n>1){for(var w in msgs.push("Only 1 "+i+" is allowed."),M.list())"p"===M.list()[w].role&&$("#"+w+"selPatRel").addClass("ui-state-error");C=!1}if(o<1&&(msgs.push("There is no one actually staying.  Pick someone to stay."),C=!1),$("input.hhk-rbPri").parent().removeClass("ui-state-error"),0===v&&1===t)for(var w in M.list())M.list()[w].pri="1";else 0===v&&(msgs.push("Set one "+r+" as "+s+"."),$("input.hhk-rbPri").parent().addClass("ui-state-error"),C=!1);for(var _ in a.find(".hhk-lastname").each(function(){""==$(this).val()?($(this).addClass("ui-state-error"),f=!0):$(this).removeClass("ui-state-error")}),a.find(".hhk-firstname").each(function(){""==$(this).val()?($(this).addClass("ui-state-error"),f=!0):$(this).removeClass("ui-state-error")}),!0===f&&(x(!0),msgs.push("Enter a first and last name for the people highlighted."),C=!1),u&&a.find(".hhk-EmergCb").each(function(){var e=L($(this).data("prefix"));(!0===$(this).prop("checked")||""===e)&&g++}),M.list()){if("p"===M.list()[_].role){if(d&""===$("#"+_+"txtBirthDate").val()?($("#"+_+"txtBirthDate").addClass("ui-state-error"),msgs.push(i+" is missing the Birth Date."),x(!0),C=!1):$("#"+_+"txtBirthDate").removeClass("ui-state-error"),c||p){let P=S(_);P.length>0&&(x(!0),$("#"+_+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+_+"toggleAddr").click(),msgs.push(...P),C=!1)}}else if(l&""===$("#"+_+"txtBirthDate").val()?($("#"+_+"txtBirthDate").addClass("ui-state-error"),msgs.push(r+" is missing the Birth Date."),x(!0),C=!1):$("#"+_+"txtBirthDate").removeClass("ui-state-error"),h){let R=S(_);R.length>0&&(x(!0),$("#"+_+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+_+"toggleAddr").click(),msgs.push(...R),C=!1)}if($("#"+_+"txtBirthDate").length>0&&""!==$("#"+_+"txtBirthDate").val()){var A=new Date($("#"+_+"txtBirthDate").val()),E=new Date;A>E?($("#"+_+"txtBirthDate").addClass("ui-state-error"),msgs.push("This birth date cannot be in the future."),x(!0),C=!1):$("#"+_+"txtBirthDate").removeClass("ui-state-error")}if(u&&g<1){var N=L(_);""!==N&&(msgs.push(N),x(!0),$("#"+_+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+_+"toggleAddr").click(),C=!1)}if(D){var N=I(_);""!==N&&(msgs.push(N),x(!0),$("#"+_+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+_+"toggleAddr").click(),C=!1)}}let T=verifyDocAgent("agentInfo"),F=verifyDocAgent("docInfo");return(!1===T||!1===F)&&(msgs.push("Some or all of the indicated Hospital Information is missing."),C=!1),!1==C&&flagAlertMessage((msgs=[...new Set(msgs)]).join("<br>"),"warning",O),k=!1,C},o.divFamDetailId=m,o.$famTbl=n;let C={yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,maxDate:0,dateFormat:"M d, yy",showButtonPanel:_,beforeShow:function(e){setTimeout(function(){var t=$(e).datepicker("widget").find(".ui-datepicker-buttonpane");t.empty(),$("<button>",{text:"Minor",click:function(){var t=$(e),a=$.datepicker._getInst(t[0]);a.input.val("Minor");var i=$.datepicker._get(a,"onSelect");i?i.apply(a.input?a.input[0]:null,["Minor",a]):a.input&&a.input.trigger("change"),a.inline?$.datepicker._updateDatepicker(a):($.datepicker._hideDatepicker(),$.datepicker._lastInput=a.input[0],"object"!=typeof a.input[0]&&a.input.trigger("focus"),$.datepicker._lastInput=null)}}).appendTo(t).addClass("ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all")},1)},onChangeMonthYear:function(e,t,a){setTimeout(function(){var e=$(a).datepicker("widget").find(".ui-datepicker-buttonpane");e.empty(),$("<button>",{text:"Minor",click:function(){var e=$(a.input),t=$.datepicker._getInst(e[0]);t.input.val("Minor");var i=$.datepicker._get(t,"onSelect");i?i.apply(t.input?t.input[0]:null,["Minor",t]):t.input&&t.input.trigger("change"),t.inline?$.datepicker._updateDatepicker(t):($.datepicker._hideDatepicker(),$.datepicker._lastInput=t.input[0],"object"!=typeof t.input[0]&&t.input.trigger("focus"),$.datepicker._lastInput=null)}}).appendTo(e).addClass("ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all")},1)}};function y(){var e=0;return $(".hhk-cbStay").each(function(){var t=$(this).data("prefix");$(this).prop("checked")?(M.list()[t].stay="1",e++):1===$(".hhk-cbStay").length?M.list()[t].stay="1":M.list()[t].stay="0"}),e}function b(){var e=$("input[type=radio][name=rbPriGuest]:checked").val();for(var t in M.list())M.list()[t].pri="0";void 0!==e&&(M.list()[e].pri="1")}function x(e){var t=$("#divfamDetail");!0===e?(t.show("blind"),t.prev("div").removeClass("ui-corner-all").addClass("ui-corner-top")):(t.hide("blind"),t.prev("div").addClass("ui-corner-all").removeClass("ui-corner-top"))}function w(e){"use strict";$("#ecSearch").dialog("close");var t=parseInt(e.id,10);if(!1===isNaN(t)&&t>0){var a=$("#hdnEcSchPrefix").val();if(""==a)return;$("#"+a+"txtEmrgFirst").val(e.first),$("#"+a+"txtEmrgLast").val(e.last),$("#"+a+"txtEmrgPhn").val(e.phone),$("#"+a+"txtEmrgAlt").val(""),$("#"+a+"selEmrgRel").val("")}}function S(e){var t=[],a=!0;$("#"+e+"incomplete").length>0&&(!1===$("#"+e+"incomplete").prop("checked")||!0==v&&!0==A&&!0===$("#"+e+"cbStay").prop("checked"))&&($("."+e+"hhk-addr-val").not(".hhk-MissingOk").each(function(){""!==$(this).val()||$(this).hasClass("bfh-states")?$(this).removeClass("ui-state-error"):($(this).addClass("ui-state-error"),t.push("Some or all of the indicated addresses are missing."),a=!1)}),!1==a&&$("#"+e+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+e+"toggleAddr").click());var i=!1;$('.hhk-phoneInput[id^="'+e+'txtPhone"]').each(function(){if($(this).hasClass("ui-state-error")&&($("#"+e+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+e+"toggleAddr").click(),$("#"+e+"phEmlTabs").tabs("option","active",1),t.push("Phone is invalid")),""!==$.trim($(this).val())&&!$(this).hasClass("ui-state-error")&&!1==i)return i=!0,!1;i=!1});var r=0!==$('.prefPhone[id^="'+e+'phno"]:checked').length;!0==v&&!0==R&&!1==i&&!1==r&&!0===$("#"+e+"cbStay").prop("checked")&&t.push("At least one valid phone number or 'No Phone' is required for check in.");var s=!1,n=0!==$('.prefEmail[id^="'+e+'emno"]:checked').length;return $('.hhk-emailInput[id^="'+e+'txtEmail"]').each(function(){if(""!==$.trim($(this).val())&&!$(this).hasClass("ui-state-error")&&!1==s)return s=!0,!1}),!0==v&&!0==P&&!1==s&&!1==n&&!0===$("#"+e+"cbStay").prop("checked")&&t.push("At least one email address or 'No Email' is required for check in."),t}function I(e){var t=!1;return($("."+e+"hhk-demog-input").each(function(){""===$(this).val()&&!0===$("#"+e+"cbStay").prop("checked")?($(this).addClass("ui-state-error"),t=!0):$(this).removeClass("ui-state-error")}),t)?"Some or all Demographics are not set":""}function L(e){var t=!1,a=$("#"+e+"txtEmrgFirst"),i=$("#"+e+"txtEmrgLast"),r=$("#"+e+"txtEmrgPhn"),s=$("#"+e+"selEmrgRel");return(a.removeClass("ui-state-error"),i.removeClass("ui-state-error"),r.removeClass("ui-state-error"),s.removeClass("ui-state-error"),$("#"+e+"cbEmrgLater").length>0&&!1===$("#"+e+"cbEmrgLater").prop("checked")&&(""===a.val()&&""===i.val()&&(a.addClass("ui-state-error"),i.addClass("ui-state-error"),t=!0),""===r.val()&&(r.addClass("ui-state-error"),t=!0),""===s.val()&&(s.addClass("ui-state-error"),t=!0),t))?"Some or all of the indicated Emergency Contact Information is missing.  ":""}function T(e){return void 0!==e&&!!e&&""!=e&&""!==$("#"+e+"adraddress1"+f).val()&&""!==$("#"+e+"adrzip"+f).val()&&""!==$("#"+e+"adrstate"+f).val()&&""!==$("#"+e+"adrcity"+f).val()}function F(e){void 0!==e&&(E.list()[e].Address_1=$("#"+e+"adraddress1"+f).val(),E.list()[e].Address_2=$("#"+e+"adraddress2"+f).val(),E.list()[e].City=$("#"+e+"adrcity"+f).val(),E.list()[e].County=$("#"+e+"adrcounty"+f).val(),E.list()[e].State_Province=$("#"+e+"adrstate"+f).val(),E.list()[e].Country_Code=$("#"+e+"adrcountry"+f).val(),E.list()[e].Postal_Code=$("#"+e+"adrzip"+f).val(),B($("#"+e+"liaddrflag")))}function B(e){var t=e.data("pref");!0===$("#"+t+"incomplete").prop("checked")?(e.show().find("span").removeClass("ui-icon-alert").addClass("ui-icon-check").attr("title","Incomplete Address is checked"),e.removeClass("ui-state-error").addClass("ui-state-highlight")):T(t)?e.hide():(e.show().find("span").removeClass("ui-icon-check").addClass("ui-icon-mail-closed").attr("title","Address is Incomplete"),e.removeClass("ui-state-highlight").addClass("ui-state-error"))}function V(e){$("#"+e+"txtEmrgFirst").val(""),$("#"+e+"txtEmrgLast").val(""),$("#"+e+"txtEmrgPhn").val(""),$("#"+e+"txtEmrgAlt").val(""),$("#"+e+"selEmrgRel").val("")}}($("#famSection")),T=new function e(t){var a,i,s,n=this;let o="Determine how to handle the pre-payment.";function d(e){var t=I[$("#selResource").val()],a=!0;$("#selccgw"+e+" option").each(function(){this.value===t.merchant&&(a=!1)}),a&&$("#selccgw"+e).append('<option value="'+t.merchant+'">'+t.merchant+"</option>"),$("#selccgw"+e).val(t.merchant)}function l(e){"use strict";var t="";return""===$("#car"+e+"txtVehLic").val()&&""===$("#car"+e+"txtVehMake").val()?"Enter vehicle info or check the 'No Vehicle' checkbox. ":(""===$("#car"+e+"txtVehLic").val()?(""===$("#car"+e+"txtVehModel").val()&&($("#car"+e+"txtVehModel").addClass("ui-state-highlight"),t="Enter Model"),""===$("#car"+e+"txtVehColor").val()&&($("#car"+e+"txtVehColor").addClass("ui-state-highlight"),t="Enter Color"),""===$("#car"+e+"selVehLicense").val()&&($("#car"+e+"selVehLicense").addClass("ui-state-highlight"),t="Enter state license plate registration")):""===$("#car"+e+"txtVehMake").val()&&""===$("#car"+e+"txtVehLic").val()&&($("#car"+e+"txtVehLic").addClass("ui-state-highlight"),t="Enter a license plate number."),t)}n.setupComplete=!1,n.checkPayments=!0,n.setUp=function e(l){if(a=$("<div/>").addClass(" hhk-tdbox ui-corner-bottom hhk-tdbox ui-widget-content hhk-flex hhk-flex-wrap hhk-overflow-x").prop("id","divResvDetail").css({padding:"5px"}),void 0!==l.resv.rdiv.rChooser&&a.append($(l.resv.rdiv.rChooser)),void 0!==l.resv.rdiv.rate&&a.append($(l.resv.rdiv.rate)),void 0!==l.resv.rdiv.cof&&a.append(l.resv.rdiv.cof),void 0!==l.resv.rdiv.pay&&a.append($(l.resv.rdiv.pay)),void 0!==l.resv.rdiv.rstat&&(a.append($(l.resv.rdiv.rstat)),a.on("change",".hhk-checkboxlist",function(){$(this).prop("checked")?($("#date"+$(this).data("code")).datepicker("setDate","+0"),$("#disp"+$(this).data("code")).show()):($("#date"+$(this).data("code")).val($("#date"+$(this).data("code")).prop("defaultValue")),$("#disp"+$(this).data("code")).hide())}),a.find(".ckdate").datepicker({yearRange:"-02:+03",changeMonth:!0,changeYear:!0,autoSize:!0,numberOfMonths:1,dateFormat:"M d, yy"})),void 0!==l.resv.rdiv.multiResv&&a.append($(l.resv.rdiv.multiResv)),void 0!==l.resv.rdiv.vehicle&&a.append($(l.resv.rdiv.vehicle)),void 0!==l.resv.rdiv.notes&&a.append(function e(t,a,i=null){return t>0?a.notesViewer({linkId:t,linkType:"reservation",newNoteAttrs:{id:"taNewNote",name:"taNewNote"},alertMessage:function(e,t){flagAlertMessage(e,t)}}):i>0&&a.notesViewer({linkId:i,linkType:"psg",newNoteAttrs:{id:"taNewNote",name:"taNewNote"},alertMessage:function(e,t){flagAlertMessage(e,t)}}),a}(l.rid,$(l.resv.rdiv.notes),l.idPsg)),void 0!==l.resv.rdiv.docViewer&&a.append((p=l.idPsg,(u=$(l.resv.rdiv.docViewer)).docUploader({visitorLabel:r,psgId:p,alertMessage:function(e,t){flagAlertMessage(e,t)}}),u)),void 0!==l.resv.rdiv.wlnotes&&a.append($(l.resv.rdiv.wlnotes)),s=$("<ul style='list-style-type:none; float:right; margin-left:5px; padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='r_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),(i=$('<div id="divResvHdr" style="padding:2px; cursor:pointer;"/>').append($(l.resv.hdr)).append(s).append('<div style="clear:both;"/>')).addClass("ui-widget-header ui-state-default ui-corner-top"),i.click(function(e){var t=$(e.target);("divResvHdr"===t[0].id||"r_drpDown"===t[0].id)&&("none"===a.css("display")?(a.show("blind"),i.removeClass("ui-corner-all").addClass("ui-corner-top")):(a.hide("blind"),i.removeClass("ui-corner-top").addClass("ui-corner-all")))}),t.empty().append(i).append(a).show(),n.$totalGuests=$("#spnNumGuests"),n.origRoomId=$("#selResource").val(),n.checkPayments=!0,$(".hhk-viewResvActivity").length>0&&$(".hhk-viewResvActivity").click(function(){$.post("ws_ckin.php",{cmd:"viewActivity",rid:$(this).data("rid")},function(e){if((e=$.parseJSON(e)).error){e.gotopage&&window.open(e.gotopage,"_self"),flagAlertMessage(e.error,"error");return}e.activity&&($("div#submitButtons").hide(),$("#activityDialog").children().remove(),$("#activityDialog").append($(e.activity)),$("#activityDialog").dialog("open"))})}),$("#btnShowCnfrm").button().click(function(){var e=$("#spnAmount").text();""===e&&(e=0),$.post("ws_ckin.php",{cmd:"confrv",rid:$(this).data("rid"),amt:e,eml:"0"},function(e){if((l=$.parseJSON(e)).error){l.gotopage&&window.open(l.gotopage,"_self"),flagAlertMessage(l.error,"error");return}if(l.confrv){$("div#submitButtons").hide(),$("#frmConfirm").children().remove(),$("#frmConfirm").html(l.confrv);var t='<div class="col-md-6 my-2 hhk-flex"><label for="confEmail" class="pr-2" style="min-width:fit-content;">To Address</label><input type="text" style="width:100%" id="confEmail" value="'+l.email+'"></div>';t+='<div class="col-md-6 my-2 hhk-flex"><label for="ccConfEmail" class="pr-2" style="min-width:fit-content;">CC Address</label><input type="text" style="width:100%" id="ccConfEmail" value="'+l.ccemail+'"></div>',$("#frmConfirm").append($('<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix hhk-flex hhk-flex-wrap">'+t+"</div>")),$("#frmConfirm").find("#confirmTabDiv").tabs(),$("#confirmDialog").dialog("open")}})}),$("#btnShowResvMsgs").button().smsDialog({resvId:l.rid}),$(".btnTextGuest").each(function(){var e=$(this).data("idname");$(this).smsDialog({guestId:e})}),v=l.rid,V.idReservation=v,$("input.hhk-constraintsCB").change(function(){V.go($("#gstDate").val(),$("#gstCoDate").val())}),void 0!==l.resv.rdiv.rate&&(f=l,g={},(k=t.find("#btnFapp")).length>0&&($("#faDialog").dialog({autoOpen:!1,resizable:!0,width:getDialogWidth(680),modal:!0,title:"Income Chooser",close:function(){$("div#submitButtons").show()},open:function(){$("div#submitButtons").hide()},buttons:{Save:function(){$.post("ws_ckin.php",$("#formf").serialize()+"&cmd=savefap&rid="+f.rid,function(e){try{e=$.parseJSON(e)}catch(t){alert("Bad JSON Encoding");return}if(e.gotopage&&window.open(e.gotopage,"_self"),e.rstat&&!0==e.rstat){var a=$("#selRateCategory");e.rcat&&""!=e.rcat&&a.length>0&&(a.val(e.rcat),a.change())}}),$(this).dialog("close")},Exit:function(){$(this).dialog("close")}}}),k.button().click(function(){getIncomeDiag(f.rid)})),f.resv.rdiv.ratelist&&(g.rateList=f.resv.rdiv.ratelist,g.resources=f.resv.rdiv.rooms,g.visitFees=f.resv.rdiv.vfee,g.idResv=m,setupRates(g)),$("#selResource").length>0&&$("#selResource").change(function(){var e=I[$("#selResource").val()];e.defaultRateCat&&""!=e.defaultRateCat&&"a"==Y&&$("#selRateCategory").val(e.defaultRateCat),$("#selRateCategory").change();var t=$("option:selected",this).parent()[0].label;null==t?$("#hhkroomMsg").hide():$("#hhkroomMsg").text(t).show(),$("#selccgw").length>0?d(""):$("#selccgwg").length>0&&d("g")})),void 0!==l.resv.rdiv.pay&&$("#selResource").length>0&&$("#selRateCategory").length>0&&(setupPayments($("#selRateCategory").val()),$("#paymentDate").datepicker({yearRange:"-1:+00",numberOfMonths:1,autoSize:!0,dateFormat:"M d, yy"}),$(document).on("change","#selResvStatus",function(){O.text()==o&&O.hide(),w>=0&&"a"!=$(this).val()&&"uc"!=$(this).val()&&"w"!=$(this).val()?(isCheckedOut=!0,$("#feesPayment").val(""),$("#cbHeld").prop("checked",!0).trigger("change")):(isCheckedOut=!1,$("#heldAmount").val(""),$("#txtOverPayAmt").val(""),$("#cbHeld").prop("checked",!1).trigger("change")),amtPaid()}),$("#selResvStatus").change()),void 0!==l.resv.rdiv.rstat){let c,h;c={yearRange:"00:+2",changeMonth:!0,changeYear:!0,autoSize:!0,minDate:0,dateFormat:"M d, yy"},h=moment().add("1","days").format("MMM D, YYYY"),$(document).on("change","#selResvStatus",function(){$("#selexcpay option[value='m']").hide(),"a"!=$(this).val()&&"uc"!=$(this).val()&&"w"!=$(this).val()?($("#newGstDate").datepicker(c),$("#rebookRow").show("fade")):($("#newGstDate").val(""),$("#cbRebook").prop("checked",!1),$("#rebookRow").hide())}),$(document).on("change","#newGstDate",function(){""!=$(this).val()?($("#cbRebook").prop("checked",!0),$("#selexcpay option[value='m']").show()):($("#cbRebook").removeAttr("checked"),$("#selexcpay option[value='m']").hide())}),$(document).on("click","#cbRebook",function(){$(this).prop("checked")?($("#newGstDate").val(h),$("#selexcpay option[value='m']").show()):($("#newGstDate").val(""),$("#selexcpay option[value='m']").hide())}),$("#selResvStatus").change()}if(void 0!==l.resv.rdiv.vehicle&&(y=2,b=(C=a).find("#cbNoVehicle"),x=C.find("#btnNextVeh"),_=C.find("#tblVehicle"),b.change(function(){this.checked?_.hide("scale, horizontal"):_.show("scale, horizontal")}),b.change(),x.button(),x.click(function(){C.find("#trVeh"+y).show("fade"),++y>4&&x.hide("fade")})),void 0!==l.resv.rdiv.cof){var p,u,v,f,g,k,C,y,b,x,_,S=I[$("#selResource").val()];$("#btnUpdtCred").button().click(function(){cardOnFile($(this).data("id"),$(this).data("idreg"),"Reserve.php?rid="+m,$(this).data("indx"))}),setupCOF($(".tblCreditExpandg"),$("#btnUpdtCred").data("indx")),""!==S.merchant&&$("#selccgwg").val(S.merchant)}$("#addGuestHeader").length>0&&(B.openControl=!0,B.setUp(l.resv.rdiv,X,$("#addGuestHeader"))),n.setupComplete=!0},n.verify=function e(){if(O.hide(),$("#cbNoVehicle").length>0){if(!1===$("#cbNoVehicle").prop("checked")){var t=l(1);if(""!=t){var a=l(2);if(""!=a)return $("#vehValidate").text(a),flagAlertMessage(t,"alert",O),!1}}$("#vehValidate").text("")}if(v){if(!0===n.checkPayments){if($("#selCategory").val()==fixedRate&&$("#txtFixedRate").length>0&&""==$("#txtFixedRate").val())return flagAlertMessage("Set the Room Rate to an amount, or to 0.","alert",O),$("#txtFixedRate").addClass("ui-state-error"),!1;if($("#txtFixedRate").removeClass("ui-state-error"),$("input#feesPayment").length>0&&""==$("input#feesPayment").val()&&x)return flagAlertMessage("Set the Room Fees to an amount, or 0.","alert",O),$("#payChooserMsg").text("Set the Room Fees to an amount, or 0.").show(),$("input#feesPayment").addClass("ui-state-error"),!1;if($("input#feesPayment").removeClass("ui-state-error"),$("#payChooserMsg").text(""),void 0!==verifyAmtTendrd&&!1===verifyAmtTendrd())return!1}}else{if(w>0&&isCheckedOut&&""==$("#selexcpay").val())return $("#selexcpay").addClass("ui-state-error"),flagAlertMessage(o,"alert",O),$("#payChooserMsg").text(o).show(),!1;if($("#selexcpay").removeClass("ui-state-error"),$("#payChooserMsg").text(""),$("#selccgw").length>0&&""===$("#spnPayAmount").html()&&(0==$("input[name=rbUseCard]:checked").val()||!0===$("input[name=rbUseCard]").prop("checked"))){if($("#selccgw").removeClass("ui-state-highlight"),0===$("#selccgw option:selected").length)return $("#tdChargeMsg").text("Select a location.").show("fade"),$("#selccgw").addClass("ui-state-highlight"),!1}else $("#selccgw").removeClass("ui-state-highlight"),$("#tdChargeMsg").text("").hide("fade")}return!0}}($("#resvSection")),F=new function e(t){var a=this;a.setupComplete=!1,a.setUp=function(e){var i=$(e.div).addClass("ui-widget-content").prop("id","divhospDetail").hide(),r=$("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='h_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),s=$('<div id="divhospHdr" style="padding:2px; cursor:pointer;"/>').append($(e.hdr)).append(r).append('<div style="clear:both;"/>');s.addClass("ui-widget-header ui-state-default ui-corner-all"),s.click(function(){"none"===i.css("display")?(i.show("blind"),s.removeClass("ui-corner-all").addClass("ui-corner-top")):(i.hide("blind"),s.removeClass("ui-corner-top").addClass("ui-corner-all"))}),t.empty().append(s).append(i),$("#txtEntryDate, #txtExitDate").datepicker({yearRange:"-01:+01",changeMonth:!0,changeYear:!0,autoSize:!0,numberOfMonths:1,dateFormat:"M d, yy",showButtonPanel:!0,beforeShow:function(e){setTimeout(function(){var t=$(e).datepicker("widget").find(".ui-datepicker-buttonpane");t.empty(),$("<button>",{text:"Clear",click:function(){$.datepicker._clearDate(e)}}).appendTo(t).addClass("ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all")},1)},onChangeMonthYear:function(e,t,a){setTimeout(function(){var e=$(a).datepicker("widget").find(".ui-datepicker-buttonpane");e.empty(),$("<button>",{text:"Clear",click:function(){$.datepicker._clearDate(a.input)}}).appendTo(e).addClass("ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all")},1)}}),$("#txtAgentSch").length>0&&(createAutoComplete($("#txtAgentSch"),3,{cmd:"filter",basis:"ra"},getAgent),""===$("#a_txtLastName").val()&&$(".hhk-agentInfo").hide(),$(document).on("click","#a_delete",function(){$("#a_idName").val(""),$("input.hhk-agentInfo").val(""),$(".hhk-agentInfo").hide()}),""!==$("#a_idName").val()?$("input.hhk-agentInfo.name").attr("readonly","readonly"):$("input.hhk-agentInfo.name").removeAttr("readonly")),$("#txtDocSch").length>0&&(createAutoComplete($("#txtDocSch"),3,{cmd:"filter",basis:"doc"},getDoc),""===$("#d_txtLastName").val()&&$(".hhk-docInfo").hide(),""!==$("#d_idName").val()?$("input.hhk-docInfo.name").attr("readonly","readonly"):$("input.hhk-docInfo.name").removeAttr("readonly"),$(document).on("click","#d_delete",function(){$("#d_idName").val(""),$("input.hhk-docInfo").val(""),$(".hhk-docInfo").hide()})),verifyAddrs("#divhospDetail"),t.on("change","#selHospital, #selAssoc",function(){var e=$("#selAssoc").find("option:selected").text();""!=e&&(e+="/ "),$("span#spnHospName").text(e+$("#selHospital").find("option:selected").text())}),t.show(),""===$("#selHospital").val()&&s.click(),a.setupComplete=!0},a.verify=function(){if(t.find(".ui-state-error").removeClass("ui-state-error"),!0===a.setupComplete){let e=t.find("select:required, input:required").filter((e,t)=>""==t.value);if(e.length>0){e.addClass("ui-state-error");let i=e.data("related");i&&t.find(i).addClass("ui-state-error");let r="Please fill in the following required fields:";return e.each((e,a)=>{r+=(0==e?" ":", ")+t.find("label[for="+a.id+"]").text()}),$("#divhospDetail").show("blind"),$("#divhospHdr").removeClass("ui-corner-all").addClass("ui-corner-top"),flagAlertMessage(r,"warning",O),!1}}return $("#divhospDetail").hide("blind"),$("#divhospHdr").removeClass("ui-corner-top").addClass("ui-corner-all"),!0}}($("#hospitalSection")),B=new function e(){var t=this;t.setupComplete=!1,t.ciDate=new Date,t.coDate=new Date,t.openControl=!1,t.setUp=function(e,t,a){if(a.empty(),e.mu&&""!==e.mu){a.append($(e.mu));var i,r=$("#gstDate"),s=$("#gstCoDate"),n=parseInt(e.defdays,10),o=!1,d=!1;""===r.val()&&b&&r.val(b),e.startDate&&(o=e.startDate),e.endDate&&(d=e.endDate),$("#spnRangePicker").length>0&&(i=$("#spnRangePicker").dateRangePicker({format:"MMM D, YYYY",separator:" to ",minDays:1,autoClose:!0,showShortcuts:!0,shortcuts:{"next-days":[n]},getValue:function(){return r.val()&&s.val()?r.val()+" to "+s.val():""},setValue:function(e,t,a){r.val(t),s.val(a)},startDate:o,endDate:d,beforeShowDay:function(e){var t;return[!0,S.includes(e.getDay())?"hhk-datepicker-closed":""]}}),e.updateOnChange&&i.bind("datepicker-change",function(a,i){var r=Math.ceil((i.date2.getTime()-i.date1.getTime())/864e5);$("#"+e.daysEle).val(r),e.mindays>0&&r<e.mindays?$("#"+e.daysErrEle).text("Stay length is less than "+e.mindays+" days").show():$("#"+e.daysErrEle).empty().hide(),$("#spnNites").length>0&&$("#spnNites").text(r),$("#gstDate").removeClass("ui-state-error"),$("#gstCoDate").removeClass("ui-state-error"),$("#selResource").length>0&&V.go($("#gstDate").val(),$("#gstCoDate").val()),$.isFunction(t)&&t(i)})),a.show()}setupComplete=!0},t.verify=function(){let e=!0,a="";var i=$("#gstDate"),r=$("#gstCoDate");if(i.removeClass("ui-state-error"),r.removeClass("ui-state-error"),""===i.val())i.addClass("ui-state-error"),a+="This "+n+" is missing the check-in date.<br>",e=!1;else if(t.ciDate=new Date(i.val()),isNaN(t.ciDate.getTime())&&(i.addClass("ui-state-error"),a+="This "+n+" is missing the check-in date.<br>",e=!1),void 0!==v&&!0===v){var s=moment($("#gstDate").val(),"MMM D, YYYY"),o=moment().endOf("date");s>o&&(i.addClass("ui-state-error"),a+="Set the Check in date to today or earlier.<br>",e=!1)}return""===r.val()?(r.addClass("ui-state-error"),a+="This "+n+" is missing the expected departure date.<br>",e=!1):(t.coDate=new Date(r.val()),isNaN(t.coDate.getTime())&&(r.addClass("ui-state-error"),a+="This "+n+" is missing the expected departure date.<br>",e=!1),t.ciDate>t.coDate&&(i.addClass("ui-state-error"),a+="This "+n+"'s check-in date is after the expected departure date.<br>",e=!1)),flagAlertMessage(a,"warning",O),e}},V=new V,O=$("#pWarnings"),t=t,Y="",G="";function z(){return w}function H(e){I=e}function U(){return m}function J(){return C}function q(){return y}function j(){return g}function W(){return k}function K(){return D}function Q(e){if(""!=G){let t=G.split(",");if("last"==e.toLowerCase()&&t.length>0)return t[0].trim();if("first"==e.toLowerCase()&&t.length>1)return t[1].trim()}return""}function X(e){O.text("").hide();var t=!1;for(var a in M.list())if(M.list()[a].id>0){t=!0;break}if(t){$(".hhk-stayIndicate").hide().parent("td").addClass("hhk-loading");var i={cmd:"updateAgenda",idPsg:g,idResv:m,idVisit:C,span:y,dt1:e.date1.getFullYear()+"-"+(e.date1.getMonth()+1)+"-"+e.date1.getDate(),dt2:e.date2.getFullYear()+"-"+(e.date2.getMonth()+1)+"-"+e.date2.getDate(),mems:M.list()};$.post("ws_resv.php",i,function(e){$(".hhk-stayIndicate").show().parent("td").removeClass("hhk-loading");try{e=$.parseJSON(e)}catch(t){flagAlertMessage(t.message,"error");return}if(e.gotopage&&window.open(e.gotopage,"_self"),e.error&&flagAlertMessage(e.error,"error"),e.stayCtrl){for(var a in e.stayCtrl){var i;$("#sb"+a).empty().html(e.stayCtrl[a].ctrl),$("#"+a+"cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),M.list()[a].stay="0",(i=$("#"+a+"lblStay")).length>0&&"1"==i.data("stay")&&i.click()}$(".hhk-getVDialog").button(),""!=$("#gstDate").val()&&""!=$("#gstCoDate").val()&&V.go($("#gstDate").val(),$("#gstCoDate").val()),$(".hhk-cbStay").change()}})}Z(e.date1.t,m)}function Z(e,t,a){var i=moment(e,"MMM D, YYYY"),r=moment().endOf("date");t>0&&i<=r&&!a?$("#btnCheckinNow").show():$("#btnCheckinNow").hide()}function V(){var e=this,t={};e.omitSelf=!0,e.numberGuests=0,e.idReservation=0,e.go=function a(i,r){var s,n=$("#selResource");0!==n.length&&(s=n.find("option:selected").val(),n.prop("disabled",!0),$("#hhk-roomChsrtitle").addClass("hhk-loading"),$("#hhkroomMsg").text("").hide(),t={},$("input.hhk-constraintsCB:checked").each(function(){t[$(this).data("cnid")]="ON"}),$.post("ws_ckin.php",{cmd:"newConstraint",rid:e.idReservation,numguests:e.numberGuests,expArr:i,expDep:r,idr:s,cbRS:t,omsf:e.omitSelf},function(e){var t,a;n.prop("disabled",!1),$("#hhk-roomChsrtitle").removeClass("hhk-loading");try{e=$.parseJSON(e)}catch(i){alert("Parser error - "+i.message);return}if(e.error){e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,"error");return}e.rooms&&(I=a=e.rooms),e.selectr&&(t=$(e.selectr),n.children().remove(),t.children().appendTo(n),n.val(e.idResource).change(),e.msg&&""!==e.msg&&$("#hhkroomMsg").text(e.msg).show())}))}}function ee(){var e,t={},a=this;function i(){return t}function r(a){return!1===s(a)&&(t[a[e]]=a,!0)}function s(a){return void 0!==t[a[e]]}a.hasItem=s,a.findItem=function e(a,i){for(var r in t)if(t[r][a]==i)return t[r];return null},a.addItem=r,a.removeIndex=function e(a){delete t[a]},a.list=i,a.makeList=function t(a,i){for(var s in e=i,a)r(a[s])},a._list=t}function et(e,t){"use strict";$("input#txtPersonSearch").val(""),t.empty().append($(e.psgChooser)).dialog("option","buttons",{Open:function(){$(this).dialog("close"),ea({idPsg:t.find("input[name=cbselpsg]:checked").val(),id:e.id,cmd:"getResv"})},Cancel:function(){$(this).dialog("close"),$("input#gstSearch").val("").focus()}}).dialog("option","title",e.patLabel+" Chooser"+(void 0===e.fullName?"":" For: "+e.fullName)).dialog("open")}function ea(e){e.guestSearchTerm&&""!=e.guestSearchTerm&&(G=e.guestSearchTerm);let t={id:e.id,rid:e.rid,idPsg:e.idPsg,vid:e.vid,span:e.span,isCheckin:v,gstDate:e.gstDate,gstCoDate:e.gstCoDate,cmd:e.cmd};$.post("ws_resv.php",t,function(e){try{e=$.parseJSON(e)}catch(t){flagAlertMessage(t.message,"error");return}e.gotopage&&window.open(e.gotopage,"_self"),e.error&&(flagAlertMessage(e.error,"error",O),$("#btnDone").val("Save "+n).show()),ei(e)})}function ei(e){var t,a,i,r,s,d,l;if((e.xfer||e.inctx||e.deluxehpf)&&(t=e,a=e.rid,paymentRedirect(t,$("#xform"),{resvId:a})),e.deleted){$("#guestSearch").hide(),$("#contentDiv").append("<p>"+e.deleted+"</p>"),e.childDeleted&&e.childDeleted>0&&$("#contentDiv").append("<p>Also deleted "+e.childDeleted+" child reservations.</p>"),$("#spnStatus").text("Deleted");return}if(e.resvChooser&&""!==e.resvChooser){i=e,r=$("#resDialog"),s=$("#psgDialog"),d={},$("input#txtPersonSearch").val(""),r.empty().append($(i.resvChooser)).children().find("input:button").button(),r.children().find(".hhk-checkinNow").click(function(){window.open("CheckingIn.php?rid="+$(this).data("rid")+"&gid="+i.id,"_self")}),i.psgChooser&&""!==i.psgChooser&&(d[i.patLabel+" Chooser"]=function(){$(this).dialog("close"),et(i,s)}),i.resvTitle&&(d["New "+i.resvTitle]=function(){i.rid=-1,i.cmd="getResv",$(this).dialog("close"),ea(i)}),d.Exit=function(){$(this).dialog("close"),$("input#gstSearch").val("").focus()},r.dialog("option","width","95%"),r.dialog("option","buttons",d),r.dialog("option","title",i.resvTitle+" Chooser"),r.dialog("open"),l=r.find("table").width(),r.dialog("option","width",l+80);return}if(e.psgChooser&&""!==e.psgChooser){et(e,$("#psgDialog"));return}e.idPsg&&(g=e.idPsg),e.id&&(k=e.id),e.rid&&(m=e.rid),e.vid&&(C=e.vid),e.span&&(y=e.span),e.resvStatusCode,e.resvStatusType&&(Y=e.resvStatusType),e.prePayment&&(w=e.prePayment),void 0!==e.hosp&&F.setUp(e.hosp),e.famSection&&(L.setUp(e),$("div#guestSearch").hide(),$("#btnDone").val("Save Family").show(),$("select.hhk-multisel").each(function(){$(this).multiselect({selectedList:3})})),void 0!==e.expDates&&""!==e.expDates&&(B.openControl=!1,B.setUp(e.expDates,X,$("#datesSection"))),void 0!==e.warning&&""!==e.warning&&flagAlertMessage(e.warning,"warning",O),void 0!==e.resv&&(e.resv.rdiv.rooms&&(I=e.resv.rdiv.rooms),T.setUp(e),$("#"+L.divFamDetailId).on("change",".hhk-cbStay",function(){let e=L.findStaysChecked();if(T.$totalGuests.text(e),e+=L.findStays("r"),$("#selRateCategory").trigger("change"),$("#selResource").length>0&&"0"!==$("#selResource").val()){let t="Room may be too small",a=I[$("#selResource").val()];e>a.maxOcc?$("#hhkroomMsg").text(t).show():$("#hhkroomMsg").text()==t&&$("#hhkroomMsg").text("").hide()}e>0?T.$totalGuests.parent().removeClass("ui-state-highlight"):T.$totalGuests.parent().addClass("ui-state-highlight")}),$("#"+L.divFamDetailId).on("click",".hhk-getVDialog",function(){var e,t=$(this).data("vid"),a=$(this).data("span");e={"Show Statement":function(){window.open("ShowStatement.php?vid="+t,"_blank")},"Show Registration Form":function(){window.open("ShowRegForm.php?vid="+t+"&span="+a,"_blank")},Save:function(){saveFees(0,t,a,!1,payFailPage)},Cancel:function(){$(this).dialog("close")}},viewVisit(0,t,e,"Edit Visit #"+t+"-"+a,"hf",a),$("#submitButtons").hide()}),$(".hhk-cbStay").change(),$("#btnDone").val(o).show(),e.rid>0&&($("#btnDelete").val("Delete "+n).show(),$("#btnShowReg").show(),$("#spnStatus").text(""===e.resv.rdiv.rStatTitle?"":" - "+e.resv.rdiv.rStatTitle)),Z($("#gstDate").val(),e.rid,e.resv.rdiv.hideCiNowBtn),D=e.insistCkinDemog),void 0!==e.addPerson&&M.addItem(e.addPerson.mem)&&(E.addItem(e.addPerson.addrs),L.newGuestMarkup(e.addPerson,e.addPerson.mem.pref),L.findStaysChecked(),$(".hhk-cbStay").change(),$("#txtPersonSearch").val(""),""===$("#"+e.addPerson.mem.pref+"txtLastName").val()&&$("#"+e.addPerson.mem.pref+"txtLastName").val(Q("last")).focus(),""===$("#"+e.addPerson.mem.pref+"txtFirstName").val()&&$("#"+e.addPerson.mem.pref+"txtFirstName").val(Q("first")).focus()),$("#submitButtons").show()}a.getReserve=ea,a.verifyInput=function e(){return O.text("").hide(),!1!==B.verify()&&!1!==L.verify()&&!1!==F.verify()&&(!0!==T.setupComplete||!1!==T.verify())},a.loadResv=ei,a.deleteReserve=function e(){return $("#feesPayment").val("").trigger("change"),!(w>0)||""!=$("#selexcpay").val()||(isCheckedOut?($("#selexcpay").addClass("ui-state-error"),flagAlertMessage("Determine how to handle the pre-payment.","alert",O),$("#payChooserMsg").text("Determine how to handle the pre-payment.").show(),!1):($("#selexcpay").removeClass("ui-state-error"),isCheckedOut=!0,$("#cbHeld").prop("checked",!0),amtPaid(),!1))},a.resvTitle=n,a.people=M,a.addrs=E,a.getIdPsg=j,a.getIdResv=U,a.getIdName=W,a.getIdVisit=J,a.getPrePaymtAmt=z,a.getSpan=q,a.setRooms=H,a.options=t}function verifyDocAgent(e){let t=$(`input.hhk-${e}`);if(t.removeClass("ui-state-error"),t.is((e,t)=>""!==$(t).val().trim())){let a=t.filter((e,t)=>""===$(t).val().trim()&&$(t).hasClass("name"));if(a.length>0)return a.addClass("ui-state-error"),$("#divhospDetail").show("blind"),!1}return!0}