function resvManager(a,c){var b=this,p=a.patLabel,q=a.visitorLabel;a.guestLabel;var r=a.primaryGuestLabel,e=a.resvTitle,s=a.saveButtonLabel,t=a.patBD,u=a.gstBD,v=a.patAddr,w=a.gstAddr,x=a.patAsGuest,y=void 0!==a.emergencyContact&&a.emergencyContact,z=void 0!==a.isCheckin&&a.isCheckin,A=a.addrPurpose,B=a.idPsg,C=a.rid,D=a.id,E=a.vid,F=a.span,G=a.arrival,H=a.insistPayFilledIn,I=!1,J=[],f=new S,g=new S,K=new function(i){var b,a=this,d="divfamDetail",j=!1;function e(){var a=0;return $(".hhk-cbStay").each(function(){var b=$(this).data("prefix");$(this).prop("checked")?(f.list()[b].stay="1",a++):1===$(".hhk-cbStay").length?f.list()[b].stay="1":f.list()[b].stay="0"}),a}function h(){var a=$("input[type=radio][name=rbPriGuest]:checked").val();for(var b in f.list())f.list()[b].pri="0";void 0!==a&&(f.list()[a].pri="1")}function k(b){var a=$("#divfamDetail");!0===b?(a.show("blind"),a.prev("div").removeClass("ui-corner-all").addClass("ui-corner-top")):(a.hide("blind"),a.prev("div").addClass("ui-corner-all").removeClass("ui-corner-top"))}function l(b){"use strict";$("#ecSearch").dialog("close");var c=parseInt(b.id,10);if(!1===isNaN(c)&&c>0){var a=$("#hdnEcSchPrefix").val();if(""==a)return;$("#"+a+"txtEmrgFirst").val(b.first),$("#"+a+"txtEmrgLast").val(b.last),$("#"+a+"txtEmrgPhn").val(b.phone),$("#"+a+"txtEmrgAlt").val(""),$("#"+a+"selEmrgRel").val("")}}function m(a){var c=/^([\(]{1}[0-9]{3}[\)]{1}[\.| |\-]{0,1}|^[0-9]{3}[\.|\-| ]?)?[0-9]{3}(\.|\-| )?[0-9]{4}$/,b=!1;return $("#"+a+"incomplete").length>0&& !1===$("#"+a+"incomplete").prop("checked")&&($("."+a+"hhk-addr-val").not(".hhk-MissingOk").each(function(){""!==$(this).val()||$(this).hasClass("bfh-states")?$(this).removeClass("ui-state-error"):($(this).addClass("ui-state-error"),b=!0)}),b)?($("#"+a+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+a+"toggleAddr").click(),"Some or all of the indicated addresses are missing.  "):($('.hhk-phoneInput[id^="'+a+'txtPhone"]').each(function(){""!==$.trim($(this).val())&& !1===c.test($(this).val())?($(this).addClass("ui-state-error"),$("#"+a+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+a+"toggleAddr").click(),$("#"+a+"phEmlTabs").tabs("option","active",1),b=!0):$(this).removeClass("ui-state-error")}),"")}function o(a){var b=!1;return($("."+a+"hhk-demog-input").each(function(){""===$(this).val()?($(this).addClass("ui-state-error"),b=!0):$(this).removeClass("ui-state-error")}),b)?"Some or all Demographics are not set":""}function s(a){var b=!1,c=$("#"+a+"txtEmrgFirst"),d=$("#"+a+"txtEmrgLast"),e=$("#"+a+"txtEmrgPhn"),f=$("#"+a+"selEmrgRel");return(c.removeClass("ui-state-error"),d.removeClass("ui-state-error"),e.removeClass("ui-state-error"),f.removeClass("ui-state-error"),$("#"+a+"cbEmrgLater").length>0&& !1===$("#"+a+"cbEmrgLater").prop("checked")&&(""===c.val()&&""===d.val()&&(c.addClass("ui-state-error"),d.addClass("ui-state-error"),b=!0),""===e.val()&&(e.addClass("ui-state-error"),b=!0),""===f.val()&&(f.addClass("ui-state-error"),b=!0),b))?"Some or all of the indicated Emergency Contact Information is missing.  ":""}function C(a){return void 0!==a&&!!a&&""!=a&&""!==$("#"+a+"adraddress1"+A).val()&&""!==$("#"+a+"adrzip"+A).val()&&""!==$("#"+a+"adrstate"+A).val()&&""!==$("#"+a+"adrcity"+A).val()}function D(a,b){if(0==b){$("#divSelAddr").remove();return}$("#"+a+"adraddress1"+A).val(g.list()[b].Address_1),$("#"+a+"adraddress2"+A).val(g.list()[b].Address_2),$("#"+a+"adrcity"+A).val(g.list()[b].City),$("#"+a+"adrcounty"+A).val(g.list()[b].County),$("#"+a+"adrzip"+A).val(g.list()[b].Postal_Code),$("#"+a+"adrcountry"+A).val()!=g.list()[b].Country_Code&&$("#"+a+"adrcountry"+A).val(g.list()[b].Country_Code).change(),$("#"+a+"adrstate"+A).val(g.list()[b].State_Province),C(a)&& !0===$("#"+a+"incomplete").prop("checked")&&$("#"+a+"incomplete").prop("checked",!1),F($("#"+a+"liaddrflag")),$("#divSelAddr").remove()}function E(a){void 0!==a&&(g.list()[a].Address_1=$("#"+a+"adraddress1"+A).val(),g.list()[a].Address_2=$("#"+a+"adraddress2"+A).val(),g.list()[a].City=$("#"+a+"adrcity"+A).val(),g.list()[a].County=$("#"+a+"adrcounty"+A).val(),g.list()[a].State_Province=$("#"+a+"adrstate"+A).val(),g.list()[a].Country_Code=$("#"+a+"adrcountry"+A).val(),g.list()[a].Postal_Code=$("#"+a+"adrzip"+A).val(),F($("#"+a+"liaddrflag")))}function F(a){var b=a.data("pref");!0===$("#"+b+"incomplete").prop("checked")?(a.show().find("span").removeClass("ui-icon-alert").addClass("ui-icon-check").attr("title","Incomplete Address is checked"),a.removeClass("ui-state-error").addClass("ui-state-highlight")):C(b)?a.hide():(a.show().find("span").removeClass("ui-icon-check").addClass("ui-icon-alert").attr("title","Address is Incomplete"),a.removeClass("ui-state-highlight").addClass("ui-state-error"))}a.findStaysChecked=e,a.findStays=function(b){var a=0;for(var c in f.list())f.list()[c].stay===b&&a++;return a},a.findPrimaryGuest=h,a.setUp=function(a){if(void 0!==a.famSection&& void 0!==a.famSection.tblId&&""!==a.famSection.tblId){for(var k in!1===j&&(q=a,r=$("<div/>").addClass("ui-widget-content ui-corner-bottom hhk-tdbox hhk-overflow-x").prop("id",d).css("padding","5px"),b=$("<table/>").prop("id",q.famSection.tblId).addClass("hhk-table").append($("<thead/>").append($(q.famSection.tblHead))).append($("<tbody/>")),r.append(b).append($(q.famSection.adtnl)),t=$("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='f_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),s=$('<div id="divfamHdr" style="padding:2px; cursor:pointer;"/>').append($(q.famSection.hdr)).append(t).append('<div style="clear:both;"/>'),s.addClass("ui-widget-header ui-state-default ui-corner-top"),s.click(function(){"none"===r.css("display")?(r.show("blind"),s.removeClass("ui-corner-all").addClass("ui-corner-top")):(r.hide("blind"),s.removeClass("ui-corner-top").addClass("ui-corner-all"))}),i.empty().append(s).append(r).show(),c.UseIncidentReports&&function(){if(B){var b,a,c;b=$('<div style="font-size: 0.9em; max-width: 100%; margin-bottom: 0.5em; margin-top: 0.5em; display: none;"/>').addClass("ui-widget hhk-visitdialog hhk-row").prop("id","incidentsSection"),a=$('<div style="padding:2px; cursor:pointer;"/>').addClass("ui-widget-header ui-state-default ui-corner-all hhk-incidentHdr"),c=$('<div style="padding: 5px;"/>').addClass("ui-corner-bottom hhk-tdbox ui-widget-content").prop("id","incidentContent").hide(),a.append('<div class="hhk-checkinHdr" style="display: inline-block">Incidents<span id="incidentCounts"/></div>').append('<ul style="list-style-type:none; float:right;margin-left:5px;padding-top:2px;" class="ui-widget"><li class="ui-widget-header ui-corner-all" title="Open - Close"><span id="f_drpDown" class="ui-icon ui-icon-circle-triangle-n"></span></li></ul>'),c.incidentViewer({psgId:B,guestLabel:$("#guestLabel").val(),visitorLabel:$("#visitorLabel").val()}),a.click(function(){"none"===c.css("display")?(c.show("blind"),a.removeClass("ui-corner-all").addClass("ui-corner-top")):(c.hide("blind"),a.removeClass("ui-corner-top").addClass("ui-corner-all"))}),b.append(a).append(c).show(),i.find("#divfamDetail").append(b)}}()),a.famSection.mem){var o,p,q,r,s,t,e=f.findItem("pref",a.famSection.mem[k].pref);e&&(b.find("tr#"+e.id+"n").remove(),b.find("tr#"+e.id+"a").remove(),b.find("input#"+e.pref+"idName").parents("tr").next("tr").remove(),b.find("input#"+e.pref+"idName").parents("tr").remove(),f.removeIndex(e.pref),g.removeIndex(e.pref))}for(var h in f.makeList(a.famSection.mem,"pref"),g.makeList(a.famSection.addrs,"pref"),void 0!==a.famSection.tblBody["1"]&&b.find("tbody:first").prepend($(a.famSection.tblBody["1"])),void 0!==a.famSection.tblBody["0"]&&b.find("tbody:first").prepend($(a.famSection.tblBody["0"])),a.famSection.tblBody)"0"!==h&&"1"!==h&&b.find("tbody:first").append($(a.famSection.tblBody[h]));for(var m in $(".hhk-cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),$(".hhk-lblStay").each(function(){"1"==$(this).data("stay")&&$(this).click()}),$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,maxDate:0,dateFormat:"M d, yy"}),$(".hhk-addrPanel").find("select.bfh-countries").each(function(){var a=$(this);a.bfhcountries(a.data()),$(this).data("dirrty-initial-value",$(this).data("country"))}),$(".hhk-addrPanel").find("select.bfh-states").each(function(){var a=$(this);a.bfhstates(a.data()),$(this).data("dirrty-initial-value",$(this).data("state"))}),$(".hhk-phemtabs").tabs(),$("#InsTabs").tabs(),verifyAddrs("#divfamDetail"),$("input.hhk-zipsearch").each(function(){var a;createZipAutoComplete($(this),"ws_admin.php",a,E)}),!1===j&&($("#lnCopy").click(function(){var a=$("input.hhk-lastname").first().val();$("input.hhk-lastname").each(function(){""===$(this).val()&&$(this).val(a)})}),$("#adrCopy").click(function(){!function(b){for(var a in g.list())b!=a&&(""===$("#"+a+"adraddress1"+A).val()||""===$("#"+a+"adrzip"+A).val())&&($("#"+a+"adraddress1"+A).val(g.list()[b].Address_1),$("#"+a+"adraddress2"+A).val(g.list()[b].Address_2),$("#"+a+"adrcity"+A).val(g.list()[b].City),$("#"+a+"adrcounty"+A).val(g.list()[b].County),$("#"+a+"adrzip"+A).val(g.list()[b].Postal_Code),$("#"+a+"adrcountry"+A).val()!=g.list()[b].Country_Code&&$("#"+a+"adrcountry"+A).val(g.list()[b].Country_Code).change(),$("#"+a+"adrstate"+A).val(g.list()[b].State_Province),!0===$("#"+b+"incomplete").prop("checked")?$("#"+a+"incomplete").prop("checked",!0):C(a)&& !0===$("#"+a+"incomplete").prop("checked")&&$("#"+a+"incomplete").prop("checked",!1),F($("#"+a+"liaddrflag")))}($("li.hhk-AddrFlag").first().data("pref"))}),$("#"+d).on("click",".hhk-togAddr",function(){o=$(this),p=$(this).siblings(),"none"===$(this).parents("tr").next("tr").css("display")?($(this).parents("tr").next("tr").show(),o.find("span").removeClass("ui-icon-circle-triangle-s").addClass("ui-icon-circle-triangle-n"),o.attr("title","Hide Address Section")):($(this).parents("tr").next("tr").hide(),o.find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),o.attr("title","Show Address Section"),isIE()&&$("#divSelAddr").remove())}),$("#"+d).on("click",".hhk-AddrFlag",function(){$("#"+$(this).data("pref")+"incomplete").click()}),$("#"+d).on("change",".hhk-copy-target",function(){E($(this).data("pref"))}),$("#"+d).on("click",".hhk-addrCopy",function(){!function(i,j){$(".hhk-addrPicker").remove();var b=$('<select id="selAddrch" multiple="multiple" />'),c=0,d=[];for(var a in g.list())if(""!=g.list()[a].Address_1||""!=g.list()[a].Postal_Code){for(var h=!0,e=g.list()[a].Address_1+", "+(""==g.list()[a].Address_2?"":g.list()[a].Address_2+", ")+g.list()[a].City+", "+g.list()[a].State_Province+"  "+g.list()[a].Postal_Code,f=0;f<=d.length;f++)if(d[f]==e){h=!1;continue}h&&(d[c]=e,c++,$('<option class="hhk-addrPickerPanel" value="'+a+'">'+e+"</option>").appendTo(b))}c>0&&(b.prop("size",c+1).prepend($('<option value="0" >(Cancel)</option>')),b.change(function(){D(j,$(this).val())}),$('<div id="divSelAddr" style="position:absolute; vertical-align:top;" class="hhk-addrPicker hhk-addrPickerPanel"/>').append($('<p class="hhk-addrPickerPanel">Choose an Address: </p>')).append(b).appendTo($("body")).position({my:"left top",at:"right center",of:i}))}($(this),$(this).data("prefix"))}),$("#"+d).on("click",".hhk-addrErase",function(){var a;a=$(this).data("prefix"),$("#"+a+"adraddress1"+A).val(""),$("#"+a+"adraddress2"+A).val(""),$("#"+a+"adrcity"+A).val(""),$("#"+a+"adrcounty"+A).val(""),$("#"+a+"adrstate"+A).val(""),$("#"+a+"adrcountry"+A).val(""),$("#"+a+"adrzip"+A).val(""),F($("#"+a+"liaddrflag"))}),$("#"+d).on("click",".hhk-incompleteAddr",function(){F($("#"+$(this).data("prefix")+"liaddrflag"))}),$("#"+d).on("click",".hhk-removeBtn",function(){(""===$("#"+$(this).data("prefix")+"txtFirstName").val()&&""===$("#"+$(this).data("prefix")+"txtLastName").val()|| !1!==confirm("Remove this person: "+$("#"+$(this).data("prefix")+"txtFirstName").val()+" "+$("#"+$(this).data("prefix")+"txtLastName").val()+"?"))&&(f.removeIndex($(this).data("prefix")),g.removeIndex($(this).data("prefix")),$(this).parentsUntil("tbody","tr").next().remove(),$(this).parentsUntil("tbody","tr").remove())}),$("#"+d).on("change",".patientRelch",function(){"slf"===$(this).val()?f.list()[$(this).data("prefix")].role="p":f.list()[$(this).data("prefix")].role="g"}),createAutoComplete($("#txtPersonSearch"),3,{cmd:"role",gp:"1"},function(b){!function(a,b,c){if(void 0!==a.No_Return&&""!==a.No_Return){flagAlertMessage("This person is set for No Return: "+a.No_Return+".","alert");return}if(void 0!==a.id){if(a.id>0&&null!==f.findItem("id",a.id)){flagAlertMessage("This person is already listed here. ","alert");return}var d={id:a.id,rid:b.rid,idPsg:b.idPsg,isCheckin:z,gstDate:$("#gstDate").val(),gstCoDate:$("#gstCoDate").val(),cmd:"addResvGuest",schTerm:c};n(d)}}(b,a,$("#txtPersonSearch").val())}),$("#"+d).on("click",".hhk-emSearch",function(){$("#hdnEcSchPrefix").val($(this).data("prefix")),$("#ecSearch").dialog("open")}),createAutoComplete($("#txtemSch"),3,{cmd:"filter",add:"phone",basis:"g"},l),$("ul.hhk-ui-icons li").hover(function(){$(this).addClass("ui-state-hover")},function(){$(this).removeClass("ui-state-hover")})),f.list())F($("#"+m+"liaddrflag"));$(".hhk-togAddr").each(function(){$(this).parents("tr").next("tr").hide(),$(this).find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),$(this).attr("title","Show Address Section")}),j=!0}},a.newGuestMarkup=function(c,a){var e,f,g,h,d;void 0!==c.tblId&&""!=c.tblId&&0!==b.length&&(g=b.children("tbody").children("tr").last().hasClass("odd")?"even":"odd",b.find("tbody:first").append($(c.ntr).addClass(g)).append($(c.atr).addClass(g)),$("#"+a+"cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),"1"==$("#"+a+"lblStay").data("stay")&&$("#"+a+"lblStay").click(),$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,maxDate:0,dateFormat:"M d, yy"}),h=$("#"+a+"liaddrflag"),d=h.siblings(),F(h),d.parents("tr").next("tr").hide(),d.find("span").removeClass("ui-icon-circle-triangle-n").addClass("ui-icon-circle-triangle-s"),d.attr("title","Show Address Section"),e=$("#"+a+"adrcountry"+A),e.bfhcountries(e.data()),$(this).data("dirrty-initial-value",$(this).data("country")),f=$("#"+a+"adrstate"+A),f.bfhstates(f.data()),$(this).data("dirrty-initial-value",$(this).data("state")),$("#"+a+"phEmlTabs").tabs(),$("input#"+a+"adrzip1").each(function(){var a;createZipAutoComplete($(this),"ws_admin.php",a,E)}))},a.verify=function(){var l=0,d=0,n=0,g=0,z=!1,A=0,B=!1;if($(".patientRelch").removeClass("ui-state-error"),$(".patientRelch").each(function(){""===$(this).val()?($(this).addClass("ui-state-error"),B=!0):$(this).removeClass("ui-state-error")}),B)return flagAlertMessage("Set the highlighted Relationship(s).","alert",O),!1;for(var c in h(),e(),f.list())l++,"p"===f.list()[c].role&&d++,"1"===f.list()[c].stay&&n++,"1"===f.list()[c].pri&&g++,$("#"+c+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-n")&&$("#"+c+"toggleAddr").click();if(d<1)return flagAlertMessage("Choose a "+p+".","alert",O),$(".patientRelch").addClass("ui-state-error"),!1;if(d>1){for(var c in flagAlertMessage("Only 1 "+p+" is allowed.","alert",O),f.list())"p"===f.list()[c].role&&$("#"+c+"selPatRel").addClass("ui-state-error");return!1}if(n<1)return flagAlertMessage("There is no one actually staying.  Pick someone to stay.","alert",O),!1;if($("input.hhk-rbPri").parent().removeClass("ui-state-error"),0===g&&1===l)for(var c in f.list())f.list()[c].pri="1";else if(0===g)return O.text("Set one "+q+" as "+r+".").show(),flagAlertMessage("Set one "+q+" as "+r+".","alert",O),$("input.hhk-rbPri").parent().addClass("ui-state-error"),!1;if(i.find(".hhk-lastname").each(function(){""==$(this).val()?($(this).addClass("ui-state-error"),z=!0):$(this).removeClass("ui-state-error")}),i.find(".hhk-firstname").each(function(){""==$(this).val()?($(this).addClass("ui-state-error"),z=!0):$(this).removeClass("ui-state-error")}),!0===z)return k(!0),flagAlertMessage("Enter a first and last name for the people highlighted.","alert",O),!1;for(var a in y&&i.find(".hhk-EmergCb").each(function(){var a=s($(this).data("prefix"));(!0===$(this).prop("checked")||""===a)&&A++}),f.list()){if("p"===f.list()[a].role){if(t&""===$("#"+a+"txtBirthDate").val())return $("#"+a+"txtBirthDate").addClass("ui-state-error"),flagAlertMessage(p+" is missing the Birth Date.","alert",O),k(!0),!1;if($("#"+a+"txtBirthDate").removeClass("ui-state-error"),v||x){var b=m(a);if(""!==b)return flagAlertMessage(b,"alert",O),k(!0),$("#"+a+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+a+"toggleAddr").click(),!1}}else{if(u&""===$("#"+a+"txtBirthDate").val())return $("#"+a+"txtBirthDate").addClass("ui-state-error"),flagAlertMessage(q+" is missing the Birth Date.","alert",O),k(!0),!1;if($("#"+a+"txtBirthDate").removeClass("ui-state-error"),w){var b=m(a);if(""!==b)return flagAlertMessage(b,"alert",O),k(!0),$("#"+a+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+a+"toggleAddr").click(),!1}}if($("#"+a+"txtBirthDate").length>0&&""!==$("#"+a+"txtBirthDate").val()){var C=new Date($("#"+a+"txtBirthDate").val()),D=new Date;if(C>D)return $("#"+a+"txtBirthDate").addClass("ui-state-error"),flagAlertMessage("This birth date cannot be in the future.","alert",O),k(!0),!1;$("#"+a+"txtBirthDate").removeClass("ui-state-error")}if(y&&A<1){var b=s(a);if(""!==b)return flagAlertMessage(b,"alert",O),k(!0),$("#"+a+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+a+"toggleAddr").click(),!1}if(I){var b=o(a);if(""!==b)return flagAlertMessage(b,"alert",O),k(!0),$("#"+a+"toggleAddr").find("span").hasClass("ui-icon-circle-triangle-s")&&$("#"+a+"toggleAddr").click(),!1}}return j=!1,!0},a.divFamDetailId=d,a.$famTbl=b}($("#famSection")),L=new function(b){var c,e,f,g,a=this;function h(a){var b=J[$("#selResource").val()],c=!0;$("#selccgw"+a+" option").each(function(){this.value===b.merchant&&(c=!1)}),c&&$("#selccgw"+a).append('<option value="'+b.merchant+'">'+b.merchant+"</option>"),$("#selccgw"+a).val(b.merchant)}function i(a){"use strict";var b="";return""===$("#car"+a+"txtVehLic").val()&&""===$("#car"+a+"txtVehMake").val()?"Enter vehicle info or check the 'No Vehicle' checkbox. ":(""===$("#car"+a+"txtVehLic").val()?(""===$("#car"+a+"txtVehModel").val()&&($("#car"+a+"txtVehModel").addClass("ui-state-highlight"),b="Enter Model"),""===$("#car"+a+"txtVehColor").val()&&($("#car"+a+"txtVehColor").addClass("ui-state-highlight"),b="Enter Color"),""===$("#car"+a+"selVehLicense").val()&&($("#car"+a+"selVehLicense").addClass("ui-state-highlight"),b="Enter state license plate registration")):""===$("#car"+a+"txtVehMake").val()&&""===$("#car"+a+"txtVehLic").val()&&($("#car"+a+"txtVehLic").addClass("ui-state-highlight"),b="Enter a license plate number."),b)}a.setupComplete=!1,a.checkPayments=!0,a.setUp=function(i){if(c=$("<div/>").addClass(" hhk-tdbox ui-corner-bottom hhk-tdbox ui-widget-content hhk-flex hhk-flex-wrap hhk-overflow-x").prop("id","divResvDetail").css({padding:"5px"}),void 0!==i.resv.rdiv.rChooser&&c.append($(i.resv.rdiv.rChooser)),void 0!==i.resv.rdiv.rate&&c.append($(i.resv.rdiv.rate)),void 0!==i.resv.rdiv.cof&&c.append(i.resv.rdiv.cof),void 0!==i.resv.rdiv.rstat&&c.append($(i.resv.rdiv.rstat)),void 0!==i.resv.rdiv.vehicle&&(e=$(i.resv.rdiv.vehicle),c.append(e),l=2,m=(k=e).find("#cbNoVehicle"),n=k.find("#btnNextVeh"),o=k.find("#tblVehicle"),m.change(function(){this.checked?o.hide("scale, horizontal"):o.show("scale, horizontal")}),m.change(),n.button(),n.click(function(){k.find("#trVeh"+l).show("fade"),++l>4&&n.hide("fade")})),void 0!==i.resv.rdiv.pay&&c.append($(i.resv.rdiv.pay)),void 0!==i.resv.rdiv.notes&&c.append((p=i.rid,q=$(i.resv.rdiv.notes),q.notesViewer({linkId:p,linkType:"reservation",newNoteAttrs:{id:"taNewNote",name:"taNewNote"},alertMessage:function(a,b){flagAlertMessage(a,b)}}),q)),void 0!==i.resv.rdiv.wlnotes&&c.append($(i.resv.rdiv.wlnotes)),g=$("<ul style='list-style-type:none; float:right; margin-left:5px; padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='r_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),f=$('<div id="divResvHdr" style="padding:2px; cursor:pointer;"/>').append($(i.resv.hdr)).append(g).append('<div style="clear:both;"/>'),f.addClass("ui-widget-header ui-state-default ui-corner-top"),f.click(function(b){var a=$(b.target);("divResvHdr"===a[0].id||"r_drpDown"===a[0].id)&&("none"===c.css("display")?(c.show("blind"),f.removeClass("ui-corner-all").addClass("ui-corner-top")):(c.hide("blind"),f.removeClass("ui-corner-top").addClass("ui-corner-all")))}),b.empty().append(f).append(c).show(),a.$totalGuests=$("#spnNumGuests"),a.origRoomId=$("#selResource").val(),a.checkPayments=!0,$(".hhk-viewResvActivity").length>0&&$(".hhk-viewResvActivity").click(function(){$.post("ws_ckin.php",{cmd:"viewActivity",rid:$(this).data("rid")},function(a){if((a=$.parseJSON(a)).error){a.gotopage&&window.open(a.gotopage,"_self"),flagAlertMessage(a.error,"error");return}a.activity&&($("div#submitButtons").hide(),$("#activityDialog").children().remove(),$("#activityDialog").append($(a.activity)),$("#activityDialog").dialog("open"))})}),$("#btnShowCnfrm").button().click(function(){var a=$("#spnAmount").text();""===a&&(a=0),$.post("ws_ckin.php",{cmd:"confrv",rid:$(this).data("rid"),amt:a,eml:"0"},function(b){if((i=$.parseJSON(b)).error){i.gotopage&&window.open(i.gotopage,"_self"),flagAlertMessage(i.error,"error");return}if(i.confrv){$("div#submitButtons").hide(),$("#frmConfirm").children().remove(),$("#frmConfirm").html(i.confrv);var a='<div class="col-md-6 my-2 hhk-flex"><label for="confEmail" class="pr-2" style="min-width:fit-content;">To Address</label><input type="text" style="width:100%" id="confEmail" value="'+i.email+'"></div>';a+='<div class="col-md-6 my-2 hhk-flex"><label for="ccConfEmail" class="pr-2" style="min-width:fit-content;">CC Address</label><input type="text" style="width:100%" id="ccConfEmail" value="'+i.ccemail+'"></div>',$("#frmConfirm").append($('<div class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix hhk-flex hhk-flex-wrap">'+a+"</div>")),$("#frmConfirm").find("#confirmTabDiv").tabs(),$("#confirmDialog").dialog("open")}})}),r=i.rid,d.idReservation=r,$("input.hhk-constraintsCB").change(function(){d.go($("#gstDate").val(),$("#gstCoDate").val())}),void 0!==i.resv.rdiv.rate&&(s=i,t={},(u=b.find("#btnFapp")).length>0&&($("#faDialog").dialog({autoOpen:!1,resizable:!0,width:getDialogWidth(680),modal:!0,title:"Income Chooser",close:function(){$("div#submitButtons").show()},open:function(){$("div#submitButtons").hide()},buttons:{Save:function(){$.post("ws_ckin.php",$("#formf").serialize()+"&cmd=savefap&rid="+s.rid,function(a){try{a=$.parseJSON(a)}catch(c){alert("Bad JSON Encoding");return}if(a.gotopage&&window.open(a.gotopage,"_self"),a.rstat&& !0==a.rstat){var b=$("#selRateCategory");a.rcat&&""!=a.rcat&&b.length>0&&(b.val(a.rcat),b.change())}}),$(this).dialog("close")},Exit:function(){$(this).dialog("close")}}}),u.button().click(function(){getIncomeDiag(s.rid)})),s.resv.rdiv.ratelist&&(t.rateList=s.resv.rdiv.ratelist,t.resources=s.resv.rdiv.rooms,t.visitFees=s.resv.rdiv.vfee,t.idResv=C,setupRates(t)),$("#selResource").length>0&&$("#selResource").change(function(){var a=J[$("#selResource").val()];a.defaultRateCat&&""!=a.defaultRateCat&&("w"===P||"uc"===P||"a"===P)&&$("#selRateCategory").val(a.defaultRateCat),$("#selRateCategory").change();var b=$("option:selected",this).parent()[0].label;null==b?$("#hhkroomMsg").hide():$("#hhkroomMsg").text(b).show(),$("#selccgw").length>0?h(""):$("#selccgwg").length>0&&h("g")})),void 0!==i.resv.rdiv.pay&&$("#selResource").length>0&&$("#selRateCategory").length>0&&(setupPayments($("#selRateCategory")),$("#paymentDate").datepicker({yearRange:"-1:+00",numberOfMonths:1,autoSize:!0,dateFormat:"M d, yy"})),void 0!==i.resv.rdiv.cof){var k,l,m,n,o,p,q,r,s,t,u,j=J[$("#selResource").val()];$("#btnUpdtCred").button().click(function(){cardOnFile($(this).data("id"),$(this).data("idreg"),"Reserve.php?rid="+C,$(this).data("indx"))}),setupCOF($("#trvdCHNameg"),$("#btnUpdtCred").data("indx")),$("#selccgwg").val(j.merchant)}$("#addGuestHeader").length>0&&(N.openControl=!0,N.setUp(i.resv.rdiv,Q,$("#addGuestHeader"))),a.setupComplete=!0},a.verify=function(){if($("#cbNoVehicle").length>0){if(!1===$("#cbNoVehicle").prop("checked")){var b=i(1);if(""!=b){var c=i(2);if(""!=c)return $("#vehValidate").text(c),flagAlertMessage(b,"alert",O),!1}}$("#vehValidate").text("")}if(z&& !0===a.checkPayments){if($("#selCategory").val()==fixedRate&&$("#txtFixedRate").length>0&&""==$("#txtFixedRate").val())return flagAlertMessage("Set the Room Rate to an amount, or to 0.","alert",O),$("#txtFixedRate").addClass("ui-state-error"),!1;if($("#txtFixedRate").removeClass("ui-state-error"),$("input#feesPayment").length>0&&""==$("input#feesPayment").val()&&H)return flagAlertMessage("Set the Room Fees to an amount, or 0.","alert",O),$("#payChooserMsg").text("Set the Room Fees to an amount, or 0.").show(),$("input#feesPayment").addClass("ui-state-error"),!1;if($("input#feesPayment").removeClass("ui-state-error"),void 0!==verifyAmtTendrd&& !1===verifyAmtTendrd())return!1}return!0}}($("#resvSection")),M=new function(b){var a=this;a.setupComplete=!1,a.setUp=function(d){var e=$(d.div).addClass("ui-widget-content").prop("id","divhospDetail").hide(),f=$("<ul style='list-style-type:none; float:right;margin-left:5px;padding-top:2px;' class='ui-widget'/>").append($("<li class='ui-widget-header ui-corner-all' title='Open - Close'>").append($("<span id='h_drpDown' class='ui-icon ui-icon-circle-triangle-n'></span>"))),c=$('<div id="divhospHdr" style="padding:2px; cursor:pointer;"/>').append($(d.hdr)).append(f).append('<div style="clear:both;"/>');c.addClass("ui-widget-header ui-state-default ui-corner-all"),c.click(function(){"none"===e.css("display")?(e.show("blind"),c.removeClass("ui-corner-all").addClass("ui-corner-top")):(e.hide("blind"),c.removeClass("ui-corner-top").addClass("ui-corner-all"))}),b.empty().append(c).append(e),$("#txtEntryDate, #txtExitDate").datepicker({yearRange:"-01:+01",changeMonth:!0,changeYear:!0,autoSize:!0,dateFormat:"M d, yy"}),$("#txtAgentSch").length>0&&(createAutoComplete($("#txtAgentSch"),3,{cmd:"filter",basis:"ra"},getAgent),""===$("#a_txtLastName").val()&&$(".hhk-agentInfo").hide(),$(document).on("click","#a_delete",function(){$("#a_idName").val(""),$("input.hhk-agentInfo").val(""),$(".hhk-agentInfo").hide()}),""!==$("#a_idName").val()?$("input.hhk-agentInfo.name").attr("readonly","readonly"):$("input.hhk-agentInfo.name").removeAttr("readonly")),$("#txtDocSch").length>0&&(createAutoComplete($("#txtDocSch"),3,{cmd:"filter",basis:"doc"},getDoc),""===$("#d_txtLastName").val()&&$(".hhk-docInfo").hide(),""!==$("#d_idName").val()?$("input.hhk-docInfo.name").attr("readonly","readonly"):$("input.hhk-docInfo.name").removeAttr("readonly"),$(document).on("click","#d_delete",function(){$("#d_idName").val(""),$("input.hhk-docInfo").val(""),$(".hhk-docInfo").hide()})),verifyAddrs("#divhospDetail"),b.on("change","#selHospital, #selAssoc",function(){var a=$("#selAssoc").find("option:selected").text();""!=a&&(a+="/ "),$("span#spnHospName").text(a+$("#selHospital").find("option:selected").text())}),b.show(),""===$("#selHospital").val()&&c.click(),a.setupComplete=!0},a.verify=function(){return(b.find(".ui-state-error").each(function(){$(this).removeClass("ui-state-error")}),$("#selHospital").length>0&& !0===a.setupComplete&&""==$("#selHospital").val())?($("#selHospital").addClass("ui-state-error"),flagAlertMessage("Select a hospital.","alert",O),$("#divhospDetail").show("blind"),$("#divhospHdr").removeClass("ui-corner-all").addClass("ui-corner-top"),!1):($("#divhospDetail").hide("blind"),$("#divhospHdr").removeClass("ui-corner-top").addClass("ui-corner-all"),!0)}}($("#hospitalSection")),N=new function(){var a=this;a.setupComplete=!1,a.ciDate=new Date,a.coDate=new Date,a.openControl=!1,a.setUp=function(b,i,c){if(c.empty(),b.mu&&""!==b.mu){c.append($(b.mu));var d,e=$("#gstDate"),j=$("#gstCoDate"),h=parseInt(b.defdays,10),f=!1,g=!1;""===e.val()&&G&&e.val(G),b.startDate&&(f=b.startDate),b.endDate&&(g=b.endDate),$("#spnRangePicker").length>0&&(d=$("#spnRangePicker").dateRangePicker({format:"MMM D, YYYY",separator:" to ",minDays:1,autoClose:!0,showShortcuts:!0,shortcuts:{"next-days":[h]},getValue:function(){return e.val()&&j.val()?e.val()+" to "+j.val():""},setValue:function(c,a,b){e.val(a),j.val(b)},startDate:f,endDate:g}),b.updateOnChange&&d.bind("datepicker-change",function(d,a){var c=Math.ceil((a.date2.getTime()-a.date1.getTime())/864e5);$("#"+b.daysEle).val(c),$("#spnNites").length>0&&$("#spnNites").text(c),$("#gstDate").removeClass("ui-state-error"),$("#gstCoDate").removeClass("ui-state-error"),$.isFunction(i)&&i(a)})),c.show(),a.openControl&&$("#spnRangePicker").length>0&&d.open()}setupComplete=!0},a.verify=function(){var b=$("#gstDate"),c=$("#gstCoDate");if(b.removeClass("ui-state-error"),c.removeClass("ui-state-error"),""===b.val()||(a.ciDate=new Date(b.val()),isNaN(a.ciDate.getTime())))return b.addClass("ui-state-error"),flagAlertMessage("This "+e+" is missing the check-in date.","alert",O),!1;if(void 0!==z&& !0===z){var d=moment($("#gstDate").val(),"MMM D, YYYY"),f=moment().endOf("date");if(d>f)return b.addClass("ui-state-error"),flagAlertMessage("Set the Check in date to today or earlier.","alert",O),!1}return""===c.val()?(c.addClass("ui-state-error"),flagAlertMessage("This "+e+" is missing the expected departure date.","alert",O),!1):(a.coDate=new Date(c.val()),isNaN(a.coDate.getTime()))?(c.addClass("ui-state-error"),flagAlertMessage("This "+e+" is missing the expected departure date","alert",O),!1):!(a.ciDate>a.coDate)||(b.addClass("ui-state-error"),flagAlertMessage("This "+e+"'s check-in date is after the expected departure date.","alert",O),!1)}},d=new d,O=$("#pWarnings"),c=c,P="";function h(a){J=a}function i(){return C}function j(){return E}function k(){return F}function l(){return B}function m(){return D}function Q(a){O.text("").hide();var b=!1;for(var c in f.list())if(f.list()[c].id>0){b=!0;break}if(b){$(".hhk-stayIndicate").hide().parent("td").addClass("hhk-loading");var e={cmd:"updateAgenda",idPsg:B,idResv:C,idVisit:E,span:F,dt1:a.date1.getFullYear()+"-"+(a.date1.getMonth()+1)+"-"+a.date1.getDate(),dt2:a.date2.getFullYear()+"-"+(a.date2.getMonth()+1)+"-"+a.date2.getDate(),mems:f.list()};$.post("ws_resv.php",e,function(a){$(".hhk-stayIndicate").show().parent("td").removeClass("hhk-loading");try{a=$.parseJSON(a)}catch(e){flagAlertMessage(e.message,"error");return}if(a.gotopage&&window.open(a.gotopage,"_self"),a.error&&flagAlertMessage(a.error,"error"),a.stayCtrl){for(var b in a.stayCtrl){var c;$("#sb"+b).empty().html(a.stayCtrl[b].ctrl),$("#"+b+"cbStay").checkboxradio({classes:{"ui-checkboxradio-label":"hhk-unselected-text"}}),f.list()[b].stay="0",(c=$("#"+b+"lblStay")).length>0&&"1"==c.data("stay")&&c.click()}$(".hhk-getVDialog").button(),""!=$("#gstDate").val()&&""!=$("#gstCoDate").val()&&d.go($("#gstDate").val(),$("#gstCoDate").val()),$(".hhk-cbStay").change()}})}R(a.date1.t,C)}function R(a,b,c){var d=moment(a,"MMM D, YYYY"),e=moment().endOf("date");b>0&&d<=e&&!c?$("#btnCheckinNow").show():$("#btnCheckinNow").hide()}function d(){var a=this,b={};a.omitSelf=!0,a.numberGuests=0,a.idReservation=0,a.go=function(e,f){var d,c=$("#selResource");0!==c.length&&(d=c.find("option:selected").val(),c.prop("disabled",!0),$("#hhk-roomChsrtitle").addClass("hhk-loading"),$("#hhkroomMsg").text("").hide(),b={},$("input.hhk-constraintsCB:checked").each(function(){b[$(this).data("cnid")]="ON"}),$.post("ws_ckin.php",{cmd:"newConstraint",rid:a.idReservation,numguests:a.numberGuests,expArr:e,expDep:f,idr:d,cbRS:b,omsf:a.omitSelf},function(a){var b,e;c.prop("disabled",!1),$("#hhk-roomChsrtitle").removeClass("hhk-loading");try{a=$.parseJSON(a)}catch(d){alert("Parser error - "+d.message);return}if(a.error){a.gotopage&&window.location.assign(a.gotopage),flagAlertMessage(a.error,"error");return}a.rooms&&(J=a.rooms),a.selectr&&(b=$(a.selectr),c.children().remove(),b.children().appendTo(c),c.val(a.idResource).change(),a.msg&&""!==a.msg&&$("#hhkroomMsg").text(a.msg).show())}))}}function S(){var f,b={},a=this;function c(){return b}function d(a){return!1===e(a)&&(b[a[f]]=a,!0)}function e(a){return void 0!==b[a[f]]}a.hasItem=e,a.findItem=function(c,d){for(var a in b)if(b[a][c]==d)return b[a];return null},a.addItem=d,a.removeIndex=function(a){delete b[a]},a.list=c,a.makeList=function(a,b){for(var c in f=b,a)d(a[c])},a._list=b}function T(a,b){"use strict";$("input#txtPersonSearch").val(""),b.empty().append($(a.psgChooser)).dialog("option","buttons",{Open:function(){$(this).dialog("close"),n({idPsg:b.find("input[name=cbselpsg]:checked").val(),id:a.id,cmd:"getResv"})},Cancel:function(){$(this).dialog("close"),$("input#gstSearch").val("").focus()}}).dialog("option","title",a.patLabel+" Chooser"+(void 0===a.fullName?"":" For: "+a.fullName)).dialog("open")}function n(a){var b={id:a.id,rid:a.rid,idPsg:a.idPsg,vid:a.vid,span:a.span,isCheckin:z,gstDate:a.gstDate,gstCoDate:a.gstCoDate,cmd:a.cmd};$.post("ws_resv.php",b,function(a){try{a=$.parseJSON(a)}catch(b){flagAlertMessage(b.message,"error");return}a.gotopage&&window.open(a.gotopage,"_self"),a.error&&(flagAlertMessage(a.error,"error",O),$("#btnDone").val("Save "+e).show()),o(a)})}function o(a){var j,c,b,i,d,h;if(a.xfer||a.inctx){paymentRedirect(a,$("#xform"));return}if(a.resvChooser&&""!==a.resvChooser){c=a,b=$("#resDialog"),i=$("#psgDialog"),d={},$("input#txtPersonSearch").val(""),b.empty().append($(c.resvChooser)).children().find("input:button").button(),b.children().find(".hhk-checkinNow").click(function(){window.open("CheckingIn.php?rid="+$(this).data("rid")+"&gid="+c.id,"_self")}),c.psgChooser&&""!==c.psgChooser&&(d[c.patLabel+" Chooser"]=function(){$(this).dialog("close"),T(c,i)}),c.resvTitle&&(d["New "+c.resvTitle]=function(){c.rid=-1,c.cmd="getResv",$(this).dialog("close"),n(c)}),d.Exit=function(){$(this).dialog("close"),$("input#gstSearch").val("").focus()},b.dialog("option","width","95%"),b.dialog("option","buttons",d),b.dialog("option","title",c.resvTitle+" Chooser"),b.dialog("open"),h=b.find("table").width(),b.dialog("option","width",h+80);return}if(a.psgChooser&&""!==a.psgChooser){T(a,$("#psgDialog"));return}a.idPsg&&(B=a.idPsg),a.id&&(D=a.id),a.rid&&(C=a.rid),a.vid&&(E=a.vid),a.span&&(F=a.span),a.resvStatusCode&&(P=a.resvStatusCode),void 0!==a.hosp&&M.setUp(a.hosp),a.famSection&&(K.setUp(a),$("div#guestSearch").hide(),$("#btnDone").val("Save Family").show(),$("select.hhk-multisel").each(function(){$(this).multiselect({selectedList:3})})),void 0!==a.expDates&&""!==a.expDates&&(N.openControl=!1,N.setUp(a.expDates,Q,$("#datesSection"))),void 0!==a.warning&&""!==a.warning&&flagAlertMessage(a.warning,"warning",O),void 0!==a.resv&&(a.resv.rdiv.rooms&&(J=a.resv.rdiv.rooms),L.setUp(a),$("#"+K.divFamDetailId).on("change",".hhk-cbStay",function(){var a=K.findStaysChecked()+K.findStays("r");if(L.$totalGuests.text(a),$("#selRateCategory").trigger("change"),$("#selResource").length>0&&"0"!==$("#selResource").val()){var b="Room may be too small",c=J[$("#selResource").val()];a>c.maxOcc?$("#hhkroomMsg").text(b).show():$("#hhkroomMsg").text()==b&&$("#hhkroomMsg").text("").hide()}a>0?L.$totalGuests.parent().removeClass("ui-state-highlight"):L.$totalGuests.parent().addClass("ui-state-highlight")}),$("#"+K.divFamDetailId).on("click",".hhk-getVDialog",function(){var a,b=$(this).data("vid"),c=$(this).data("span");a={"Show Statement":function(){window.open("ShowStatement.php?vid="+b,"_blank")},"Show Registration Form":function(){window.open("ShowRegForm.php?vid="+b+"&span="+c,"_blank")},Save:function(){saveFees(0,b,c,!1,payFailPage)},Cancel:function(){$(this).dialog("close")}},viewVisit(0,b,a,"Edit Visit #"+b+"-"+c,"hf",c),$("#submitButtons").hide()}),$(".hhk-cbStay").change(),$("#btnDone").val(s).show(),a.rid>0&&($("#btnDelete").val("Delete "+e).show(),$("#btnShowReg").show(),$("#spnStatus").text(""===a.resv.rdiv.rStatTitle?"":" - "+a.resv.rdiv.rStatTitle)),R($("#gstDate").val(),a.rid,a.resv.rdiv.hideCiNowBtn),I=a.insistCkinDemog),void 0!==a.addPerson&&($("input#txtPersonSearch").val(""),f.addItem(a.addPerson.mem)&&(g.addItem(a.addPerson.addrs),K.newGuestMarkup(a.addPerson,a.addPerson.mem.pref),K.findStaysChecked(),$(".hhk-cbStay").change(),$("#"+a.addPerson.mem.pref+"txtFirstName").focus())),$("#submitButtons").show()}b.getReserve=n,b.verifyInput=function(){return O.text("").hide(),!1!==N.verify()&& !1!==K.verify()&& !1!==M.verify()&&(!0!==L.setupComplete|| !1!==L.verify())},b.loadResv=o,b.deleteReserve=function(a,b,c){$.post("ws_ckin.php","&cmd=delResv&rid="+a,function(d){var a;try{a=$.parseJSON(d)}catch(e){flagAlertMessage(e.message,"error"),$(b).remove()}a.error&&(a.gotopage&&window.open(a.gotopage,"_self"),flagAlertMessage(a.error,"error"),$(b).remove()),a.warning&&(flagAlertMessage(a.warning,"warning"),c.hide()),a.result&&($(b).remove(),flagAlertMessage(a.result+' <a href="Reserve.php">Continue</a>',"success"))})},b.resvTitle=e,b.people=f,b.addrs=g,b.getIdPsg=l,b.getIdResv=i,b.getIdName=m,b.getIdVisit=j,b.getSpan=k,b.setRooms=h,b.options=c}