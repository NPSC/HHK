function hideAlertMessage(a){"use strict";a||(a="divAlert1"),$("#"+a+":visible").removeAttr("style").hide()}function flagAlertMessage(a,b){"use strict";var c=document.getElementById("alrMessage");b?($("alrResponse").removeClass("ui-state-highlight").addClass("ui-state-error"),$("#alrIcon").removeClass("ui-icon-info").addClass("ui-icon-alert"),c.innerHTML="<strong>Alert: </strong>"+a,$("#divAlert1").show("pulsate"),window.scrollTo(0,5)):($("#alrResponse").removeClass("ui-state-error").addClass("ui-state-highlight"),$("#alrIcon").removeClass("ui-icon-alert").addClass("ui-icon-info"),c.innerHTML="<strong>Success: </strong>"+a,$("#divAlert1").show("slide"),window.scrollTo(0,5))}function additionalGuest(a){"use strict";var b=reserv;if(hideAlertMessage(),a.id>0)for(var c=0;c<b.members.length;c++){var d=b.members[c];if(d.idName==a.id&&d.idPrefix==b.patientPrefix&&1==b.patStaying)return void flagAlertMessage("This guest is already added.",!0)}if(confirm("Add "+a.value+"?")){b.addRoom=!1,$("#cbAddnlRoom").prop("checked")&&(b.addRoom=!0);var e={cmd:"addResv",id:a.id,rid:b.idReserv,addRoom:b.addRoom};$.post("ws_ckin.php",e,function(a){var b=reserv;try{a=$.parseJSON(a)}catch(a){return void alert("Parser error - "+a.message)}if(!a)return void alert("Bad Reply from Server");if(a.error)return a.gotopage&&window.open(a.gotopage,"_self"),void flagAlertMessage(a.error,!0);if($("#txtAddGuest").val(""),a.newRoom&&a.newRoom>1)return void flagAlertMessage('<a href="Referral.php?rid='+a.newRoom+'">View New Reservation</a>',!1);if(a.addtguest&&""!==a.addtguest){$("#diagAddGuest").remove();var c=$(a.addtguest);c.css("font-size",".85em"),c.dialog({autoOpen:!1,resizable:!0,width:900,modal:!0,title:"Additional Guest",close:function(a,b){$("div#submitButtons").show()},open:function(a,b){$("div#submitButtons").hide()},buttons:{Save:function(){$.post("ws_ckin.php",$("#fAddGuest").serialize()+"&cmd=addResv&rid="+b.idReserv+"&addRoom="+b.addRoom,function(a){return a=$.parseJSON(a),a.error?(a.gotopage&&window.open(a.gotopage,"_self"),void flagAlertMessage(a.error,!0)):void injectSlot(a)}),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),c.find("select.bfh-countries").each(function(){var a=$(this);a.bfhcountries(a.data())}),c.find("select.bfh-states").each(function(){var a=$(this);a.bfhstates(a.data())}),$("#diagAddGuest #bphEmlTabs").tabs(),verifyAddrs("#diagAddGuest");var d;return createZipAutoComplete($("#diagAddGuest input.hhk-zipsearch"),"ws_admin.php",d),$("#diagAddGuest").on("click",".hhk-addrCopy",function(){var a=$(this).attr("name");if(!(b.members.length<1))for(var c=0;c<b.members.length;c++)b.members[c]&&b.members[c].idPrefix!==a&&($("#"+a+"adraddress1"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adraddress1"+b.adrPurpose).val()),$("#"+a+"adraddress2"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adraddress2"+b.adrPurpose).val()),$("#"+a+"adrcity"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adrcity"+b.adrPurpose).val()),$("#"+a+"adrcounty"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adrcounty"+b.adrPurpose).val()),$("#"+a+"adrstate"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adrstate"+b.adrPurpose).val()),$("#"+a+"adrcountry"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adrcountry"+b.adrPurpose).val()),$("#"+a+"adrzip"+b.adrPurpose).val($("#"+b.members[c].idPrefix+"adrzip"+b.adrPurpose).val()))}),$("#diagAddGuest").on("click",".hhk-addrErase",function(){var a=$(this).attr("name");$("#"+a+"adraddress1"+b.adrPurpose).val(""),$("#"+a+"adraddress2"+b.adrPurpose).val(""),$("#"+a+"adrcity"+b.adrPurpose).val(""),$("#"+a+"adrcounty"+b.adrPurpose).val(""),$("#"+a+"adrstate"+b.adrPurpose).val(""),$("#"+a+"adrcountry"+b.adrPurpose).val(""),$("#"+a+"adrzip"+b.adrPurpose).val(""),$("#"+a+"adrbad"+b.adrPurpose).prop("checked",!1)}),void c.dialog("open")}injectSlot(a)})}}function delAdditionalGuest(a){"use strict";var b=reserv;if(hideAlertMessage(),confirm("Remove "+a.value+"?")){for(var c=0;c<b.members.length;c++){var d=b.members[c];d&&d.idName===a.id&&b.members.splice(c,1)}$("#spnNumGuests").text(b.members.length),$.post("ws_ckin.php",{cmd:"delResvGst",id:a.id,rid:b.idReserv}).done(function(a){return(a=$.parseJSON(a))?a.error?(a.gotopage&&window.open(a.gotopage,"_self"),void flagAlertMessage(a.error,!0)):void injectSlot(a):void alert("Bad Reply from Server")})}}function injectSlot(a){"use strict";var b=reserv;if(a.memMkup&&a.txtHdr){var e,f,c=$("div#guestAccordion"),d=$('<div id="'+a.idPrefix+'divGstpnl" />').append($(a.memMkup));d.addClass("Slot gstdetail");var g=$('<div id="'+a.idPrefix+'divGsthdr" style="padding:2px;"/>').append($(a.txtHdr)).append($('<span id="'+a.idPrefix+'drpDown" class="ui-icon ui-icon-circle-triangle-s" style="float:right; cursor:pointer; margin:right:3px;"></span>').click(function(){var a=d.css("display");"none"===a?(d.show("blind"),g.removeClass("ui-corner-all").addClass("ui-corner-top")):(d.hide("blind"),g.removeClass("ui-corner-top").addClass("ui-corner-all"))})).append($('<div style="clear:both;"/>'));g.addClass("ui-widget-header ui-state-default ui-corner-top"),c.children().remove(),c.append(g),c.append(d),d.find("select.bfh-countries").each(function(){var a=$(this);a.bfhcountries(a.data())}),d.find("select.bfh-states").each(function(){var a=$(this);a.bfhstates(a.data())}),$("#"+a.idPrefix+"selPatRel").change(function(){"slf"===$(this).val()||""===$(this).val()?($("div#patientSection").hide("blind"),g.removeClass("ui-state-default"),g.find("#pgspnHdrLabel").text((b.patAsGuest?b.patientLabel+"/":"")+"Primary Guest: "),b.patSection=!1):($("div#patientSection").show("blind"),g.addClass("ui-state-default"),g.find("#pgspnHdrLabel").text("Primary Guest: "),b.patSection=!0)}),$("input.dprange").click(function(){$("div#dtpkrDialog").toggle("scale, horizontal"),$("#dtpkrDialog").position({my:"left top",at:"left bottom",of:"#"+a.idPrefix+"gstDate"})}),$(".ckdate").datepicker(),$("#"+a.idPrefix+"phEmlTabs").tabs(),0===a.idName&&($("#"+a.idPrefix+"phEmlTabs").tabs("option","active",1),$("#"+a.idPrefix+"phEmlTabs").tabs("option","disabled",[0])),e=$("#"+a.idPrefix+"gstDate"),f=$("#"+a.idPrefix+"gstCoDate"),f.datepicker("destroy"),f.datepicker({minDate:1}),$("#dtpkrDialog").datepicker("destroy"),$("#dtpkrDialog").datepicker({numberOfMonths:2,minDate:0,beforeShowDay:function(a){var b,c;try{b=$.datepicker.parseDate($.datepicker._defaults.dateFormat,e.val()),c=$.datepicker.parseDate($.datepicker._defaults.dateFormat,f.val())}catch(a){}return[!0,b&&(a.getTime()===b.getTime()||c&&a>=b&&a<=c)?"dp-highlight":""]},onSelect:function(a,b){var c,d;try{c=$.datepicker.parseDate($.datepicker._defaults.dateFormat,e.val()),d=$.datepicker.parseDate($.datepicker._defaults.dateFormat,f.val())}catch(a){}!c||d?(e.val(a),f.val("")):(f.val(a),$("div#dtpkrDialog").hide("fade"))}}),$(document).mousedown(function(a){var b=$(a.target);"dtpkrDialog"!==b[0].id&&0===b.parents("#dtpkrDialog").length&&$("#dtpkrDialog").hide("fade")}),$("#guestSearch").hide()}if(a.notes&&$("#notesGuest").children().remove().end().append($(a.notes)).show(),b.patStaying=a.patStay,a.idPsg&&(b.idPsg=a.idPsg),void 0!==a.hosp){var h=$(a.hosp.div).addClass("ui-widget-content").prop("id","divhospDetail"),i=$('<div id="divhospHdr" style="padding:2px; cursor:pointer;"/>').append($(a.hosp.hdr)).append($('<span class="ui-icon ui-icon-circle-triangle-s" style="float:right; margin:right:3px;"></span>')).append('<div style="clear:both;"/>');i.addClass("ui-widget-header ui-state-default ui-corner-top"),i.click(function(){var a=h.css("display");"none"===a?(h.show("blind"),i.removeClass("ui-corner-all").addClass("ui-corner-top")):(h.hide("blind"),i.removeClass("ui-corner-top").addClass("ui-corner-all"))}),$("#hospitalSection").children().remove().end().append(i).append(h),$("#txtEntryDate, #txtExitDate").datepicker(),$("#txtAgentSch").length>0&&(createAutoComplete($("#txtAgentSch"),3,{cmd:"filter",basis:"ra"},getAgent),""===$("#a_txtLastName").val()&&$(".hhk-agentInfo").hide()),$("#txtDocSch").length>0&&(createAutoComplete($("#txtDocSch"),3,{cmd:"filter",basis:"doc"},getDoc),""===$("#d_txtLastName").val()&&$(".hhk-docInfo").hide()),$("#hospitalSection").show("blind"),""!=$("#selHospital").val()&&i.click()}if(void 0!==a.patient&&""!=a.patient){var k=$("div#patientSection"),l=$('<div id="h_divGstpnl" />').append($(a.patient)),m=$('<div id="h_divGsthdr" style="padding:2px;"/>').append($('<span style="font-size:1.5em;">'+b.patientLabel+": </span>")).append($('<span id="h_hdrFirstName" style="font-size:1.5em;">'+l.find("#h_txtFirstName").val()+" </span>")).append($('<span id="h_hdrLastName" style="font-size:1.5em;">'+l.find("#h_txtLastName").val()+"</span>")).append($('<span style="font-size:1.5em;">'+(a.patStay?" (staying)":"")+"</span>")).append($('<span id="h_drpDown" class="ui-icon ui-icon-circle-triangle-s" style="float:right; cursor:pointer; margin:right:3px;"></span>').click(function(){var a=l.css("display");"none"===a?(l.show("blind"),m.removeClass("ui-corner-all").addClass("ui-corner-top")):(l.hide("blind"),m.removeClass("ui-corner-top").addClass("ui-corner-all"))})).append($('<div style="clear:both;"/>')).addClass("ui-widget-header ui-corner-top");l.find("select.bfh-countries").each(function(){var a=$(this);a.bfhcountries(a.data())}),l.find("select.bfh-states").each(function(){var a=$(this);a.bfhstates(a.data())}),l.find("#h_phEmlTabs").tabs(),void 0!==a.idPsg&&0!=a.idPsg||(l.find("#h_phEmlTabs").tabs("option","active",1),l.find("#h_phEmlTabs").tabs("option","disabled",[0])),b.patSection=!0,$(".patientRelch").length>0&&$('.patientRelch option[value="slf"]').remove(),k.children().remove().end().append(m).append(l).show("scale, horizontal"),""!=l.find("#h_txtLastName").val()&&$("#h_drpDown").click()}$("#"+a.idPrefix+"selPatRel").change(),void 0!==a.ratelist&&(b.rateList=a.ratelist),void 0!==a.rooms&&(b.resources=a.rooms),void 0!==a.vfee&&(b.visitFees=a.vfee),void 0!==a.resc&&($("#rescList").children().remove().end().append($(a.resc)).show(),void 0!==a.resv&&($("#resvStatus").children().remove().end().append($(a.resv)).show(),$(".hhk-viewResvActivity").click(function(){$.post("ws_ckin.php",{cmd:"viewActivity",rid:$(this).data("rid")},function(a){return a=$.parseJSON(a),a.error?(a.gotopage&&window.open(a.gotopage,"_self"),void flagAlertMessage(a.error,!0)):void(a.activity&&($("div#submitButtons").hide(),$("#activityDialog").children().remove(),$("#activityDialog").append($(a.activity)),$("#activityDialog").dialog("open")))})}),$("input.hhk-constraintsCB").change(function(){updateRoomChooser(b.idReserv,$("#spnNumGuests").text(),$("#pggstDate").val(),$("#pggstCoDate").val())}),$("#btnShowCnfrm").button(),$("#btnShowCnfrm").click(function(){$.post("ws_ckin.php",{cmd:"confrv",rid:$(this).data("rid"),amt:$("#spnAmount").text(),notes:"tb"},function(a){return a=$.parseJSON(a),a.error?(a.gotopage&&window.open(a.gotopage,"_self"),void flagAlertMessage(a.error,!0)):void(a.confrv&&($("div#submitButtons").hide(),$("#confirmDialog").children().remove(),$("#confirmDialog").append($(a.confrv)).append($('<div style="padding-top:10px;" class="ui-dialog-buttonpane ui-widget-content ui-helper-clearfix"><span>Email Address </span><input type="text" id="confEmail" value="'+a.email+'"/></div>')),$("#confirmDialog").dialog("open")))})})),$("#btnDone").val("Save")),void 0!==a.rate&&($("#rate").children().remove().end().append($(a.rate)).show(),$("#btnFapp").button(),$("#btnFapp").click(function(){getIncomeDiag(b.idReserv)}),setupRates(b,$("#selResource").val()),$("#h_drpDown, #divhospHdr, #"+a.idPrefix+"drpDown").click(),$("#selResource").change(function(){$("#selRateCategory").change();var a=$("option:selected",this);"Not Suitable"===a.parent()[0].label?$("#hhkroomMsg").text("Not Suitable").show():$("#hhkroomMsg").hide()})),void 0!==a.pay&&($("#pay").children().remove().end().append($(a.pay)).show(),$("#paymentDate").datepicker({yearRange:"-1:+01",numberOfMonths:1}),setupPayments(a.rooms,$("#selResource"),$("#selRateCategory"))),a.adguests&&($("#resvGuest").children().remove().end().append($(a.adguests)).show(),$(".hhk-addResv, .hhk-delResv").button(),a.static&&"y"===a.static||(createAutoComplete($("#txtAddGuest"),3,{cmd:"role"},additionalGuest),createAutoComplete($("#txtAddPhone"),5,{cmd:"role"},additionalGuest),$(".hhk-addResv").click(function(){var a={id:$(this).data("id"),value:$(this).data("name")};additionalGuest(a)}),$(".hhk-delResv").click(function(){var a={id:$(this).data("id"),value:$(this).data("name")};delAdditionalGuest(a),$(this).parent("td").next().children("a").removeClass("ui-state-highlight"),$(this).remove()}))),a.vehicle&&($("#vehicle").children().remove().end().append($(a.vehicle)).show(),$("#cbNoVehicle").change(function(){this.checked?$("#tblVehicle").hide("scale, horizontal"):$("#tblVehicle").show("scale, horizontal")}),$("#cbNoVehicle").change(),$("#btnNextVeh").button(),b.nextVeh=1,$("#btnNextVeh").click(function(){$("#trVeh"+b.nextVeh).show("fade"),b.nextVeh++,b.nextVeh>4&&$("#btnNextVeh").hide("fade")})),a.numGuests&&$("#spnNumGuests").text(a.numGuests),a.rvstatus?$("#spnStatus").text(" - "+a.rvstatus).show():$("#spnStatus").text("").hide(),a.showRegBtn&&"y"===a.showRegBtn?$("#btnCkinForm").data("rid",b.idReserv).show():$("#btnCkinForm").hide(),b.idReserv>0?$("input#btnDelete").show():$("input#btnDelete").hide(),a.resun&&flagAlertMessage(a.resun,!0),$(".ckbdate").datepicker({yearRange:"-99:+00",changeMonth:!0,changeYear:!0,autoSize:!0,maxDate:0,dateFormat:"M d, yy"});var n;createZipAutoComplete($("input.hhk-zipsearch"),"ws_admin.php",n)}function loadResources(a,b){"use strict";var c=reserv;hideAlertMessage();try{a=$.parseJSON(a)}catch(a){flagAlertMessage(a.message,!0),$("form#form1").remove()}if(a.error&&(a.gotopage&&window.open(a.gotopage,"_self"),flagAlertMessage(a.error,!0),$("form#form1").remove()),a.xfer){var e=$("#xform");if(e.children("input").remove(),e.prop("action",a.xfer),a.paymentId&&""!=a.paymentId)e.append($('<input type="hidden" name="PaymentID" value="'+a.paymentId+'"/>'));else{if(!a.cardId||""==a.cardId)return void flagAlertMessage("PaymentId and CardId are missing!",!0);e.append($('<input type="hidden" name="CardID" value="'+a.cardId+'"/>'))}e.submit()}return a.warning&&flagAlertMessage(a.warning,!0),a.idReserv&&(c.idReserv=parseInt(a.idReserv,10)),"Saving >>>>"===$("#btnDone").val()&&$("#btnDone").val(b),a&&injectSlot(a),a.resCh?void resvPicker(a):void(a.receipt&&""!==a.receipt&&showReceipt("#pmtRcpt",a.receipt,"Payment Receipt"))}function loadGuest(a,b,c,d){"use strict";var e=reserv,f=a.id,g="pg";if(hideAlertMessage(),b&&""!=b||(b="g"),"p"==b&&(g="h_"),e.role=b,e.patStaying=d,f>0)for(var h=0;h<e.members.length;h++){var i=e.members[h];if(i.idName==f&&"p"===b&&i.isPatient===!1)return flagAlertMessage("To make the guest also the "+e.patientLabel+", set this Guest's "+e.patientLabel+" Relationship to "+e.patientLabel+".",!0),void $("#pgselPatRel").addClass("ui-state-highlight")}var j={cmd:"getResv",id:f,rid:e.idReserv,idPrefix:g,idPsg:c,role:b,patStay:d};$.getJSON("ws_ckin.php",j,function(a){var b=reserv;if(!a)return void alert("Bad Reply from Server");if(a.error)return a.gotopage&&window.open(a.gotopage,"_self"),void flagAlertMessage(a.error,!0);if(a.warning&&flagAlertMessage(a.warning,!0),a.resCh)return void resvPicker(a);if(a.choosePsg)return b.idGuest=a.idGuest,void psgChooser(a);if(injectSlot(a),a.static&&"y"===a.static)$("input#btnDone").hide(),$("input#btnDelete").show();else{if($("input#btnDone").show(),b.idReserv>0&&$("input#btnDelete").show(),a.patient&&""!==a.patient){var c=$("div#patientSection #h_idName").val(),d=parseInt(""==c?0:c,10);if(isNaN(d)===!1&&d>-1){var e=new Mpanel("h_",d);e.isPatient=!0,e.isPG=!1,b.members.push(e)}}if(null!==a.idName){var f=parseInt(a.idName,10);if(isNaN(f)===!1&&f>-1){var g=new Mpanel(a.idPrefix,f);g.isPG=!0,b.members.push(g)}}}$("input#gstSearch").val("")})}function psgChooser(a){"use strict";var b=reserv;$("#psgDialog").children().remove().end().append($(a.choosePsg)).dialog("option","buttons",{Open:function(){return 0==$("#cbpstayy").prop("checked")&&0==$("#cbpstayn").prop("checked")?($("#spnstaymsg").text("Choose Yes or No"),void $(".pstaytd").addClass("ui-state-highlight")):(b.idPsg=$("#psgDialog input[name=cbselpsg]:checked").val(),loadGuest({id:b.idGuest},b.role,b.idPsg,$("#cbpstayy").prop("checked")),void $("#psgDialog").dialog("close"))},Cancel:function(){$("#gstSearch").val(""),$("#psgDialog").dialog("close")}}).dialog("open")}function resvPicker(a){"use strict";var b=reserv,c=$("#resDialog");c.children().remove(),c.append($(a.resCh)),c.children().find("input:button").button(),$("#resDialog .hhk-checkinNow").click(function(){window.open("CheckIn.php?rid="+$(this).data("rid")+"&gid="+a.id,"_self")});var d={New:function(){b.idReserv=-1,$(this).dialog("close"),loadGuest(a,b.role,a.idPsg,b.patStaying)},Exit:function(){$(this).dialog("close")}};c.dialog("option","buttons",d),c.dialog("option","title",a.title),c.dialog("open")}function verifyDone(a){"use strict";var b=a;hideAlertMessage();var c=!1;if("c"==$("#selResvStatus").val()||"td"==$("#selResvStatus").val()||"ns"==$("#selResvStatus").val())return!0;if(0===b.members.length)return flagAlertMessage("Use 'Add Guest' to enter a Guest.",!0,0),$("#gstSearch").addClass("ui-state-highlight").show("blind"),!1;if($("#hospitalSection").find(".ui-state-error").each(function(){$(this).removeClass("ui-state-error")}),$("#selHospital").length>0&&$("#hospitalSection:visible").length>0&&""==$("#selHospital").val())return $("#selHospital").addClass("ui-state-error"),flagAlertMessage("Select a hospital.",!0,0),$("#divhospDetail").show("blind"),$("#divhospHdr").removeClass("ui-corner-all").addClass("ui-corner-top"),!1;$("#divhospDetail").hide("blind"),$("#divhospHdr").removeClass("ui-corner-top").addClass("ui-corner-all"),$("#guestAccordion").find(".ui-state-error").each(function(){$(this).removeClass("ui-state-error")});for(var d=0;d<a.members.length;d++){var f,g,e=a.members[d],h=$("#"+e.idPrefix+"memMsg");"h_"===e.idPrefix&&(c=!0),h.text("");var i=!1,j=$("span#"+e.idPrefix+"hdrFirstName").text()+" "+$("span#"+e.idPrefix+"hdrLastName").text();if(""==$("#"+e.idPrefix+"txtFirstName").val()&&($("#"+e.idPrefix+"txtFirstName").addClass("ui-state-error"),i=!0),""==$("#"+e.idPrefix+"txtLastName").val()&&($("#"+e.idPrefix+"txtLastName").addClass("ui-state-error"),i=!0),i)return flagAlertMessage("Enter a first and last name for the "+("h_"===e.idPrefix?b.patientLabel:"Primary Guest")+".",!0),h.text("Incomplete Name"),$("#"+e.idPrefix+"divGstpnl").show("blind"),$("#"+e.idPrefix+"divGsthdr").removeClass("ui-corner-all").addClass("ui-corner-top"),!1;if($("#"+e.idPrefix+"incomplete").prop("checked")===!1&&($("."+e.idPrefix+"hhk-addr-val").each(function(){""===$(this).val()&&($(this).hasClass("bfh-states")||(h.text("Incomplete Address"),$(this).addClass("ui-state-error"),i=!0))}),i))return flagAlertMessage(("h_"===e.idPrefix?b.patientLabel:"Primary Guest")+" ("+j+") is missing some or all of their address.",!0),$("#"+e.idPrefix+"divGstpnl").show("blind"),$("#"+e.idPrefix+"divGsthdr").removeClass("ui-corner-all").addClass("ui-corner-top"),!1;if(""==$("#"+e.idPrefix+"selPatRel").val())return $("#"+e.idPrefix+"selPatRel").addClass("ui-state-error"),h.text("Set Primary Guest - "+b.patientLabel+" Relationship"),flagAlertMessage("Primary Guest ("+j+") is missing their relationship to the "+b.patientLabel+".",!0),$("#"+e.idPrefix+"divGstpnl").show("blind"),$("#"+e.idPrefix+"divGsthdr").removeClass("ui-corner-all").addClass("ui-corner-top"),!1;if("slf"==$("#"+e.idPrefix+"selPatRel").val()&&(c=!0),$("#"+e.idPrefix+"gstDate").length>0){if(""==$("#"+e.idPrefix+"gstDate").val())return $("#"+e.idPrefix+"gstDate").addClass("ui-state-error"),h.text("Enter guest check in date."),flagAlertMessage(("h_"===e.idPrefix?b.patientLabel:"Primary Guest")+" ("+j+") is missing their check-in date.",!0),!1;if(f=new Date($("#"+e.idPrefix+"gstDate").val()),isNaN(f.getTime()))return $("#"+e.idPrefix+"gstDate").addClass("ui-state-error"),h.text("Guest check-in date error."),flagAlertMessage(("h_"===e.idPrefix?b.patientLabel:"Primary Guest")+" ("+j+") is missing their check-in date.",!0),!1}if($("#"+e.idPrefix+"gstCoDate").length>0){if(""==$("#"+e.idPrefix+"gstCoDate").val())return $("#"+e.idPrefix+"gstCoDate").addClass("ui-state-error"),h.text("Enter guest check out date."),flagAlertMessage(("h_"===e.idPrefix?b.patientLabel:"Primary Guest")+" ("+j+") is missing their Expected Departure date.  Are they staying forever?",!0),!1;if(g=new Date($("#"+e.idPrefix+"gstCoDate").val()),isNaN(g.getTime()))return $("#"+e.idPrefix+"gstCoDate").addClass("ui-state-error"),h.text("Guest Expected Departure date error."),flagAlertMessage(("h_"===e.idPrefix?b.patientLabel:"Primary Guest")+" ("+j+") is missing their Expected Departure date.  Are they staying forever?",!0),!1;if(f>g)return $("#"+e.idPrefix+"gstDate").addClass("ui-state-error"),h.text("Check in date is after check out date."),flagAlertMessage(("h_"===e.idPrefix?b.patientLabel:"Primary Guest")+" ("+j+") check in date is after their expected departure date.  (Real life is a causal system.)",!0),!1}$("#"+e.idPrefix+"divGstpnl").hide("blind"),$("#"+e.idPrefix+"divGsthdr").removeClass("ui-corner-top").addClass("ui-corner-all")}return c!==!1||(flagAlertMessage("A "+b.patientLabel+" is not selected",!0),!1)}function Mpanel(a,b){var c=this;c.idPrefix=a,c.isPG,c.isPatient,c.idName=b}function Reserv(){"use strict";var a=this;a.idReserv,a.members=[],a.idPsg=0,a.adrPurpose="1",a.gpnl,a.Total=0,a.rateList,a.isFixed,a.resources,a.visitFees,a.patStaying,a.patAsGuest,a.role,a.patSection}$(document).ready(function(){"use strict";function c(a){loadGuest(a,"g",b.idPsg,b.patStaying)}function d(a){b.patAsGuest?($("#hhk-patPromptQuery").text("Will "+a.fullName+" be staying at the House for at least one night?"),$("#patientPrompt").dialog("option","buttons",{Yes:function(){loadGuest(a,"p",b.idPsg,!0),$("#patientPrompt").dialog("close")},No:function(){loadGuest(a,"p",b.idPsg,!1),$("#patientPrompt").dialog("close")}}).dialog("open")):loadGuest(a,"p",b.idPsg,!1)}var b=reserv;$.ajaxSetup({beforeSend:function(){$("body").css("cursor","wait")},complete:function(){$("body").css("cursor","auto")},cache:!1}),$(window).bind("beforeunload",function(){if("Saving >>>>"!=$("#btnDone").val()){var a=!1;return $("#guestAccordion").find("input[type='text']").not(".ignrSave").each(function(){$(this).val()!==$(this).prop("defaultValue")&&(a=!0)}),$("#rescList").find("input[type='checkbox']").each(function(){$(this).prop("checked")!=$(this).prop("defaultChecked")&&(a=!0)}),$("#rescList").find("select").not(".ignrSave").each(function(){$(this).children("option").each(function(){this.defaultSelected!=this.selected&&(a=!0)})}),a===!0?"You have unsaved changes.":void 0}}),$("#contentDiv").css("margin-top",$("#global-nav").css("height")),$("#btnDone, #btnCkinForm, #btnDelete").button(),$("#btnCkinForm").click(function(){$(this).data("rid")>0&&window.open("ShowRegForm.php?rid="+$(this).data("rid"),"_blank")}),$("#btnDelete").click(function(){if("Deleting >>>>"!=$(this).val()&&confirm("Delete this "+resvTitle+"?")){var a="&cmd=delResv&rid="+b.idReserv;$(this).val("Deleting >>>>"),$.post("ws_ckin.php",a,function(a){try{a=$.parseJSON(a)}catch(a){flagAlertMessage(a.message,!0),$("form#form1").remove()}a.error&&(a.gotopage&&window.open(a.gotopage,"_self"),flagAlertMessage(a.error,!0),$("form#form1").remove()),$("#btnDelete").val("Delete"),a.warning&&flagAlertMessage(a.warning,!0),a.result&&($("form#form1").remove(),flagAlertMessage(a.result+' <a href="register.php">Continue</a>',!0))})}}),$("#pmtRcpt").dialog({autoOpen:!1,resizable:!0,modal:!0,title:"Payment Receipt"}),$("#confirmDialog").dialog({autoOpen:!1,resizable:!0,width:850,modal:!0,title:"Confirmation Form",close:function(){$("div#submitButtons").show(),$("#confirmDialog").children().remove()},buttons:{"Send Email":function(){$.post("ws_ckin.php",{cmd:"confrv",rid:$("#btnShowCnfrm").data("rid"),eml:"1",eaddr:$("#confEmail").val(),amt:$("#spnAmount").text(),notes:$("#tbCfmNotes").val()},function(a){a=$.parseJSON(a),a.gotopage&&window.open(a.gotopage,"_self"),flagAlertMessage(a.mesg,!0)}),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),$("#faDialog").dialog({autoOpen:!1,resizable:!0,width:650,modal:!0,title:"Income Chooser",close:function(a,b){$("div#submitButtons").show()},open:function(a,b){$("div#submitButtons").hide()},buttons:{Save:function(){$.post("ws_ckin.php",$("#formf").serialize()+"&cmd=savefap&rid="+b.idReserv,function(a){try{a=$.parseJSON(a)}catch(a){return void alert("Bad JSON Encoding")}if(a.gotopage&&window.open(a.gotopage,"_self"),a.rstat&&1==a.rstat){var b=$("#selRateCategory");a.rcat&&""!=a.rcat&&b.length>0&&(b.val(a.rcat),b.change())}}),$(this).dialog("close")},Exit:function(){$(this).dialog("close")}}}),$("#psgDialog").dialog({autoOpen:!1,resizable:!0,width:500,modal:!0,title:b.patientLabel+" Support Group Chooser",close:function(a,b){$("div#submitButtons").show()},open:function(a,b){$("div#submitButtons").hide()}}),$("#activityDialog").dialog({autoOpen:!1,resizable:!0,width:900,modal:!0,title:"Reservation Activity Log",close:function(a,b){$("div#submitButtons").show()},open:function(a,b){$("div#submitButtons").hide()},buttons:{Exit:function(){$(this).dialog("close")}}}),$("#resDialog").dialog({autoOpen:!1,resizable:!0,width:900,modal:!0,title:"Reservtion Chooser",buttons:{Exit:function(){$(this).dialog("close")}}}),$("#patientPrompt").dialog({autoOpen:!1,resizable:!0,width:470,modal:!0,title:""}),""!==pmtMkup&&$("#paymentMessage").html(pmtMkup).show("pulsate",{},400),""!==rctMkup&&showReceipt("#pmtRcpt",rctMkup,"Payment Receipt"),$.datepicker.setDefaults({yearRange:"-0:+02",changeMonth:!0,changeYear:!0,autoSize:!0,dateFormat:"M d, yy"}),$("div#guestAccordion, div#patientSection").on("click",".hhk-addrCopy",function(){var a=$(this).attr("name"),c="h_";"h_"===a&&(c="pg"),""!=$("#"+c+"adrcity1").val()&&($("#"+a+"adraddress1"+b.adrPurpose).val($("#"+c+"adraddress11").val()),$("#"+a+"adraddress2"+b.adrPurpose).val($("#"+c+"adraddress21").val()),$("#"+a+"adrcity"+b.adrPurpose).val($("#"+c+"adrcity1").val()),$("#"+a+"adrcounty"+b.adrPurpose).val($("#"+c+"adrcounty1").val()),$("#"+a+"adrstate"+b.adrPurpose).val($("#"+c+"adrstate1").val()),$("#"+a+"adrcountry"+b.adrPurpose).val($("#"+c+"adrcountry1").val()),$("#"+a+"adrzip"+b.adrPurpose).val($("#"+c+"adrzip1").val()))}),$("div#guestAccordion, div#patientSection").on("click",".hhk-addrErase",function(){var a=$(this).attr("name");$("#"+a+"adraddress11").val(""),$("#"+a+"adraddress21").val(""),$("#"+a+"adrcity1").val(""),$("#"+a+"adrcounty1").val(""),$("#"+a+"adrstate1").val(""),$("#"+a+"adrcountry1").val(""),$("#"+a+"adrzip1").val(""),$("#"+a+"adrbad1").prop("checked",!1)}),verifyAddrs("div#guestAccordion, #hospitalSection, div#patientSection"),$("div#guestAccordion, div#patientSection").on("change","input.hhk-lastname",function(){$("span#"+$(this).data("prefix")+"hdrLastName").text(" "+$(this).val())}),$("div#guestAccordion, div#patientSection").on("change","input.hhk-firstname",function(){$("span#"+$(this).data("prefix")+"hdrFirstName").text(" "+$(this).val())}),$("div#hospitalSection").on("click",".hhk-agentSearch, .hhk-docSearch",function(){$("#txtAgentSch").val(""),$("#txtDocSch").val("")}),$("div#hospitalSection").on("change","#selHospital, #selAssoc",function(){var a=$("#selAssoc").find("option:selected").text();""!=a&&(a+="/ "),$("span#spnHospName").text(a+$("#selHospital").find("option:selected").text())}),$("#closeDP").click(function(){$("#dtpkrDialog").hide()}),$("#btnDone").click(function(){if("Saving >>>>"!=$(this).val()&&($("#divPayMessage").remove(),verifyDone(b)===!0)){var a=$(this).val(),c="&cmd=makeResv&idPsg="+b.idPsg+"&rid="+b.idReserv+"&patStay="+b.patStaying;$(this).val("Saving >>>>"),$.post("ws_ckin.php",$("#form1").serialize()+c,function(b){loadResources(b,a)})}}),createAutoComplete($("#gstSearch"),3,{cmd:"role"},c),createAutoComplete($("#gstphSearch"),4,{cmd:"role"},c),$("#gstSearch").keypress(function(a){$(this).removeClass("ui-state-highlight")}),$("#gstSearch").focus(),createAutoComplete($("#h_Search"),3,{cmd:"role"},d),createAutoComplete($("#h_phSearch"),4,{cmd:"role"},d),b.gpnl&&""!==b.gpnl&&loadGuest({id:b.gpnl},"g",b.idPsg)});
