function getMember(e,t,a){"use strict";function i(e,t,a,i){if(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}if(e.error)return e.gotopage&&window.open(e.gotopage),void flagAlertMessage(e.error,!0);if($("#txtAddGuest").val(""),e.addtguest){$("#keysfees").dialog("close"),$("#diagAddGuest").remove();var s=$('<div style="font-size:.9em;"/>').append($(e.addtguest.memMkup)),d=$('<div style="min-height:30px; padding:3px;font-size:.9em;"/>').append($(e.addtguest.txtHdr)).append($('<span id="'+e.addtguest.idPrefix+'memMsg" style="color: red; margin-right:20px;margin-left:20px;margin-top:7px;"></span>')).addClass("ui-widget-header ui-state-default ui-corner-top"),o=$('<div id="diagAddGuest"/>').append($('<form id="fAddGuest"  style="font-size:.9em;"/>').append(d).append(s));return o.dialog({autoOpen:!1,resizable:!0,width:950,modal:!0,title:"Additional Guest",buttons:{Save:function(){n(t,a,i),$(this).dialog("close")},Cancel:function(){$(this).dialog("close")}}}),$("div#diagAddGuest .ckdate").datepicker(),o.find("select.bfh-countries").each(function(){var e=$(this);e.bfhcountries(e.data())}),o.find("select.bfh-states").each(function(){var e=$(this);e.bfhstates(e.data())}),$("#diagAddGuest #qphEmlTabs").tabs(),verifyAddrs("#diagAddGuest"),e.addr&&$("#diagAddGuest").on("click",".hhk-addrCopy",function(){$("#qadraddress11").val(e.addr.adraddress1),$("#qadraddress21").val(e.addr.adraddress2),$("#qadrcity1").val(e.addr.adrcity),$("#qadrstate1").val(e.addr.adrstate),$("#qadrzip1").val(e.addr.adrzip)}),$("#diagAddGuest").on("click",".hhk-addrErase",function(){$("#qadraddress11").val(""),$("#qadraddress21").val(""),$("#qadrcity1").val(""),$("#qadrstate1").val(""),$("#qadrzip1").val(""),$("#qadrbad1").prop("checked",!1)}),void o.dialog("open")}}else alert("Bad Reply from Server")}function n(e,t,a){$.post("ws_ckin.php",$("#fAddGuest").serialize()+"&cmd=addStay&id="+e+"&vid="+t+"&span="+a,function(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}e.error&&(e.gotopage&&window.open(e.gotopage),flagAlertMessage(e.error,!0)),e.stays&&""!==e.stays&&($("#keysfees").dialog("open"),$("#divksStays").children().remove(),$("#divksStays").append($(e.stays)))})}$.post("ws_ckin.php",{cmd:"addStay",vid:t,id:e.id,span:a},function(n){i(n,e.id,t,a)})}function viewVisit(e,t,a,i,n,s,d){"use strict";$.post("ws_ckin.php",{cmd:"visitFees",idVisit:t,idGuest:e,action:n,span:s,ckoutdt:d},function(d){if(d){try{d=$.parseJSON(d)}catch(e){return void alert("Parser error - "+e.message)}if(d.error)return d.gotopage?void window.location.assign(d.gotopage):void flagAlertMessage(d.error,!0);var o=$("#keysfees");if(o.children().remove(),o.append($('<div class="hhk-panel hhk-tdbox hhk-visitdialog" style="font-size:0.8em;"/>').append($(d.success))),o.find(".ckdate").datepicker({yearRange:"-07:+01",changeMonth:!0,changeYear:!0,autoSize:!0,numberOfMonths:1,maxDate:0,dateFormat:"M d, yy",onSelect:function(){this.lastShown=(new Date).getTime()},beforeShow:function(){var e=(new Date).getTime();return void 0===this.lastShown||e-this.lastShown>500},onClose:function(){$(this).change()}}),o.find(".ckdateFut").datepicker({yearRange:"-02:+01",changeMonth:!0,changeYear:!0,autoSize:!0,numberOfMonths:1,minDate:0,dateFormat:"M d, yy",onSelect:function(){this.lastShown=(new Date).getTime()},beforeShow:function(){var e=(new Date).getTime();return void 0===this.lastShown||e-this.lastShown>500},onClose:function(){$(this).change()}}),o.css("background-color","#fff"),"ref"===n&&o.css("background-color","#FEFF9B"),$(".hhk-extVisitSw").length>0&&($(".hhk-extVisitSw").change(function(){this.checked?$(".hhk-extendVisit").show("fade"):$(".hhk-extendVisit").hide("fade")}),$(".hhk-extVisitSw").change()),$("#rateChgCB").length>0){var r=$("#chgRateDate");r.datepicker({changeMonth:!0,changeYear:!0,autoSize:!0,numberOfMonths:1,dateFormat:"M d, yy",maxDate:new Date(d.end),minDate:new Date(d.start)}),r.change(function(){""!==this.value&&r.siblings("input#rbReplaceRate").prop("checked",!0)}),$("input#rbReplaceRate").change(function(){this.checked&&""===r.val()?r.val($.datepicker.formatDate("M d, yy",new Date)):r.val("")}),$("#rateChgCB").change(function(){this.checked?($(".changeRateTd").show("fade"),$("#showRateTd").hide("fade")):($(".changeRateTd").hide("fade"),$("#showRateTd").show("fade"))}),$("#rateChgCB").change()}$("#spnExPay").hide(),isCheckedOut=!1;var h=0,c=0;if($("#spnCfBalDue").length>0&&(h=parseFloat($("#spnCfBalDue").data("bal")),c=parseFloat($("#spnCfBalDue").data("vfee")),h-=c),$("input.hhk-ckoutCB").length>0)$("#tblStays").on("change","input.hhk-ckoutCB",function(){var d=!0,r=1,l=new Date;if(!1===this.checked?$(this).next().val(""):""===$(this).next().val()&&$(this).next().val($.datepicker.formatDate("M d, yy",new Date)),$("input.hhk-ckoutCB").each(function(){if(!1===this.checked)d=!1;else if(""!=$(this).next().val()){var e=new Date($(this).next().val());e.getTime()>l.getTime()?($(this).next().val(""),d=!1):e.getTime()>r&&(r=e.getTime())}}),!0===d){isCheckedOut=!0;var p=(l=new Date).getFullYear()+"-"+l.getMonth()+"-"+l.getDate(),u=new Date(r),g=u.getFullYear()+"-"+u.getMonth()+"-"+u.getDate();if(u.getTime()>l.getTime())return!1;if(p!==g&&"ref"!==n)return o.children().remove(),o.dialog("option","buttons",{}),o.append($('<div class="hhk-panel hhk-tdbox hhk-visitdialog"/>').append($('<div class="ui-autocomplete-loading" style="width:5em;">Loading</div>'))),void viewVisit(e,t,a,i,"ref",s,u.toDateString());$(".hhk-kdrow").hide("fade"),$(".hhk-finalPayment").show("fade");var f=parseFloat($("#kdPaid").data("amt"));isNaN(f)&&(f=0),f>0?($("#DepRefundAmount").val((0-f).toFixed(2).toString()),$(".hhk-refundDeposit").show("fade")):($("#DepRefundAmount").val(""),$(".hhk-refundDeposit").hide("fade")),h<0?($("#guestCredit").val(h.toFixed(2).toString()),$("#feesCharges").val(""),$(".hhk-RoomCharge").hide(),$(".hhk-GuestCredit").show(),$("#visitFeeCb").length>0&&Math.abs(h)>=c&&$("#visitFeeCb").prop("checked",!0).prop("disabled",!0)):($("#feesCharges").val(h.toFixed(2).toString()),$("#guestCredit").val(""),$(".hhk-GuestCredit").hide(),$(".hhk-RoomCharge").show()),$("input#cbFinalPayment").change()}else{if("ref"===n)return o.children().remove(),o.dialog("option","buttons",{}),o.append($('<div class="hhk-panel hhk-tdbox hhk-visitdialog"/>').append($('<div class="ui-autocomplete-loading" style="width:5em;">Loading</div>'))),void viewVisit(e,t,a,i,"",s);isCheckedOut=!1,$(".hhk-finalPayment").hide("fade"),$(".hhk-GuestCredit").hide(),$(".hhk-RoomCharge").hide(),$("#feesCharges").val(""),$("#guestCredit").val(""),$(".hhk-refundDeposit").hide("fade"),$("#DepRefundAmount").val(""),$("input#cbFinalPayment").prop("checked",!1),$("input#cbFinalPayment").change()}}),$("#tblStays").on("change","input.hhk-ckoutDate",function(){""!=$(this).val()?$(this).prev().prop("checked",!0):$(this).prev().prop("checked",!1),$("input.hhk-ckoutCB").change()}),$("#cbCoAll").button().click(function(){$("input.hhk-ckoutCB").each(function(){$(this).prop("checked",!0)}),$("input.hhk-ckoutCB").change()}),$("input.hhk-ckoutCB").change();else if($("#cbFinalPayment").length>0){isCheckedOut=!0,$(".hhk-finalPayment").show();var l=parseFloat($("#kdPaid").data("amt"));isNaN(l)?($("#DepRefundAmount").val(""),$(".hhk-refundDeposit").hide("fade")):($("#DepRefundAmount").val((0-l).toFixed(2).toString()),$(".hhk-refundDeposit").show("fade")),h<0?($("#guestCredit").val(h.toFixed(2).toString()),$("#feesCharges").val(""),$(".hhk-RoomCharge").hide(),$(".hhk-GuestCredit").show()):($("#feesCharges").val(h.toFixed(2).toString()),$("#guestCredit").val(""),$(".hhk-GuestCredit").hide(),$(".hhk-RoomCharge").show()),o.css("background-color","#F2F2F2")}setupPayments(d.resc,$("#selResource"),$("#selRateCategory"),t,$("#pmtRcpt"));var p=$("#btnFapp");p.length>0&&(p.button(),p.click(function(){getIncomeDiag(p.data("rid"))})),$("#guestAdd").click(function(){$(".hhk-addGuest").toggle()}),$("#btnAddGuest").length>0&&($("#btnAddGuest").button(),$("#btnAddGuest").click(function(){window.location.assign("CheckIn.php?rid="+$(this).data("rid"))})),createAutoComplete($("#txtAddGuest"),3,{cmd:"role"},function(e){getMember(e,t,s)}),$("#selRateCategory").length>0&&($("#selRateCategory").change(function(){"x"==$(this).val()?($(".hhk-fxFixed").show("fade"),$(".hhk-fxAdj").hide("fade")):($(".hhk-fxFixed").hide("fade"),$(".hhk-fxAdj").show("fade"))}),$("#selRateCategory").change()),o.dialog("option","buttons",a),o.dialog("option","title",i),o.dialog("option","width",.8*$(window).width()),o.dialog("option","height",$(window).height()),o.dialog("open")}})}function saveFees(e,t,a,i,n){"use strict";var s=[],d=[],o=!1,r={cmd:"saveFees",idGuest:e,idVisit:t,span:a,rtntbl:!0===i?"1":"0",pbp:n};if($("input.hhk-expckout").each(function(){var e=$(this).attr("id").split("_");e.length>0&&(r[e[0]+"["+e[1]+"]"]=$(this).val())}),$("input.hhk-stayckin").each(function(){var e=$(this).attr("id").split("_");e.length>0&&(r[e[0]+"["+e[1]+"]"]=$(this).val())}),$("#undoCkout").length>0&&$("#undoCkout").prop("checked")&&(o=!0),(!isCheckedOut||!1!==verifyBalDisp()||!1!==o)&&!1!==verifyAmtTendrd()){if($("input.hhk-ckoutCB").each(function(){if(this.checked){var e=$(this).attr("id").split("_");if(e.length>0){r["stayActionCb["+e[1]+"]"]="on";var t=$("#stayCkOutDate_"+e[1]).datepicker("getDate");if(t){var a=new Date;t.setHours(a.getHours()),t.setMinutes(a.getMinutes())}else t=new Date;r["stayCkOutDate["+e[1]+"]"]=t.toJSON(),s.push($(this).data("nm")+", "+t.toDateString())}}}),$("input.hhk-removeCB").each(function(){if(this.checked){var e=$(this).attr("id").split("_");e.length>0&&(r[e[0]+"["+e[1]+"]"]="on",d.push($(this).data("nm")))}}),s.length>0){var h="Check Out:\n"+s.join("\n");if("1"===$("#EmptyExtend").val()&&$("#extendCb").prop("checked")&&s.length>=$("#currGuests").val()&&(h+="\nand extend the visit for "+$("#extendDays").val()+" days"),!1===confirm(h+"?"))return void $("#keysfees").dialog("close")}if(d.length>0&&!1===confirm("Remove:\n"+d.join("\n")+"?"))$("#keysfees").dialog("close");else{if($("#keyDepAmt").removeClass("ui-state-highlight"),$("#resvResource").length>0&&"0"!=$("#resvResource").val()){$("#resvChangeDate").removeClass("ui-state-highlight"),$("#chgmsg").text("");var c=$('<span id="chgmsg"/>');if(""==$("#resvChangeDate").val())return c.text("Enter a change room date."),c.css("color","red"),$("#moveTable").prepend($("<tr/>").append($('<td colspan="2">').append(c))),void $("#resvChangeDate").addClass("ui-state-highlight");var l=$("#resvChangeDate").datepicker("getDate");if(!l)return c.text("Something wrong with the change room date."),c.css("color","red"),$("#moveTable").prepend($("<tr/>").append($('<td colspan="2">').append(c))),void $("#resvChangeDate").addClass("ui-state-highlight");if(l>new Date)return c.text("Change room date can't be in the future."),c.css("color","red"),$("#moveTable").prepend($("<tr/>").append($('<td colspan="2">').append(c))),void $("#resvChangeDate").addClass("ui-state-highlight");if(!1===confirm("Change Rooms?"))return void $("#keysfees").dialog("close")}$(".hhk-feeskeys").each(function(){if("checkbox"===$(this).attr("type"))!1!==this.checked&&(r[$(this).attr("id")]="on");else if($(this).hasClass("ckdate")){var e=$(this).datepicker("getDate");r[$(this).attr("id")]=e?e.toJSON():""}else"radio"===$(this).attr("type")?!1!==this.checked&&(r[$(this).attr("id")]=this.value):r[$(this).attr("id")]=this.value}),$("#keysfees").css("background-color","white"),$("#keysfees").dialog("close"),$.post("ws_ckin.php",r,function(e){try{e=$.parseJSON(e)}catch(e){return void alert("Parser error - "+e.message)}e.error&&(e.gotopage&&window.location.assign(e.gotopage),flagAlertMessage(e.error,!0)),"undefined"!=typeof refreshdTables&&refreshdTables(e),paymentReply(e,!0)})}}}function paymentReply(e,t){"use strict";if(e){if(e.hostedError)flagAlertMessage(e.hostedError,!0);else if(e.xfer&&$("#xform").length>0){var a=$("#xform");if(a.children("input").remove(),a.prop("action",e.xfer),e.paymentId&&""!=e.paymentId)a.append($('<input type="hidden" name="PaymentID" value="'+e.paymentId+'"/>'));else{if(!e.cardId||""==e.cardId)return void flagAlertMessage("PaymentId and CardId are missing!",!0);a.append($('<input type="hidden" name="CardID" value="'+e.cardId+'"/>'))}a.submit()}e.success&&""!==e.success&&(flagAlertMessage(e.success,!1),$("#calendar").length>0&&t&&$("#calendar").hhkCalendar("refetchEvents")),e.receipt&&""!==e.receipt&&showReceipt("#pmtRcpt",e.receipt,"Payment Receipt"),e.invoiceNumber&&""!==e.invoiceNumber&&window.open("ShowInvoice.php?invnum="+e.invoiceNumber)}}function updateVisitMessage(e,t){$("#h3VisitMsgHdr").text(e),$("#spnVisitMsg").text(t),$("#visitMsg").effect("pulsate")}var isCheckedOut=!1;
